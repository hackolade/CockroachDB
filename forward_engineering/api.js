"use strict";var ht=Object.defineProperty;var nu=Object.getOwnPropertyDescriptor;var su=Object.getOwnPropertyNames;var iu=Object.prototype.hasOwnProperty;var i=(t,e)=>ht(t,"name",{value:e,configurable:!0});var ou=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),au=(t,e)=>{for(var r in e)ht(t,r,{get:e[r],enumerable:!0})},cu=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of su(e))!iu.call(t,s)&&s!==r&&ht(t,s,{get:()=>e[s],enumerable:!(n=nu(e,s))||n.enumerable});return t};var uu=t=>cu(ht({},"__esModule",{value:!0}),t);var Kt=A((qy,Bs)=>{"use strict";var lu=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",o=""){e.progress({message:n,containerName:s,entityName:o})},error(n){e.log("error",pu(n),t)}}),"createLogger"),pu=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Bs.exports={createLogger:lu}});var Vt=A($s=>{"use strict";$s.parse=function(t,e){return new Gt(t,e).parse()};var yt=class yt{constructor(e,r){this.source=e,this.transform=r||mu,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new yt(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(yt,"ArrayParser");var Gt=yt;function mu(t){return t}i(mu,"identity")});var Ht=A(($y,Us)=>{var du=Vt();Us.exports={create:function(t,e){return{parse:function(){return du.parse(t,e)}}}}});var Vs=A((Uy,Gs)=>{"use strict";var fu=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,hu=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,yu=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,gu=/^-?infinity$/;Gs.exports=i(function(e){if(gu.test(e))return Number(e.replace("i","I"));var r=fu.exec(e);if(!r)return Eu(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=Ks(s));var o=parseInt(r[2],10)-1,a=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var d,f=_u(e);return f!=null?(d=new Date(Date.UTC(s,o,a,c,l,u,p)),Qt(s)&&d.setUTCFullYear(s),f!==0&&d.setTime(d.getTime()-f)):(d=new Date(s,o,a,c,l,u,p),Qt(s)&&d.setFullYear(s)),d},"parseDate");function Eu(t){var e=hu.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=Ks(r));var s=parseInt(e[2],10)-1,o=e[3],a=new Date(r,s,o);return Qt(r)&&a.setFullYear(r),a}}i(Eu,"getDate");function _u(t){if(t.endsWith("+00"))return 0;var e=yu.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(_u,"timeZoneOffset");function Ks(t){return-(t-1)}i(Ks,"bcYearToNegativeYear");function Qt(t){return t>=0&&t<100}i(Qt,"is0To99")});var Qs=A((Gy,Hs)=>{Hs.exports=Tu;var Su=Object.prototype.hasOwnProperty;function Tu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Su.call(r,n)&&(t[n]=r[n])}return t}i(Tu,"extend")});var js=A((Hy,Ys)=>{"use strict";var Cu=Qs();Ys.exports=Be;function Be(t){if(!(this instanceof Be))return new Be(t);Cu(this,Mu(t))}i(Be,"PostgresInterval");var Au=["seconds","minutes","hours","days","months","years"];Be.prototype.toPostgres=function(){var t=Au.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var Nu={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},bu=["years","months","days"],Iu=["hours","minutes","seconds"];Be.prototype.toISOString=Be.prototype.toISO=function(){var t=bu.map(r,this).join(""),e=Iu.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+Nu[n]}};var Wt="([+-]?\\d+)",Ou=Wt+"\\s+years?",wu=Wt+"\\s+mons?",vu=Wt+"\\s+days?",Ru="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Pu=new RegExp([Ou,wu,vu,Ru].map(function(t){return"("+t+")?"}).join("\\s*")),Ws={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Du=["hours","minutes","seconds","milliseconds"];function Lu(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Lu,"parseMilliseconds");function Mu(t){if(!t)return{};var e=Pu.exec(t),r=e[8]==="-";return Object.keys(Ws).reduce(function(n,s){var o=Ws[s],a=e[o];return!a||(a=s==="milliseconds"?Lu(a):parseInt(a,10),!a)||(r&&~Du.indexOf(s)&&(a*=-1),n[s]=a),n},{})}i(Mu,"parse")});var Xs=A((Wy,zs)=>{"use strict";zs.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var o=0;o<Math.floor(s/2);++o)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var si=A((jy,ni)=>{var Je=Vt(),et=Ht(),gt=Vs(),Js=js(),ei=Xs();function Et(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Et,"allowNull");function ti(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(ti,"parseBool");function xu(t){return t?Je.parse(t,ti):null}i(xu,"parseBoolArray");function qu(t){return parseInt(t,10)}i(qu,"parseBaseTenInt");function Yt(t){return t?Je.parse(t,Et(qu)):null}i(Yt,"parseIntegerArray");function ku(t){return t?Je.parse(t,Et(function(e){return ri(e).trim()})):null}i(ku,"parseBigIntegerArray");var Fu=i(function(t){if(!t)return null;var e=et.create(t,function(r){return r!==null&&(r=Zt(r)),r});return e.parse()},"parsePointArray"),jt=i(function(t){if(!t)return null;var e=et.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),fe=i(function(t){if(!t)return null;var e=et.create(t);return e.parse()},"parseStringArray"),zt=i(function(t){if(!t)return null;var e=et.create(t,function(r){return r!==null&&(r=gt(r)),r});return e.parse()},"parseDateArray"),Bu=i(function(t){if(!t)return null;var e=et.create(t,function(r){return r!==null&&(r=Js(r)),r});return e.parse()},"parseIntervalArray"),$u=i(function(t){return t?Je.parse(t,Et(ei)):null},"parseByteAArray"),Xt=i(function(t){return parseInt(t,10)},"parseInteger"),ri=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Zs=i(function(t){return t?Je.parse(t,Et(JSON.parse)):null},"parseJsonArray"),Zt=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Uu=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var o=Zt(e);return o.radius=parseFloat(r),o},"parseCircle"),Ku=i(function(t){t(20,ri),t(21,Xt),t(23,Xt),t(26,Xt),t(700,parseFloat),t(701,parseFloat),t(16,ti),t(1082,gt),t(1114,gt),t(1184,gt),t(600,Zt),t(651,fe),t(718,Uu),t(1e3,xu),t(1001,$u),t(1005,Yt),t(1007,Yt),t(1028,Yt),t(1016,ku),t(1017,Fu),t(1021,jt),t(1022,jt),t(1231,jt),t(1014,fe),t(1015,fe),t(1008,fe),t(1009,fe),t(1040,fe),t(1041,fe),t(1115,zt),t(1182,zt),t(1185,zt),t(1186,Js),t(1187,Bu),t(17,ei),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Zs),t(3807,Zs),t(3907,fe),t(2951,fe),t(791,fe),t(1183,fe),t(1270,fe)},"init");ni.exports={init:Ku}});var oi=A((Xy,ii)=>{"use strict";var ue=1e6;function Gu(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",o,a,c,l,u,p;{if(o=e%ue,e=e/ue>>>0,a=4294967296*o+r,r=a/ue>>>0,c=""+(a-ue*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%ue,e=e/ue>>>0,a=4294967296*o+r,r=a/ue>>>0,c=""+(a-ue*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%ue,e=e/ue>>>0,a=4294967296*o+r,r=a/ue>>>0,c=""+(a-ue*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}return o=e%ue,a=4294967296*o+r,c=""+a%ue,n+c+s}i(Gu,"readInt8");ii.exports=Gu});var pi=A((Jy,li)=>{var Vu=oi(),G=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(h,S,y){return h*Math.pow(2,y)+S};var o=r>>3,a=i(function(h){return n?~h&255:h},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=s(0,a(t[o])&c,l));for(var p=e+r>>3,d=o+1;d<p;d++)u=s(u,a(t[d]),8);var f=(e+r)%8;return f>0&&(u=s(u,a(t[p])>>8-f,f)),u},"parseBits"),ui=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=G(t,1),o=G(t,r,1);if(o===0)return 0;var a=1,c=i(function(u,p,d){u===0&&(u=1);for(var f=1;f<=d;f++)a/=2,(p&1<<d-f)>0&&(u+=a);return u},"parsePrecisionBits"),l=G(t,e,r+1,!1,c);return o==Math.pow(2,r+1)-1?l===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,o-n)*l},"parseFloatFromBits"),Hu=i(function(t){return G(t,1)==1?-1*(G(t,15,1,!0)+1):G(t,15,1)},"parseInt16"),ai=i(function(t){return G(t,1)==1?-1*(G(t,31,1,!0)+1):G(t,31,1)},"parseInt32"),Qu=i(function(t){return ui(t,23,8)},"parseFloat32"),Wu=i(function(t){return ui(t,52,11)},"parseFloat64"),Yu=i(function(t){var e=G(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,G(t,16,16)),n=0,s=[],o=G(t,16),a=0;a<o;a++)n+=G(t,16,64+16*a)*r,r/=1e4;var c=Math.pow(10,G(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),ci=i(function(t,e){var r=G(e,1),n=G(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(o){this.usec=o},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),tt=i(function(t){for(var e=G(t,32),r=G(t,32,32),n=G(t,32,64),s=96,o=[],a=0;a<e;a++)o[a]=G(t,32,s),s+=32,s+=32;var c=i(function(u){var p=G(t,32,s);if(s+=32,p==4294967295)return null;var d;if(u==23||u==20)return d=G(t,p*8,s),s+=p*8,d;if(u==25)return d=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var d=[],f;if(u.length>1){var h=u.shift();for(f=0;f<h;f++)d[f]=l(u,p);u.unshift(h)}else for(f=0;f<u[0];f++)d[f]=c(p);return d},"parse");return l(o,n)},"parseArray"),ju=i(function(t){return t.toString("utf8")},"parseText"),zu=i(function(t){return t===null?null:G(t,8)>0},"parseBool"),Xu=i(function(t){t(20,Vu),t(21,Hu),t(23,ai),t(26,ai),t(1700,Yu),t(700,Qu),t(701,Wu),t(16,zu),t(1114,ci.bind(null,!1)),t(1184,ci.bind(null,!0)),t(1e3,tt),t(1007,tt),t(1016,tt),t(1008,tt),t(1009,tt),t(25,ju)},"init");li.exports={init:Xu}});var di=A((tg,mi)=>{mi.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var st=A(nt=>{var Zu=si(),Ju=pi(),el=Ht(),tl=di();nt.getTypeParser=rl;nt.setTypeParser=nl;nt.arrayParser=el;nt.builtins=tl;var rt={text:{},binary:{}};function fi(t){return String(t)}i(fi,"noParse");function rl(t,e){return e=e||"text",rt[e]&&rt[e][t]||fi}i(rl,"getTypeParser");function nl(t,e,r){typeof e=="function"&&(r=e,e="text"),rt[e][t]=r}i(nl,"setTypeParser");Zu.init(function(t,e){rt.text[t]=e});Ju.init(function(t,e){rt.binary[t]=e})});var it=A((sg,Jt)=>{"use strict";Jt.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var $e=st(),sl=$e.getTypeParser(20,"text"),il=$e.getTypeParser(1016,"text");Jt.exports.__defineSetter__("parseInt8",function(t){$e.setTypeParser(20,"text",t?$e.getTypeParser(23,"text"):sl),$e.setTypeParser(1016,"text",t?$e.getTypeParser(1007,"text"):il)})});var ot=A((ig,yi)=>{"use strict";var ol=it();function al(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(al,"escapeElement");function hi(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+hi(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=al(_t(t[r]));return e=e+"}",e}i(hi,"arrayString");var _t=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?ol.parseInputDatesAsUTC?ll(t):ul(t):Array.isArray(t)?hi(t):typeof t=="object"?cl(t,e):t.toString()},"prepareValue");function cl(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),_t(t.toPostgres(_t),e)}return JSON.stringify(t)}i(cl,"prepareObject");function se(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(se,"pad");function ul(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=se(r,4)+"-"+se(t.getMonth()+1,2)+"-"+se(t.getDate(),2)+"T"+se(t.getHours(),2)+":"+se(t.getMinutes(),2)+":"+se(t.getSeconds(),2)+"."+se(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=se(Math.floor(e/60),2)+":"+se(e%60,2),n&&(s+=" BC"),s}i(ul,"dateToString");function ll(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=se(e,4)+"-"+se(t.getUTCMonth()+1,2)+"-"+se(t.getUTCDate(),2)+"T"+se(t.getUTCHours(),2)+":"+se(t.getUTCMinutes(),2)+":"+se(t.getUTCSeconds(),2)+"."+se(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(ll,"dateToStringUTC");function pl(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(pl,"normalizeQueryConfig");var ml=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),dl=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");yi.exports={prepareValue:i(function(e){return _t(e)},"prepareValueWrapper"),normalizeQueryConfig:pl,escapeIdentifier:ml,escapeLiteral:dl}});var Ei=A((ag,gi)=>{"use strict";var at=require("crypto");function er(t){return at.createHash("md5").update(t,"utf-8").digest("hex")}i(er,"md5");function fl(t,e,r){var n=er(e+t),s=er(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(fl,"postgresMd5PasswordHash");function hl(t){return at.createHash("sha256").update(t).digest()}i(hl,"sha256");function yl(t,e){return at.createHmac("sha256",t).update(e).digest()}i(yl,"hmacSha256");async function gl(t,e,r){return at.pbkdf2Sync(t,e,r,32,"sha256")}i(gl,"deriveKey");gi.exports={postgresMd5PasswordHash:fl,randomBytes:at.randomBytes,deriveKey:gl,sha256:hl,hmacSha256:yl,md5:er}});var Ci=A((ug,Ti)=>{var _i=require("crypto");Ti.exports={postgresMd5PasswordHash:_l,randomBytes:El,deriveKey:Cl,sha256:Sl,hmacSha256:Tl,md5:tr};var Si=_i.webcrypto||globalThis.crypto,Ue=Si.subtle,rr=new TextEncoder;function El(t){return Si.getRandomValues(Buffer.alloc(t))}i(El,"randomBytes");async function tr(t){try{return _i.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?rr.encode(t):t,n=await Ue.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(tr,"md5");async function _l(t,e,r){var n=await tr(e+t),s=await tr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(_l,"postgresMd5PasswordHash");async function Sl(t){return await Ue.digest("SHA-256",t)}i(Sl,"sha256");async function Tl(t,e){let r=await Ue.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Ue.sign("HMAC",r,rr.encode(e))}i(Tl,"hmacSha256");async function Cl(t,e,r){let n=await Ue.importKey("raw",rr.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await Ue.deriveBits(s,n,32*8,["deriveBits"])}i(Cl,"deriveKey")});var sr=A((pg,nr)=>{"use strict";var Al=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Al?nr.exports=Ei():nr.exports=Ci()});var Ii=A((mg,bi)=>{"use strict";var Le=sr();function Nl(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=Le.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Nl,"startSession");async function bl(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=wl(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,o="r="+n.nonce+",s="+n.salt+",i="+n.iteration,a="c=biws,r="+n.nonce,c=s+","+o+","+a,l=Buffer.from(n.salt,"base64"),u=await Le.deriveKey(e,l,n.iteration),p=await Le.hmacSha256(u,"Client Key"),d=await Le.sha256(p),f=await Le.hmacSha256(d,c),h=Rl(Buffer.from(p),Buffer.from(f)).toString("base64"),S=await Le.hmacSha256(u,"Server Key"),y=await Le.hmacSha256(S,c);t.message="SASLResponse",t.serverSignature=Buffer.from(y).toString("base64"),t.response=a+",p="+h}i(bl,"continueSession");function Il(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=vl(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(Il,"finalizeSession");function Ol(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Ol,"isPrintableChars");function Ai(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(Ai,"isBase64");function Ni(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(Ni,"parseAttributePairs");function wl(t){let e=Ni(t),r=e.get("r");if(r){if(!Ol(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!Ai(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let o=parseInt(s,10);return{nonce:r,salt:n,iteration:o}}i(wl,"parseServerFirstMessage");function vl(t){let r=Ni(t).get("v");if(r){if(!Ai(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(vl,"parseServerFinalMessage");function Rl(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(Rl,"xorBuffers");bi.exports={startSession:Nl,continueSession:bl,finalizeSession:Il}});var ir=A((fg,Oi)=>{"use strict";var Pl=st();function St(t){this._types=t||Pl,this.text={},this.binary={}}i(St,"TypeOverrides");St.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};St.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};St.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};Oi.exports=St});var vi=A((yg,wi)=>{"use strict";function or(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let o=r.pathname.slice(1)||null;e.database=o?decodeURI(o):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let a=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=a.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=a.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=a.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(or,"parse");wi.exports=or;or.parse=or});var ur=A((Eg,Di)=>{"use strict";var Dl=require("dns"),Pi=it(),Ri=vi().parse,ae=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Pi[t]},"val"),Ll=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Pi.ssl},"readSSLConfigFromEnvironment"),Ke=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),he=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+Ke(n))},"add"),cr=class cr{constructor(e){e=typeof e=="string"?Ri(e):e||{},e.connectionString&&(e=Object.assign({},e,Ri(e.connectionString))),this.user=ae("user",e),this.database=ae("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(ae("port",e),10),this.host=ae("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:ae("password",e)}),this.binary=ae("binary",e),this.options=ae("options",e),this.ssl=typeof e.ssl>"u"?Ll():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=ae("client_encoding",e),this.replication=ae("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=ae("application_name",e,"PGAPPNAME"),this.fallback_application_name=ae("fallback_application_name",e,!1),this.statement_timeout=ae("statement_timeout",e,!1),this.lock_timeout=ae("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=ae("idle_in_transaction_session_timeout",e,!1),this.query_timeout=ae("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];he(r,this,"user"),he(r,this,"password"),he(r,this,"port"),he(r,this,"application_name"),he(r,this,"fallback_application_name"),he(r,this,"connect_timeout"),he(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(he(r,n,"sslmode"),he(r,n,"sslca"),he(r,n,"sslkey"),he(r,n,"sslcert"),he(r,n,"sslrootcert"),this.database&&r.push("dbname="+Ke(this.database)),this.replication&&r.push("replication="+Ke(this.replication)),this.host&&r.push("host="+Ke(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+Ke(this.client_encoding)),Dl.lookup(this.host,function(s,o){return s?e(s,null):(r.push("hostaddr="+Ke(o)),e(null,r.join(" ")))})}};i(cr,"ConnectionParameters");var ar=cr;Di.exports=ar});var xi=A((Sg,Mi)=>{"use strict";var Ml=st(),Li=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,pr=class pr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=Li.exec(e.text):r=Li.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var o=e[n];o!==null?r[n]=this._parsers[n](o):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var o=e[n],a=this.fields[n].name;o!==null?r[a]=this._parsers[n](o):r[a]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Ml.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(pr,"Result");var lr=pr;Mi.exports=lr});var Bi=A((Cg,Fi)=>{"use strict";var{EventEmitter:xl}=require("events"),qi=xi(),ki=ot(),dr=class dr extends xl{constructor(e,r,n){super(),e=ki.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new qi(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new qi(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:ki.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(dr,"Query");var mr=dr;Fi.exports=mr});var Kr=A(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.NoticeMessage=L.DataRowMessage=L.CommandCompleteMessage=L.ReadyForQueryMessage=L.NotificationResponseMessage=L.BackendKeyDataMessage=L.AuthenticationMD5Password=L.ParameterStatusMessage=L.ParameterDescriptionMessage=L.RowDescriptionMessage=L.Field=L.CopyResponse=L.CopyDataMessage=L.DatabaseError=L.copyDone=L.emptyQuery=L.replicationStart=L.portalSuspended=L.noData=L.closeComplete=L.bindComplete=L.parseComplete=void 0;L.parseComplete={name:"parseComplete",length:5};L.bindComplete={name:"bindComplete",length:5};L.closeComplete={name:"closeComplete",length:5};L.noData={name:"noData",length:5};L.portalSuspended={name:"portalSuspended",length:5};L.replicationStart={name:"replicationStart",length:4};L.emptyQuery={name:"emptyQuery",length:4};L.copyDone={name:"copyDone",length:4};var wr=class wr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(wr,"DatabaseError");var fr=wr;L.DatabaseError=fr;var vr=class vr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(vr,"CopyDataMessage");var hr=vr;L.CopyDataMessage=hr;var Rr=class Rr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Rr,"CopyResponse");var yr=Rr;L.CopyResponse=yr;var Pr=class Pr{constructor(e,r,n,s,o,a,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=o,this.dataTypeModifier=a,this.format=c}};i(Pr,"Field");var gr=Pr;L.Field=gr;var Dr=class Dr{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Dr,"RowDescriptionMessage");var Er=Dr;L.RowDescriptionMessage=Er;var Lr=class Lr{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(Lr,"ParameterDescriptionMessage");var _r=Lr;L.ParameterDescriptionMessage=_r;var Mr=class Mr{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(Mr,"ParameterStatusMessage");var Sr=Mr;L.ParameterStatusMessage=Sr;var xr=class xr{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(xr,"AuthenticationMD5Password");var Tr=xr;L.AuthenticationMD5Password=Tr;var qr=class qr{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(qr,"BackendKeyDataMessage");var Cr=qr;L.BackendKeyDataMessage=Cr;var kr=class kr{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(kr,"NotificationResponseMessage");var Ar=kr;L.NotificationResponseMessage=Ar;var Fr=class Fr{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(Fr,"ReadyForQueryMessage");var Nr=Fr;L.ReadyForQueryMessage=Nr;var Br=class Br{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(Br,"CommandCompleteMessage");var br=Br;L.CommandCompleteMessage=br;var $r=class $r{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i($r,"DataRowMessage");var Ir=$r;L.DataRowMessage=Ir;var Ur=class Ur{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Ur,"NoticeMessage");var Or=Ur;L.NoticeMessage=Or});var $i=A(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.Writer=void 0;var Vr=class Vr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(Vr,"Writer");var Gr=Vr;Tt.Writer=Gr});var Ki=A(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.serialize=void 0;var Hr=$i(),V=new Hr.Writer,ql=i(t=>{V.addInt16(3).addInt16(0);for(let n of Object.keys(t))V.addCString(n).addCString(t[n]);V.addCString("client_encoding").addCString("UTF8");var e=V.addCString("").flush(),r=e.length+4;return new Hr.Writer().addInt32(r).add(e).flush()},"startup"),kl=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Fl=i(t=>V.addCString(t).flush(112),"password"),Bl=i(function(t,e){return V.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),V.flush(112)},"sendSASLInitialResponseMessage"),$l=i(function(t){return V.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Ul=i(t=>V.addCString(t).flush(81),"query"),Ui=[],Kl=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ui;for(var n=r.length,s=V.addCString(e).addCString(t.text).addInt16(n),o=0;o<n;o++)s.addInt32(r[o]);return V.flush(80)},"parse"),Ge=new Hr.Writer,Gl=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(V.addInt16(0),Ge.addInt32(-1)):n instanceof Buffer?(V.addInt16(1),Ge.addInt32(n.length),Ge.add(n)):(V.addInt16(0),Ge.addInt32(Buffer.byteLength(n)),Ge.addString(n))}},"writeValues"),Vl=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Ui,o=s.length;return V.addCString(e).addCString(r),V.addInt16(o),Gl(s,t.valueMapper),V.addInt16(o),V.add(Ge.flush()),V.addInt16(n?1:0),V.flush(66)},"bind"),Hl=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Ql=i(t=>{if(!t||!t.portal&&!t.rows)return Hl;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,o=Buffer.allocUnsafe(1+s);return o[0]=69,o.writeInt32BE(s,1),o.write(e,5,"utf-8"),o[n+5]=0,o.writeUInt32BE(r,o.length-4),o},"execute"),Wl=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),Qr=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Yl=V.addCString("P").flush(68),jl=V.addCString("S").flush(68),zl=i(t=>t.name?Qr(68,`${t.type}${t.name||""}`):t.type==="P"?Yl:jl,"describe"),Xl=i(t=>{let e=`${t.type}${t.name||""}`;return Qr(67,e)},"close"),Zl=i(t=>V.add(t).flush(100),"copyData"),Jl=i(t=>Qr(102,t),"copyFail"),Ct=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),ep=Ct(72),tp=Ct(83),rp=Ct(88),np=Ct(99),sp={startup:ql,password:Fl,requestSsl:kl,sendSASLInitialResponseMessage:Bl,sendSCRAMClientFinalMessage:$l,query:Ul,parse:Kl,bind:Vl,execute:Ql,describe:zl,close:Xl,flush:()=>ep,sync:()=>tp,end:()=>rp,copyData:Zl,copyDone:()=>np,copyFail:Jl,cancel:Wl};At.serialize=sp});var Gi=A(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.BufferReader=void 0;var ip=Buffer.allocUnsafe(0),Yr=class Yr{constructor(e=0){this.offset=e,this.buffer=ip,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(Yr,"BufferReader");var Wr=Yr;Nt.BufferReader=Wr});var Qi=A(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.Parser=void 0;var H=Kr(),op=Gi(),jr=1,ap=4,Vi=jr+ap,Hi=Buffer.allocUnsafe(0),Xr=class Xr{constructor(e){if(this.buffer=Hi,this.bufferLength=0,this.bufferOffset=0,this.reader=new op.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Vi<=n;){let o=this.buffer[s],a=this.buffer.readUInt32BE(s+jr),c=jr+a;if(c+s<=n){let l=this.handlePacket(s+Vi,o,a,this.buffer);r(l),s+=c}else break}s===n?(this.buffer=Hi,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let o=this.buffer.byteLength*2;for(;r>=o;)o*=2;s=Buffer.allocUnsafe(o)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return H.bindComplete;case 49:return H.parseComplete;case 51:return H.closeComplete;case 110:return H.noData;case 115:return H.portalSuspended;case 99:return H.copyDone;case 87:return H.replicationStart;case 73:return H.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new H.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new H.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new H.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new H.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let o=this.reader.byte()!==0,a=this.reader.int16(),c=new H.CopyResponse(r,s,o,a);for(let l=0;l<a;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.cstring(),a=this.reader.cstring();return new H.NotificationResponseMessage(r,s,o,a)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new H.RowDescriptionMessage(r,s);for(let a=0;a<s;a++)o.fields[a]=this.parseField();return o}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),o=this.reader.int16(),a=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new H.Field(e,r,n,s,o,a,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new H.ParameterDescriptionMessage(r,s);for(let a=0;a<s;a++)o.dataTypeIDs[a]=this.reader.int32();return o}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Array(s);for(let a=0;a<s;a++){let c=this.reader.int32();o[a]=c===-1?null:this.reader.string(c)}return new H.DataRowMessage(r,o)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),o=this.reader.cstring();return new H.ParameterStatusMessage(r,s,o)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.int32();return new H.BackendKeyDataMessage(r,s,o)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:o.length===8&&(o.name="authenticationCleartextPassword");break;case 5:if(o.length===12){o.name="authenticationMD5Password";let c=this.reader.bytes(4);return new H.AuthenticationMD5Password(r,c)}break;case 10:o.name="authenticationSASL",o.mechanisms=[];let a;do a=this.reader.cstring(),a&&o.mechanisms.push(a);while(a);break;case 11:o.name="authenticationSASLContinue",o.data=this.reader.string(r-8);break;case 12:o.name="authenticationSASLFinal",o.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return o}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let o={},a=this.reader.string(1);for(;a!=="\0";)o[a]=this.reader.cstring(),a=this.reader.string(1);let c=o.M,l=s==="notice"?new H.NoticeMessage(r,c):new H.DatabaseError(c,r,s);return l.severity=o.S,l.code=o.C,l.detail=o.D,l.hint=o.H,l.position=o.P,l.internalPosition=o.p,l.internalQuery=o.q,l.where=o.W,l.schema=o.s,l.table=o.t,l.column=o.c,l.dataType=o.d,l.constraint=o.n,l.file=o.F,l.line=o.L,l.routine=o.R,l}};i(Xr,"Parser");var zr=Xr;bt.Parser=zr});var Zr=A(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.DatabaseError=we.serialize=we.parse=void 0;var cp=Kr();Object.defineProperty(we,"DatabaseError",{enumerable:!0,get:function(){return cp.DatabaseError}});var up=Ki();Object.defineProperty(we,"serialize",{enumerable:!0,get:function(){return up.serialize}});var lp=Qi();function pp(t,e){let r=new lp.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(pp,"parse");we.parse=pp});var Wi={};au(Wi,{default:()=>mp});var mp,Yi=ou(()=>{mp={}});var ji=A((qg,Jr)=>{Jr.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Yi(),uu(Wi));return new n(e)}},"getStream");Jr.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var rn=A((Bg,zi)=>{"use strict";var Fg=require("net"),dp=require("events").EventEmitter,{parse:fp,serialize:ee}=Zr(),{getStream:hp,getSecureStream:yp}=ji(),gp=ee.flush(),Ep=ee.sync(),_p=ee.end(),tn=class tn extends dp{constructor(e){super(),e=e||{},this.stream=e.stream||hp(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(o){n._ending&&(o.code==="ECONNRESET"||o.code==="EPIPE")||n.emit("error",o)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(o){var a=o.toString("utf8");switch(a){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{n.stream=yp(c)}catch(u){return n.emit("error",u)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){fp(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(ee.requestSsl())}startup(e){this.stream.write(ee.startup(e))}cancel(e,r){this._send(ee.cancel(e,r))}password(e){this._send(ee.password(e))}sendSASLInitialResponseMessage(e,r){this._send(ee.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(ee.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(ee.query(e))}parse(e){this._send(ee.parse(e))}bind(e){this._send(ee.bind(e))}execute(e){this._send(ee.execute(e))}flush(){this.stream.writable&&this.stream.write(gp)}sync(){this._ending=!0,this._send(Ep)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(_p,()=>{this.stream.end()})}close(e){this._send(ee.close(e))}describe(e){this._send(ee.describe(e))}sendCopyFromChunk(e){this._send(ee.copyData(e))}endCopyFrom(){this._send(ee.copyDone())}sendCopyFail(e){this._send(ee.copyFail(e))}};i(tn,"Connection");var en=tn;zi.exports=en});var eo=A((Ug,Ji)=>{"use strict";var{Transform:Sp}=require("stream"),{StringDecoder:Tp}=require("string_decoder"),ve=Symbol("last"),It=Symbol("decoder");function Cp(t,e,r){let n;if(this.overflow){if(n=this[It].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[ve]+=this[It].write(t),n=this[ve].split(this.matcher);this[ve]=n.pop();for(let s=0;s<n.length;s++)try{Zi(this,this.mapper(n[s]))}catch(o){return r(o)}if(this.overflow=this[ve].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(Cp,"transform");function Ap(t){if(this[ve]+=this[It].end(),this[ve])try{Zi(this,this.mapper(this[ve]))}catch(e){return t(e)}t()}i(Ap,"flush");function Zi(t,e){e!==void 0&&t.push(e)}i(Zi,"push");function Xi(t){return t}i(Xi,"noop");function Np(t,e,r){switch(t=t||/\r?\n/,e=e||Xi,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Xi)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Cp,r.flush=Ap,r.readableObjectMode=!0;let n=new Sp(r);return n[ve]="",n[It]=new Tp("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,o){this._writableState.errorEmitted=!1,o(s)},n}i(Np,"split");Ji.exports=Np});var no=A((Gg,be)=>{"use strict";var to=require("path"),bp=require("stream").Stream,Ip=eo(),ro=require("util"),Op=5432,Ot=process.platform==="win32",ct=process.stderr,wp=56,vp=7,Rp=61440,Pp=32768;function Dp(t){return(t&Rp)==Pp}i(Dp,"isRegFile");var Ve=["host","port","database","user","password"],nn=Ve.length,Lp=Ve[nn-1];function sn(){var t=ct instanceof bp&&ct.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);ct.write(ro.format.apply(ro,e))}}i(sn,"warn");Object.defineProperty(be.exports,"isWin",{get:function(){return Ot},set:function(t){Ot=t}});be.exports.warnTo=function(t){var e=ct;return ct=t,e};be.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Ot?to.join(e.APPDATA||"./","postgresql","pgpass.conf"):to.join(e.HOME||"./",".pgpass"));return r};be.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Ot?!0:(e=e||"<unkn>",Dp(t.mode)?t.mode&(wp|vp)?(sn('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(sn('WARNING: password file "%s" is not a plain file',e),!1))};var Mp=be.exports.match=function(t,e){return Ve.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Op)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};be.exports.getPassword=function(t,e,r){var n,s=e.pipe(Ip());function o(l){var u=xp(l);u&&qp(u)&&Mp(t,u)&&(n=u[Lp],s.end())}i(o,"onLine");var a=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(l){e.destroy(),sn("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),s.on("data",o).on("end",a).on("error",c)};var xp=be.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,o=0,a={},c=!1,l=i(function(p,d,f){var h=t.substring(d,f);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(h=h.replace(/\\([:\\])/g,"$1")),a[Ve[p]]=h},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=n==nn-1,c){l(n,s);break}u>=0&&e==":"&&r!=="\\"&&(l(n,s,u+1),s=u+2,n+=1)}return a=Object.keys(a).length===nn?a:null,a},qp=be.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Ve.length;r+=1){var n=e[r],s=t[Ve[r]]||"",o=n(s);if(!o)return!1}return!0}});var io=A((Qg,on)=>{"use strict";var Hg=require("path"),so=require("fs"),wt=no();on.exports=function(t,e){var r=wt.getFileName();so.stat(r,function(n,s){if(n||!wt.usePgPass(s,r))return e(void 0);var o=so.createReadStream(r);wt.getPassword(t,o,e)})};on.exports.warnTo=wt.warnTo});var uo=A((Wg,co)=>{"use strict";var kp=require("events").EventEmitter,oo=ot(),an=Ii(),Fp=ir(),Bp=ur(),ao=Bi(),$p=it(),Up=rn(),Kp=sr(),cn=class cn extends kp{constructor(e){super(),this.connectionParameters=new Bp(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Fp(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Up({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||$p.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{io()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Kp.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=an.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await an.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{an.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return oo.escapeIdentifier(e)}escapeLiteral(e){return oo.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,o,a,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,o=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(a=this.connectionParameters.query_timeout,s=new ao(e,r,n),s.callback||(o=new this._Promise((u,p)=>{s.callback=(d,f)=>d?p(d):u(f)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=s.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),l(u),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},a),s.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),o):(this.queryQueue.push(s),this._pulseQueryQueue(),o):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),o)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(cn,"Client");var vt=cn;vt.Query=ao;co.exports=vt});var fo=A((jg,mo)=>{"use strict";var Gp=require("events").EventEmitter,lo=i(function(){},"NOOP"),po=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),pn=class pn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(pn,"IdleItem");var un=pn,mn=class mn{constructor(e){this.callback=e}};i(mn,"PendingItem");var He=mn;function Vp(){throw new Error("Release called on client which has already been released to the pool.")}i(Vp,"throwOnDoubleRelease");function Rt(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(a,c){a?r(a):n(c)},"cb"),o=new t(function(a,c){n=a,r=c}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:s,result:o}}i(Rt,"promisify");function Hp(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(Hp,"makeIdleListener");var dn=class dn extends Gp{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||fn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=po(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Rt(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new He(r.callback)),n;let s=i((c,l,u)=>{clearTimeout(a),r.callback(c,l,u)},"queueCallback"),o=new He(s),a=setTimeout(()=>{po(this._pendingQueue,c=>c.callback===s),o.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(o),n}return this.newClient(new He(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=Hp(this,r);this.log("checking client timeout");let s,o=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),o=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(s&&clearTimeout(s),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(c=>c!==r),o&&(a.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(a,void 0,lo);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new He((u,p,d)=>d()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,o=>{if(o)return e.release(o),r.callback(o,void 0,lo);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Vp(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let o;this.options.idleTimeoutMillis&&(o=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&o.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new un(e,r,o)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let o=Rt(this.Promise,e);return setImmediate(function(){return o.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),o.result}typeof r=="function"&&(n=r,r=void 0);let s=Rt(this.Promise,n);return n=s.callback,this.connect((o,a)=>{if(o)return n(o);let c=!1,l=i(u=>{c||(c=!0,a.release(u),n(u))},"onError");a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,p)=>{if(this.log("query dispatched"),a.removeListener("error",l),!c)return c=!0,a.release(u),u?n(u):n(void 0,p)})}catch(u){return a.release(u),n(u)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Rt(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(dn,"Pool");var ln=dn;mo.exports=ln});var go=A((Xg,yo)=>{"use strict";var ho=require("events").EventEmitter,Qp=require("util"),hn=ot(),Qe=yo.exports=function(t,e,r){ho.call(this),t=hn.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Qp.inherits(Qe,ho);var Wp={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Qe.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=Wp[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Qe.prototype.then=function(t,e){return this._getPromise().then(t,e)};Qe.prototype.catch=function(t){return this._getPromise().catch(t)};Qe.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Qe.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(o,a,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),o)return e.handleError(o);e._emitRowEvents&&(c.length>1?a.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):a.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(hn.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let o=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(o)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(o){return o?r(o):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let o=new Error("Query values must be an array");return r(o)}var s=this.values.map(hn.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var Co=A((Jg,To)=>{"use strict";var Eo;try{Eo=require("pg-native")}catch(t){throw t}var Yp=ir(),_o=require("events").EventEmitter,jp=require("util"),zp=ur(),So=go(),le=To.exports=function(t){_o.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Yp(t.types),this.native=new Eo({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new zp(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};le.Query=So;jp.inherits(le,_o);le.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};le.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(o){e._queryable=!1,e._errorAllQueries(o),e.emit("error",o)}),e.native.on("notification",function(o){e.emit("notification",{channel:o.relname,payload:o.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};le.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};le.prototype.query=function(t,e,r){var n,s,o,a,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")o=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(o=this.connectionParameters.query_timeout,n=new So(t,e,r),!n.callback){let l,u;s=new this._Promise((p,d)=>{l=p,u=d}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,d)=>p?u(p):l(d)}return o&&(c=n.callback,a=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),c(l),n.callback=()=>{};var u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},o),n.callback=(l,u)=>{clearTimeout(a),c(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};le.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(o=>o?s(o):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};le.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};le.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};le.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};le.prototype.ref=function(){};le.prototype.unref=function(){};le.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};le.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var yn=A((tE,Ao)=>{"use strict";Ao.exports=Co()});var fn=A((rE,ut)=>{"use strict";var Xp=uo(),Zp=it(),Jp=rn(),em=fo(),{DatabaseError:tm}=Zr(),{escapeIdentifier:rm,escapeLiteral:nm}=ot(),sm=i(t=>{var e;return e=class extends em{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),gn=i(function(t){this.defaults=Zp,this.Client=t,this.Query=this.Client.Query,this.Pool=sm(this.Client),this._pools=[],this.Connection=Jp,this.types=st(),this.DatabaseError=tm,this.escapeIdentifier=rm,this.escapeLiteral=nm},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ut.exports=new gn(yn()):(ut.exports=new gn(Xp),Object.defineProperty(ut.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new gn(yn())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ut.exports,"native",{value:t}),t}}))});var bo=A((sE,No)=>{"use strict";var We=require("fs"),im=fn(),om="The server does not support SSL connections",am="28000",cm=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,o){e.info("Certificate",{hostname:s,cert:{subject:o.subject,issuer:o.issuer,valid_from:o.valid_from,valid_to:o.valid_to}})}};return We.existsSync(t.certAuthority)&&(n.ca=We.readFileSync(t.certAuthority).toString()),We.existsSync(t.clientCert)&&(n.cert=We.readFileSync(t.clientCert).toString()),We.existsSync(t.clientPrivateKey)&&(n.key=We.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),um=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),lm=i(async(t,e,r)=>{let n=!1;if(t.ssh){let{options:a}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...a},n=!0}t=Object.assign({},t,{sslType:um(t.sslType)});let s={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:cm(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await En(s,r),isSshTunnel:n}},"createClient"),pm=i((t,e,r)=>{var n;if(r.message===om&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),En({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===am&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),En({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),En=i((t,e)=>{let r=new im.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return pm(t,e,n)})},"createConnectionPool");No.exports={createClient:lm}});var _n=A((oE,wo)=>{"use strict";var Io=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),Oo={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
		SELECT tables.table_name, tables.table_type
		FROM information_schema.tables AS tables
		INNER JOIN (
			SELECT pg_class.relname AS table_name,
				   pg_namespace.nspname AS table_schema
			FROM pg_catalog.pg_class AS pg_class
				INNER JOIN pg_catalog.pg_namespace AS pg_namespace
				ON (pg_namespace.oid = pg_class.relnamespace)
			WHERE (pg_class.relispartition = false OR pg_class.relispartition IS NULL) AND pg_class.relkind = ANY ('{"r","v","t","m","p"}')
		) AS catalog_table_data
		ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
		WHERE tables.table_schema = $1;
	`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1, $2)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:`
    SELECT indexname,
           index_id,
           index_method,
           index_unique,
           number_of_keys,
           where_expression,
           array_agg(attname ORDER BY ord)::text[] AS columns,
           array_agg(coll ORDER BY ord) AS collations,
           array_agg(opclass ORDER BY ord) AS opclasses,
           array_agg(expression ORDER BY ord) AS expressions,
           array_agg(ascending ORDER BY ord) AS ascendings,
           array_agg(nulls_first ORDER BY ord) AS nulls_first,
           reloptions AS storage_parameters
    FROM (
        SELECT ct.oid AS table_oid,
            c.relname AS indexname,
            m.amname AS index_method,
            indexes.indisunique AS index_unique,
            indexes.ord,
            attribute.attname,
            c.reloptions,
            indexes.indnkeyatts AS number_of_keys,
            ti.index_id AS index_id,
            pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
            CASE
                WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
            END AS coll,
            CASE
                WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
            END AS opclass,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 1 = 1 THEN 'DESC' ELSE 'ASC'
        END AS ascending,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 2 = 2 THEN 'NULLS FIRST' ELSE 'NULLS LAST'
        END AS nulls_first,
        pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
        FROM
            (
                SELECT *,
                    generate_series(1,array_length(i.indkey,1)) AS ord,
                    unnest(i.indkey) AS key,
                    unnest(i.indcollation) AS coll,
                    unnest(i.indclass) AS class,
                    unnest(i.indoption) AS option
                FROM pg_catalog.pg_index i
            ) indexes
        JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
        JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
        JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
        LEFT JOIN pg_catalog.pg_attribute attribute
            ON (attribute.attrelid=indexes.indrelid AND attribute.attnum=indexes.key)
        LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
        LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
        LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
        LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
        INNER JOIN crdb_internal.table_indexes ti ON (
            indexes.indrelid = ti.descriptor_id
            AND c.relname = ti.index_name
        )
    ) s2
    WHERE table_oid = $1
    GROUP BY
        indexname,
        index_id,
        index_method,
        index_unique,
        reloptions,
        number_of_keys,
        where_expression;
    `,GET_TABLE_INDEX_PARTITIONING_DATA:`
        SELECT
            partitions.name AS partition_name,
            partitions.index_id,
            parent_name,
            column_names,
            list_value,
            range_value,
            index_name
        FROM crdb_internal.partitions
            INNER JOIN crdb_internal.table_indexes
                ON partitions.table_id = table_indexes.descriptor_id
                    AND partitions.index_id = table_indexes.index_id
        WHERE table_indexes.descriptor_id = $1;
    `,GET_TABLE_INDEX_CREATE_INFO:`
        SELECT index_name,
               is_sharded,
               is_visible,
               create_statement
        FROM crdb_internal.table_indexes WHERE descriptor_id = $1;
    `,GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:Io(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:Io(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND (
                (pg_type.typtype = 'c' AND (pg_class.relkind = 'c' OR pg_class.relkind IS NULL))
                OR pg_type.typtype = 'e'
                OR pg_type.typtype = 'r'
            )
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;"},mm=i(t=>(Object.entries(Oo).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");wo.exports={getQueryName:mm,...Oo}});var Ro=A((cE,vo)=>{"use strict";var dm=_n(),Me=null,Pt=null;vo.exports={initializeClient(t,e){Me=t,Pt=e,Me.on("error",r=>e.error(r))},isClientInitialized(){return!!Me},releaseClient(){return Me?new Promise(t=>{Me.end(()=>{Me=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=dm.getQueryName(t);Pt.info("Execute query",{queryName:n,params:e});let s=Date.now(),o=await Me.query(t,e),a=Date.now()-s;Pt.info("Query executed",{queryName:n,params:e,duration:a,rowsCount:o.rowCount});let c=o.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,Pt.error(n),null}}}});var Lo=A((uE,Do)=>{"use strict";var Po=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...Po(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");Do.exports={getJsonSchema:Po}});var Cn=A((pE,Mo)=>{"use strict";var xe=null,fm=i(t=>{xe=t.require("lodash")},"setDependencies"),Sn={column_default:"default",is_nullable:{keyword:"required",map:(t,e,r)=>({YES:!1,NO:!0})[r]},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e,r)=>r!==-1&&Am(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:{keyword:"length",map:(t,e,r)=>Number(r)},description:"description"},hm=i((t,e,r)=>{let n=Sn[e];if(!n||typeof n=="string")return r;let s=n.check||((c,l,u)=>!0),o=n.map||((c,l,u)=>u),a="";return s(t,e,r)&&(a=r),o(t,e,a)},"getColumnValue"),ym=i(t=>e=>xe.chain(e).toPairs().map(([r,n])=>{var s;return[((s=Sn[r])==null?void 0:s.keyword)||Sn[r],hm(e,r,n)]}).filter(([r,n])=>r&&!xe.isNil(n)).fromPairs().thru(gm(t)).value(),"mapColumnData"),gm=i(t=>e=>({...e,...Em(t,e)}),"setColumnType"),Em=i((t,e)=>e.type==="ARRAY"?_m(t,e):e.type==="USER-DEFINED"?Tn(t,e.udt_name):Tn(t,e.type),"getType"),_m=i((t,e)=>({...Tn(t,e.udt_name.slice(1)),array_type:xe.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Tn=i((t,e)=>{switch(e){case"bigserial":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"numeric":case"dec":case"decimal":return{type:"numeric",mode:"decimal"};case"int2":case"smallint":return{type:"numeric",mode:"int2"};case"int4":case"integer":return{type:"numeric",mode:"int4"};case"int":case"int8":case"int64":case"bigint":return{type:"numeric",mode:"int"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return xe.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Sm=i((t,e)=>{let r=xe.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],o=Tm(s),a=Cm(o);return{...n,subtype:a}})},"setSubtypeFromSampledJsonValues"),Tm=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Cm=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),Am=i(t=>xe.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");Mo.exports={setDependencies:fm,mapColumnData:ym,setSubtypeFromSampledJsonValues:Sm}});var lt=A((dE,xo)=>{"use strict";var Nm=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],Ye=null,bm=i(t=>{Ye=t.require("lodash")},"setDependencies"),Im=i(t=>Ye.chain(t).toPairs().reject(([e,r])=>Ye.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Om=i(t=>e=>{var r;return(r=Ye.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),wm=i(t=>/\s|\W/.test(t)||Ye.includes(Nm,Ye.toUpper(t))?`"${t}"`:t,"wrapInQuotes");xo.exports={clearEmptyPropertiesInObject:Im,setDependencies:bm,getColumnNameByPosition:Om,wrapInQuotes:wm}});var Fo=A((hE,ko)=>{"use strict";var{getColumnNameByPosition:vm}=lt(),An=null,Rm=i(t=>{An=t.require("lodash")},"setDependencies"),qo=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Pm=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";default:return""}},"prepareMatch"),Dm=i((t,e,r,n)=>An.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:An.map(s.table_columns_positions,vm(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:qo(s.relationship_on_delete),relationshipOnUpdate:qo(s.relationship_on_update),relationshipMatch:Pm(s.relationship_match)}})),"prepareForeignKeys");ko.exports={setDependencies:Rm,prepareForeignKeys:Dm}});var Uo=A((gE,$o)=>{"use strict";var Dt=null,Lm=i(t=>{Dt=t.require("lodash")},"setDependencies"),Bo=i(t=>Dt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Mm(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Mm=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),xm=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),qm=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),km=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Fm=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:Bo(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Dt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:xm(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:km(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:qm(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Bm=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Dt.toLower(t.external_language),inputArgs:Bo(e),body:t.routine_definition}),"mapProcedureData");$o.exports={setDependencies:Lm,mapFunctionData:Fm,mapProcedureData:Bm}});var Ho=A((_E,Vo)=>{"use strict";var $m=i(t=>e=>{if(!e)return null;let r=Km(e),n=Gm(t)(e),s=Vm(e);return[{partitionMethod:r,compositePartitionKey:n,partitioning_expression:s}]},"preparePartition"),Nn=i((t={})=>t.list_value?"LIST":t.range_value?"RANGE":"","getPartitionMethodByRow"),Ko=i((t=[])=>t.filter(e=>!e.parent_name),"getParentPartitionRows"),Um=i((t=[],e=null)=>t.filter(r=>r.parent_name===e),"getChildPartitionRows"),Km=i((t=[])=>{let e=Ko(t);if(!e.length)return"";let r=e[0];return Nn(r)},"getPartitionMethod"),Gm=i(t=>(e=[])=>{let n=e.filter(s=>!s.parent_name).flatMap(s=>(s.column_names||"").split(",").map(a=>a.trim()));return t.uniq(n)},"getCompositePartitionKey"),Vm=i(t=>{let e=Ko(t);if(!e.length)return"";let r=e[0],n=Nn(r),s=r.column_names||"",o=e.map(a=>Go({partition:a,paddingFactor:1,partitionResult:t})).join(`,
`);return`PARTITION BY ${n} (${s}) (
${o}
)`},"getPartitionExpression"),Go=i(({partition:t,partitionResult:e,paddingFactor:r})=>{let n=t.list_value?"VALUES IN":"VALUES FROM",s=t.list_value||t.range_value||"",o="	".repeat(r),a=`${o}PARTITION ${t.partition_name} ${n} ${s}`,c=Um(e,t.partition_name);if(c.length){let l=c.map(f=>Go({partition:f,partitionResult:e,paddingFactor:r+1})).join(`,
`),u=c[0],p=Nn(u),d=u.column_names||"";return a+` PARTITION BY ${p} (${d}) (
`+l+`
`+o+")"}return a},"getSinglePartitionExpression");Vo.exports={preparePartition:$m}});var zo=A((TE,jo)=>{"use strict";var{clearEmptyPropertiesInObject:Lt,getColumnNameByPosition:Qo}=lt(),{preparePartition:Hm}=Ho(),K=null,Qm=i(t=>{K=t.require("lodash")},"setDependencies"),Wm=i(t=>{let e={};for(let r of Object.keys(t))r.startsWith("ttl")?(e.ttl_storage_parameters||(e.ttl_storage_parameters={}),e.ttl_storage_parameters[r]=t[r]):e[r]=t[r];return e},"groupTtlStorageParams"),Wo=i((t,e)=>{if(!t&&!e)return null;let r=fd(t),n=Lt(r),s=Wm(n);return Lt(s)},"prepareStorageParameters"),bn=i(t=>K.split(t,"="),"splitByEqualitySymbol"),Ym=i(t=>K.find(t,{type:"json"}),"checkHaveJsonTypes"),jm=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),zm=i((t,e,r)=>K.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,Jm(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,Xm(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,Zm(s,e)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Xm=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:K.map(t.constraint_keys,Qo(e)),indexStorageParameters:K.join(t.storage_parameters,",")}),"getPrimaryKeyConstraint"),Zm=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:K.map(t.constraint_keys,Qo(e)),indexStorageParameters:K.join(t.storage_parameters,","),indexComment:t.description}),"getUniqueKeyConstraint"),Jm=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,notValid:t.notValid,constrDescription:t.description}),"getCheckConstraint"),ed=i((t,e=[])=>e.find(n=>n.index_name===t)||{}||{},"getIndexCreateInfoRowByName"),td=i(t=>{switch(t.toUpperCase()){case"INVERTED":return"gin";case"PREFIX":return"btree";default:return t}},"parseIndexMethod"),rd=i((t,e)=>(t||[]).filter(r=>r.index_name===e.indexname&&r.index_id===e.index_id),"getIndexPartitioningRows"),nd=i(({tableIndexesResult:t,tableIndexesCreateInfoResult:e=[],tableIndexesPartitioningResult:r})=>K.map(t,n=>{let s=ed(n.indexname,e),o=s.create_statement,a=cd(n,o),c=K.slice(a,0,n.number_of_keys),l=K.chain(a).slice(n.number_of_keys).map(y=>K.pick(y,"name")).value(),u=s.is_visible?"VISIBLE":"NOT VISIBLE",p=!!s.is_sharded,d=rd(r,n),h=(Hm(K)(d)||[{}])[0].partitioning_expression,S={indxName:n.indexname,index_method:td(n.index_method),unique:n.index_unique??!1,index_storage_parameter:ld(n.storage_parameters,o),where:n.where_expression||"",partitioning_expression:h,include:l,columns:c,using_hash:p,visibility:u};return Lt(S)}),"prepareTableIndexes"),sd=i(({createStatement:t,columnName:e})=>{let r=["(",","],n=0;for(;n<t.length;){let s=t.indexOf(e,n);if(s===-1)return-1;let o=t.charAt(s-1);if(t.charAt(s+e.length).match(/\s/)&&r.includes(o))return s;n=s+e.length}},"getIndexColumnDefinitionStart"),id=i(({createStatement:t,columnDefinitionStart:e})=>{let r=t.substring(e),n=r.indexOf(","),s=r.indexOf(")");return n===-1?e+s:e+Math.min(n,s)},"getColumnDefinitionEnd"),od=i(({createStatement:t,columnName:e})=>{let r=sd({columnName:e,createStatement:t});if(r===-1)return"";let n=id({columnDefinitionStart:r,createStatement:t});return n===-1?"":t.substring(r,n)},"getIndexColumnQueryDefinition"),ad=i(({indexData:t,itemIndex:e,columnName:r,createStatement:n})=>{let s=K.get(t,`opclasses.${e}`,"");if(s)return s;let o=od({columnName:r,createStatement:n});if(!o)return"";let a=o.substring(r.length).trim();return a?a.toUpperCase().replaceAll("ASC","").replaceAll("DESC","").replaceAll("NULLS FIRST","").replaceAll("NULLS LAST","").toLowerCase().trim():""},"getIndexColumnOpClass"),cd=i((t,e)=>K.chain(t.columns).map((r,n)=>{if(!r)return;let s=K.get(t,`ascendings.${n}`,"ASC"),o=K.get(t,`nulls_first.${n}`,"NULLS FIRST"),a=ad({columnName:r,createStatement:e,itemIndex:n,indexData:t}),c=K.get(t,`collations.${n}`,"");return{name:r,sortOrder:s,nullsOrder:o,opclass:a,collation:c}}).compact().value(),"mapIndexColumns"),Yo=i(t=>{let e={fillfactor:t.fillfactor,bucket_count:t.bucket_count,geometry_max_x:t.geometry_max_x,geometry_max_y:t.geometry_max_y,geometry_min_x:t.geometry_min_x,geometry_min_y:t.geometry_min_y,s2_level_mod:t.s2_level_mod,s2_max_cells:t.s2_max_cells,s2_max_level:t.s2_max_level};return Lt(e)},"hydrateIndexStorageParameters"),ud=i(t=>{let e=/\s+with\s+\(.*?\)/im,r=t.match(e);if(!(r!=null&&r.length))return null;let n=r[0],s=7,o=n.length-1,a=n.substring(s,o).split(",").map(l=>l.trim()),c=K.fromPairs(K.map(a,l=>bn(l)));return Yo(c)},"parseIndexStorageParametersFromDdl"),ld=i((t,e)=>{if(!t)return ud(e);let r=K.fromPairs(K.map(t,n=>bn(n)));return Yo(r)},"getIndexStorageParameters"),pd=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Wo(t==null?void 0:t.reloptions,e),o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,partitionBounds:o}},"prepareTableLevelData"),md=i(t=>{switch(dd(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),dd=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),fd=i(t=>K.chain(t).map(bn).map(([e,r])=>[e,md(r)]).fromPairs().value()||{},"prepareOptions"),hd=i((t,e)=>K.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");jo.exports={prepareStorageParameters:Wo,setDependencies:Qm,checkHaveJsonTypes:Ym,prepareTableConstraints:zm,prepareTableLevelData:pd,prepareTableIndexes:nd,getSampleDocSize:jm,prepareTableInheritance:hd}});var Zo=A((AE,Xo)=>{"use strict";var{mapColumnData:yd}=Cn(),In=null,gd=i(t=>{In=t.require("lodash")},"setDependencies"),Ed=i(t=>In.chain(t).map(e=>{switch(e.type){case"e":return _d(e);case"r":return Sd(e);case"c":return Td(e);default:return null}}).compact().value(),"getUserDefinedTypes"),_d=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Sd=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Td=i(t=>{let e=In.map(t.columns,yd([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Cd=i(t=>t.type==="c","isTypeComposite");Xo.exports={setDependencies:gd,getUserDefinedTypes:Ed,isTypeComposite:Cd}});var ea=A((bE,Jo)=>{"use strict";var{clearEmptyPropertiesInObject:Ad,wrapInQuotes:Nd}=lt(),Ie=null,bd=i(t=>{Ie=t.require("lodash")},"setDependencies"),On=" (v)",Id=i(t=>t==="VIEW","isViewByTableType"),Od=i(t=>Ie.endsWith(t,On),"isViewByName"),wd=i(t=>t.slice(0,-On.length),"removeViewNameSuffix"),vd=i(t=>`${t}${On}`,"setViewSuffix"),Rd=i((t,e,r={})=>{let n=Ie.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${Nd(t)} AS ${n}`:""},"generateCreateViewScript"),Pd=i((t,e)=>{let r={withCheckOption:t.check_option!=="NONE"||Ie.isNil(t.check_option),checkTestingScope:Dd(t.check_option),viewOptions:Ie.fromPairs(Ie.map(e==null?void 0:e.view_options,Md)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Ld(t),description:e==null?void 0:e.description};return Ad(r)},"prepareViewData"),Dd=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Ld=i(t=>Ie.startsWith(Ie.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Md=i(t=>Ie.split(t,"="),"splitByEqualitySymbol");Jo.exports={setDependencies:bd,isViewByTableType:Id,isViewByName:Od,removeViewNameSuffix:wd,generateCreateViewScript:Rd,setViewSuffix:vd,prepareViewData:Pd}});var na=A((OE,ra)=>{"use strict";var xd=i((t,e)=>[qd,kd].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),qd=i((t,e)=>{var o,a,c;if(((c=(a=(o=e.primaryKey)==null?void 0:o[0])==null?void 0:a.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Fd(t,s,n),entityLevel:Kd(e)}},"reorganizePrimaryKeys"),kd=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let a=s.compositeUniqueKey[0];return{attributes:$d(r,a,s),entityLevel:Gd(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Fd=i((t,e,r)=>t.map(n=>n.name!==e?n:Bd(n,r)),"setAttributesPrimaryKeyData"),Bd=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:ta(e)}),"setPrimaryKeyData"),$d=i((t,e,r)=>t.map(n=>n.name!==e?n:Ud(n,r)),"setAttributesUniqueKeyData"),Ud=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:ta(e)}),"setUniqueKeyData"),ta=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexComment:t.indexComment}],"getOptions"),Kd=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Gd=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");ra.exports={reorganizeConstraints:xd}});var vn=A((vE,aa)=>{"use strict";var{createClient:Vd}=bo(),k=Ro(),{getJsonSchema:sa}=Lo(),{setDependencies:Hd,mapColumnData:Qd,setSubtypeFromSampledJsonValues:Wd}=Cn(),{setDependencies:Yd,clearEmptyPropertiesInObject:ia}=lt(),{setDependencies:jd,prepareForeignKeys:zd}=Fo(),{setDependencies:Xd,mapFunctionData:Zd,mapProcedureData:Jd}=Uo(),{setDependencies:ef,checkHaveJsonTypes:tf,prepareTableConstraints:rf,getSampleDocSize:nf,prepareTableLevelData:sf,prepareTableIndexes:of}=zo(),{setDependencies:af,getUserDefinedTypes:cf,isTypeComposite:uf}=Zo(),{setDependencies:lf,isViewByTableType:pf,isViewByName:mf,removeViewNameSuffix:df,generateCreateViewScript:ff,setViewSuffix:hf,prepareViewData:yf}=ea(),F=_n(),{reorganizeConstraints:gf}=na(),wn=!1,Z=null,ye=null,oa=14;aa.exports={setDependencies(t){Z=t.require("lodash"),Yd(t),ef(t),Hd(t),jd(t),lf(t),Xd(t),af(t)},async connect(t,e,r){k.isClientInitialized()&&await this.disconnect(e);let{client:n,isSshTunnel:s}=await Vd(t,e,r);k.initializeClient(n,r),wn=s,ye=r,oa=await this._getServerVersion()},async disconnect(t){wn&&(await t.closeConsumer(),wn=!1),await k.releaseClient()},pingDb(){return k.query(F.PING)},applyScript(t){return k.query(t)},async getDatabaseNames(){return Z.map(await k.query(F.GET_DATABASES),"database_name")},async logVersion(){let t=await k.queryTolerant(F.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved"},async getAllSchemasNames(){return(await k.query(F.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!Ef(e))},async getTablesNames(t){let e=await k.query(F.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!Z.includes(r,n)).map(({table_name:n,table_type:s})=>pf(s)?hf(n):n)},async getDbLevelData(){var n,s,o;ye.progress("Get database data");let t=(n=await k.queryTolerant(F.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await k.queryTolerant(F.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(o=await k.queryTolerant(F.GET_DB_COLLATE_NAME,[],!0))==null?void 0:o.default_collate_name;return ia({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r){let n=await this._retrieveUserDefinedTypes(t),s=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0),o=s==null?void 0:s.oid,[a,c]=Z.partition(e,mf),l=c.map(d=>({tableName:d})),u=await pt(Z.uniq(l),Z.bind(this._retrieveSingleTableData,this,r,o,t,n));return{views:await pt(a,Z.bind(this._retrieveSingleViewData,this,o,t)),tables:u,modelDefinitions:sa(n)}},async retrieveSchemaLevelData(t,e){var u;if(e)return ye.info("Functions and procedures ignored"),{functions:[],procedures:[]};ye.progress("Get Functions and Procedures",t);let r=(u=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,n=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await k.queryTolerant(_f(oa),[r]),[o,a]=Z.partition(Z.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await pt(o,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),f=Z.find(s,{function_name:p.name});return Zd(p,d,f)}),l=await pt(a,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),f=Z.find(s,{function_name:p.name});return Jd(p,d,f)});return{functions:c,procedures:l}},async _retrieveUserDefinedTypes(t){ye.progress("Get User-Defined Types",t);let e=await k.queryTolerant(F.GET_USER_DEFINED_TYPES,[t]),r=await pt(e,async n=>uf(n)?{...n,columns:await k.queryTolerant(F.GET_COMPOSITE_TYPE_COLUMNS,[n.pg_class_oid])}:n);return cf(r)},async _retrieveSingleTableData(t,e,r,n,{tableName:s}){ye.progress("Get table data",r,s);let o=await k.queryTolerant(F.GET_TABLE_LEVEL_DATA,[s,e],!0),a=o==null?void 0:o.oid,c=await k.queryTolerant(F.GET_TABLE_TOAST_OPTIONS,[s,e],!0),l=await this._getTableColumns(s,r,a),p=await k.queryTolerant(F.GET_DESCRIPTION_BY_OID,[a,"pg_class"],!0),d=await k.queryTolerant(F.GET_TABLE_CONSTRAINTS,[a]),f=await k.queryTolerant(F.GET_TABLE_INDEXES,[a]),h=await k.queryTolerant(F.GET_TABLE_INDEX_PARTITIONING_DATA,[a]),S=await k.queryTolerant(F.GET_TABLE_INDEX_CREATE_INFO,[a]),y=await k.queryTolerant(F.GET_TABLE_FOREIGN_KEYS,[a]);ye.info("Table data retrieved",{schemaName:r,tableName:s,columnTypes:l.map(Ee=>Ee.data_type)});let T=sf(o,c),_=Sf(p),P=rf(d,l,f),N=of({tableIndexesResult:f,tableIndexesCreateInfoResult:S,tableIndexesPartitioningResult:h}),w=zd(y,s,r,l),D={description:_,Indxs:N,...T,...P},C=ia(D),b=l.map(Qd(n)),M=tf(b),B=[];M&&(B=await this._getDocuments(r,s,b,t),b=Wd(b,B));let{attributes:Q,entityLevel:ge}=gf(b,C);return{name:s,entityLevel:ge,jsonSchema:sa(Q),documents:B,relationships:w}},async _getTableColumns(t,e,r){ye.progress("Get columns",e,t);let n=await k.query(F.GET_TABLE_COLUMNS,[t,e]),s=await k.queryTolerant(F.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return Z.map(n,o=>({...o,ordinal_position:Number(o.ordinal_position),...Z.find(s,{name:o.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;ye.progress("Sampling table",t,e);let s=`${t}.${e}`,o=((p=await k.queryTolerant(F.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,a=nf(o,n),c=r.filter(({type:d})=>Z.includes(["json","jsonb"],d)),l=Z.map(c,"name").join(", "),u=await k.queryTolerant(F.GET_SAMPLED_DATA_SIZE(s,l),[a],!0);return ye.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:u==null?void 0:u._hackolade_tmp_sampling_tbl_size}),await k.queryTolerant(F.GET_SAMPLED_DATA(s,l),[a])},async _retrieveSingleViewData(t,e,r){ye.progress("Get view data",e,r),r=df(r);let n=await k.query(F.GET_VIEW_DATA,[r,e],!0),s=!n.view_definition&&await k.queryTolerant(F.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),o=await k.queryTolerant(F.GET_VIEW_OPTIONS,[r,t],!0),a=ff(r,n,s),c=yf(n,o);return a?{name:r,data:c,ddl:{script:a,type:"postgres"}}:(ye.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:c,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await k.queryTolerant(F.GET_VERSION_AS_NUM,[],!0),e=Z.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var Ef=i(t=>!!(Z.startsWith(t,"pg_")||Z.includes(["information_schema"],t)),"isSystemSchema"),_f=i(t=>t===10?F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),Sf=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),pt=i((t,e)=>Promise.all(Z.map(t,e)),"mapPromises")});var ua=A((PE,ca)=>{"use strict";var{createLogger:Mt}=Kt(),z=vn();ca.exports={async disconnect(t,e,r,n){let s=n.require("@hackolade/ssh-service");await z.disconnect(s),r()},async testConnection(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Rn("Test connection",t,e);let o=Mt({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});z.setDependencies(n),await z.connect(t,s,o),await z.pingDb(),await z.logVersion(),r()}catch(o){e.log("error",qe(o),"Test connection instance log"),r(qe(o))}finally{await z.disconnect(s)}},async getDatabases(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Rn("Get databases",t,e);let o=Mt({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});z.setDependencies(n),await z.connect(t,s,o),await z.logVersion();let a=await z.getDatabaseNames();return e.log("info",a,"All databases list",t.hiddenKeys),r(null,a)}catch(o){return e.log("error",o),r(qe(o))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Rn("Get DB table names",t,e);let o=Mt({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});z.setDependencies(n),await z.connect(t,s,o),await z.logVersion();let c=await(await z.getAllSchemasNames()).reduce(async(l,u)=>{let p=await l;try{let d=await z.getTablesNames(u);return p.concat({dbName:u,dbCollections:d,isEmpty:d.length===0})}catch(d){return o.info(`Error reading database "${u}"`),o.error(d),p.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(o){e.log("error",qe(o),"Get DB collections names"),r(qe(o)),await z.disconnect(s)}},async getDbCollectionsData(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let o=Mt({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});o.progress("Start reverse engineering...");let a=t.collectionData.collections,c=t.collectionData.dataBaseNames,l=await z.getDbLevelData(),{packages:u,relationships:p}=await Promise.all(c.map(async d=>{let{tables:f,views:h,modelDefinitions:S}=await z.retrieveEntitiesData(d,a[d],t.recordSamplingSettings),{functions:y,procedures:T}=await z.retrieveSchemaLevelData(d,t.ignoreUdfUdpTriggers);return o.progress("Schema data fetched successfully",d),{schemaName:d,tables:f,views:h,functions:y,procedures:T,modelDefinitions:S}})).then(d=>{let f=d.flatMap(({tables:S})=>S.map(y=>y.relationships)).flat();return{packages:d.flatMap(({schemaName:S,tables:y,views:T,functions:_,procedures:P,modelDefinitions:N})=>{let w={UDFs:_,Procedures:P},D=y.map(C=>({dbName:S,collectionName:C.name,documents:C.documents,views:[],emptyBucket:!1,entityLevel:C.entityLevel,validation:{jsonSchema:C.jsonSchema},bucketInfo:w,modelDefinitions:N})).sort(C=>n.require("lodash").isEmpty(C.entityLevel.inherits)?-1:1);if(T!=null&&T.length){let C={dbName:S,views:T,emptyBucket:!1};return[...D,C]}return D}),relationships:f}}).then(({packages:d,relationships:f})=>({packages:Tf(d),relationships:f}));o.info("The data is processed and sent to the application",{packagesLength:u==null?void 0:u.length,relationshipsLength:p==null?void 0:p.length}),r(null,u,l,p)}catch(o){e.log("error",qe(o),"Retrieve tables data"),r(qe(o))}finally{await z.disconnect(s)}}};var qe=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Rn=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Tf=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var pa=A((LE,la)=>{"use strict";var xt=vn(),Cf=i(async(t,e,r)=>{try{let n=r.require("@hackolade/ssh-service");xt.setDependencies(r),await xt.connect(t,n,e),await xt.logVersion(),await xt.applyScript(Af(t.script))}catch(n){throw e.error(n),Nf(n)}},"applyToInstance"),Af=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),Nf=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");la.exports={applyToInstance:Cf}});var re=A((xE,ma)=>{"use strict";var Ln=class Ln{script;isDropScript};i(Ln,"ModificationScript");var Pn=Ln,Mn=class Mn{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(o=>({isDropScript:n,script:o}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(Mn,"AlterScriptDto");var Dn=Mn;ma.exports={ModificationScript:Pn,AlterScriptDto:Dn}});var je=A((kE,da)=>{"use strict";var Un=class Un{id;constraintName;indexStorageParameters;indexInclude};i(Un,"AlterCollectionColumnPrimaryKeyOptionDto");var xn=Un,Kn=class Kn{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(Kn,"AlterCollectionColumnDto");var qn=Kn,Gn=class Gn extends xn{compositePrimaryKey};i(Gn,"AlterCollectionRoleCompModPKDto");var kn=Gn,Vn=class Vn{new;old};i(Vn,"AlterCollectionRoleCompModPrimaryKey");var Fn=Vn,Hn=class Hn{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;bucketId;compMod;name;roleType;patternProperties};i(Hn,"AlterCollectionRoleDto");var Bn=Hn,Qn=class Qn{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Qn,"AlterCollectionDto");var $n=Qn;da.exports={AlterCollectionDto:$n,AlterCollectionRoleDto:Bn,AlterCollectionColumnDto:qn,AlterCollectionRoleCompModPrimaryKey:Fn,AlterCollectionRoleCompModPKDto:kn}});var ha=A((BE,fa)=>{"use strict";var bf=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),If=Object.values(bf);fa.exports={ReservedWordsAsArray:If}});var q=A((KE,ya)=>{"use strict";var{AlterCollectionDto:$E,AlterCollectionRoleDto:UE}=je(),{ReservedWordsAsArray:Of}=ha(),wf=/\t|\n|'|\f|\r/gm;ya.exports=t=>{let e=i(g=>t.get(g,"[0].code")||t.get(g,"[0].name",""),"getDbName"),r=i(g=>g&&(g.code||g.collectionName)||"","getEntityName"),n=i(g=>g&&(g.code||g.name)||"","getViewName"),s=i(g=>Object.assign({},t.get(g,"[0]",{}),{name:e(g)}),"getDbData"),o=i(g=>t.get(g,"[0].viewOn"),"getViewOn"),a=i((g,O="	")=>g.split(`
`).map(x=>O+x).join(`
`),"tab"),c=i((g,O)=>Object.keys(g).map(t.toLower).includes(t.toLower(O)),"hasType"),l=i(g=>({...g,...t.omit(g==null?void 0:g.role,"properties")||{}}),"getSchemaOfAlterCollection"),u=i(g=>{var $;let O=r(g),x=($=g.compMod)==null?void 0:$.keyspaceName;return B(O,x)},"getFullCollectionName"),p=i(g=>Object.entries(g).filter(([O,x])=>!t.isNil(x)).reduce((O,[x,$])=>({...O,[x]:$}),{}),"clean"),d=i(g=>g.every(O=>t.get(O,"isActivated",!0)),"checkAllKeysActivated"),f=i(g=>g.length?g.every(O=>!t.get(O,"isActivated",!0)):!1,"checkAllKeysDeactivated"),h=i((g,O)=>{let x=g.filter(W=>t.get(W,"isActivated",!0)).map(O),$=g.filter(W=>!t.get(W,"isActivated",!0)).map(O);return{activatedItems:x,deactivatedItems:$}},"divideIntoActivatedAndDeactivated"),S=i((g,{isActivated:O,isPartOfLine:x,inlineComment:$="--"})=>g?O!==!1?g:x?"/* "+g+" */":g.includes(`
`)?`/*
`+g+` */
`:$+" "+g:"","commentIfDeactivated"),y=i((g,O="'",x="'")=>{let $=g[0];return g[g.length-1]===O&&$===x?g:`${O}${g}${x}`},"wrap"),T=i((g,O)=>O.some(x=>(g==null?void 0:g.oldField[x])!==(g==null?void 0:g.newField[x])),"checkFieldPropertiesChanged"),_=i(g=>{var W;let O={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},x=r(O),$=(W=O.compMod)==null?void 0:W.keyspaceName;return B(x,$)},"getFullTableName"),P=i((g,O)=>`${_(g)}.${Q(O)}`,"getFullColumnName"),N=i(g=>{var W;let O={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},x=n(O),$=(W=O.compMod)==null?void 0:W.keyspaceName;return B(x,$)},"getFullViewName"),w=i(g=>g.code||g.name,"getUdtName"),D=i((g="")=>{let O=g.match(/\d+/);return Number(t.get(O,[0],0))},"getDbVersion"),C=i((g="")=>g.replace(wf,O=>`\\${O}`),"prepareComment"),b=i(g=>`E'${C(JSON.stringify(g)).slice(1,-1)}'`,"wrapComment"),M=i(g=>t.map(g,O=>{let x=O.defaultExpression?`DEFAULT ${O.defaultExpression}`:"";return t.trim(`${O.argumentMode} ${O.argumentName||""} ${O.argumentType} ${x}`)}).join(", "),"getFunctionArguments"),B=i((g,O)=>O?`${Q(O)}.${Q(g)}`:Q(g),"getNamePrefixedWithSchemaName"),Q=i(g=>/\s|\W/.test(g)||t.includes(Of,t.toUpper(g))?`"${g}"`:g,"wrapInQuotes"),ge=i(({name:g})=>Q(g),"columnMapToString"),Ee=i((g,O,x,$=ge)=>{var E;let W=h(g,$),m=(E=W==null?void 0:W.deactivatedItems)!=null&&E.length?S(W.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!O&&x?" ("+W.activatedItems.join(", ")+m+")":" ("+g.map($).join(", ")+")"},"getColumnsList"),Se=i(g=>g?g.alias?`${Q(g.name)} as ${Q(g.alias)}`:Q(g.name):"","getKeyWithAlias");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:o,tab:a,hasType:c,clean:p,checkAllKeysActivated:d,checkAllKeysDeactivated:f,divideIntoActivatedAndDeactivated:h,commentIfDeactivated:S,wrap:y,checkFieldPropertiesChanged:T,getFullTableName:_,getFullColumnName:P,getFullViewName:N,getUdtName:w,getDbVersion:D,wrapComment:b,getFunctionArguments:M,getNamePrefixedWithSchemaName:B,wrapInQuotes:Q,getColumnsList:Ee,getViewData:i(g=>Array.isArray(g)?g.reduce((O,x)=>{if(!x.tableName)return O.columns.push(Se(x)),O;let $=`${Q(x.dbName)}.${Q(x.tableName)}`;return O.tables.includes($)||O.tables.push($),O.columns.push({statement:`${$}.${Se(x)}`,isActivated:x.isActivated}),O},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getSchemaOfAlterCollection:l,getFullCollectionName:u}}});var Sa=A((VE,_a)=>{"use strict";var{AlterScriptDto:ga}=re(),Ea=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),vf=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=q()(t),o=Ea(r);if(o.new&&o.new!==o.old){let a=n(o.new),c=s(r.role.name),l=e.updateSchemaComment(c,a);return ga.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),Rf=i((t,e)=>r=>{let{wrapInQuotes:n}=q()(t),s=Ea(r);if(s.old&&!s.new){let o=n(r.role.name),a=e.dropSchemaComment(o);return ga.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),Pf=i((t,e)=>r=>{let n=vf(t,e)(r),s=Rf(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");_a.exports={getModifySchemaCommentsScriptDtos:Pf}});var Ca=A((QE,Ta)=>{"use strict";Ta.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var Na=A((WE,Aa)=>{"use strict";Aa.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},int:{},int2:{},int4:{},decimal:{},float:{},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var Ia=A((YE,ba)=>{"use strict";ba.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${collate}${characterClassification};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${notValid}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON ${tableName}${using}${keys}${options};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}"}});var va=A((jE,wa)=>{"use strict";var Oa=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),Df=i(t=>t.match(Oa("gi"))||[],"getAllTemplates"),Lf=i(t=>(t.match(Oa("i"))||[])[1],"parseTemplate"),Mf=i((t,e)=>Df(t).reduce((r,n)=>{let s=Lf(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");wa.exports=Mf});var Pa=A((XE,Ra)=>{"use strict";Ra.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:o})=>({generateConstraintsString:i((f,h)=>{var _,P;let S=e(((f==null?void 0:f.deactivatedItems)||[]).join(`,
	`),{isActivated:!h,isPartOfLine:!0}),y=(_=f==null?void 0:f.activatedItems)!=null&&_.length?`,
	`+f.activatedItems.join(`,
	`):"",T=(P=f==null?void 0:f.deactivatedItems)!=null&&P.length?`
	`+S:"";return y+T},"generateConstraintsString"),foreignKeysToString:i(f=>{if(Array.isArray(f)){let h=f.filter(T=>t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),S=f.filter(T=>!t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),y=S.length?e(S,{isActivated:!1,isPartOfLine:!0}):"";return h.join(", ")+y}return f},"foreignKeysToString"),foreignActiveKeysToString:i(f=>f.map(h=>t.trim(h.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((f,h)=>S=>{let y=s(t.trim(S.name)),T=r(S.columns||[]),_=t.isEmpty(S.columns)?"":o(S.columns,T,h),P=S.include.length?` INCLUDE${o(S.include,T,h)}`:"",N=S.storageParameters?` WITH (${S.storageParameters})`:"";return{statement:n(f.createKeyConstraint,{constraintName:S.name?`CONSTRAINT ${y} `:"",keyType:S.keyType,columns:_,includeNonKey:P,storageParameters:N}),isActivated:!T}},"createKeyConstraint"),getConstraintsWarnings:i((f=[])=>t.isEmpty(f)?"":`
	`+f.map(h=>{let S=h.name?` [constraint name: ${h.name}]`:"";return`-- ${h.errorMessage}${S}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(f=>{let h=t.get(f,"relationshipOnDelete",""),S=t.get(f,"relationshipOnUpdate",""),y=t.get(f,"relationshipMatch","");return{foreignOnDelete:h,foreignOnUpdate:S,foreignMatch:y}},"additionalPropertiesForForeignKey")})});var La=A((JE,Da)=>{"use strict";Da.exports=(t,e)=>{let r=i((y,T)=>Object.entries(y.properties).map(T),"mapProperties"),n=i(y=>y.compositeUniqueKey?!1:!!y.unique,"isUniqueKey"),s=i(y=>{var T,_;return n(y)&&(((T=y.uniqueKeyOptions)==null?void 0:T.length)===1&&!((_=t.first(y.uniqueKeyOptions))!=null&&_.constraintName)||t.isEmpty(y.uniqueKeyOptions))},"isInlineUnique"),o=i(y=>y.compositeUniqueKey||y.compositePrimaryKey?!1:!!y.primaryKey,"isPrimaryKey"),a=i(y=>{var T;return o(y)&&!((T=t.first(y.primaryKeyOptions))!=null&&T.constraintName)},"isInlinePrimaryKey"),c=i(({options:y,columnName:T,isActivated:_,jsonSchema:P,dbVersion:N})=>e({keyType:"UNIQUE",name:y.constraintName,columns:[{name:T,isActivated:_}],include:d(y.indexInclude||[],P),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydrateUniqueOptions"),l=i((y,T,_,P)=>e({keyType:"PRIMARY KEY",name:y.constraintName,columns:[{name:T,isActivated:_}],include:d(y.indexInclude||[],P),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydratePrimaryKeyOptions"),u=i((y,T)=>Object.keys(T).find(_=>T[_].GUID===y),"findName"),p=i((y,T)=>t.get(Object.values(T).find(_=>_.GUID===y),"isActivated",!0),"checkIfActivated"),d=i((y,T)=>t.map(y,_=>({name:u(_.keyId,T.properties),isActivated:p(_.keyId,T.properties)})),"getKeys"),f=i(y=>Array.isArray(y.primaryKey)?y.primaryKey.map(T=>t.isEmpty(T.compositePrimaryKey)?{name:T.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(T,null,null,y),columns:d(T.compositePrimaryKey,y)}):[],"getCompositePrimaryKeys"),h=i((y,T)=>Array.isArray(y.uniqueKey)?y.uniqueKey.map(_=>t.isEmpty(_.compositeUniqueKey)?{name:_.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...c({options:_,columnName:null,isActivated:null,jsonSchema:y,dbVersion:T}),columns:d(_.compositeUniqueKey,y)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((y,T)=>{if(!y.properties)return[];let _=r(y,([N,w])=>{if(!(!o(w)||a(w)))return l(t.first(w.primaryKeyOptions),N,w.isActivated,y)}).filter(Boolean),P=t.flatten(r(y,([N,w])=>!n(w)||s(w)?[]:(w.uniqueKeyOptions||[]).map(D=>c({options:D,columnName:N,isActivated:w.isActivated,jsonSchema:y,dbVersion:T})))).filter(Boolean);return[..._,...f(y),...P,...h(y,T)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:a,getKeys:d,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:c}}});var xa=A((t_,Ma)=>{"use strict";Ma.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=i((N,w)=>t.map(w,D=>{let C=D.functionOrReplace?" OR REPLACE":"",b=r(e.createFunction,{name:s(D.name,N),orReplace:C,parameters:n(D.functionArguments),returnType:D.functionReturnsSetOf?`SETOF ${D.functionReturnType}`:D.functionReturnType,language:D.functionLanguage,properties:c(D),definition:D.functionBody}),M=D.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(D.name,N),comment:o(D.functionDescription)}):"";return[b,M].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(N=>{let w=i(D=>D?`	${D}
`:"","wrap");return[{key:"functionWindow",getValue:l},{key:"functionVolatility",getValue:u},{key:"functionLeakProof",getValue:p},{key:"functionNullArgs",getValue:d},{key:"functionSqlSecurity",getValue:f},{key:"functionParallel",getValue:h},{key:"functionExecutionCost",getValue:S},{key:"functionExecutionRows",getValue:y},{key:"functionSupportFunction",getValue:T},{key:"functionConfigurationParameters",getValue:_}].map(D=>w(D.getValue(N[D.key],N))).filter(Boolean).join("")},"getProperties"),l=i((N,w)=>w.language!=="c"||!N?"":"WINDOW","getWindow"),u=i(N=>N,"getVolatility"),p=i(N=>N?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),d=i(N=>N,"getNullArgs"),f=i(N=>{if(N)return`SECURITY ${N}`},"getSqlSecurity"),h=i(N=>{if(N)return`PARALLEL ${N}`},"getParallel"),S=i(N=>{if(N)return`COST ${N}`},"getExecutionCost"),y=i((N,w)=>!N||!w.functionReturnsSetOf&&!P(w)?"":`ROWS ${N}`,"getExecutionRows"),T=i(N=>{if(N)return`SUPPORT ${N}`},"getSupportFunction"),_=i(N=>{if(N)return`SET ${N}`},"getConfigurationParameters"),P=i(N=>(N.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:a}}});var ka=A((n_,qa)=>{"use strict";qa.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((a,c)=>t.map(c,l=>{let u=l.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(l.name,a),orReplace:u,parameters:n(l.inputArgs),language:l.language,body:l.body})}).join(`
`),"getProceduresScript")})});var Ba=A((i_,Fa)=>{"use strict";Fa.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,d)=>p?" TEMPORARY":d?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let d=i(h=>h?`${h}
`:"","wrap"),f=[{key:"inherits",getValue:l("INHERITS")},{key:"partitionBounds",getValue:l("")},{key:"partitioning",getValue:o},{key:"usingMethod",getValue:l("USING")},{key:"storage_parameter",getValue:u},{key:"on_commit",getValue:c},{key:"selectStatement",getValue:l("AS")}].map(h=>d(h.getValue(p[h.key],p))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),o=i((p,{isActivated:d})=>{if(p&&p.partitionMethod){let h=a(p,d)+` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${h}`}},"getPartitioning"),a=i((p,d)=>{let f=r(p.compositePartitionKey);return e(p.compositePartitionKey,f,d)},"getPartitionKeys"),c=i((p,d)=>{if(p&&d.temporary)return`ON COMMIT ${p}`},"getOnCommit"),l=i(p=>d=>{if(d)return`${p} ${d}`},"getBasicValue"),u=i(p=>{if(t.isEmpty(p))return"";let d=["ttl_storage_parameters"],f=["id",...d];return t.chain(p).toPairs().flatMap(([h,S])=>d.includes(h)?t.toPairs(S):[[h,S]]).reject(([h])=>t.includes(f,h)).map(([h,S])=>{if(!(!S&&S!==0))return`${h}=${S}`}).compact().join(`,
	`).trim().thru(h=>{if(h)return`WITH (
	${h}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var Ua=A((a_,$a)=>{"use strict";$a.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=["composite","enum","range_udt","domain"],c=i((h,S)=>{let y=s(h.name,h.schemaName),T=r(n.comment,{object:"TYPE",objectName:y,comment:o(h.comment)});switch(h.type){case"composite":return r(n.createCompositeType,{name:y,columnDefinitions:t.join(S,`,
	`),comment:h.comment?T:""});case"enum":return r(n.createEnumType,{name:y,values:t.map(h.enum,_=>`'${_}'`).join(", "),comment:h.comment?T:""});case"range_udt":return r(n.createRangeType,{name:y,subtype:h.rangeSubtype,options:u(h),comment:h.comment?T:""});case"domain":{let _=r(n.comment,{object:"DOMAIN",objectName:y,comment:o(h.comment)});return r(n.createDomainType,{name:y,underlyingType:h.underlyingType,notNull:h.nullable?"":" NOT NULL",collate:h.collation?`
	COLLATE ${h.collation}`:"",default:h.default?`
	DEFAULT ${h.default}`:"",constraints:p(h),comment:h.comment?_:""})}default:return""}},"getPlainUdt"),l=i(h=>a.includes(h.type),"isNotPlainType"),u=i(h=>{let S=i(T=>T?`	${T}`:"","wrap"),y=[{key:"operatorClass",getValue:d("SUBTYPE_OPCLASS")},{key:"collation",getValue:d("COLLATION")},{key:"canonicalFunction",getValue:d("CANONICAL")},{key:"subtypeDiffFunction",getValue:d("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:d("MULTIRANGE_TYPE_NAME")}].map(T=>S(T.getValue(h[T.key]))).filter(Boolean).join(`,
`);return t.trim(y)?`,
	`+t.trim(y):""},"getRangeOptions"),p=i(h=>t.map(h.checkConstraints,S=>S.name?`
	CONSTRAINT ${S.name} CHECK (${S.expression})`:`
	CHECK (${S.expression})`).join(""),"getDomainConstraints"),d=i(h=>S=>{if(S)return`${h}=${S}`},"getBasicValue");return{getUserDefinedType:i((h,S)=>e(c(h,S),{isActivated:h.isActivated}),"getUserDefinedType"),isNotPlainType:l}}});var Ga=A((u_,Ka)=>{"use strict";Ka.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:u,sortOrder:p,nullsOrder:d,opclass:f})=>{let h=p?` ${p}`:"",S=d?` ${d}`:"",y=f?` ${f}`:"";return`${e(u)}${y}${h}${S}`},"mapIndexKey"),o=i((u=[],p)=>{let d=r(u);return n(u,d,p,s)},"getIndexKeys"),a=i((u,p)=>{var w;let d=n(u.include||[],r(u.include||[]),p),f=["btree"],h=u.using_hash&&f.includes(u.index_method)?" USING HASH":"",S=(w=u.include)!=null&&w.length?` INCLUDE ${t.trim(d)}`:"",y=u.partitioning_expression||"",T=c(u),_=T?` WITH (
	${T})`:"",P=u.where?` WHERE ${u.where}`:"",N=u.visibility?` ${u.visibility}`:"";return t.compact([" ",h,S,y,_,P,N]).join(`
`)},"getIndexOptions"),c=i(u=>{let p=["id"];return t.chain(u.index_storage_parameter).toPairs().map(([d,f])=>{if(!(p.includes(d)||t.isNil(f)||f===""))return`${d}=${l(f)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(u=>t.isBoolean(u)?u?"ON":"OFF":u,"getValue");return{getIndexKeys:o,getIndexOptions:a}}});var Ha=A((p_,Va)=>{"use strict";Va.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:o})=>{let a=i((C,b)=>`${C}(${b})`,"addLength"),c=i((C,b,M)=>t.isNumber(M)?`${C}(${b},${M})`:`${C}(${b})`,"addScalePrecision"),l=i((C,b)=>t.isNumber(b)?`${C}(${b})`:C,"addPrecision"),u=i((C,b)=>b?`${C} ${b}`:C,"addWithTimezone"),p=i(({type:C,typeModifier:b,srid:M})=>{let B=M?`, ${M}`:"";return b&&b!==""?`${C}(${b}${B})`:C},"addTypeModifier"),d=i((C,b)=>{let M=(b==null?void 0:b.map(B=>`[${(B==null?void 0:B.array_size_limit)??""}]`).join("").trim())||"";return`${C}${M}`},"addArrayDecorator"),f=i(C=>["char","varchar","bit","varbit"].includes(C),"canHaveLength"),h=i(C=>["numeric","decimal"].includes(C),"canHavePrecision"),S=i(C=>["time","timestamp"].includes(C),"canHaveTimePrecision"),y=i(C=>["numeric","decimal"].includes(C),"canHaveScale"),T=i(C=>["geography","geometry"].includes(C),"canHaveTypeModifier"),_=i((C,b)=>(f(C)&&t.isNumber(b.length)?C=a(C,b.length):h(C)&&y(C)&&t.isNumber(b.precision)?C=c(C,b.precision,b.scale):h(C)&&t.isNumber(b.precision)?C=l(C,b.precision):T(C)?C=p({type:C,typeModifier:b.typeModifier,srid:b.srid}):S(C)&&(t.isNumber(b.timePrecision)||b.timezone)&&(C=u(l(C,b.timePrecision),b.timezone)),d(C,b.array_type)),"decorateType"),P=i(C=>["char","varchar","text","bit","varbit"].includes(C),"isString"),N=i(C=>["date","time","timestamp","interval"].includes(C),"isDateTime");return{decorateType:_,decorateDefault:i((C,b,M)=>{let B=["current_timestamp","current_user","null"];return(P(C)||N(C))&&!B.includes(t.toLower(b))&&!M?s(b):b},"decorateDefault"),getColumnComments:i((C,b)=>t.chain(b).filter("comment").map(M=>{let B=e(r.comment,{object:"COLUMN",objectName:`${C}.${o(M.name)}`,comment:s(M.comment)});return n(B,M)}).join(`
`).value(),"getColumnComments")}}});var J=A((d_,Wa)=>{"use strict";var xf=Ca(),Qa=Na(),R=Ia();Wa.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:o,checkAllKeysDeactivated:a,divideIntoActivatedAndDeactivated:c,hasType:l,wrap:u,clean:p,wrapComment:d,getFunctionArguments:f,wrapInQuotes:h,getNamePrefixedWithSchemaName:S,getColumnsList:y,getViewData:T}=q()(n),_=va(),{generateConstraintsString:P,foreignKeysToString:N,foreignActiveKeysToString:w,createKeyConstraint:D,getConstraintsWarnings:C,additionalPropertiesForForeignKey:b}=Pa()({_:n,commentIfDeactivated:o,checkAllKeysDeactivated:a,assignTemplates:_,getColumnsList:y,wrapInQuotes:h}),M=La()(n,p),{getFunctionsScript:B}=xa()({_:n,templates:R,assignTemplates:_,getFunctionArguments:f,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getProceduresScript:Q}=ka()({_:n,templates:R,assignTemplates:_,getFunctionArguments:f,getNamePrefixedWithSchemaName:S}),{getTableTemporaryValue:ge,getTableOptions:Ee}=Ba()({_:n,checkAllKeysDeactivated:a,getColumnsList:y}),{getUserDefinedType:Se,isNotPlainType:Oe}=Ua()({_:n,commentIfDeactivated:o,assignTemplates:_,templates:R,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getIndexKeys:g,getIndexOptions:O}=Ga()({_:n,wrapInQuotes:h,checkAllKeysDeactivated:a,getColumnsList:y}),{decorateType:x,decorateDefault:$,getColumnComments:W}=Ha()({_:n,wrap:u,assignTemplates:_,templates:R,commentIfDeactivated:o,wrapInQuotes:h,wrapComment:d});return{createDatabase(m){if(!m.databaseName)return"";let{collate:E,characterClassification:I}=m;return _(R.createDatabase,{name:h(m.databaseName),template:m.template?`
	TEMPLATE ${m.template}`:"",encoding:m.encoding?`
	ENCODING = '${m.encoding}'`:"",collate:E?`
	LC_COLLATE = '${m.collate}'`:"",characterClassification:I?`
	LC_CTYPE = '${I}'`:""})},createSchema({schemaName:m,ifNotExist:E,comments:I,udfs:v,procedures:U}){let te=_(R.comment,{object:"SCHEMA",objectName:h(m),comment:d(I)}),X=_(R.createSchema,{name:h(m),ifNotExist:E?" IF NOT EXISTS":"",comment:I?te:""}),Y=B(m,v),ne=Q(m,U);return n.chain([X,Y,ne]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:m,columns:E,checkConstraints:I,foreignKeyConstraints:v,schemaData:U,columnDefinitions:te,keyConstraints:X,inherits:Y,description:ne,ifNotExist:ce,usingMethod:me,on_commit:j,partitioning:pe,storage_parameter:Te,temporary:Ce,unlogged:_e,selectStatement:Ae,partitionOf:oe,partitionBounds:Re},Ne){let dt=ce?" IF NOT EXISTS":"",Fe=S(m,U.schemaName),ft=_(R.comment,{object:"TABLE",objectName:Fe,comment:d(ne)}),de=c(X.filter(({errorMessage:De})=>!De).map(D(R,Ne)),De=>De.statement),Ut=C(X.filter(({errorMessage:De})=>De)),Pe=`${P(de,Ne)}${Ut}`,xs=oe?Pe==null?void 0:Pe.slice(1):Pe,zc=c(v,De=>De.statement),qs=P(zc,Ne),Xc=`
`+W(Fe,te),Zc=oe?R.createTablePartitionOf:R.createTable,Jc=oe&&!Pe?`
	`:`,
	`,ks=n.isEmpty(I)?"":u(n.join(I,`,
	`),Jc,""),Fs=oe&&!xs&&!ks&&!qs,eu=Fs?"":"(",tu=Fs?"":")",ru=_(Zc,{temporary:ge(Ce,_e),ifNotExist:dt,name:Fe,columnDefinitions:oe?"":"	"+n.join(E,`,
	`),keyConstraints:xs,checkConstraints:ks,foreignKeyConstraints:qs,options:Ee({inherits:Y,partitioning:pe,usingMethod:me,on_commit:j,storage_parameter:Te,selectStatement:Ae,partitionBounds:Re}),comment:ne?ft:"",partitionOf:oe?` PARTITION OF ${oe} `:"",columnDescriptions:Xc,openParenthesis:eu,closeParenthesis:tu});return o([ru].map(n.trim).join(`

`).trim()+`
`,{isActivated:Ne})},convertColumnDefinition(m){let E=m.nullable?"":" NOT NULL",I=m.primaryKey?" "+D(R,!0)(m.primaryKeyOptions).statement:"",v=m.unique?" "+D(R,!0)(m.uniqueKeyOptions).statement:"",U=m.collationRule?` COLLATE "${m.collationRule}"`:"",te=Array.isArray(m.array_type)&&m.array_type.length>0,X=n.isUndefined(m.default)?"":" DEFAULT "+$(m.type,m.default,te),Y=m.dbVersion>=12&&m.generatedColumn&&m.columnGenerationExpression?_(R.generatedColumnClause,{generationExpression:m.columnGenerationExpression}):"";return o(_(R.columnDefinition,{name:h(m.name),type:x(m.type,m),generatedColumnClause:Y,notNull:E,primaryKey:I,uniqueKey:v,collation:U,defaultValue:X}),{isActivated:m.isActivated})},createIndex(m,E,I,v=!0){let U=E.unique&&E.index_method==="btree",te=h(E.indxName),X=U?" UNIQUE":"",Y=E.concurrently?" CONCURRENTLY":"",ne=E.ifNotExist?" IF NOT EXISTS":"",ce=E.index_method?` USING ${n.toUpper(E.index_method)}`:"",me=g(E.index_method==="btree"?E.columns:n.map(E.columns,pe=>n.omit(pe,"sortOrder","nullsOrder")),v),j=O(E,v);return o(_(R.index,{unique:X,concurrently:Y,ifNotExist:ne,name:te,using:ce,keys:me,options:j,tableName:S(m,E.schemaName)}),{isActivated:E.isActivated})},createCheckConstraint(m){return _(R.checkConstraint,{name:m.name?`CONSTRAINT ${h(m.name)}`:"",expression:n.trim(m.expression).replace(/^\(([\s\S]*)\)$/,"$1"),notValid:m.notValid?" NOT VALID":""})},createForeignKeyConstraint({name:m,foreignKey:E,primaryTable:I,primaryKey:v,primaryTableActivated:U,foreignTableActivated:te,foreignSchemaName:X,primarySchemaName:Y,customProperties:ne,isActivated:ce},me,j){let pe=a(v),Te=a(E),Ce=!pe&&!Te&&U&&te,{foreignOnDelete:_e,foreignOnUpdate:Ae,foreignMatch:oe}=b(ne),Re=_(R.createForeignKeyConstraint,{primaryTable:S(I,Y||j.schemaName),name:m?`CONSTRAINT ${h(m)}`:"",foreignKey:Ce?N(E):w(E),primaryKey:Ce?N(v):w(v),onDelete:_e?` ON DELETE ${_e}`:"",onUpdate:Ae?` ON UPDATE ${Ae}`:"",match:oe?` MATCH ${oe}`:""});return{statement:n.trim(Re),isActivated:Ce&&ce}},createForeignKey({name:m,foreignTable:E,foreignKey:I,primaryTable:v,primaryKey:U,primaryTableActivated:te,foreignTableActivated:X,foreignSchemaName:Y,primarySchemaName:ne,customProperties:ce,isActivated:me},j,pe){let Te=a(U),Ce=a(I),_e=!Te&&!Ce&&te&&X,{foreignOnDelete:Ae,foreignOnUpdate:oe,foreignMatch:Re}=b(ce),Ne=_(R.createForeignKey,{primaryTable:S(v,ne||pe.schemaName),foreignTable:S(E,Y||pe.schemaName),name:m?h(m):"",foreignKey:_e?N(I):w(I),primaryKey:_e?N(U):w(U),onDelete:Ae?` ON DELETE ${Ae}`:"",onUpdate:oe?` ON UPDATE ${oe}`:"",match:Re?` MATCH ${Re}`:""});return{statement:n.trim(Ne),isActivated:_e&&me}},createView(m,E,I){var Ne,dt,Fe,ft;let v=S(m.name,m.schemaName),U=_(R.comment,{object:"VIEW",objectName:v,comment:d(m.comment)}),X=a(m.keys||[])||!I,{columns:Y,tables:ne}=T(m.keys),ce=Y.map(de=>de.statement).join(`,
		`);if(!X){let de=c(Y,Pe=>Pe.statement),Ut=de.deactivatedItems.length?o(de.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";ce=de.activatedItems.join(`,
		`)+Ut}let me=n.trim(m.selectStatement)?n.trim(s(m.selectStatement)):_(R.viewSelectStatement,{tableName:ne.join(", "),keys:ce}),j=(Ne=m.viewOptions)!=null&&Ne.check_option?`check_option=${(dt=m.viewOptions)==null?void 0:dt.check_option}`:"",pe=(Fe=m.viewOptions)!=null&&Fe.security_barrier?"security_barrier":"",Te=15,{getDbVersion:Ce}=q()(n),_e=(ft=m.viewOptions)!=null&&ft.security_invoker&&Ce(E.dbVersion)>=Te?"security_invoker":"",Ae=j||pe||_e?`
	WITH (${n.compact([j,pe,_e]).join(",")})`:"",oe=i(de=>de.withCheckOption&&de.checkTestingScope?`
	WITH ${de.checkTestingScope} CHECK OPTION`:de.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption");return[o(_(R.createView,{name:v,orReplace:m.orReplace?" OR REPLACE":"",temporary:m.temporary?" TEMPORARY":"",checkOption:oe(m),comment:m.comment?U:"",withOptions:Ae,selectStatement:me}),{isActivated:!X})].map(n.trim).join(`

`).trim()+`
`},dropView(m){let E={viewName:m};return _(R.dropView,E)},createViewIndex(){return""},createUdt(m){let E=n.map(m.properties,this.convertColumnDefinition);return Se(m,E)},getDefaultType(m){return xf[m]},getTypesDescriptors(){return Qa},hasType(m){return l(Qa,m)},hydrateDatabase({modelData:m}){return m=n.get(m,"0",{}),{databaseName:m.database_name,encoding:m.encoding,template:m.template,collate:m.LC_COLLATE,characterClassification:m.LC_CTYPE,dbVersion:m.dbVersion}},hydrateColumn({columnDefinition:m,jsonSchema:E,schemaData:I,definitionJsonSchema:v={},parentJsonSchema:U}){let te=n.includes(["char","varchar","text"],m.type)?E.collationRule:"",X=["time","timestamp"],Y=n.includes(X,m.type)?E.timePrecision:"",ne=n.includes(X,m.type)?E.timezone:"",ce=m.type==="interval"?E.intervalOptions:"",{getDbVersion:me}=q()(n),j=me(I.dbVersion),pe=n.omit(M.hydratePrimaryKeyOptions(n.first(E.primaryKeyOptions)||{},m.name,m.isActivated,U),"columns"),Te=n.omit(M.hydrateUniqueOptions({options:n.first(E.uniqueKeyOptions)||{},columnName:m.name,isActivated:m.isActivated,jsonSchema:U,dbVersion:j}),"columns");return{name:m.name,type:m.type,primaryKey:M.isInlinePrimaryKey(E),primaryKeyOptions:pe,unique:M.isInlineUnique(E),uniqueKeyOptions:Te,nullable:m.nullable,default:m.default,comment:E.refDescription||E.description||v.description,isActivated:m.isActivated,scale:m.scale,precision:m.precision,length:m.length,enum:E.enum,array_type:E.array_type,unit:E.unit,rangeSubtype:E.rangeSubtype,operatorClass:E.operatorClass,collation:E.collation,canonicalFunction:E.canonicalFunction,subtypeDiffFunction:E.subtypeDiffFunction,multiRangeType:E.multiRangeType,schemaName:I.schemaName,underlyingType:E.underlyingType,checkConstraints:E.checkConstraints,typeModifier:E.typeModifier,srid:E.srid,collationRule:te,timePrecision:Y,timezone:ne,intervalOptions:ce,dbVersion:j,generatedColumn:!!E.generatedColumn,columnGenerationExpression:E.columnGenerationExpression}},hydrateJsonSchemaColumn(m,E){return!m.$ref||n.isEmpty(E)||Oe(E)?m:(m=n.omit(m,"$ref"),{...E,...m})},hydrateIndex(m,E,I){return{...m,schemaName:I.schemaName}},hydrateViewIndex(m){return{}},hydrateCheckConstraint(m){return{name:m.chkConstrName,expression:m.constrExpression,notValid:m.notValid}},hydrateSchema(m,E){let I=n.get(E,"modelData.0.dbVersion");return{schemaName:m.name,ifNotExist:m.ifNotExist,comments:m.description,udfs:(E==null?void 0:E.udfs)||[],procedures:(E==null?void 0:E.procedures)||[],dbVersion:I}},hydrateTable({tableData:m,entityData:E,jsonSchema:I}){let v=E[0],U=n.chain(v.inherits).map(({parentTable:j})=>n.get(m,`relatedSchemas[${j}]`,"")).compact().map(j=>j.code||j.collectionName).join(", ").thru(j=>j?`(${j})`:"").value(),te=n.first(v.partitioning)||{},X=M.getKeys(te.compositePartitionKey,I),Y=n.get(m,`relatedSchemas[${v.partitionOf}]`),ne=Y?S(Y.collectionName,Y.bucketName):"",{getDbVersion:ce}=q()(n),me=ce(n.get(m,"dbData.dbVersion",""));return{...m,partitionOf:ne,keyConstraints:M.getTableKeyConstraints(I,me),inherits:U,selectStatement:n.trim(v.selectStatement),partitioning:n.assign({},te,{compositePartitionKey:X}),...n.pick(v,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","partitionBounds")}},hydrateViewColumn(m){return{name:m.name,tableName:m.entityName,alias:m.alias,isActivated:m.isActivated,dbName:m.dbName}},hydrateView({viewData:m,entityData:E,relatedSchemas:I}){let v=E[0];return{name:m.name,keys:m.keys,comment:v.description,orReplace:v.orReplace,temporary:v.temporary,recursive:v.recursive,viewOptions:v.viewOptions,selectStatement:v.selectStatement,withCheckOption:v.withCheckOption,checkTestingScope:v.withCheckOption?v.checkTestingScope:"",schemaName:m.schemaData.schemaName}},commentIfDeactivated(m,E,I){return m},alterColumnType(m,E,I,v){let U=I;return v.length?U+=`(${v.length})`:v.precision&&v.scale?U+=`(${v.precision},${v.scale})`:v.precision&&(U+=`(${v.precision})`),_(R.alterColumnType,{tableName:m,columnName:E,dataType:U})},setNotNullConstraint(m,E){return _(R.addNotNullConstraint,{tableName:m,columnName:E})},dropNotNullConstraint(m,E){return _(R.dropNotNullConstraint,{tableName:m,columnName:E})},renameColumn(m,E,I){return _(R.renameColumn,{tableName:m,oldColumnName:E,newColumnName:I})},addCheckConstraint(m,E,I){let v={tableName:m,constraintName:E,expression:I};return _(R.addCheckConstraint,v)},dropConstraint(m,E){let I={tableName:m,constraintName:E};return _(R.dropConstraint,I)},updateTableComment(m,E){let I={tableName:m,comment:E};return _(R.updateCommentOnTable,I)},dropTableComment(m){let E={tableName:m,comment:"NULL"};return _(R.updateCommentOnTable,E)},updateColumnComment(m,E){let I={columnName:m,comment:E};return _(R.updateCommentOnColumn,I)},dropColumnComment(m){let E={columnName:m,comment:"NULL"};return _(R.updateCommentOnColumn,E)},updateSchemaComment(m,E){let I={schemaName:m,comment:E};return _(R.updateCommentOnSchema,I)},dropSchemaComment(m){let E={schemaName:m,comment:"NULL"};return _(R.updateCommentOnSchema,E)},updateViewComment(m,E){let I={viewName:m,comment:E};return _(R.updateCommentOnView,I)},dropViewComment(m){let E={viewName:m,comment:"NULL"};return _(R.updateCommentOnView,E)},createSchemaOnly(m){let E={schemaName:m};return _(R.createSchemaOnly,E)},dropSchema(m){let E={schemaName:m};return _(R.dropSchema,E)},dropTable(m){let E={tableName:m};return _(R.dropTable,E)},addColumn(m,E){let I={tableName:m,columnDefinition:E};return _(R.addColumn,I)},dropColumn(m,E){let I={tableName:m,columnName:E};return _(R.dropColumn,I)},dropDomain(m){let E={udtName:m};return _(R.dropDomain,E)},dropType(m){let E={udtName:m};return _(R.dropType,E)},alterTypeAddAttribute(m,E){let I={udtName:m,columnDefinition:E};return _(R.alterTypeAddAttribute,I)},alterTypeDropAttribute(m,E){let I={udtName:m,attributeName:E};return _(R.alterTypeDropAttribute,I)},alterTypeRenameAttribute(m,E,I){let v={udtName:m,oldAttributeName:E,newAttributeName:I};return _(R.alterTypeRenameAttribute,v)},alterTypeChangeAttributeType(m,E,I){let v={udtName:m,attributeName:E,newDataType:I};return _(R.alterTypeChangeAttributeType,v)},dropForeignKey(m,E){let I={tableName:m,fkConstraintName:E};return _(R.dropForeignKey,I)},createKeyConstraint(m,E,I){let v=D(R,E)(I);return{statement:_(R.addPkConstraint,{constraintStatement:(v.statement||"").trim(),tableName:m}),isActivated:v.isActivated}},dropPkConstraint(m,E){let I={tableName:m,constraintName:E};return _(R.dropConstraint,I)}}}});var za=A((h_,ja)=>{"use strict";var{getModifySchemaCommentsScriptDtos:qf}=Sa(),{AlterScriptDto:Ya}=re(),kf=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{wrapInQuotes:s}=q()(r),o=n.createSchemaOnly(s(e));return Ya.getInstance([o],!0,!1)},"getAddContainerScriptDto"),Ff=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{wrapInQuotes:s}=q()(r),o=n.dropSchema(s(e));return Ya.getInstance([o],!0,!0)},"getDeleteContainerScriptDto"),Bf=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t);return[...qf(r,n)(e)]},"getModifyContainerScriptDtos");ja.exports={getAddContainerScriptDto:kf,getDeleteContainerScriptDto:Ff,getModifyContainerScriptDtos:Bf}});var Za=A((E_,Xa)=>{"use strict";var{AlterCollectionDto:g_}=je(),{AlterScriptDto:qt}=re(),$f=i(t=>e=>{var a;let r=(a=e==null?void 0:e.compMod)==null?void 0:a.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),Uf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>o.old&&!o.new).map(o=>{let a=s(o.old.chkConstrName);return e.dropConstraint(n,a)}).map(o=>qt.getInstance([o],!0,!0))},"getDropCheckConstraintScriptDtos"),Kf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>o.new&&!o.old).map(o=>{let{chkConstrName:a,constrExpression:c}=o.new;return e.addCheckConstraint(n,s(a),c)}).map(o=>qt.getInstance([o],!0,!1))},"getAddCheckConstraintScriptDtos"),Gf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>{if(o.old&&o.new){let a=o.old.constrExpression,c=o.new.constrExpression;return a!==c}return!1}).map(o=>{let{chkConstrName:a}=o.old,c=e.dropConstraint(n,s(a)),{chkConstrName:l,constrExpression:u}=o.new,p=e.addCheckConstraint(n,s(l),u);return[qt.getInstance([c],!0,!0),qt.getInstance([p],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),Vf=i((t,e)=>r=>{let{getFullTableName:n}=q()(t),s=n(r),o=$f(t)(r),a=Kf(t,e)(o,s),c=Uf(t,e)(o,s),l=Gf(t,e)(o,s);return[...a,...c,...l]},"getModifyCheckConstraintScriptDtos");Xa.exports={getModifyCheckConstraintScriptDtos:Vf}});var tc=A((T_,ec)=>{"use strict";var{AlterScriptDto:Ja}=re(),{AlterCollectionDto:S_}=je(),Hf=i((t,e)=>r=>{var d;let{getFullTableName:n,wrapComment:s}=q()(t),o=(d=r==null?void 0:r.role.compMod)==null?void 0:d.description;if(!o)return;let{old:a,new:c}=o;if(!c||c===a)return;let l=n(r),u=s(c),p=e.updateTableComment(l,u);return Ja.getInstance([p],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),Qf=i((t,e)=>r=>{var u;let{getFullTableName:n}=q()(t),s=(u=r==null?void 0:r.role.compMod)==null?void 0:u.description;if(!s)return;let{old:o,new:a}=s;if(!o||a)return;let c=n(r),l=e.dropTableComment(c);return Ja.getInstance([l],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),Wf=i((t,e)=>r=>{let n=Hf(t,e)(r),s=Qf(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");ec.exports={getModifyEntityCommentsScriptDtos:Wf}});var nc=A((A_,rc)=>{"use strict";var{AlterScriptDto:Yf}=re(),jf=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,o=r==null?void 0:r.length;return s!==o},"hasLengthChanged"),zf=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,o=r==null?void 0:r.precision,a=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==o||a!==c},"hasPrecisionOrScaleChanged"),Xf=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=q()(t),a=s(r);return t.toPairs(r.properties).filter(([c,l])=>{let u=n(l.compMod,["type","mode"]);if(!u){let p=l.compMod.oldField.name,d=jf(r,p,l),f=zf(r,p,l);return d||f}return u}).map(([c,l])=>{let u=l.compMod.newField.mode||l.compMod.newField.type,p=o(c),d=t.pick(l,["length","precision","scale"]);return e.alterColumnType(a,p,u,d)}).map(c=>Yf.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");rc.exports={getUpdateTypesScriptDtos:Xf}});var oc=A((b_,ic)=>{"use strict";var{AlterScriptDto:sc}=re(),Zf=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=q()(t),o=n(r),a=r.required||[],c=r.role.required||[],l=t.difference(a,c),u=t.difference(c,a),p=t.toPairs(r.properties).filter(([f,h])=>{let S=h.compMod.oldField.name,y=u.includes(S);return l.includes(f)&&!y}).map(([f])=>e.setNotNullConstraint(o,s(f))).map(f=>sc.getInstance([f],!0,!1)),d=t.toPairs(r.properties).filter(([f,h])=>{let S=h.compMod.oldField.name,y=u.includes(S),T=l.includes(f);return y&&!T}).map(([f])=>e.dropNotNullConstraint(o,s(f))).map(f=>sc.getInstance([f],!0,!0));return[...p,...d]},"getModifyNonNullColumnsScriptDtos");ic.exports={getModifyNonNullColumnsScriptDtos:Zf}});var uc=A((O_,cc)=>{"use strict";var{AlterScriptDto:ac}=re(),Jf=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=q()(t);return t.toPairs(r.properties).filter(([o,a])=>{var p;let c=a.description,l=a.compMod.oldField.name,u=(p=r.role.properties[l])==null?void 0:p.description;return c&&(!u||c!==u)}).map(([o,a])=>{let c=a.description,l=s(c),u=n(r,o);return e.updateColumnComment(u,l)}).map(o=>ac.getInstance([o],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),eh=i((t,e)=>r=>{let{getFullColumnName:n}=q()(t);return t.toPairs(r.properties).filter(([s,o])=>{var u;let a=o.description,c=o.compMod.oldField.name;return((u=r.role.properties[c])==null?void 0:u.description)&&!a}).map(([s,o])=>{let a=n(r,s);return e.dropColumnComment(a)}).map(s=>ac.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),th=i((t,e)=>r=>{let n=Jf(t,e)(r),s=eh(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");cc.exports={getModifiedCommentOnColumnScriptDtos:th}});var pc=A((v_,lc)=>{"use strict";var{AlterScriptDto:rh}=re(),nh=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=q()(t),a=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let l=o(c.compMod.oldField.name),u=o(c.compMod.newField.name);return e.renameColumn(a,l,u)}).map(c=>rh.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");lc.exports={getRenameColumnScriptDtos:nh}});var yc=A((q_,hc)=>{"use strict";var{AlterScriptDto:sh}=re(),{AlterCollectionDto:P_,AlterCollectionColumnDto:D_,AlterCollectionRoleCompModPKDto:L_,AlterCollectionColumnPrimaryKeyOptionDto:M_,AlterCollectionRoleCompModPrimaryKey:x_}=je(),ze=1,Yn=class Yn{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(Yn,"PkTransitionDto");var ie=Yn,jn=class jn{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(jn,"PkScriptModificationDto");var Xe=jn,Wn=i(t=>`${t}_pkey`,"getDefaultConstraintName"),mc=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),Ze=i(t=>(t.primaryKeyOptions||[]).map(r=>mc(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),kt=i(t=>[mc(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),ih=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).old||[],s=n.flatMap(f=>f.compositePrimaryKey.map(h=>h.keyId));if(s.length!==ze)return ie.noTransition();let o=s[0],a=Object.values(e.properties).find(f=>f.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return ie.noTransition();let l=Ze(a),u=n.some(f=>{if(f.compositePrimaryKey.length!==ze)return!1;let h=kt(f);return t(h).differenceWith(l,t.isEqual).isEmpty()});return ie.transition(!u)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),oh=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).new||[],s=n.flatMap(f=>f.compositePrimaryKey.map(h=>h.keyId));if(s.length!==ze)return ie.noTransition();let o=s[0],a=Object.values(e.role.properties).find(f=>f.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return ie.noTransition();let l=Ze(a),u=n.some(f=>{if(f.compositePrimaryKey.length!==ze)return!1;let h=kt(f);return t(h).differenceWith(l,t.isEqual).isEmpty()});return ie.transition(!u)},"wasCompositePkChangedInTransitionFromRegularToComposite"),ah=i((t,e)=>t.constraintName?t.constraintName:Wn(e),"getConstraintNameForCompositePk"),ch=i(t=>(e,r,n)=>{let s=ah(e,r),o=t.toPairs(n.role.properties).filter(([l,u])=>!!e.compositePrimaryKey.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated})),a="",c=[];return e.indexStorageParameters&&(a=e.indexStorageParameters),e.indexInclude&&(c=t.toPairs(n.role.properties).filter(([l,u])=>!!e.indexInclude.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:o,include:c,storageParameters:a}},"getCreateCompositePKDDLProviderConfig"),uh=i((t,e)=>r=>{var h,S;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=q()(t),a=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},c=a.new||[],l=a.old||[];if(c.length===0&&l.length===0)return[];let u=oh(t)(r);if(u.didTransitionHappen&&!u.wasPkChangedInTransition)return[];if(c.length===l.length&&t(l).differenceWith(c,t.isEqual).isEmpty())return[];let p=s(r),d=n(p),f=o(p);return c.map(y=>{let T=ch(t)(y,f,r),_=e.createKeyConstraint(d,r.isActivated,T);return new Xe(_.statement,d,!1,_.isActivated)}).filter(y=>!!y.script)},"getAddCompositePkScriptDtos"),lh=i((t,e)=>r=>{var S,y;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=q()(t),c=((y=(S=r==null?void 0:r.role)==null?void 0:S.compMod)==null?void 0:y.primaryKey)||{},l=c.new||[],u=c.old||[];if(l.length===0&&u.length===0)return[];let p=ih(t)(r);if(p.didTransitionHappen&&!p.wasPkChangedInTransition)return[];if(l.length===u.length&&t(u).differenceWith(l,t.isEqual).isEmpty())return[];let d=s(r),f=n(d),h=o(d);return u.map(T=>{let _=Wn(h);T.constraintName&&(_=T.constraintName);let P=a(_),N=e.dropPkConstraint(f,P);return new Xe(N,f,!0,r.isActivated)}).filter(T=>!!T.script)},"getDropCompositePkScriptDtos"),ph=i((t,e)=>r=>{let n=lh(t,e)(r),s=uh(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),dc=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return Wn(e)},"getConstraintNameForRegularPk"),mh=i(t=>(e,r,n,s)=>{let o=dc(r,n),a=[{name:e,isActivated:r.isActivated}],c="",l=[],u=r.primaryKeyOptions;if(u!=null&&u.length&&(u==null?void 0:u.length)>0){let p=u[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([d,f])=>!!p.indexInclude.find(h=>h.keyId===f.GUID)).map(([d,f])=>({name:d,isActivated:f.isActivated})))}return{name:o,keyType:"PRIMARY KEY",columns:a,include:l,storageParameters:c}},"getCreateRegularPKDDLProviderConfig"),dh=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);return o&&!a},"wasFieldChangedToBeARegularPk"),fh=i(t=>(e,r)=>{var h,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);if(!(o&&a))return ie.noTransition();let c=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],u=c.old||[],p=u.some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),d=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID));if(o&&(p&&!d)){let y=Ze(e),T=u.some(_=>{if(_.compositePrimaryKey.length!==ze)return!1;let P=kt(_);return t(P).differenceWith(y,t.isEqual).isEmpty()});return ie.transition(!T)}return ie.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),hh=i(t=>(e,r)=>{var h,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=s.primaryKey&&!s.compositePrimaryKey,a=!!(e!=null&&e.primaryKey);if(!(o&&a))return ie.noTransition();let c=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],p=(c.old||[]).some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),f=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID))&&!p;if(o&&f){let y=Ze(s),T=l.some(_=>{if(_.compositePrimaryKey.length!==ze)return!1;let P=kt(_);return t(P).differenceWith(y,t.isEqual).isEmpty()});return ie.transition(!T)}return ie.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),yh=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),a=!e.primaryKey&&!e.compositePrimaryKey;return o&&a},"isFieldNoLongerARegularPk"),fc=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},o=e.primaryKey&&!e.compositePrimaryKey,a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(o&&a))return!1;let c=Ze(e),l=Ze(s);return!t(l).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),gh=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=q()(t),a=s(r),c=n(a),l=o(a);return t.toPairs(r.properties).filter(([u,p])=>{if(dh(t)(p,r))return!0;let d=fh(t)(p,r);return d.didTransitionHappen?d.wasPkChangedInTransition:fc(t)(p,r)}).map(([u,p])=>{let d=mh(t)(u,p,l,r),f=e.createKeyConstraint(c,r.isActivated,d);return new Xe(f.statement,c,!1,f.isActivated)}).filter(u=>!!u.script)},"getAddPkScriptDtos"),Eh=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=q()(t),c=s(r),l=n(c),u=o(c);return t.toPairs(r.properties).filter(([p,d])=>{if(yh(t)(d,r))return!0;let f=hh(t)(d,r);return f.didTransitionHappen?f.wasPkChangedInTransition:fc(t)(d,r)}).map(([p,d])=>{let f=d.compMod.oldField.name,h=r.role.properties[f],S=a(dc(h,u)),y=e.dropPkConstraint(l,S);return new Xe(y,l,!0,r.isActivated)}).filter(p=>!!p.script)},"getDropPkScriptDto"),_h=i((t,e)=>r=>{let n=Eh(t,e)(r),s=gh(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),Sh=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),Th=i((t,e)=>r=>{let n=ph(t,e)(r),s=_h(t,e)(r),o=[...n,...s];return Sh(o).map(c=>sh.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");hc.exports={getModifyPkConstraintsScriptDtos:Th}});var mt=A((F_,gc)=>{"use strict";gc.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u})=>e({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u,getType:r}),"createColumnDefinitionBySchema")}}});var Tc=A((U_,Sc)=>{"use strict";var{getModifyCheckConstraintScriptDtos:Ch}=Za(),{getModifyEntityCommentsScriptDtos:Ah}=tc(),{getUpdateTypesScriptDtos:Nh}=nc(),{getModifyNonNullColumnsScriptDtos:bh}=oc(),{getModifiedCommentOnColumnScriptDtos:Ih}=uc(),{getRenameColumnScriptDtos:Oh}=pc(),{AlterScriptDto:Ft}=re(),{AlterCollectionDto:$_}=je(),{getModifyPkConstraintsScriptDtos:wh}=yc(),vh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{getEntityName:c}=q()(a),{createColumnDefinitionBySchema:l}=mt()(t),u=J()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),f={schemaName:o.compMod.keyspaceName,dbVersion:e},h={...o,...a.omit(o==null?void 0:o.role,"properties")||{}},S=a.toPairs(h.properties).map(([N,w])=>{let D=p({propertySchema:w,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return l({name:N,jsonSchema:w,parentJsonSchema:h,ddlProvider:u,schemaData:f,definitionJsonSchema:D})}),y=(h.chkConstr||[]).map(N=>u.createCheckConstraint(u.hydrateCheckConstraint(N))),T={name:c(h),columns:S.map(u.convertColumnDefinition),checkConstraints:y,foreignKeyConstraints:[],schemaData:f,columnDefinitions:S,dbData:{dbVersion:e}},_=u.hydrateTable({tableData:T,entityData:[h],jsonSchema:h}),P=u.createTable(_,h.isActivated);return Ft.getInstance([P],!0,!1)},"getAddCollectionScriptDto"),Rh=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{getFullTableName:s}=q()(r),o=s(e),a=n.dropTable(o);return Ft.getInstance([a],!0,!0)},"getDeleteCollectionScriptDto"),Ph=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),s=Ch(r,n)(e),o=Ah(r,n)(e),a=wh(r,n)(e);return[...s,...o,...a].filter(Boolean)},"getModifyCollectionScriptDtos"),Ec=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(o,a)=>{var P;let c=t.require("lodash"),{getEntityName:l,getNamePrefixedWithSchemaName:u}=q()(c),{createColumnDefinitionBySchema:p}=mt()(t),d=J()(null,null,t),{getDefinitionByReference:f}=t.require("@hackolade/ddl-fe-utils"),h={...o,...c.omit(o==null?void 0:o.role,"properties")||{}},S=l(h),y=(P=h.compMod)==null?void 0:P.keyspaceName,T=u(S,y),_={schemaName:y,dbVersion:e};return c.toPairs(o.properties).filter(([N,w])=>a([N,w])).map(([N,w])=>{let D=f({propertySchema:w,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return p({name:N,jsonSchema:w,parentJsonSchema:h,ddlProvider:d,schemaData:_,definitionJsonSchema:D})}).map(d.convertColumnDefinition).map(N=>d.addColumn(T,N)).map(N=>Ft.getInstance([N],!0,!1)).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),Dh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>Ec({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o,([a,c])=>!c.compMod),"getAddColumnScriptDtos"),_c=i(t=>(e,r)=>{var f;let n=t.require("lodash"),s=J()(null,null,t),{getEntityName:o,getNamePrefixedWithSchemaName:a,wrapInQuotes:c}=q()(n),l={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},u=o(l),p=(f=l.compMod)==null?void 0:f.keyspaceName,d=a(u,p);return n.toPairs(e.properties).filter(([h,S])=>r([h,S])).map(([h])=>{let S=c(h);return s.dropColumn(d,S)}).map(h=>Ft.getInstance([h],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),Lh=i(t=>e=>_c(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),Mh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash");return a.toPairs(o.properties).filter(([c,l])=>{let u=l.compMod.oldField.name,p=o.role.properties[u];return p.generatedColumn!==l.generatedColumn||p.columnGenerationExpression!==l.columnGenerationExpression}).flatMap(([c,l])=>{let u={...o,properties:a.fromPairs([[c,l]])},p=_c(t)(u,()=>!0),d=Ec({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(u,()=>!0);return[...p,...d]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),xh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),c=J()(null,null,t),l=Oh(a,c)(o),u=Mh({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o);if(u.length)return[...l,...u].filter(Boolean);let p=Nh(a,c)(o),d=bh(a,c)(o),f=Ih(a,c)(o);return[...l,...p,...d,...f].filter(Boolean)},"getModifyColumnScriptDtos");Sc.exports={getAddCollectionScriptDto:vh,getDeleteCollectionScriptDto:Rh,getModifyCollectionScriptDtos:Ph,getAddColumnScriptDtos:Dh,getDeleteColumnScriptDtos:Lh,getModifyColumnScriptDtos:xh}});var Ac=A((G_,Cc)=>{"use strict";var{AlterScriptDto:ke}=re(),qh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=mt()(t),l=J()(null,null,t),{getDefinitionByReference:u}=t.require("@hackolade/ddl-fe-utils"),p={dbVersion:e},d=a.toPairs(o.properties||{}).map(([y,T])=>{let _=u({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:y,jsonSchema:T,parentJsonSchema:o,ddlProvider:l,schemaData:p,definitionJsonSchema:_})}),h={...c({name:o.code||o.name,jsonSchema:o,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:l,schemaData:p}),properties:d},S=l.createUdt(h);return ke.getInstance([S],!0,!1)},"getCreateUdtScriptDto"),kh=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{getUdtName:s,wrapInQuotes:o}=q()(r),a=o(s(e));if(e.type==="domain"){let c=n.dropDomain(a);return ke.getInstance([c],!0,!0)}else{let c=n.dropType(a);return ke.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),Fh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=mt()(t),{getUdtName:l,wrapInQuotes:u}=q()(a),p=J()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),f=u(l(o)),h={dbVersion:e};return a.toPairs(o.properties).filter(([S,y])=>!y.compMod).map(([S,y])=>{let T=d({propertySchema:y,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:S,jsonSchema:y,parentJsonSchema:{required:[]},ddlProvider:p,schemaData:h,definitionJsonSchema:T})}).map(p.convertColumnDefinition).map(S=>p.alterTypeAddAttribute(f,S)).map(S=>ke.getInstance([S],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),Bh=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{wrapInQuotes:s}=q()(r),o=s(e.code||e.name);return r.toPairs(e.properties).filter(([a,c])=>!c.compMod).map(([a])=>n.alterTypeDropAttribute(o,s(a))).map(a=>ke.getInstance([a],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),$h=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:o}=q()(r),a=o(e.code||e.name),c=r.values(e.properties).filter(u=>s(u.compMod,["name"])).map(u=>{let p=o(u.compMod.oldField.name),d=o(u.compMod.newField.name);return n.alterTypeRenameAttribute(a,p,d)}).map(u=>ke.getInstance([u],!0,!1)),l=r.toPairs(e.properties).filter(([u,p])=>s(p.compMod,["type","mode"])).map(([u,p])=>{let d=o(u),f=p.compMod.newField.mode||p.compMod.newField.type;return n.alterTypeChangeAttributeType(a,d,f)}).map(u=>ke.getInstance([u],!0,!1));return[...c,...l].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");Cc.exports={getCreateUdtScriptDto:qh,getDeleteUdtScriptDto:kh,getAddColumnToTypeScriptDtos:Fh,getDeleteColumnFromTypeScriptDtos:Bh,getModifyColumnOfTypeScriptDtos:$h}});var Oc=A((H_,Ic)=>{"use strict";var{AlterScriptDto:Nc}=re(),bc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Uh=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=q()(t),o=bc(r);if(o.new&&o.new!==o.old){let a=s(o.new),c=n(r),l=e.updateViewComment(c,a);return Nc.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),Kh=i((t,e)=>r=>{let n=bc(r),{getFullViewName:s}=q()(t);if(n.old&&!n.new){let o=s(r),a=e.dropViewComment(o);return Nc.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),Gh=i((t,e)=>r=>{let n=Uh(t,e)(r),s=Kh(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");Ic.exports={getModifyViewCommentsScriptDtos:Gh}});var Rc=A((W_,vc)=>{"use strict";var{getModifyViewCommentsScriptDtos:Vh}=Oc(),{AlterScriptDto:wc}=re(),Hh=i(t=>e=>{let r=J()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),o=r.createView(s,{},e.isActivated);return wc.getInstance([o],!0,!1)},"getAddViewScriptDto"),Qh=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t),{wrapInQuotes:s}=q()(r),o=s(e.code||e.name),a=n.dropView(o);return wc.getInstance([a],!0,!0)},"getDeleteViewScriptDto"),Wh=i(t=>e=>{let r=t.require("lodash"),n=J()(null,null,t);return[...Vh(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");vc.exports={getAddViewScriptDto:Hh,getDeleteViewScriptDto:Qh,getModifyViewScriptDtos:Wh}});var Dc=A((j_,Pc)=>{"use strict";var ns=class ns{isActivated;name};i(ns,"AlterRelationshipFKField");var zn=ns,ss=class ss{bucket;collection};i(ss,"AlterRelationshipParentDto");var Xn=ss,is=class is{bucket;collection};i(is,"AlterRelationshipChildDto");var Zn=is,os=class os{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(os,"AlterRelationshipCustomProperties");var Jn=os,as=class as{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(as,"AlterRelationshipRoleCompModDto");var es=as,cs=class cs{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(cs,"AlterRelationshipRoleDto");var ts=cs,us=class us{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(us,"AlterRelationshipDto");var rs=us;Pc.exports={AlterRelationshipRoleCompModDto:es,AlterRelationshipRoleDto:ts,AlterRelationshipDto:rs,AlterRelationshipFKField:zn,AlterRelationshipParentDto:Xn,AlterRelationshipChildDto:Zn,AlterRelationshipCustomProperties:Jn}});var Fc=A((Z_,kc)=>{"use strict";var{AlterScriptDto:ls}=re(),{AlterRelationshipDto:X_}=Dc(),Bt=i(t=>t.role.name,"getRelationshipName"),Yh=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=q()(t),n=e.role.compMod,s=n.child.bucket.name,o=n.child.collection.name;return r(o,s)},"getFullChildTableName"),Lc=i((t,e)=>r=>{var o,a,c,l,u;let n=r.role.compMod,s=((o=n.name)==null?void 0:o.new)||Bt(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(a=n.customProperties)==null?void 0:a.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((u=(l=(c=r.role)==null?void 0:c.compMod)==null?void 0:l.isActivated)!=null&&u.new)})},"getAddSingleForeignKeyStatementDto"),Mc=i(t=>{var r,n,s,o,a,c,l,u,p,d,f;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||Bt(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(a=(o=e.parent)==null?void 0:o.collection)==null?void 0:a.fkFields)==null?void 0:c.length,(l=e.child)==null?void 0:l.bucket,(u=e.child)==null?void 0:u.collection,(f=(d=(p=e.child)==null?void 0:p.collection)==null?void 0:d.fkFields)==null?void 0:f.length].every(h=>!!h):!1},"canRelationshipBeAdded"),jh=i((t,e)=>r=>r.filter(n=>Mc(n)).map(n=>{let s=Lc(t,e)(n);return ls.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),xc=i((t,e)=>r=>{var d,f,h,S;let{wrapInQuotes:n}=q()(e),s=r.role.compMod,o=Yh(e)(r),a=((d=s.name)==null?void 0:d.old)||Bt(r)||"",c=n(a),l=t.dropForeignKey(o,c),u=!!((S=(h=(f=r.role)==null?void 0:f.compMod)==null?void 0:h.isActivated)!=null&&S.new),p=s.child.collection.isActivated;return{statement:l,isActivated:u&&p}},"getDeleteSingleForeignKeyStatementDto"),qc=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||Bt(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(o=>!!o):!1},"canRelationshipBeDeleted"),zh=i((t,e)=>r=>r.filter(n=>qc(n)).map(n=>{let s=xc(t,e)(n);return ls.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),Xh=i((t,e)=>r=>r.filter(n=>Mc(n)&&qc(n)).map(n=>{let s=xc(t,e)(n),o=Lc(t,e)(n),a=o.isActivated&&s.isActivated;return ls.getDropAndRecreateInstance(s.statement,o.statement,a)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");kc.exports={getDeleteForeignKeyScriptDtos:zh,getModifyForeignKeyScriptDtos:Xh,getAddForeignKeyScriptDtos:jh}});var $c=A((eS,Bc)=>{"use strict";var hs=class hs{message;stack};i(hs,"PluginError");var ps=hs,ys=class ys{require};i(ys,"App");var ms=ys,gs=class gs{log;clear};i(gs,"Logger");var ds=gs,Es=class Es{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i(Es,"CoreData");var fs=Es;Bc.exports={App:ms,CoreData:fs,Logger:ds,PluginError:ps}});var Kc=A((rS,Uc)=>{"use strict";var Os=class Os{name;isActivated};i(Os,"ContainerJsonSchema");var _s=Os,ws=class ws{backgroundColor};i(ws,"ContainerStyles");var Ss=ws,vs=class vs{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(vs,"EntityData");var Ts=vs,Rs=class Rs{$schema;type;GUID};i(Rs,"InternalDefinitions");var Cs=Rs,Ps=class Ps{$schema;type;GUID};i(Ps,"ModelDefinitions");var As=Ps,Ds=class Ds{$schema;type;GUID};i(Ds,"ExternalDefinitions");var Ns=Ds,Ls=class Ls{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(Ls,"FieldJsonSchema");var bs=Ls,Ms=class Ms{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(Ms,"EntityJsonSchema");var Is=Ms;Uc.exports={ContainerJsonSchema:_s,ContainerStyles:Ss,EntityData:Ts,InternalDefinitions:Cs,ModelDefinitions:As,ExternalDefinitions:Ns,FieldJsonSchema:bs,EntityJsonSchema:Is}});var Vc=A((pS,Gc)=>{"use strict";var{getAddContainerScriptDto:Zh,getDeleteContainerScriptDto:Jh,getModifyContainerScriptDtos:ey}=za(),{getAddCollectionScriptDto:ty,getDeleteCollectionScriptDto:ry,getAddColumnScriptDtos:ny,getDeleteColumnScriptDtos:sy,getModifyColumnScriptDtos:iy,getModifyCollectionScriptDtos:oy}=Tc(),{getDeleteUdtScriptDto:ay,getCreateUdtScriptDto:cy,getAddColumnToTypeScriptDtos:uy,getDeleteColumnFromTypeScriptDtos:ly,getModifyColumnOfTypeScriptDtos:py}=Ac(),{getAddViewScriptDto:my,getDeleteViewScriptDto:dy,getModifyViewScriptDtos:fy}=Rc(),{getModifyForeignKeyScriptDtos:hy,getDeleteForeignKeyScriptDtos:yy,getAddForeignKeyScriptDtos:gy}=Fc(),{AlterScriptDto:sS,ModificationScript:iS}=re(),{App:oS,CoreData:aS}=$c(),{InternalDefinitions:cS,ModelDefinitions:uS,ExternalDefinitions:lS}=Kc(),Ey=i(({collection:t,app:e})=>{var l,u,p,d,f,h,S,y,T,_,P,N;let r=(d=(p=(u=(l=t.properties)==null?void 0:l.containers)==null?void 0:u.properties)==null?void 0:p.added)==null?void 0:d.items,n=(y=(S=(h=(f=t.properties)==null?void 0:f.containers)==null?void 0:h.properties)==null?void 0:S.deleted)==null?void 0:y.items,s=(N=(P=(_=(T=t.properties)==null?void 0:T.containers)==null?void 0:_.properties)==null?void 0:P.modified)==null?void 0:N.items,o=[].concat(r).filter(Boolean).map(w=>Zh(e)(Object.keys(w.properties)[0])),a=[].concat(n).filter(Boolean).map(w=>Jh(e)(Object.keys(w.properties)[0])),c=[].concat(s).filter(Boolean).map(w=>Object.values(w.properties)[0]).flatMap(w=>ey(e)(w));return[...o,...a,...c].filter(Boolean)},"getAlterContainersScriptDtos"),_y=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var f,h,S,y,T,_,P,N,w,D,C,b,M,B,Q,ge,Ee,Se,Oe,g,O,x,$,W;let a=[].concat((y=(S=(h=(f=t.properties)==null?void 0:f.entities)==null?void 0:h.properties)==null?void 0:S.added)==null?void 0:y.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>{var E;return(E=m.compMod)==null?void 0:E.created}).map(ty({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((N=(P=(_=(T=t.properties)==null?void 0:T.entities)==null?void 0:_.properties)==null?void 0:P.deleted)==null?void 0:N.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>{var E;return(E=m.compMod)==null?void 0:E.deleted}).map(ry(e)),l=[].concat((b=(C=(D=(w=t.properties)==null?void 0:w.entities)==null?void 0:D.properties)==null?void 0:C.modified)==null?void 0:b.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).flatMap(oy(e)),u=[].concat((ge=(Q=(B=(M=t.properties)==null?void 0:M.entities)==null?void 0:B.properties)==null?void 0:Q.added)==null?void 0:ge.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(ny({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),p=[].concat((g=(Oe=(Se=(Ee=t.properties)==null?void 0:Ee.entities)==null?void 0:Se.properties)==null?void 0:Oe.deleted)==null?void 0:g.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(sy(e)),d=[].concat((W=($=(x=(O=t.properties)==null?void 0:O.entities)==null?void 0:x.properties)==null?void 0:$.modified)==null?void 0:W.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(iy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}));return[...a,...c,...l,...u,...p,...d].filter(Boolean)},"getAlterCollectionsScriptDtos"),Sy=i((t,e)=>{var o,a,c,l,u,p,d,f,h,S,y,T;let r=[].concat((l=(c=(a=(o=t.properties)==null?void 0:o.views)==null?void 0:a.properties)==null?void 0:c.added)==null?void 0:l.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).filter(_=>{var P;return((P=_.compMod)==null?void 0:P.created)&&_.selectStatement}).map(my(e)),n=[].concat((f=(d=(p=(u=t.properties)==null?void 0:u.views)==null?void 0:p.properties)==null?void 0:d.deleted)==null?void 0:f.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).map(dy(e)),s=[].concat((T=(y=(S=(h=t.properties)==null?void 0:h.views)==null?void 0:S.properties)==null?void 0:y.modified)==null?void 0:T.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).flatMap(_=>fy(e)(_));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),Ty=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var d,f,h,S,y,T,_,P,N,w,D,C,b,M,B,Q,ge,Ee,Se,Oe;let a=[].concat((S=(h=(f=(d=t.properties)==null?void 0:d.modelDefinitions)==null?void 0:f.properties)==null?void 0:h.added)==null?void 0:S.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var O;return(O=g.compMod)==null?void 0:O.created}).map(cy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((P=(_=(T=(y=t.properties)==null?void 0:y.modelDefinitions)==null?void 0:T.properties)==null?void 0:_.deleted)==null?void 0:P.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var O;return(O=g.compMod)==null?void 0:O.deleted}).map(ay(e)),l=[].concat((C=(D=(w=(N=t.properties)==null?void 0:N.modelDefinitions)==null?void 0:w.properties)==null?void 0:D.added)==null?void 0:C.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(uy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),u=[].concat((Q=(B=(M=(b=t.properties)==null?void 0:b.modelDefinitions)==null?void 0:M.properties)==null?void 0:B.deleted)==null?void 0:Q.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(ly(e)),p=[].concat((Oe=(Se=(Ee=(ge=t.properties)==null?void 0:ge.modelDefinitions)==null?void 0:Ee.properties)==null?void 0:Se.modified)==null?void 0:Oe.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(py(e));return[...c,...a,...l,...u,...p].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),Cy=i(({collection:t,app:e})=>{var p,d,f,h,S,y,T,_,P,N,w,D;let r=e.require("lodash"),n=J()(null,null,e),s=[].concat((h=(f=(d=(p=t.properties)==null?void 0:p.relationships)==null?void 0:d.properties)==null?void 0:f.added)==null?void 0:h.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,M;return(M=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:M.created}),o=[].concat((_=(T=(y=(S=t.properties)==null?void 0:S.relationships)==null?void 0:y.properties)==null?void 0:T.deleted)==null?void 0:_.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,M;return(M=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:M.deleted}),a=[].concat((D=(w=(N=(P=t.properties)==null?void 0:P.relationships)==null?void 0:N.properties)==null?void 0:w.modified)==null?void 0:D.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,M;return(M=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:M.modified}),c=yy(n,r)(o),l=gy(n,r)(s),u=hy(n,r)(a);return[...c,...l,...u].filter(Boolean)},"getAlterRelationshipsScriptDtos"),Ay=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),Ny=i((t,e)=>{var f;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),o=JSON.parse(t.externalDefinitions),a=(f=t.modelData[0])==null?void 0:f.dbVersion,c=Ey({collection:r,app:e}),l=_y({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),u=Sy(r,e),p=Ty({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),d=Cy({collection:r,app:e});return[...c,...p,...l,...u,...d].filter(Boolean).map(h=>Ay(h)).filter(Boolean)},"getAlterScriptDtos");Gc.exports={getAlterScriptDtos:Ny}});var Yc=A((fS,Wc)=>{"use strict";var{getAlterScriptDtos:$t}=Vc(),{AlterScriptDto:dS}=re(),Hc=i(t=>(e,r)=>{let{commentIfDeactivated:n}=q()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(o=>n(o.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(o=>o.script):s.scripts.map(o=>n(o.script,{isActivated:!o.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),by=i((t,e)=>{var o,a;let r=e.require("lodash"),n=$t(t,e),s=(a=(o=t.options)==null?void 0:o.additionalOptions)==null?void 0:a.some(c=>c.id==="applyDropStatements"&&c.value);return Hc(r)(n,s)},"buildEntityLevelAlterScript"),Iy=i((t,e)=>$t(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),Qc=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),Oy=i((t,e)=>{var a,c;let r=Qc(t),n=e.require("lodash"),s=$t(r,e),o=(c=(a=r.options)==null?void 0:a.additionalOptions)==null?void 0:c.some(l=>l.id==="applyDropStatements"&&l.value);return Hc(n)(s,o)},"buildContainerLevelAlterScript"),wy=i((t,e)=>{let r=Qc(t);return $t(r,e).some(s=>s.isActivated&&s.scripts.some(o=>o.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");Wc.exports={buildEntityLevelAlterScript:by,doesEntityLevelAlterScriptContainDropStatements:Iy,buildContainerLevelAlterScript:Oy,doesContainerLevelAlterScriptContainDropStatements:wy}});var jc=ua(),{createLogger:vy}=Kt(),Ry=pa(),{buildEntityLevelAlterScript:Py,buildContainerLevelAlterScript:Dy,doesContainerLevelAlterScriptContainDropStatements:Ly,doesEntityLevelAlterScriptContainDropStatements:My}=Yc();module.exports={generateScript(t,e,r,n){try{let s=Py(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=Dy(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),jc.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=vy({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});Ry.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){jc.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=Ly(t,n);r(null,s)}else{let s=My(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
