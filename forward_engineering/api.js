"use strict";var vt=Object.defineProperty;var ju=Object.getOwnPropertyDescriptor;var zu=Object.getOwnPropertyNames;var Xu=Object.prototype.hasOwnProperty;var i=(t,e)=>vt(t,"name",{value:e,configurable:!0});var Zu=(t,e)=>()=>(t&&(e=t(t=0)),e);var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ju=(t,e)=>{for(var r in e)vt(t,r,{get:e[r],enumerable:!0})},el=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of zu(e))!Xu.call(t,s)&&s!==r&&vt(t,s,{get:()=>e[s],enumerable:!(n=ju(e,s))||n.enumerable});return t};var tl=t=>el(vt({},"__esModule",{value:!0}),t);var tr=C((ME,ci)=>{"use strict";var rl=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",o=""){e.progress({message:n,containerName:s,entityName:o})},error(n){e.log("error",nl(n),t)}}),"createLogger"),nl=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");ci.exports={createLogger:rl}});var li=C((kE,ui)=>{var nt=1e3,st=nt*60,it=st*60,ot=it*24,sl=ot*365.25;ui.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return il(t);if(r==="number"&&isNaN(t)===!1)return e.long?al(t):ol(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function il(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*sl;case"days":case"day":case"d":return r*ot;case"hours":case"hour":case"hrs":case"hr":case"h":return r*it;case"minutes":case"minute":case"mins":case"min":case"m":return r*st;case"seconds":case"second":case"secs":case"sec":case"s":return r*nt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}i(il,"parse");function ol(t){return t>=ot?Math.round(t/ot)+"d":t>=it?Math.round(t/it)+"h":t>=st?Math.round(t/st)+"m":t>=nt?Math.round(t/nt)+"s":t+"ms"}i(ol,"fmtShort");function al(t){return wt(t,ot,"day")||wt(t,it,"hour")||wt(t,st,"minute")||wt(t,nt,"second")||t+" ms"}i(al,"fmtLong");function wt(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}i(wt,"plural")});var sr=C((B,pi)=>{B=pi.exports=nr.debug=nr.default=nr;B.coerce=ml;B.disable=ll;B.enable=ul;B.enabled=pl;B.humanize=li();B.names=[];B.skips=[];B.formatters={};var rr;function cl(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return B.colors[Math.abs(e)%B.colors.length]}i(cl,"selectColor");function nr(t){function e(){if(e.enabled){var r=e,n=+new Date,s=n-(rr||n);r.diff=s,r.prev=rr,r.curr=n,rr=n;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=B.coerce(o[0]),typeof o[0]!="string"&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(u,p){if(u==="%%")return u;c++;var d=B.formatters[p];if(typeof d=="function"){var h=o[c];u=d.call(r,h),o.splice(c,1),c--}return u}),B.formatArgs.call(r,o);var l=e.log||B.log||console.log.bind(console);l.apply(r,o)}}return i(e,"debug"),e.namespace=t,e.enabled=B.enabled(t),e.useColors=B.useColors(),e.color=cl(t),typeof B.init=="function"&&B.init(e),e}i(nr,"createDebug");function ul(t){B.save(t),B.names=[],B.skips=[];for(var e=(typeof t=="string"?t:"").split(/[\s,]+/),r=e.length,n=0;n<r;n++)e[n]&&(t=e[n].replace(/\*/g,".*?"),t[0]==="-"?B.skips.push(new RegExp("^"+t.substr(1)+"$")):B.names.push(new RegExp("^"+t+"$")))}i(ul,"enable");function ll(){B.enable("")}i(ll,"disable");function pl(t){var e,r;for(e=0,r=B.skips.length;e<r;e++)if(B.skips[e].test(t))return!1;for(e=0,r=B.names.length;e<r;e++)if(B.names[e].test(t))return!0;return!1}i(pl,"enabled");function ml(t){return t instanceof Error?t.stack||t.message:t}i(ml,"coerce")});var fi=C((ue,di)=>{ue=di.exports=sr();ue.log=hl;ue.formatArgs=fl;ue.save=yl;ue.load=mi;ue.useColors=dl;ue.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:gl();ue.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function dl(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}i(dl,"useColors");ue.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function fl(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+ue.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(o){o!=="%%"&&(n++,o==="%c"&&(s=n))}),t.splice(s,0,r)}}i(fl,"formatArgs");function hl(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}i(hl,"log");function yl(t){try{t==null?ue.storage.removeItem("debug"):ue.storage.debug=t}catch{}}i(yl,"save");function mi(){var t;try{t=ue.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}i(mi,"load");ue.enable(mi());function gl(){try{return window.localStorage}catch{}}i(gl,"localstorage")});var Ei=C((te,gi)=>{var hi=require("tty"),at=require("util");te=gi.exports=sr();te.init=Nl;te.log=Tl;te.formatArgs=Sl;te.save=Cl;te.load=yi;te.useColors=_l;te.colors=[6,2,3,4,5,1];te.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(s,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});var Ge=parseInt(process.env.DEBUG_FD,10)||2;Ge!==1&&Ge!==2&&at.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var El=Ge===1?process.stdout:Ge===2?process.stderr:Al(Ge);function _l(){return"colors"in te.inspectOpts?!!te.inspectOpts.colors:hi.isatty(Ge)}i(_l,"useColors");te.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,at.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};te.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,at.inspect(t,this.inspectOpts)};function Sl(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,s="  \x1B[3"+n+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push("\x1B[3"+n+"m+"+te.humanize(this.diff)+"\x1B[0m")}else t[0]=new Date().toUTCString()+" "+e+" "+t[0]}i(Sl,"formatArgs");function Tl(){return El.write(at.format.apply(at,arguments)+`
`)}i(Tl,"log");function Cl(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}i(Cl,"save");function yi(){return process.env.DEBUG}i(yi,"load");function Al(t){var e,r=process.binding("tty_wrap");switch(r.guessHandleType(t)){case"TTY":e=new hi.WriteStream(t),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(t,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var s=require("net");e=new s.Socket({fd:t,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}i(Al,"createWritableStdioStream");function Nl(t){t.inspectOpts={};for(var e=Object.keys(te.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=te.inspectOpts[e[r]]}i(Nl,"init");te.enable(yi())});var or=C((KE,ir)=>{typeof process<"u"&&process.type==="renderer"?ir.exports=fi():ir.exports=Ei()});var _i=C(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.default=null});var wi=C((VE,vi)=>{var Ti=9007199254740991,bl="[object Arguments]",vl="[object Function]",wl="[object GeneratorFunction]",Ol=/^(?:0|[1-9]\d*)$/;function Ci(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}i(Ci,"apply");function Il(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}i(Il,"baseTimes");var ct=Object.prototype,ut=ct.hasOwnProperty,Ai=ct.toString,Rl=ct.propertyIsEnumerable,Si=Math.max;function Pl(t,e){var r=$l(t)||Ul(t)?Il(t.length,String):[],n=r.length,s=!!n;for(var o in t)(e||ut.call(t,o))&&!(s&&(o=="length"||bi(o,n)))&&r.push(o);return r}i(Pl,"arrayLikeKeys");function Dl(t,e,r,n){return t===void 0||cr(t,ct[r])&&!ut.call(n,r)?e:t}i(Dl,"assignInDefaults");function Ll(t,e,r){var n=t[e];(!(ut.call(t,e)&&cr(n,r))||r===void 0&&!(e in t))&&(t[e]=r)}i(Ll,"assignValue");function xl(t){if(!lr(t))return Bl(t);var e=Fl(t),r=[];for(var n in t)n=="constructor"&&(e||!ut.call(t,n))||r.push(n);return r}i(xl,"baseKeysIn");function Ni(t,e){return e=Si(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=Si(r.length-e,0),o=Array(s);++n<s;)o[n]=r[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=r[n];return a[e]=o,Ci(t,this,a)}}i(Ni,"baseRest");function Ml(t,e,r,n){r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;Ll(r,a,c===void 0?t[a]:c)}return r}i(Ml,"copyObject");function ql(t){return Ni(function(e,r){var n=-1,s=r.length,o=s>1?r[s-1]:void 0,a=s>2?r[2]:void 0;for(o=t.length>3&&typeof o=="function"?(s--,o):void 0,a&&kl(r[0],r[1],a)&&(o=s<3?void 0:o,s=1),e=Object(e);++n<s;){var c=r[n];c&&t(e,c,n,o)}return e})}i(ql,"createAssigner");function bi(t,e){return e=e??Ti,!!e&&(typeof t=="number"||Ol.test(t))&&t>-1&&t%1==0&&t<e}i(bi,"isIndex");function kl(t,e,r){if(!lr(r))return!1;var n=typeof e;return(n=="number"?ur(r)&&bi(e,r.length):n=="string"&&e in r)?cr(r[e],t):!1}i(kl,"isIterateeCall");function Fl(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ct;return t===r}i(Fl,"isPrototype");function Bl(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}i(Bl,"nativeKeysIn");function cr(t,e){return t===e||t!==t&&e!==e}i(cr,"eq");function Ul(t){return Kl(t)&&ut.call(t,"callee")&&(!Rl.call(t,"callee")||Ai.call(t)==bl)}i(Ul,"isArguments");var $l=Array.isArray;function ur(t){return t!=null&&Vl(t.length)&&!Gl(t)}i(ur,"isArrayLike");function Kl(t){return Hl(t)&&ur(t)}i(Kl,"isArrayLikeObject");function Gl(t){var e=lr(t)?Ai.call(t):"";return e==vl||e==wl}i(Gl,"isFunction");function Vl(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ti}i(Vl,"isLength");function lr(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}i(lr,"isObject");function Hl(t){return!!t&&typeof t=="object"}i(Hl,"isObjectLike");var Ql=ql(function(t,e,r,n){Ml(e,Yl(e),t,n)}),Wl=Ni(function(t){return t.push(void 0,Dl),Ci(Ql,void 0,t)});function Yl(t){return ur(t)?Pl(t,!0):xl(t)}i(Yl,"keysIn");vi.exports=Wl});var Ii=C((QE,Oi)=>{var jl=require("util"),zl=wi(),Xl=or()("tunnel-ssh-config"),pr=i(function(t,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=t,this.extra=e},"ConfigError");jl.inherits(pr,Error);function Zl(t){var e=process.env;if(zl(t||{},{username:e.TUNNELSSH_USER||e.USER||e.USERNAME||"root",port:22,host:null,srcPort:0,srcHost:"127.0.0.1",dstPort:null,dstHost:"127.0.0.1",localHost:"127.0.0.1",localPort:t.dstPort,agent:process.env.SSH_AUTH_SOCK}),!t.host)throw new pr("host not set");if(!t.dstPort)throw new pr("dstPort not set");return Xl("ssh-config",function(){var r=["password","privateKey"];return Object.keys(t).reduce(function(n,s){return r.indexOf(s)===-1?n[s]=t[s]:n[s]="***HIDDEN***",n},{})}()),t}i(Zl,"createConfig");Oi.exports=Zl});var Pi=C((YE,Ri)=>{var Jl=require("net"),mr=or()("tunnel-ssh"),ep=_i().Client,tp=Ii(),rp=require("events"),np=i(function(){},"noop");function sp(t,e){var r=new ep;return e.on("close",r.end.bind(r)),r.on("ready",function(){mr("sshConnection:ready"),e.emit("sshConnection",r,e),r.forwardOut(t.srcHost,t.srcPort,t.dstHost,t.dstPort,function(n,s){if(n){e.emit("error",n),mr("Destination port:",n);return}mr("sshStream:create"),e.emit("sshStream",s),e.pipe(s).pipe(e)})}),r}i(sp,"bindSSHConnection");function ip(t,e){return e.reduce(function(r,n){return delete r[n],r},Object.assign({},t))}i(ip,"omit");function op(t){var e,r=[],n=0;return e=Jl.createServer(function(s){var o;n++,s.on("error",e.emit.bind(e,"error")),s.on("close",function(){n--,n===0&&(t.keepAlive||setTimeout(function(){n===0&&e.close()},2))}),e.emit("netConnection",s,e),o=sp(t,s),o.on("error",e.emit.bind(e,"error")),s.on("sshStream",function(a){a.on("error",function(){e.close()})}),r.push(o,s);try{o.connect(ip(t,["localPort","localHost"]))}catch(a){e.emit("error",a)}}),e.on("close",function(){r.forEach(function(s){s.end()})}),e}i(op,"createServer");function ap(t,e){var r,n;e||(e=np);try{n=tp(t),r=op(n),r.listen(n.localPort,n.localHost,function(s){e(s,r)})}catch(s){r=new rp.EventEmitter,setImmediate(function(){e(s),r.emit("error",s)})}return r}i(ap,"tunnel");Ri.exports=ap});var fr=C(Di=>{"use strict";Di.parse=function(t,e){return new dr(t,e).parse()};var Ot=class Ot{constructor(e,r){this.source=e,this.transform=r||cp,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new Ot(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Ot,"ArrayParser");var dr=Ot;function cp(t){return t}i(cp,"identity")});var hr=C((ZE,Li)=>{var up=fr();Li.exports={create:function(t,e){return{parse:function(){return up.parse(t,e)}}}}});var qi=C((JE,Mi)=>{"use strict";var lp=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,pp=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,mp=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,dp=/^-?infinity$/;Mi.exports=i(function(e){if(dp.test(e))return Number(e.replace("i","I"));var r=lp.exec(e);if(!r)return fp(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=xi(s));var o=parseInt(r[2],10)-1,a=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var d,h=hp(e);return h!=null?(d=new Date(Date.UTC(s,o,a,c,l,u,p)),yr(s)&&d.setUTCFullYear(s),h!==0&&d.setTime(d.getTime()-h)):(d=new Date(s,o,a,c,l,u,p),yr(s)&&d.setFullYear(s)),d},"parseDate");function fp(t){var e=pp.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=xi(r));var s=parseInt(e[2],10)-1,o=e[3],a=new Date(r,s,o);return yr(r)&&a.setFullYear(r),a}}i(fp,"getDate");function hp(t){if(t.endsWith("+00"))return 0;var e=mp.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(hp,"timeZoneOffset");function xi(t){return-(t-1)}i(xi,"bcYearToNegativeYear");function yr(t){return t>=0&&t<100}i(yr,"is0To99")});var Fi=C((t_,ki)=>{ki.exports=gp;var yp=Object.prototype.hasOwnProperty;function gp(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)yp.call(r,n)&&(t[n]=r[n])}return t}i(gp,"extend")});var $i=C((n_,Ui)=>{"use strict";var Ep=Fi();Ui.exports=Ve;function Ve(t){if(!(this instanceof Ve))return new Ve(t);Ep(this,Rp(t))}i(Ve,"PostgresInterval");var _p=["seconds","minutes","hours","days","months","years"];Ve.prototype.toPostgres=function(){var t=_p.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var Sp={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Tp=["years","months","days"],Cp=["hours","minutes","seconds"];Ve.prototype.toISOString=Ve.prototype.toISO=function(){var t=Tp.map(r,this).join(""),e=Cp.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+Sp[n]}};var gr="([+-]?\\d+)",Ap=gr+"\\s+years?",Np=gr+"\\s+mons?",bp=gr+"\\s+days?",vp="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",wp=new RegExp([Ap,Np,bp,vp].map(function(t){return"("+t+")?"}).join("\\s*")),Bi={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Op=["hours","minutes","seconds","milliseconds"];function Ip(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Ip,"parseMilliseconds");function Rp(t){if(!t)return{};var e=wp.exec(t),r=e[8]==="-";return Object.keys(Bi).reduce(function(n,s){var o=Bi[s],a=e[o];return!a||(a=s==="milliseconds"?Ip(a):parseInt(a,10),!a)||(r&&~Op.indexOf(s)&&(a*=-1),n[s]=a),n},{})}i(Rp,"parse")});var Gi=C((i_,Ki)=>{"use strict";Ki.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var o=0;o<Math.floor(s/2);++o)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var zi=C((a_,ji)=>{var lt=fr(),pt=hr(),It=qi(),Hi=$i(),Qi=Gi();function Rt(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Rt,"allowNull");function Wi(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(Wi,"parseBool");function Pp(t){return t?lt.parse(t,Wi):null}i(Pp,"parseBoolArray");function Dp(t){return parseInt(t,10)}i(Dp,"parseBaseTenInt");function Er(t){return t?lt.parse(t,Rt(Dp)):null}i(Er,"parseIntegerArray");function Lp(t){return t?lt.parse(t,Rt(function(e){return Yi(e).trim()})):null}i(Lp,"parseBigIntegerArray");var xp=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=Cr(r)),r});return e.parse()},"parsePointArray"),_r=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),ge=i(function(t){if(!t)return null;var e=pt.create(t);return e.parse()},"parseStringArray"),Sr=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=It(r)),r});return e.parse()},"parseDateArray"),Mp=i(function(t){if(!t)return null;var e=pt.create(t,function(r){return r!==null&&(r=Hi(r)),r});return e.parse()},"parseIntervalArray"),qp=i(function(t){return t?lt.parse(t,Rt(Qi)):null},"parseByteAArray"),Tr=i(function(t){return parseInt(t,10)},"parseInteger"),Yi=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Vi=i(function(t){return t?lt.parse(t,Rt(JSON.parse)):null},"parseJsonArray"),Cr=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),kp=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var o=Cr(e);return o.radius=parseFloat(r),o},"parseCircle"),Fp=i(function(t){t(20,Yi),t(21,Tr),t(23,Tr),t(26,Tr),t(700,parseFloat),t(701,parseFloat),t(16,Wi),t(1082,It),t(1114,It),t(1184,It),t(600,Cr),t(651,ge),t(718,kp),t(1e3,Pp),t(1001,qp),t(1005,Er),t(1007,Er),t(1028,Er),t(1016,Lp),t(1017,xp),t(1021,_r),t(1022,_r),t(1231,_r),t(1014,ge),t(1015,ge),t(1008,ge),t(1009,ge),t(1040,ge),t(1041,ge),t(1115,Sr),t(1182,Sr),t(1185,Sr),t(1186,Hi),t(1187,Mp),t(17,Qi),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Vi),t(3807,Vi),t(3907,ge),t(2951,ge),t(791,ge),t(1183,ge),t(1270,ge)},"init");ji.exports={init:Fp}});var Zi=C((u_,Xi)=>{"use strict";var me=1e6;function Bp(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",o,a,c,l,u,p;{if(o=e%me,e=e/me>>>0,a=4294967296*o+r,r=a/me>>>0,c=""+(a-me*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%me,e=e/me>>>0,a=4294967296*o+r,r=a/me>>>0,c=""+(a-me*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%me,e=e/me>>>0,a=4294967296*o+r,r=a/me>>>0,c=""+(a-me*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}return o=e%me,a=4294967296*o+r,c=""+a%me,n+c+s}i(Bp,"readInt8");Xi.exports=Bp});var no=C((p_,ro)=>{var Up=Zi(),V=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(f,S,y){return f*Math.pow(2,y)+S};var o=r>>3,a=i(function(f){return n?~f&255:f},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=s(0,a(t[o])&c,l));for(var p=e+r>>3,d=o+1;d<p;d++)u=s(u,a(t[d]),8);var h=(e+r)%8;return h>0&&(u=s(u,a(t[p])>>8-h,h)),u},"parseBits"),to=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=V(t,1),o=V(t,r,1);if(o===0)return 0;var a=1,c=i(function(u,p,d){u===0&&(u=1);for(var h=1;h<=d;h++)a/=2,(p&1<<d-h)>0&&(u+=a);return u},"parsePrecisionBits"),l=V(t,e,r+1,!1,c);return o==Math.pow(2,r+1)-1?l===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,o-n)*l},"parseFloatFromBits"),$p=i(function(t){return V(t,1)==1?-1*(V(t,15,1,!0)+1):V(t,15,1)},"parseInt16"),Ji=i(function(t){return V(t,1)==1?-1*(V(t,31,1,!0)+1):V(t,31,1)},"parseInt32"),Kp=i(function(t){return to(t,23,8)},"parseFloat32"),Gp=i(function(t){return to(t,52,11)},"parseFloat64"),Vp=i(function(t){var e=V(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,V(t,16,16)),n=0,s=[],o=V(t,16),a=0;a<o;a++)n+=V(t,16,64+16*a)*r,r/=1e4;var c=Math.pow(10,V(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),eo=i(function(t,e){var r=V(e,1),n=V(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(o){this.usec=o},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),mt=i(function(t){for(var e=V(t,32),r=V(t,32,32),n=V(t,32,64),s=96,o=[],a=0;a<e;a++)o[a]=V(t,32,s),s+=32,s+=32;var c=i(function(u){var p=V(t,32,s);if(s+=32,p==4294967295)return null;var d;if(u==23||u==20)return d=V(t,p*8,s),s+=p*8,d;if(u==25)return d=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var d=[],h;if(u.length>1){var f=u.shift();for(h=0;h<f;h++)d[h]=l(u,p);u.unshift(f)}else for(h=0;h<u[0];h++)d[h]=c(p);return d},"parse");return l(o,n)},"parseArray"),Hp=i(function(t){return t.toString("utf8")},"parseText"),Qp=i(function(t){return t===null?null:V(t,8)>0},"parseBool"),Wp=i(function(t){t(20,Up),t(21,$p),t(23,Ji),t(26,Ji),t(1700,Vp),t(700,Kp),t(701,Gp),t(16,Qp),t(1114,eo.bind(null,!1)),t(1184,eo.bind(null,!0)),t(1e3,mt),t(1007,mt),t(1016,mt),t(1008,mt),t(1009,mt),t(25,Hp)},"init");ro.exports={init:Wp}});var io=C((d_,so)=>{so.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var ht=C(ft=>{var Yp=zi(),jp=no(),zp=hr(),Xp=io();ft.getTypeParser=Zp;ft.setTypeParser=Jp;ft.arrayParser=zp;ft.builtins=Xp;var dt={text:{},binary:{}};function oo(t){return String(t)}i(oo,"noParse");function Zp(t,e){return e=e||"text",dt[e]&&dt[e][t]||oo}i(Zp,"getTypeParser");function Jp(t,e,r){typeof e=="function"&&(r=e,e="text"),dt[e][t]=r}i(Jp,"setTypeParser");Yp.init(function(t,e){dt.text[t]=e});jp.init(function(t,e){dt.binary[t]=e})});var yt=C((y_,Ar)=>{"use strict";Ar.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var He=ht(),em=He.getTypeParser(20,"text"),tm=He.getTypeParser(1016,"text");Ar.exports.__defineSetter__("parseInt8",function(t){He.setTypeParser(20,"text",t?He.getTypeParser(23,"text"):em),He.setTypeParser(1016,"text",t?He.getTypeParser(1007,"text"):tm)})});var gt=C((g_,co)=>{"use strict";var rm=yt();function nm(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(nm,"escapeElement");function ao(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+ao(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=nm(Pt(t[r]));return e=e+"}",e}i(ao,"arrayString");var Pt=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?rm.parseInputDatesAsUTC?om(t):im(t):Array.isArray(t)?ao(t):typeof t=="object"?sm(t,e):t.toString()},"prepareValue");function sm(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Pt(t.toPostgres(Pt),e)}return JSON.stringify(t)}i(sm,"prepareObject");function oe(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(oe,"pad");function im(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=oe(r,4)+"-"+oe(t.getMonth()+1,2)+"-"+oe(t.getDate(),2)+"T"+oe(t.getHours(),2)+":"+oe(t.getMinutes(),2)+":"+oe(t.getSeconds(),2)+"."+oe(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=oe(Math.floor(e/60),2)+":"+oe(e%60,2),n&&(s+=" BC"),s}i(im,"dateToString");function om(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=oe(e,4)+"-"+oe(t.getUTCMonth()+1,2)+"-"+oe(t.getUTCDate(),2)+"T"+oe(t.getUTCHours(),2)+":"+oe(t.getUTCMinutes(),2)+":"+oe(t.getUTCSeconds(),2)+"."+oe(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(om,"dateToStringUTC");function am(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(am,"normalizeQueryConfig");var cm=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),um=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");co.exports={prepareValue:i(function(e){return Pt(e)},"prepareValueWrapper"),normalizeQueryConfig:am,escapeIdentifier:cm,escapeLiteral:um}});var lo=C((__,uo)=>{"use strict";var Et=require("crypto");function Nr(t){return Et.createHash("md5").update(t,"utf-8").digest("hex")}i(Nr,"md5");function lm(t,e,r){var n=Nr(e+t),s=Nr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(lm,"postgresMd5PasswordHash");function pm(t){return Et.createHash("sha256").update(t).digest()}i(pm,"sha256");function mm(t,e){return Et.createHmac("sha256",t).update(e).digest()}i(mm,"hmacSha256");async function dm(t,e,r){return Et.pbkdf2Sync(t,e,r,32,"sha256")}i(dm,"deriveKey");uo.exports={postgresMd5PasswordHash:lm,randomBytes:Et.randomBytes,deriveKey:dm,sha256:pm,hmacSha256:mm,md5:Nr}});var ho=C((T_,fo)=>{var po=require("crypto");fo.exports={postgresMd5PasswordHash:hm,randomBytes:fm,deriveKey:Em,sha256:ym,hmacSha256:gm,md5:br};var mo=po.webcrypto||globalThis.crypto,Qe=mo.subtle,vr=new TextEncoder;function fm(t){return mo.getRandomValues(Buffer.alloc(t))}i(fm,"randomBytes");async function br(t){try{return po.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?vr.encode(t):t,n=await Qe.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(br,"md5");async function hm(t,e,r){var n=await br(e+t),s=await br(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(hm,"postgresMd5PasswordHash");async function ym(t){return await Qe.digest("SHA-256",t)}i(ym,"sha256");async function gm(t,e){let r=await Qe.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Qe.sign("HMAC",r,vr.encode(e))}i(gm,"hmacSha256");async function Em(t,e,r){let n=await Qe.importKey("raw",vr.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await Qe.deriveBits(s,n,32*8,["deriveBits"])}i(Em,"deriveKey")});var Or=C((A_,wr)=>{"use strict";var _m=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;_m?wr.exports=lo():wr.exports=ho()});var _o=C((N_,Eo)=>{"use strict";var qe=Or();function Sm(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=qe.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Sm,"startSession");async function Tm(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Nm(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,o="r="+n.nonce+",s="+n.salt+",i="+n.iteration,a="c=biws,r="+n.nonce,c=s+","+o+","+a,l=Buffer.from(n.salt,"base64"),u=await qe.deriveKey(e,l,n.iteration),p=await qe.hmacSha256(u,"Client Key"),d=await qe.sha256(p),h=await qe.hmacSha256(d,c),f=vm(Buffer.from(p),Buffer.from(h)).toString("base64"),S=await qe.hmacSha256(u,"Server Key"),y=await qe.hmacSha256(S,c);t.message="SASLResponse",t.serverSignature=Buffer.from(y).toString("base64"),t.response=a+",p="+f}i(Tm,"continueSession");function Cm(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=bm(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(Cm,"finalizeSession");function Am(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Am,"isPrintableChars");function yo(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(yo,"isBase64");function go(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(go,"parseAttributePairs");function Nm(t){let e=go(t),r=e.get("r");if(r){if(!Am(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!yo(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let o=parseInt(s,10);return{nonce:r,salt:n,iteration:o}}i(Nm,"parseServerFirstMessage");function bm(t){let r=go(t).get("v");if(r){if(!yo(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(bm,"parseServerFinalMessage");function vm(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(vm,"xorBuffers");Eo.exports={startSession:Sm,continueSession:Tm,finalizeSession:Cm}});var Ir=C((v_,So)=>{"use strict";var wm=ht();function Dt(t){this._types=t||wm,this.text={},this.binary={}}i(Dt,"TypeOverrides");Dt.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Dt.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Dt.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};So.exports=Dt});var Co=C((O_,To)=>{"use strict";function Rr(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let o=r.pathname.slice(1)||null;e.database=o?decodeURI(o):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let a=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=a.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=a.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=a.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(Rr,"parse");To.exports=Rr;Rr.parse=Rr});var Lr=C((R_,bo)=>{"use strict";var Om=require("dns"),No=yt(),Ao=Co().parse,le=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||No[t]},"val"),Im=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return No.ssl},"readSSLConfigFromEnvironment"),We=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),Ee=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+We(n))},"add"),Dr=class Dr{constructor(e){e=typeof e=="string"?Ao(e):e||{},e.connectionString&&(e=Object.assign({},e,Ao(e.connectionString))),this.user=le("user",e),this.database=le("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(le("port",e),10),this.host=le("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:le("password",e)}),this.binary=le("binary",e),this.options=le("options",e),this.ssl=typeof e.ssl>"u"?Im():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=le("client_encoding",e),this.replication=le("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=le("application_name",e,"PGAPPNAME"),this.fallback_application_name=le("fallback_application_name",e,!1),this.statement_timeout=le("statement_timeout",e,!1),this.lock_timeout=le("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=le("idle_in_transaction_session_timeout",e,!1),this.query_timeout=le("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];Ee(r,this,"user"),Ee(r,this,"password"),Ee(r,this,"port"),Ee(r,this,"application_name"),Ee(r,this,"fallback_application_name"),Ee(r,this,"connect_timeout"),Ee(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Ee(r,n,"sslmode"),Ee(r,n,"sslca"),Ee(r,n,"sslkey"),Ee(r,n,"sslcert"),Ee(r,n,"sslrootcert"),this.database&&r.push("dbname="+We(this.database)),this.replication&&r.push("replication="+We(this.replication)),this.host&&r.push("host="+We(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+We(this.client_encoding)),Om.lookup(this.host,function(s,o){return s?e(s,null):(r.push("hostaddr="+We(o)),e(null,r.join(" ")))})}};i(Dr,"ConnectionParameters");var Pr=Dr;bo.exports=Pr});var Oo=C((D_,wo)=>{"use strict";var Rm=ht(),vo=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Mr=class Mr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=vo.exec(e.text):r=vo.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var o=e[n];o!==null?r[n]=this._parsers[n](o):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var o=e[n],a=this.fields[n].name;o!==null?r[a]=this._parsers[n](o):r[a]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Rm.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(Mr,"Result");var xr=Mr;wo.exports=xr});var Do=C((x_,Po)=>{"use strict";var{EventEmitter:Pm}=require("events"),Io=Oo(),Ro=gt(),kr=class kr extends Pm{constructor(e,r,n){super(),e=Ro.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Io(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Io(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Ro.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(kr,"Query");var qr=kr;Po.exports=qr});var dn=C(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.NoticeMessage=L.DataRowMessage=L.CommandCompleteMessage=L.ReadyForQueryMessage=L.NotificationResponseMessage=L.BackendKeyDataMessage=L.AuthenticationMD5Password=L.ParameterStatusMessage=L.ParameterDescriptionMessage=L.RowDescriptionMessage=L.Field=L.CopyResponse=L.CopyDataMessage=L.DatabaseError=L.copyDone=L.emptyQuery=L.replicationStart=L.portalSuspended=L.noData=L.closeComplete=L.bindComplete=L.parseComplete=void 0;L.parseComplete={name:"parseComplete",length:5};L.bindComplete={name:"bindComplete",length:5};L.closeComplete={name:"closeComplete",length:5};L.noData={name:"noData",length:5};L.portalSuspended={name:"portalSuspended",length:5};L.replicationStart={name:"replicationStart",length:4};L.emptyQuery={name:"emptyQuery",length:4};L.copyDone={name:"copyDone",length:4};var Zr=class Zr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(Zr,"DatabaseError");var Fr=Zr;L.DatabaseError=Fr;var Jr=class Jr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Jr,"CopyDataMessage");var Br=Jr;L.CopyDataMessage=Br;var en=class en{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(en,"CopyResponse");var Ur=en;L.CopyResponse=Ur;var tn=class tn{constructor(e,r,n,s,o,a,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=o,this.dataTypeModifier=a,this.format=c}};i(tn,"Field");var $r=tn;L.Field=$r;var rn=class rn{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(rn,"RowDescriptionMessage");var Kr=rn;L.RowDescriptionMessage=Kr;var nn=class nn{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(nn,"ParameterDescriptionMessage");var Gr=nn;L.ParameterDescriptionMessage=Gr;var sn=class sn{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(sn,"ParameterStatusMessage");var Vr=sn;L.ParameterStatusMessage=Vr;var on=class on{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(on,"AuthenticationMD5Password");var Hr=on;L.AuthenticationMD5Password=Hr;var an=class an{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(an,"BackendKeyDataMessage");var Qr=an;L.BackendKeyDataMessage=Qr;var cn=class cn{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(cn,"NotificationResponseMessage");var Wr=cn;L.NotificationResponseMessage=Wr;var un=class un{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(un,"ReadyForQueryMessage");var Yr=un;L.ReadyForQueryMessage=Yr;var ln=class ln{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(ln,"CommandCompleteMessage");var jr=ln;L.CommandCompleteMessage=jr;var pn=class pn{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(pn,"DataRowMessage");var zr=pn;L.DataRowMessage=zr;var mn=class mn{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(mn,"NoticeMessage");var Xr=mn;L.NoticeMessage=Xr});var Lo=C(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.Writer=void 0;var hn=class hn{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(hn,"Writer");var fn=hn;Lt.Writer=fn});var Mo=C(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.serialize=void 0;var yn=Lo(),H=new yn.Writer,Dm=i(t=>{H.addInt16(3).addInt16(0);for(let n of Object.keys(t))H.addCString(n).addCString(t[n]);H.addCString("client_encoding").addCString("UTF8");var e=H.addCString("").flush(),r=e.length+4;return new yn.Writer().addInt32(r).add(e).flush()},"startup"),Lm=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),xm=i(t=>H.addCString(t).flush(112),"password"),Mm=i(function(t,e){return H.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),H.flush(112)},"sendSASLInitialResponseMessage"),qm=i(function(t){return H.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),km=i(t=>H.addCString(t).flush(81),"query"),xo=[],Fm=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||xo;for(var n=r.length,s=H.addCString(e).addCString(t.text).addInt16(n),o=0;o<n;o++)s.addInt32(r[o]);return H.flush(80)},"parse"),Ye=new yn.Writer,Bm=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(H.addInt16(0),Ye.addInt32(-1)):n instanceof Buffer?(H.addInt16(1),Ye.addInt32(n.length),Ye.add(n)):(H.addInt16(0),Ye.addInt32(Buffer.byteLength(n)),Ye.addString(n))}},"writeValues"),Um=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||xo,o=s.length;return H.addCString(e).addCString(r),H.addInt16(o),Bm(s,t.valueMapper),H.addInt16(o),H.add(Ye.flush()),H.addInt16(n?1:0),H.flush(66)},"bind"),$m=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Km=i(t=>{if(!t||!t.portal&&!t.rows)return $m;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,o=Buffer.allocUnsafe(1+s);return o[0]=69,o.writeInt32BE(s,1),o.write(e,5,"utf-8"),o[n+5]=0,o.writeUInt32BE(r,o.length-4),o},"execute"),Gm=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),gn=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Vm=H.addCString("P").flush(68),Hm=H.addCString("S").flush(68),Qm=i(t=>t.name?gn(68,`${t.type}${t.name||""}`):t.type==="P"?Vm:Hm,"describe"),Wm=i(t=>{let e=`${t.type}${t.name||""}`;return gn(67,e)},"close"),Ym=i(t=>H.add(t).flush(100),"copyData"),jm=i(t=>gn(102,t),"copyFail"),xt=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),zm=xt(72),Xm=xt(83),Zm=xt(88),Jm=xt(99),ed={startup:Dm,password:xm,requestSsl:Lm,sendSASLInitialResponseMessage:Mm,sendSCRAMClientFinalMessage:qm,query:km,parse:Fm,bind:Um,execute:Km,describe:Qm,close:Wm,flush:()=>zm,sync:()=>Xm,end:()=>Zm,copyData:Ym,copyDone:()=>Jm,copyFail:jm,cancel:Gm};Mt.serialize=ed});var qo=C(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.BufferReader=void 0;var td=Buffer.allocUnsafe(0),_n=class _n{constructor(e=0){this.offset=e,this.buffer=td,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(_n,"BufferReader");var En=_n;qt.BufferReader=En});var Bo=C(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.Parser=void 0;var Q=dn(),rd=qo(),Sn=1,nd=4,ko=Sn+nd,Fo=Buffer.allocUnsafe(0),Cn=class Cn{constructor(e){if(this.buffer=Fo,this.bufferLength=0,this.bufferOffset=0,this.reader=new rd.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+ko<=n;){let o=this.buffer[s],a=this.buffer.readUInt32BE(s+Sn),c=Sn+a;if(c+s<=n){let l=this.handlePacket(s+ko,o,a,this.buffer);r(l),s+=c}else break}s===n?(this.buffer=Fo,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let o=this.buffer.byteLength*2;for(;r>=o;)o*=2;s=Buffer.allocUnsafe(o)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return Q.bindComplete;case 49:return Q.parseComplete;case 51:return Q.closeComplete;case 110:return Q.noData;case 115:return Q.portalSuspended;case 99:return Q.copyDone;case 87:return Q.replicationStart;case 73:return Q.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new Q.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new Q.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new Q.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new Q.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let o=this.reader.byte()!==0,a=this.reader.int16(),c=new Q.CopyResponse(r,s,o,a);for(let l=0;l<a;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.cstring(),a=this.reader.cstring();return new Q.NotificationResponseMessage(r,s,o,a)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Q.RowDescriptionMessage(r,s);for(let a=0;a<s;a++)o.fields[a]=this.parseField();return o}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),o=this.reader.int16(),a=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new Q.Field(e,r,n,s,o,a,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Q.ParameterDescriptionMessage(r,s);for(let a=0;a<s;a++)o.dataTypeIDs[a]=this.reader.int32();return o}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Array(s);for(let a=0;a<s;a++){let c=this.reader.int32();o[a]=c===-1?null:this.reader.string(c)}return new Q.DataRowMessage(r,o)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),o=this.reader.cstring();return new Q.ParameterStatusMessage(r,s,o)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.int32();return new Q.BackendKeyDataMessage(r,s,o)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:o.length===8&&(o.name="authenticationCleartextPassword");break;case 5:if(o.length===12){o.name="authenticationMD5Password";let c=this.reader.bytes(4);return new Q.AuthenticationMD5Password(r,c)}break;case 10:o.name="authenticationSASL",o.mechanisms=[];let a;do a=this.reader.cstring(),a&&o.mechanisms.push(a);while(a);break;case 11:o.name="authenticationSASLContinue",o.data=this.reader.string(r-8);break;case 12:o.name="authenticationSASLFinal",o.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return o}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let o={},a=this.reader.string(1);for(;a!=="\0";)o[a]=this.reader.cstring(),a=this.reader.string(1);let c=o.M,l=s==="notice"?new Q.NoticeMessage(r,c):new Q.DatabaseError(c,r,s);return l.severity=o.S,l.code=o.C,l.detail=o.D,l.hint=o.H,l.position=o.P,l.internalPosition=o.p,l.internalQuery=o.q,l.where=o.W,l.schema=o.s,l.table=o.t,l.column=o.c,l.dataType=o.d,l.constraint=o.n,l.file=o.F,l.line=o.L,l.routine=o.R,l}};i(Cn,"Parser");var Tn=Cn;kt.Parser=Tn});var An=C(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.DatabaseError=Pe.serialize=Pe.parse=void 0;var sd=dn();Object.defineProperty(Pe,"DatabaseError",{enumerable:!0,get:function(){return sd.DatabaseError}});var id=Mo();Object.defineProperty(Pe,"serialize",{enumerable:!0,get:function(){return id.serialize}});var od=Bo();function ad(t,e){let r=new od.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(ad,"parse");Pe.parse=ad});var Uo={};Ju(Uo,{default:()=>cd});var cd,$o=Zu(()=>{cd={}});var Ko=C((Y_,Nn)=>{Nn.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=($o(),tl(Uo));return new n(e)}},"getStream");Nn.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var wn=C((X_,Go)=>{"use strict";var z_=require("net"),ud=require("events").EventEmitter,{parse:ld,serialize:re}=An(),{getStream:pd,getSecureStream:md}=Ko(),dd=re.flush(),fd=re.sync(),hd=re.end(),vn=class vn extends ud{constructor(e){super(),e=e||{},this.stream=e.stream||pd(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(o){n._ending&&(o.code==="ECONNRESET"||o.code==="EPIPE")||n.emit("error",o)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(o){var a=o.toString("utf8");switch(a){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{n.stream=md(c)}catch(u){return n.emit("error",u)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){ld(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(re.requestSsl())}startup(e){this.stream.write(re.startup(e))}cancel(e,r){this._send(re.cancel(e,r))}password(e){this._send(re.password(e))}sendSASLInitialResponseMessage(e,r){this._send(re.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(re.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(re.query(e))}parse(e){this._send(re.parse(e))}bind(e){this._send(re.bind(e))}execute(e){this._send(re.execute(e))}flush(){this.stream.writable&&this.stream.write(dd)}sync(){this._ending=!0,this._send(fd)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(hd,()=>{this.stream.end()})}close(e){this._send(re.close(e))}describe(e){this._send(re.describe(e))}sendCopyFromChunk(e){this._send(re.copyData(e))}endCopyFrom(){this._send(re.copyDone())}sendCopyFail(e){this._send(re.copyFail(e))}};i(vn,"Connection");var bn=vn;Go.exports=bn});var Wo=C((J_,Qo)=>{"use strict";var{Transform:yd}=require("stream"),{StringDecoder:gd}=require("string_decoder"),De=Symbol("last"),Ft=Symbol("decoder");function Ed(t,e,r){let n;if(this.overflow){if(n=this[Ft].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[De]+=this[Ft].write(t),n=this[De].split(this.matcher);this[De]=n.pop();for(let s=0;s<n.length;s++)try{Ho(this,this.mapper(n[s]))}catch(o){return r(o)}if(this.overflow=this[De].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(Ed,"transform");function _d(t){if(this[De]+=this[Ft].end(),this[De])try{Ho(this,this.mapper(this[De]))}catch(e){return t(e)}t()}i(_d,"flush");function Ho(t,e){e!==void 0&&t.push(e)}i(Ho,"push");function Vo(t){return t}i(Vo,"noop");function Sd(t,e,r){switch(t=t||/\r?\n/,e=e||Vo,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Vo)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Ed,r.flush=_d,r.readableObjectMode=!0;let n=new yd(r);return n[De]="",n[Ft]=new gd("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,o){this._writableState.errorEmitted=!1,o(s)},n}i(Sd,"split");Qo.exports=Sd});var zo=C((tS,Oe)=>{"use strict";var Yo=require("path"),Td=require("stream").Stream,Cd=Wo(),jo=require("util"),Ad=5432,Bt=process.platform==="win32",_t=process.stderr,Nd=56,bd=7,vd=61440,wd=32768;function Od(t){return(t&vd)==wd}i(Od,"isRegFile");var je=["host","port","database","user","password"],On=je.length,Id=je[On-1];function In(){var t=_t instanceof Td&&_t.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);_t.write(jo.format.apply(jo,e))}}i(In,"warn");Object.defineProperty(Oe.exports,"isWin",{get:function(){return Bt},set:function(t){Bt=t}});Oe.exports.warnTo=function(t){var e=_t;return _t=t,e};Oe.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Bt?Yo.join(e.APPDATA||"./","postgresql","pgpass.conf"):Yo.join(e.HOME||"./",".pgpass"));return r};Oe.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Bt?!0:(e=e||"<unkn>",Od(t.mode)?t.mode&(Nd|bd)?(In('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(In('WARNING: password file "%s" is not a plain file',e),!1))};var Rd=Oe.exports.match=function(t,e){return je.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Ad)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Oe.exports.getPassword=function(t,e,r){var n,s=e.pipe(Cd());function o(l){var u=Pd(l);u&&Dd(u)&&Rd(t,u)&&(n=u[Id],s.end())}i(o,"onLine");var a=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(l){e.destroy(),In("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),s.on("data",o).on("end",a).on("error",c)};var Pd=Oe.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,o=0,a={},c=!1,l=i(function(p,d,h){var f=t.substring(d,h);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[je[p]]=f},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=n==On-1,c){l(n,s);break}u>=0&&e==":"&&r!=="\\"&&(l(n,s,u+1),s=u+2,n+=1)}return a=Object.keys(a).length===On?a:null,a},Dd=Oe.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<je.length;r+=1){var n=e[r],s=t[je[r]]||"",o=n(s);if(!o)return!1}return!0}});var Zo=C((sS,Rn)=>{"use strict";var nS=require("path"),Xo=require("fs"),Ut=zo();Rn.exports=function(t,e){var r=Ut.getFileName();Xo.stat(r,function(n,s){if(n||!Ut.usePgPass(s,r))return e(void 0);var o=Xo.createReadStream(r);Ut.getPassword(t,o,e)})};Rn.exports.warnTo=Ut.warnTo});var ra=C((iS,ta)=>{"use strict";var Ld=require("events").EventEmitter,Jo=gt(),Pn=_o(),xd=Ir(),Md=Lr(),ea=Do(),qd=yt(),kd=wn(),Fd=Or(),Dn=class Dn extends Ld{constructor(e){super(),this.connectionParameters=new Md(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new xd(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new kd({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||qd.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{Zo()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Fd.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Pn.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Pn.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Pn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Jo.escapeIdentifier(e)}escapeLiteral(e){return Jo.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,o,a,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,o=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(a=this.connectionParameters.query_timeout,s=new ea(e,r,n),s.callback||(o=new this._Promise((u,p)=>{s.callback=(d,h)=>d?p(d):u(h)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=s.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),l(u),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},a),s.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),o):(this.queryQueue.push(s),this._pulseQueryQueue(),o):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),o)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(Dn,"Client");var $t=Dn;$t.Query=ea;ta.exports=$t});var oa=C((aS,ia)=>{"use strict";var Bd=require("events").EventEmitter,na=i(function(){},"NOOP"),sa=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),Mn=class Mn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(Mn,"IdleItem");var Ln=Mn,qn=class qn{constructor(e){this.callback=e}};i(qn,"PendingItem");var ze=qn;function Ud(){throw new Error("Release called on client which has already been released to the pool.")}i(Ud,"throwOnDoubleRelease");function Kt(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(a,c){a?r(a):n(c)},"cb"),o=new t(function(a,c){n=a,r=c}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:s,result:o}}i(Kt,"promisify");function $d(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i($d,"makeIdleListener");var kn=class kn extends Bd{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Fn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=sa(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Kt(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ze(r.callback)),n;let s=i((c,l,u)=>{clearTimeout(a),r.callback(c,l,u)},"queueCallback"),o=new ze(s),a=setTimeout(()=>{sa(this._pendingQueue,c=>c.callback===s),o.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(o),n}return this.newClient(new ze(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=$d(this,r);this.log("checking client timeout");let s,o=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),o=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(s&&clearTimeout(s),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(c=>c!==r),o&&(a.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(a,void 0,na);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new ze((u,p,d)=>d()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,o=>{if(o)return e.release(o),r.callback(o,void 0,na);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Ud(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let o;this.options.idleTimeoutMillis&&(o=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&o.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Ln(e,r,o)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let o=Kt(this.Promise,e);return setImmediate(function(){return o.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),o.result}typeof r=="function"&&(n=r,r=void 0);let s=Kt(this.Promise,n);return n=s.callback,this.connect((o,a)=>{if(o)return n(o);let c=!1,l=i(u=>{c||(c=!0,a.release(u),n(u))},"onError");a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,p)=>{if(this.log("query dispatched"),a.removeListener("error",l),!c)return c=!0,a.release(u),u?n(u):n(void 0,p)})}catch(u){return a.release(u),n(u)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Kt(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(kn,"Pool");var xn=kn;ia.exports=xn});var ua=C((uS,ca)=>{"use strict";var aa=require("events").EventEmitter,Kd=require("util"),Bn=gt(),Xe=ca.exports=function(t,e,r){aa.call(this),t=Bn.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Kd.inherits(Xe,aa);var Gd={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xe.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=Gd[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xe.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xe.prototype.catch=function(t){return this._getPromise().catch(t)};Xe.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xe.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(o,a,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),o)return e.handleError(o);e._emitRowEvents&&(c.length>1?a.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):a.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(Bn.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let o=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(o)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(o){return o?r(o):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let o=new Error("Query values must be an array");return r(o)}var s=this.values.map(Bn.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var fa=C((pS,da)=>{"use strict";var la;try{la=require("pg-native")}catch(t){throw t}var Vd=Ir(),pa=require("events").EventEmitter,Hd=require("util"),Qd=Lr(),ma=ua(),de=da.exports=function(t){pa.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Vd(t.types),this.native=new la({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Qd(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};de.Query=ma;Hd.inherits(de,pa);de.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};de.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(o){e._queryable=!1,e._errorAllQueries(o),e.emit("error",o)}),e.native.on("notification",function(o){e.emit("notification",{channel:o.relname,payload:o.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};de.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};de.prototype.query=function(t,e,r){var n,s,o,a,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")o=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(o=this.connectionParameters.query_timeout,n=new ma(t,e,r),!n.callback){let l,u;s=new this._Promise((p,d)=>{l=p,u=d}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,d)=>p?u(p):l(d)}return o&&(c=n.callback,a=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),c(l),n.callback=()=>{};var u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},o),n.callback=(l,u)=>{clearTimeout(a),c(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};de.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(o=>o?s(o):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};de.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};de.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};de.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};de.prototype.ref=function(){};de.prototype.unref=function(){};de.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};de.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Un=C((dS,ha)=>{"use strict";ha.exports=fa()});var Fn=C((fS,St)=>{"use strict";var Wd=ra(),Yd=yt(),jd=wn(),zd=oa(),{DatabaseError:Xd}=An(),{escapeIdentifier:Zd,escapeLiteral:Jd}=gt(),ef=i(t=>{var e;return e=class extends zd{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),$n=i(function(t){this.defaults=Yd,this.Client=t,this.Query=this.Client.Query,this.Pool=ef(this.Client),this._pools=[],this.Connection=jd,this.types=ht(),this.DatabaseError=Xd,this.escapeIdentifier=Zd,this.escapeLiteral=Jd},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?St.exports=new $n(Un()):(St.exports=new $n(Wd),Object.defineProperty(St.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new $n(Un())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(St.exports,"native",{value:t}),t}}))});var ga=C((yS,ya)=>{"use strict";var ke=require("fs"),tf=Pi(),rf=Fn(),nf="The server does not support SSL connections",sf="28000",of=i(t=>{let e={username:t.ssh_user,host:t.ssh_host,port:t.ssh_port,dstHost:t.host,dstPort:t.port,localHost:"127.0.0.1",localPort:t.port,keepAlive:!0};return t.ssh_method==="privateKey"?Object.assign({},e,{privateKey:ke.readFileSync(t.ssh_key_file),passphrase:t.ssh_key_passphrase}):Object.assign({},e,{password:t.ssh_password})},"getSshConfig"),af=i(t=>new Promise((e,r)=>{tf(of(t),(n,s)=>{n?r(n):e({tunnel:s,info:Object.assign({},t,{host:"127.0.0.1"})})})}),"connectViaSsh"),cf=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,o){e.info("Certificate",{hostname:s,cert:{subject:o.subject,issuer:o.issuer,valid_from:o.valid_from,valid_to:o.valid_to}})}};return ke.existsSync(t.certAuthority)&&(n.ca=ke.readFileSync(t.certAuthority).toString()),ke.existsSync(t.clientCert)&&(n.cert=ke.readFileSync(t.clientCert).toString()),ke.existsSync(t.clientPrivateKey)&&(n.key=ke.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),uf=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),lf=i(async(t,e)=>{let r=null;if(t.ssh){let{info:o,tunnel:a}=await af(t);r=a,t=o}t=Object.assign({},t,{sslType:uf(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:cf(t,e),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await Kn(n,e),sshTunnel:r}},"createClient"),pf=i((t,e,r)=>{var n;if(r.message===nf&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),Kn({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===sf&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),Kn({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),Kn=i((t,e)=>{let r=new rf.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return pf(t,e,n)})},"createConnectionPool");ya.exports={createClient:lf}});var Gn=C((ES,Sa)=>{"use strict";var Ea=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),_a={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
		SELECT tables.table_name, tables.table_type
		FROM information_schema.tables AS tables
		INNER JOIN (
			SELECT pg_class.relname AS table_name,
				   pg_namespace.nspname AS table_schema
			FROM pg_catalog.pg_class AS pg_class
				INNER JOIN pg_catalog.pg_namespace AS pg_namespace
				ON (pg_namespace.oid = pg_class.relnamespace)
			WHERE (pg_class.relispartition = false OR pg_class.relispartition IS NULL) AND pg_class.relkind = ANY ('{"r","v","t","m","p"}')
		) AS catalog_table_data
		ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
		WHERE tables.table_schema = $1;
	`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1, $2)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:`
    SELECT indexname,
           index_id,
           index_method,
           index_unique,
           number_of_keys,
           where_expression,
           array_agg(attname ORDER BY ord)::text[] AS columns,
           array_agg(coll ORDER BY ord) AS collations,
           array_agg(opclass ORDER BY ord) AS opclasses,
           array_agg(expression ORDER BY ord) AS expressions,
           array_agg(ascending ORDER BY ord) AS ascendings,
           array_agg(nulls_first ORDER BY ord) AS nulls_first,
           reloptions AS storage_parameters
    FROM (
        SELECT ct.oid AS table_oid,
            c.relname AS indexname,
            m.amname AS index_method,
            indexes.indisunique AS index_unique,
            indexes.ord,
            attribute.attname,
            c.reloptions,
            indexes.indnkeyatts AS number_of_keys,
            ti.index_id AS index_id,
            pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
            CASE
                WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
            END AS coll,
            CASE
                WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
            END AS opclass,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 1 = 1 THEN 'DESC' ELSE 'ASC'
        END AS ascending,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 2 = 2 THEN 'NULLS FIRST' ELSE 'NULLS LAST'
        END AS nulls_first,
        pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
        FROM
            (
                SELECT *,
                    generate_series(1,array_length(i.indkey,1)) AS ord,
                    unnest(i.indkey) AS key,
                    unnest(i.indcollation) AS coll,
                    unnest(i.indclass) AS class,
                    unnest(i.indoption) AS option
                FROM pg_catalog.pg_index i
            ) indexes
        JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
        JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
        JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
        LEFT JOIN pg_catalog.pg_attribute attribute
            ON (attribute.attrelid=indexes.indrelid AND attribute.attnum=indexes.key)
        LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
        LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
        LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
        LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
        INNER JOIN crdb_internal.table_indexes ti ON (
            indexes.indrelid = ti.descriptor_id
            AND c.relname = ti.index_name
        )
    ) s2
    WHERE table_oid = $1
    GROUP BY
        indexname,
        index_id,
        index_method,
        index_unique,
        reloptions,
        number_of_keys,
        where_expression;
    `,GET_TABLE_INDEX_PARTITIONING_DATA:`
        SELECT
            partitions.name AS partition_name,
            partitions.index_id,
            parent_name,
            column_names,
            list_value,
            range_value,
            index_name
        FROM crdb_internal.partitions
            INNER JOIN crdb_internal.table_indexes
                ON partitions.table_id = table_indexes.descriptor_id
                    AND partitions.index_id = table_indexes.index_id
        WHERE table_indexes.descriptor_id = $1;
    `,GET_TABLE_INDEX_CREATE_INFO:`
        SELECT index_name,
               is_sharded,
               is_visible,
               create_statement
        FROM crdb_internal.table_indexes WHERE descriptor_id = $1;
    `,GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:Ea(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:Ea(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND (
                (pg_type.typtype = 'c' AND (pg_class.relkind = 'c' OR pg_class.relkind IS NULL))
                OR pg_type.typtype = 'e'
                OR pg_type.typtype = 'r'
            )
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;"},mf=i(t=>(Object.entries(_a).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");Sa.exports={getQueryName:mf,..._a}});var Ca=C((SS,Ta)=>{"use strict";var df=Gn(),Fe=null,Gt=null;Ta.exports={initializeClient(t,e){Fe=t,Gt=e,Fe.on("error",r=>e.error(r))},isClientInitialized(){return!!Fe},releaseClient(){return Fe?new Promise(t=>{Fe.end(()=>{Fe=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=df.getQueryName(t);Gt.info("Execute query",{queryName:n,params:e});let s=Date.now(),o=await Fe.query(t,e),a=Date.now()-s;Gt.info("Query executed",{queryName:n,params:e,duration:a,rowsCount:o.rowCount});let c=o.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,Gt.error(n),null}}}});var ba=C((TS,Na)=>{"use strict";var Aa=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...Aa(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");Na.exports={getJsonSchema:Aa}});var Qn=C((AS,va)=>{"use strict";var Be=null,ff=i(t=>{Be=t.require("lodash")},"setDependencies"),Vn={column_default:"default",is_nullable:{keyword:"required",map:(t,e,r)=>({YES:!1,NO:!0})[r]},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e,r)=>r!==-1&&Af(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:{keyword:"length",map:(t,e,r)=>Number(r)},description:"description"},hf=i((t,e,r)=>{let n=Vn[e];if(!n||typeof n=="string")return r;let s=n.check||((c,l,u)=>!0),o=n.map||((c,l,u)=>u),a="";return s(t,e,r)&&(a=r),o(t,e,a)},"getColumnValue"),yf=i(t=>e=>Be.chain(e).toPairs().map(([r,n])=>{var s;return[((s=Vn[r])==null?void 0:s.keyword)||Vn[r],hf(e,r,n)]}).filter(([r,n])=>r&&!Be.isNil(n)).fromPairs().thru(gf(t)).value(),"mapColumnData"),gf=i(t=>e=>({...e,...Ef(t,e)}),"setColumnType"),Ef=i((t,e)=>e.type==="ARRAY"?_f(t,e):e.type==="USER-DEFINED"?Hn(t,e.udt_name):Hn(t,e.type),"getType"),_f=i((t,e)=>({...Hn(t,e.udt_name.slice(1)),array_type:Be.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Hn=i((t,e)=>{switch(e){case"bigserial":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"numeric":case"dec":case"decimal":return{type:"numeric",mode:"decimal"};case"int2":case"smallint":return{type:"numeric",mode:"int2"};case"int4":case"integer":return{type:"numeric",mode:"int4"};case"int":case"int8":case"int64":case"bigint":return{type:"numeric",mode:"int"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return Be.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Sf=i((t,e)=>{let r=Be.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],o=Tf(s),a=Cf(o);return{...n,subtype:a}})},"setSubtypeFromSampledJsonValues"),Tf=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Cf=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),Af=i(t=>Be.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");va.exports={setDependencies:ff,mapColumnData:yf,setSubtypeFromSampledJsonValues:Sf}});var Tt=C((bS,wa)=>{"use strict";var Nf=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],Ze=null,bf=i(t=>{Ze=t.require("lodash")},"setDependencies"),vf=i(t=>Ze.chain(t).toPairs().reject(([e,r])=>Ze.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),wf=i(t=>e=>{var r;return(r=Ze.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Of=i(t=>/\s|\W/.test(t)||Ze.includes(Nf,Ze.toUpper(t))?`"${t}"`:t,"wrapInQuotes");wa.exports={clearEmptyPropertiesInObject:vf,setDependencies:bf,getColumnNameByPosition:wf,wrapInQuotes:Of}});var Ra=C((wS,Ia)=>{"use strict";var{getColumnNameByPosition:If}=Tt(),Wn=null,Rf=i(t=>{Wn=t.require("lodash")},"setDependencies"),Oa=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Pf=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";default:return""}},"prepareMatch"),Df=i((t,e,r,n)=>Wn.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Wn.map(s.table_columns_positions,If(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:Oa(s.relationship_on_delete),relationshipOnUpdate:Oa(s.relationship_on_update),relationshipMatch:Pf(s.relationship_match)}})),"prepareForeignKeys");Ia.exports={setDependencies:Rf,prepareForeignKeys:Df}});var La=C((IS,Da)=>{"use strict";var Vt=null,Lf=i(t=>{Vt=t.require("lodash")},"setDependencies"),Pa=i(t=>Vt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:xf(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),xf=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Mf=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),qf=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),kf=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Ff=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:Pa(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Vt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Mf(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:kf(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:qf(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Bf=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Vt.toLower(t.external_language),inputArgs:Pa(e),body:t.routine_definition}),"mapProcedureData");Da.exports={setDependencies:Lf,mapFunctionData:Ff,mapProcedureData:Bf}});var ka=C((PS,qa)=>{"use strict";var Uf=i(t=>e=>{if(!e)return null;let r=Kf(e),n=Gf(t)(e),s=Vf(e);return[{partitionMethod:r,compositePartitionKey:n,partitioning_expression:s}]},"preparePartition"),Yn=i((t={})=>t.list_value?"LIST":t.range_value?"RANGE":"","getPartitionMethodByRow"),xa=i((t=[])=>t.filter(e=>!e.parent_name),"getParentPartitionRows"),$f=i((t=[],e=null)=>t.filter(r=>r.parent_name===e),"getChildPartitionRows"),Kf=i((t=[])=>{let e=xa(t);if(!e.length)return"";let r=e[0];return Yn(r)},"getPartitionMethod"),Gf=i(t=>(e=[])=>{let n=e.filter(s=>!s.parent_name).flatMap(s=>(s.column_names||"").split(",").map(a=>a.trim()));return t.uniq(n)},"getCompositePartitionKey"),Vf=i(t=>{let e=xa(t);if(!e.length)return"";let r=e[0],n=Yn(r),s=r.column_names||"",o=e.map(a=>Ma({partition:a,paddingFactor:1,partitionResult:t})).join(`,
`);return`PARTITION BY ${n} (${s}) (
${o}
)`},"getPartitionExpression"),Ma=i(({partition:t,partitionResult:e,paddingFactor:r})=>{let n=t.list_value?"VALUES IN":"VALUES FROM",s=t.list_value||t.range_value||"",o="	".repeat(r),a=`${o}PARTITION ${t.partition_name} ${n} ${s}`,c=$f(e,t.partition_name);if(c.length){let l=c.map(h=>Ma({partition:h,partitionResult:e,paddingFactor:r+1})).join(`,
`),u=c[0],p=Yn(u),d=u.column_names||"";return a+` PARTITION BY ${p} (${d}) (
`+l+`
`+o+")"}return a},"getSinglePartitionExpression");qa.exports={preparePartition:Uf}});var Ka=C((LS,$a)=>{"use strict";var{clearEmptyPropertiesInObject:Ht,getColumnNameByPosition:Fa}=Tt(),{preparePartition:Hf}=ka(),G=null,Qf=i(t=>{G=t.require("lodash")},"setDependencies"),Wf=i(t=>{let e={};for(let r of Object.keys(t))r.startsWith("ttl")?(e.ttl_storage_parameters||(e.ttl_storage_parameters={}),e.ttl_storage_parameters[r]=t[r]):e[r]=t[r];return e},"groupTtlStorageParams"),Ba=i((t,e)=>{if(!t&&!e)return null;let r=fh(t),n=Ht(r),s=Wf(n);return Ht(s)},"prepareStorageParameters"),jn=i(t=>G.split(t,"="),"splitByEqualitySymbol"),Yf=i(t=>G.find(t,{type:"json"}),"checkHaveJsonTypes"),jf=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),zf=i((t,e,r)=>G.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,Jf(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,Xf(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,Zf(s,e)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Xf=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:G.map(t.constraint_keys,Fa(e)),indexStorageParameters:G.join(t.storage_parameters,",")}),"getPrimaryKeyConstraint"),Zf=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:G.map(t.constraint_keys,Fa(e)),indexStorageParameters:G.join(t.storage_parameters,","),indexComment:t.description}),"getUniqueKeyConstraint"),Jf=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,notValid:t.notValid,constrDescription:t.description}),"getCheckConstraint"),eh=i((t,e=[])=>e.find(n=>n.index_name===t)||{}||{},"getIndexCreateInfoRowByName"),th=i(t=>{switch(t.toUpperCase()){case"INVERTED":return"gin";case"PREFIX":return"btree";default:return t}},"parseIndexMethod"),rh=i((t,e)=>(t||[]).filter(r=>r.index_name===e.indexname&&r.index_id===e.index_id),"getIndexPartitioningRows"),nh=i(({tableIndexesResult:t,tableIndexesCreateInfoResult:e=[],tableIndexesPartitioningResult:r})=>G.map(t,n=>{let s=eh(n.indexname,e),o=s.create_statement,a=ch(n,o),c=G.slice(a,0,n.number_of_keys),l=G.chain(a).slice(n.number_of_keys).map(y=>G.pick(y,"name")).value(),u=s.is_visible?"VISIBLE":"NOT VISIBLE",p=!!s.is_sharded,d=rh(r,n),f=(Hf(G)(d)||[{}])[0].partitioning_expression,S={indxName:n.indexname,index_method:th(n.index_method),unique:n.index_unique??!1,index_storage_parameter:lh(n.storage_parameters,o),where:n.where_expression||"",partitioning_expression:f,include:l,columns:c,using_hash:p,visibility:u};return Ht(S)}),"prepareTableIndexes"),sh=i(({createStatement:t,columnName:e})=>{let r=["(",","],n=0;for(;n<t.length;){let s=t.indexOf(e,n);if(s===-1)return-1;let o=t.charAt(s-1);if(t.charAt(s+e.length).match(/\s/)&&r.includes(o))return s;n=s+e.length}},"getIndexColumnDefinitionStart"),ih=i(({createStatement:t,columnDefinitionStart:e})=>{let r=t.substring(e),n=r.indexOf(","),s=r.indexOf(")");return n===-1?e+s:e+Math.min(n,s)},"getColumnDefinitionEnd"),oh=i(({createStatement:t,columnName:e})=>{let r=sh({columnName:e,createStatement:t});if(r===-1)return"";let n=ih({columnDefinitionStart:r,createStatement:t});return n===-1?"":t.substring(r,n)},"getIndexColumnQueryDefinition"),ah=i(({indexData:t,itemIndex:e,columnName:r,createStatement:n})=>{let s=G.get(t,`opclasses.${e}`,"");if(s)return s;let o=oh({columnName:r,createStatement:n});if(!o)return"";let a=o.substring(r.length).trim();return a?a.toUpperCase().replaceAll("ASC","").replaceAll("DESC","").replaceAll("NULLS FIRST","").replaceAll("NULLS LAST","").toLowerCase().trim():""},"getIndexColumnOpClass"),ch=i((t,e)=>G.chain(t.columns).map((r,n)=>{if(!r)return;let s=G.get(t,`ascendings.${n}`,"ASC"),o=G.get(t,`nulls_first.${n}`,"NULLS FIRST"),a=ah({columnName:r,createStatement:e,itemIndex:n,indexData:t}),c=G.get(t,`collations.${n}`,"");return{name:r,sortOrder:s,nullsOrder:o,opclass:a,collation:c}}).compact().value(),"mapIndexColumns"),Ua=i(t=>{let e={fillfactor:t.fillfactor,bucket_count:t.bucket_count,geometry_max_x:t.geometry_max_x,geometry_max_y:t.geometry_max_y,geometry_min_x:t.geometry_min_x,geometry_min_y:t.geometry_min_y,s2_level_mod:t.s2_level_mod,s2_max_cells:t.s2_max_cells,s2_max_level:t.s2_max_level};return Ht(e)},"hydrateIndexStorageParameters"),uh=i(t=>{let e=/\s+with\s+\(.*?\)/im,r=t.match(e);if(!(r!=null&&r.length))return null;let n=r[0],s=7,o=n.length-1,a=n.substring(s,o).split(",").map(l=>l.trim()),c=G.fromPairs(G.map(a,l=>jn(l)));return Ua(c)},"parseIndexStorageParametersFromDdl"),lh=i((t,e)=>{if(!t)return uh(e);let r=G.fromPairs(G.map(t,n=>jn(n)));return Ua(r)},"getIndexStorageParameters"),ph=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Ba(t==null?void 0:t.reloptions,e),o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,partitionBounds:o}},"prepareTableLevelData"),mh=i(t=>{switch(dh(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),dh=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),fh=i(t=>G.chain(t).map(jn).map(([e,r])=>[e,mh(r)]).fromPairs().value()||{},"prepareOptions"),hh=i((t,e)=>G.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");$a.exports={prepareStorageParameters:Ba,setDependencies:Qf,checkHaveJsonTypes:Yf,prepareTableConstraints:zf,prepareTableLevelData:ph,prepareTableIndexes:nh,getSampleDocSize:jf,prepareTableInheritance:hh}});var Va=C((MS,Ga)=>{"use strict";var{mapColumnData:yh}=Qn(),zn=null,gh=i(t=>{zn=t.require("lodash")},"setDependencies"),Eh=i(t=>zn.chain(t).map(e=>{switch(e.type){case"e":return _h(e);case"r":return Sh(e);case"c":return Th(e);default:return null}}).compact().value(),"getUserDefinedTypes"),_h=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Sh=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Th=i(t=>{let e=zn.map(t.columns,yh([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Ch=i(t=>t.type==="c","isTypeComposite");Ga.exports={setDependencies:gh,getUserDefinedTypes:Eh,isTypeComposite:Ch}});var Qa=C((kS,Ha)=>{"use strict";var{clearEmptyPropertiesInObject:Ah,wrapInQuotes:Nh}=Tt(),Ie=null,bh=i(t=>{Ie=t.require("lodash")},"setDependencies"),Xn=" (v)",vh=i(t=>t==="VIEW","isViewByTableType"),wh=i(t=>Ie.endsWith(t,Xn),"isViewByName"),Oh=i(t=>t.slice(0,-Xn.length),"removeViewNameSuffix"),Ih=i(t=>`${t}${Xn}`,"setViewSuffix"),Rh=i((t,e,r={})=>{let n=Ie.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${Nh(t)} AS ${n}`:""},"generateCreateViewScript"),Ph=i((t,e)=>{let r={withCheckOption:t.check_option!=="NONE"||Ie.isNil(t.check_option),checkTestingScope:Dh(t.check_option),viewOptions:Ie.fromPairs(Ie.map(e==null?void 0:e.view_options,xh)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Lh(t),description:e==null?void 0:e.description};return Ah(r)},"prepareViewData"),Dh=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Lh=i(t=>Ie.startsWith(Ie.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),xh=i(t=>Ie.split(t,"="),"splitByEqualitySymbol");Ha.exports={setDependencies:bh,isViewByTableType:vh,isViewByName:wh,removeViewNameSuffix:Oh,generateCreateViewScript:Rh,setViewSuffix:Ih,prepareViewData:Ph}});var ja=C((BS,Ya)=>{"use strict";var Mh=i((t,e)=>[qh,kh].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),qh=i((t,e)=>{var o,a,c;if(((c=(a=(o=e.primaryKey)==null?void 0:o[0])==null?void 0:a.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Fh(t,s,n),entityLevel:Kh(e)}},"reorganizePrimaryKeys"),kh=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let a=s.compositeUniqueKey[0];return{attributes:Uh(r,a,s),entityLevel:Gh(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Fh=i((t,e,r)=>t.map(n=>n.name!==e?n:Bh(n,r)),"setAttributesPrimaryKeyData"),Bh=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Wa(e)}),"setPrimaryKeyData"),Uh=i((t,e,r)=>t.map(n=>n.name!==e?n:$h(n,r)),"setAttributesUniqueKeyData"),$h=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Wa(e)}),"setUniqueKeyData"),Wa=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexComment:t.indexComment}],"getOptions"),Kh=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Gh=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Ya.exports={reorganizeConstraints:Mh}});var Zn=C(($S,Ja)=>{"use strict";var{createClient:Vh}=ga(),k=Ca(),{getJsonSchema:za}=ba(),{setDependencies:Hh,mapColumnData:Qh,setSubtypeFromSampledJsonValues:Wh}=Qn(),{setDependencies:Yh,clearEmptyPropertiesInObject:Xa}=Tt(),{setDependencies:jh,prepareForeignKeys:zh}=Ra(),{setDependencies:Xh,mapFunctionData:Zh,mapProcedureData:Jh}=La(),{setDependencies:ey,checkHaveJsonTypes:ty,prepareTableConstraints:ry,getSampleDocSize:ny,prepareTableLevelData:sy,prepareTableIndexes:iy}=Ka(),{setDependencies:oy,getUserDefinedTypes:ay,isTypeComposite:cy}=Va(),{setDependencies:uy,isViewByTableType:ly,isViewByName:py,removeViewNameSuffix:my,generateCreateViewScript:dy,setViewSuffix:fy,prepareViewData:hy}=Qa(),F=Gn(),{reorganizeConstraints:yy}=ja(),Qt=null,J=null,_e=null,Za=14;Ja.exports={setDependencies(t){J=t.require("lodash"),Yh(t),ey(t),Hh(t),jh(t),uy(t),Xh(t),oy(t)},async connect(t,e){k.isClientInitialized()&&await this.disconnect();let{client:r,sshTunnel:n}=await Vh(t,e);k.initializeClient(r,e),Qt=n,_e=e,Za=await this._getServerVersion()},async disconnect(){Qt&&(Qt.close(),Qt=null),await k.releaseClient()},pingDb(){return k.query(F.PING)},applyScript(t){return k.query(t)},async getDatabaseNames(){return J.map(await k.query(F.GET_DATABASES),"database_name")},async logVersion(){let t=await k.queryTolerant(F.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved"},async getAllSchemasNames(){return(await k.query(F.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!gy(e))},async getTablesNames(t){let e=await k.query(F.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!J.includes(r,n)).map(({table_name:n,table_type:s})=>ly(s)?fy(n):n)},async getDbLevelData(){var n,s,o;_e.progress("Get database data");let t=(n=await k.queryTolerant(F.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await k.queryTolerant(F.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(o=await k.queryTolerant(F.GET_DB_COLLATE_NAME,[],!0))==null?void 0:o.default_collate_name;return Xa({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r){let n=await this._retrieveUserDefinedTypes(t),s=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0),o=s==null?void 0:s.oid,[a,c]=J.partition(e,py),l=c.map(d=>({tableName:d})),u=await Ct(J.uniq(l),J.bind(this._retrieveSingleTableData,this,r,o,t,n));return{views:await Ct(a,J.bind(this._retrieveSingleViewData,this,o,t)),tables:u,modelDefinitions:za(n)}},async retrieveSchemaLevelData(t,e){var u;if(e)return _e.info("Functions and procedures ignored"),{functions:[],procedures:[]};_e.progress("Get Functions and Procedures",t);let r=(u=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,n=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await k.queryTolerant(Ey(Za),[r]),[o,a]=J.partition(J.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await Ct(o,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),h=J.find(s,{function_name:p.name});return Zh(p,d,h)}),l=await Ct(a,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),h=J.find(s,{function_name:p.name});return Jh(p,d,h)});return{functions:c,procedures:l}},async _retrieveUserDefinedTypes(t){_e.progress("Get User-Defined Types",t);let e=await k.queryTolerant(F.GET_USER_DEFINED_TYPES,[t]),r=await Ct(e,async n=>cy(n)?{...n,columns:await k.queryTolerant(F.GET_COMPOSITE_TYPE_COLUMNS,[n.pg_class_oid])}:n);return ay(r)},async _retrieveSingleTableData(t,e,r,n,{tableName:s}){_e.progress("Get table data",r,s);let o=await k.queryTolerant(F.GET_TABLE_LEVEL_DATA,[s,e],!0),a=o==null?void 0:o.oid,c=await k.queryTolerant(F.GET_TABLE_TOAST_OPTIONS,[s,e],!0),l=await this._getTableColumns(s,r,a),p=await k.queryTolerant(F.GET_DESCRIPTION_BY_OID,[a,"pg_class"],!0),d=await k.queryTolerant(F.GET_TABLE_CONSTRAINTS,[a]),h=await k.queryTolerant(F.GET_TABLE_INDEXES,[a]),f=await k.queryTolerant(F.GET_TABLE_INDEX_PARTITIONING_DATA,[a]),S=await k.queryTolerant(F.GET_TABLE_INDEX_CREATE_INFO,[a]),y=await k.queryTolerant(F.GET_TABLE_FOREIGN_KEYS,[a]);_e.info("Table data retrieved",{schemaName:r,tableName:s,columnTypes:l.map(Te=>Te.data_type)});let T=sy(o,c),_=_y(p),D=ry(d,l,h),N=iy({tableIndexesResult:h,tableIndexesCreateInfoResult:S,tableIndexesPartitioningResult:f}),O=zh(y,s,r,l),R={description:_,Indxs:N,...T,...D},A=Xa(R),b=l.map(Qh(n)),x=ty(b),U=[];x&&(U=await this._getDocuments(r,s,b,t),b=Wh(b,U));let{attributes:W,entityLevel:Se}=yy(b,A);return{name:s,entityLevel:Se,jsonSchema:za(W),documents:U,relationships:O}},async _getTableColumns(t,e,r){_e.progress("Get columns",e,t);let n=await k.query(F.GET_TABLE_COLUMNS,[t,e]),s=await k.queryTolerant(F.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return J.map(n,o=>({...o,ordinal_position:Number(o.ordinal_position),...J.find(s,{name:o.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;_e.progress("Sampling table",t,e);let s=`${t}.${e}`,o=((p=await k.queryTolerant(F.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,a=ny(o,n),c=r.filter(({type:d})=>J.includes(["json","jsonb"],d)),l=J.map(c,"name").join(", "),u=await k.queryTolerant(F.GET_SAMPLED_DATA_SIZE(s,l),[a],!0);return _e.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:u==null?void 0:u._hackolade_tmp_sampling_tbl_size}),await k.queryTolerant(F.GET_SAMPLED_DATA(s,l),[a])},async _retrieveSingleViewData(t,e,r){_e.progress("Get view data",e,r),r=my(r);let n=await k.query(F.GET_VIEW_DATA,[r,e],!0),s=!n.view_definition&&await k.queryTolerant(F.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),o=await k.queryTolerant(F.GET_VIEW_OPTIONS,[r,t],!0),a=dy(r,n,s),c=hy(n,o);return a?{name:r,data:c,ddl:{script:a,type:"postgres"}}:(_e.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:c,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await k.queryTolerant(F.GET_VERSION_AS_NUM,[],!0),e=J.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var gy=i(t=>!!(J.startsWith(t,"pg_")||J.includes(["information_schema"],t)),"isSystemSchema"),Ey=i(t=>t===10?F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),_y=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),Ct=i((t,e)=>Promise.all(J.map(t,e)),"mapPromises")});var tc=C((GS,ec)=>{"use strict";var{createLogger:Wt}=tr(),X=Zn();ec.exports={async disconnect(t,e,r,n){await X.disconnect(),r()},async testConnection(t,e,r,n){try{Jn("Test connection",t,e);let s=Wt({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s),await X.pingDb(),await X.logVersion(),r()}catch(s){e.log("error",Ue(s),"Test connection instance log"),r(Ue(s))}finally{await X.disconnect()}},async getDatabases(t,e,r,n){try{Jn("Get databases",t,e);let s=Wt({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s),await X.logVersion();let o=await X.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(s){return e.log("error",s),r(Ue(s))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){try{Jn("Get DB table names",t,e);let s=Wt({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s),await X.logVersion();let a=await(await X.getAllSchemasNames()).reduce(async(c,l)=>{let u=await c;try{let p=await X.getTablesNames(l);return u.concat({dbName:l,dbCollections:p,isEmpty:p.length===0})}catch(p){return s.info(`Error reading database "${l}"`),s.error(p),u.concat({dbName:l,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,a)}catch(s){e.log("error",Ue(s),"Get DB collections names"),r(Ue(s)),await X.disconnect()}},async getDbCollectionsData(t,e,r,n){try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let s=Wt({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});s.progress("Start reverse engineering...");let o=t.collectionData.collections,a=t.collectionData.dataBaseNames,c=await X.getDbLevelData(),{packages:l,relationships:u}=await Promise.all(a.map(async p=>{let{tables:d,views:h,modelDefinitions:f}=await X.retrieveEntitiesData(p,o[p],t.recordSamplingSettings),{functions:S,procedures:y}=await X.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return s.progress("Schema data fetched successfully",p),{schemaName:p,tables:d,views:h,functions:S,procedures:y,modelDefinitions:f}})).then(p=>{let d=p.flatMap(({tables:f})=>f.map(S=>S.relationships)).flat();return{packages:p.flatMap(({schemaName:f,tables:S,views:y,functions:T,procedures:_,modelDefinitions:D})=>{let N={UDFs:T,Procedures:_},O=S.map(R=>({dbName:f,collectionName:R.name,documents:R.documents,views:[],emptyBucket:!1,entityLevel:R.entityLevel,validation:{jsonSchema:R.jsonSchema},bucketInfo:N,modelDefinitions:D})).sort(R=>n.require("lodash").isEmpty(R.entityLevel.inherits)?-1:1);if(y!=null&&y.length){let R={dbName:f,views:y,emptyBucket:!1};return[...O,R]}return O}),relationships:d}}).then(({packages:p,relationships:d})=>({packages:Sy(p),relationships:d}));s.info("The data is processed and sent to the application",{packagesLength:l==null?void 0:l.length,relationshipsLength:u==null?void 0:u.length}),r(null,l,c,u)}catch(s){e.log("error",Ue(s),"Retrieve tables data"),r(Ue(s))}finally{await X.disconnect()}}};var Ue=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Jn=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Sy=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var nc=C((HS,rc)=>{"use strict";var Yt=Zn(),Ty=i(async(t,e,r)=>{try{Yt.setDependencies(r),await Yt.connect(t,e),await Yt.logVersion(),await Yt.applyScript(Cy(t.script))}catch(n){throw e.error(n),Ay(n)}},"applyToInstance"),Cy=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),Ay=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");rc.exports={applyToInstance:Ty}});var se=C((WS,sc)=>{"use strict";var rs=class rs{script;isDropScript};i(rs,"ModificationScript");var es=rs,ns=class ns{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(o=>({isDropScript:n,script:o}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(ns,"AlterScriptDto");var ts=ns;sc.exports={ModificationScript:es,AlterScriptDto:ts}});var Je=C((jS,ic)=>{"use strict";var ls=class ls{id;constraintName;indexStorageParameters;indexInclude};i(ls,"AlterCollectionColumnPrimaryKeyOptionDto");var ss=ls,ps=class ps{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(ps,"AlterCollectionColumnDto");var is=ps,ms=class ms extends ss{compositePrimaryKey};i(ms,"AlterCollectionRoleCompModPKDto");var os=ms,ds=class ds{new;old};i(ds,"AlterCollectionRoleCompModPrimaryKey");var as=ds,fs=class fs{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;bucketId;compMod;name;roleType;patternProperties};i(fs,"AlterCollectionRoleDto");var cs=fs,hs=class hs{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(hs,"AlterCollectionDto");var us=hs;ic.exports={AlterCollectionDto:us,AlterCollectionRoleDto:cs,AlterCollectionColumnDto:is,AlterCollectionRoleCompModPrimaryKey:as,AlterCollectionRoleCompModPKDto:os}});var ac=C((XS,oc)=>{"use strict";var Ny=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),by=Object.values(Ny);oc.exports={ReservedWordsAsArray:by}});var q=C((eT,cc)=>{"use strict";var{AlterCollectionDto:ZS,AlterCollectionRoleDto:JS}=Je(),{ReservedWordsAsArray:vy}=ac(),wy=/\t|\n|'|\f|\r/gm;cc.exports=t=>{let e=i(g=>t.get(g,"[0].code")||t.get(g,"[0].name",""),"getDbName"),r=i(g=>g&&(g.code||g.collectionName)||"","getEntityName"),n=i(g=>g&&(g.code||g.name)||"","getViewName"),s=i(g=>Object.assign({},t.get(g,"[0]",{}),{name:e(g)}),"getDbData"),o=i(g=>t.get(g,"[0].viewOn"),"getViewOn"),a=i((g,w="	")=>g.split(`
`).map(M=>w+M).join(`
`),"tab"),c=i((g,w)=>Object.keys(g).map(t.toLower).includes(t.toLower(w)),"hasType"),l=i(g=>({...g,...t.omit(g==null?void 0:g.role,"properties")||{}}),"getSchemaOfAlterCollection"),u=i(g=>{var $;let w=r(g),M=($=g.compMod)==null?void 0:$.keyspaceName;return U(w,M)},"getFullCollectionName"),p=i(g=>Object.entries(g).filter(([w,M])=>!t.isNil(M)).reduce((w,[M,$])=>({...w,[M]:$}),{}),"clean"),d=i(g=>g.every(w=>t.get(w,"isActivated",!0)),"checkAllKeysActivated"),h=i(g=>g.length?g.every(w=>!t.get(w,"isActivated",!0)):!1,"checkAllKeysDeactivated"),f=i((g,w)=>{let M=g.filter(Y=>t.get(Y,"isActivated",!0)).map(w),$=g.filter(Y=>!t.get(Y,"isActivated",!0)).map(w);return{activatedItems:M,deactivatedItems:$}},"divideIntoActivatedAndDeactivated"),S=i((g,{isActivated:w,isPartOfLine:M,inlineComment:$="--"})=>g?w!==!1?g:M?"/* "+g+" */":g.includes(`
`)?`/*
`+g+` */
`:$+" "+g:"","commentIfDeactivated"),y=i((g,w="'",M="'")=>{let $=g[0];return g[g.length-1]===w&&$===M?g:`${w}${g}${M}`},"wrap"),T=i((g,w)=>w.some(M=>(g==null?void 0:g.oldField[M])!==(g==null?void 0:g.newField[M])),"checkFieldPropertiesChanged"),_=i(g=>{var Y;let w={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},M=r(w),$=(Y=w.compMod)==null?void 0:Y.keyspaceName;return U(M,$)},"getFullTableName"),D=i((g,w)=>`${_(g)}.${W(w)}`,"getFullColumnName"),N=i(g=>{var Y;let w={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},M=n(w),$=(Y=w.compMod)==null?void 0:Y.keyspaceName;return U(M,$)},"getFullViewName"),O=i(g=>g.code||g.name,"getUdtName"),R=i((g="")=>{let w=g.match(/\d+/);return Number(t.get(w,[0],0))},"getDbVersion"),A=i((g="")=>g.replace(wy,w=>`\\${w}`),"prepareComment"),b=i(g=>`E'${A(JSON.stringify(g)).slice(1,-1)}'`,"wrapComment"),x=i(g=>t.map(g,w=>{let M=w.defaultExpression?`DEFAULT ${w.defaultExpression}`:"";return t.trim(`${w.argumentMode} ${w.argumentName||""} ${w.argumentType} ${M}`)}).join(", "),"getFunctionArguments"),U=i((g,w)=>w?`${W(w)}.${W(g)}`:W(g),"getNamePrefixedWithSchemaName"),W=i(g=>/\s|\W/.test(g)||t.includes(vy,t.toUpper(g))?`"${g}"`:g,"wrapInQuotes"),Se=i(({name:g})=>W(g),"columnMapToString"),Te=i((g,w,M,$=Se)=>{var E;let Y=f(g,$),m=(E=Y==null?void 0:Y.deactivatedItems)!=null&&E.length?S(Y.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!w&&M?" ("+Y.activatedItems.join(", ")+m+")":" ("+g.map($).join(", ")+")"},"getColumnsList"),Ae=i(g=>g?g.alias?`${W(g.name)} as ${W(g.alias)}`:W(g.name):"","getKeyWithAlias");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:o,tab:a,hasType:c,clean:p,checkAllKeysActivated:d,checkAllKeysDeactivated:h,divideIntoActivatedAndDeactivated:f,commentIfDeactivated:S,wrap:y,checkFieldPropertiesChanged:T,getFullTableName:_,getFullColumnName:D,getFullViewName:N,getUdtName:O,getDbVersion:R,wrapComment:b,getFunctionArguments:x,getNamePrefixedWithSchemaName:U,wrapInQuotes:W,getColumnsList:Te,getViewData:i(g=>Array.isArray(g)?g.reduce((w,M)=>{if(!M.tableName)return w.columns.push(Ae(M)),w;let $=`${W(M.dbName)}.${W(M.tableName)}`;return w.tables.includes($)||w.tables.push($),w.columns.push({statement:`${$}.${Ae(M)}`,isActivated:M.isActivated}),w},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getSchemaOfAlterCollection:l,getFullCollectionName:u}}});var mc=C((rT,pc)=>{"use strict";var{AlterScriptDto:uc}=se(),lc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Oy=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=q()(t),o=lc(r);if(o.new&&o.new!==o.old){let a=n(o.new),c=s(r.role.name),l=e.updateSchemaComment(c,a);return uc.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),Iy=i((t,e)=>r=>{let{wrapInQuotes:n}=q()(t),s=lc(r);if(s.old&&!s.new){let o=n(r.role.name),a=e.dropSchemaComment(o);return uc.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),Ry=i((t,e)=>r=>{let n=Oy(t,e)(r),s=Iy(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");pc.exports={getModifySchemaCommentsScriptDtos:Ry}});var fc=C((sT,dc)=>{"use strict";dc.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var yc=C((iT,hc)=>{"use strict";hc.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},int:{},int2:{},int4:{},decimal:{},float:{},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var Ec=C((oT,gc)=>{"use strict";gc.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${collate}${characterClassification};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${notValid}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON ${tableName}${using}${keys}${options};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}"}});var Tc=C((aT,Sc)=>{"use strict";var _c=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),Py=i(t=>t.match(_c("gi"))||[],"getAllTemplates"),Dy=i(t=>(t.match(_c("i"))||[])[1],"parseTemplate"),Ly=i((t,e)=>Py(t).reduce((r,n)=>{let s=Dy(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");Sc.exports=Ly});var Ac=C((uT,Cc)=>{"use strict";Cc.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:o})=>({generateConstraintsString:i((h,f)=>{var _,D;let S=e(((h==null?void 0:h.deactivatedItems)||[]).join(`,
	`),{isActivated:!f,isPartOfLine:!0}),y=(_=h==null?void 0:h.activatedItems)!=null&&_.length?`,
	`+h.activatedItems.join(`,
	`):"",T=(D=h==null?void 0:h.deactivatedItems)!=null&&D.length?`
	`+S:"";return y+T},"generateConstraintsString"),foreignKeysToString:i(h=>{if(Array.isArray(h)){let f=h.filter(T=>t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),S=h.filter(T=>!t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),y=S.length?e(S,{isActivated:!1,isPartOfLine:!0}):"";return f.join(", ")+y}return h},"foreignKeysToString"),foreignActiveKeysToString:i(h=>h.map(f=>t.trim(f.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((h,f)=>S=>{let y=s(t.trim(S.name)),T=r(S.columns||[]),_=t.isEmpty(S.columns)?"":o(S.columns,T,f),D=S.include.length?` INCLUDE${o(S.include,T,f)}`:"",N=S.storageParameters?` WITH (${S.storageParameters})`:"";return{statement:n(h.createKeyConstraint,{constraintName:S.name?`CONSTRAINT ${y} `:"",keyType:S.keyType,columns:_,includeNonKey:D,storageParameters:N}),isActivated:!T}},"createKeyConstraint"),getConstraintsWarnings:i((h=[])=>t.isEmpty(h)?"":`
	`+h.map(f=>{let S=f.name?` [constraint name: ${f.name}]`:"";return`-- ${f.errorMessage}${S}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(h=>{let f=t.get(h,"relationshipOnDelete",""),S=t.get(h,"relationshipOnUpdate",""),y=t.get(h,"relationshipMatch","");return{foreignOnDelete:f,foreignOnUpdate:S,foreignMatch:y}},"additionalPropertiesForForeignKey")})});var bc=C((pT,Nc)=>{"use strict";Nc.exports=(t,e)=>{let r=i((y,T)=>Object.entries(y.properties).map(T),"mapProperties"),n=i(y=>y.compositeUniqueKey?!1:!!y.unique,"isUniqueKey"),s=i(y=>{var T,_;return n(y)&&(((T=y.uniqueKeyOptions)==null?void 0:T.length)===1&&!((_=t.first(y.uniqueKeyOptions))!=null&&_.constraintName)||t.isEmpty(y.uniqueKeyOptions))},"isInlineUnique"),o=i(y=>y.compositeUniqueKey||y.compositePrimaryKey?!1:!!y.primaryKey,"isPrimaryKey"),a=i(y=>{var T;return o(y)&&!((T=t.first(y.primaryKeyOptions))!=null&&T.constraintName)},"isInlinePrimaryKey"),c=i(({options:y,columnName:T,isActivated:_,jsonSchema:D,dbVersion:N})=>e({keyType:"UNIQUE",name:y.constraintName,columns:[{name:T,isActivated:_}],include:d(y.indexInclude||[],D),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydrateUniqueOptions"),l=i((y,T,_,D)=>e({keyType:"PRIMARY KEY",name:y.constraintName,columns:[{name:T,isActivated:_}],include:d(y.indexInclude||[],D),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydratePrimaryKeyOptions"),u=i((y,T)=>Object.keys(T).find(_=>T[_].GUID===y),"findName"),p=i((y,T)=>t.get(Object.values(T).find(_=>_.GUID===y),"isActivated",!0),"checkIfActivated"),d=i((y,T)=>t.map(y,_=>({name:u(_.keyId,T.properties),isActivated:p(_.keyId,T.properties)})),"getKeys"),h=i(y=>Array.isArray(y.primaryKey)?y.primaryKey.map(T=>t.isEmpty(T.compositePrimaryKey)?{name:T.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(T,null,null,y),columns:d(T.compositePrimaryKey,y)}):[],"getCompositePrimaryKeys"),f=i((y,T)=>Array.isArray(y.uniqueKey)?y.uniqueKey.map(_=>t.isEmpty(_.compositeUniqueKey)?{name:_.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...c({options:_,columnName:null,isActivated:null,jsonSchema:y,dbVersion:T}),columns:d(_.compositeUniqueKey,y)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((y,T)=>{if(!y.properties)return[];let _=r(y,([N,O])=>{if(!(!o(O)||a(O)))return l(t.first(O.primaryKeyOptions),N,O.isActivated,y)}).filter(Boolean),D=t.flatten(r(y,([N,O])=>!n(O)||s(O)?[]:(O.uniqueKeyOptions||[]).map(R=>c({options:R,columnName:N,isActivated:O.isActivated,jsonSchema:y,dbVersion:T})))).filter(Boolean);return[..._,...h(y),...D,...f(y,T)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:a,getKeys:d,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:c}}});var wc=C((dT,vc)=>{"use strict";vc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=i((N,O)=>t.map(O,R=>{let A=R.functionOrReplace?" OR REPLACE":"",b=r(e.createFunction,{name:s(R.name,N),orReplace:A,parameters:n(R.functionArguments),returnType:R.functionReturnsSetOf?`SETOF ${R.functionReturnType}`:R.functionReturnType,language:R.functionLanguage,properties:c(R),definition:R.functionBody}),x=R.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(R.name,N),comment:o(R.functionDescription)}):"";return[b,x].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(N=>{let O=i(R=>R?`	${R}
`:"","wrap");return[{key:"functionWindow",getValue:l},{key:"functionVolatility",getValue:u},{key:"functionLeakProof",getValue:p},{key:"functionNullArgs",getValue:d},{key:"functionSqlSecurity",getValue:h},{key:"functionParallel",getValue:f},{key:"functionExecutionCost",getValue:S},{key:"functionExecutionRows",getValue:y},{key:"functionSupportFunction",getValue:T},{key:"functionConfigurationParameters",getValue:_}].map(R=>O(R.getValue(N[R.key],N))).filter(Boolean).join("")},"getProperties"),l=i((N,O)=>O.language!=="c"||!N?"":"WINDOW","getWindow"),u=i(N=>N,"getVolatility"),p=i(N=>N?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),d=i(N=>N,"getNullArgs"),h=i(N=>{if(N)return`SECURITY ${N}`},"getSqlSecurity"),f=i(N=>{if(N)return`PARALLEL ${N}`},"getParallel"),S=i(N=>{if(N)return`COST ${N}`},"getExecutionCost"),y=i((N,O)=>!N||!O.functionReturnsSetOf&&!D(O)?"":`ROWS ${N}`,"getExecutionRows"),T=i(N=>{if(N)return`SUPPORT ${N}`},"getSupportFunction"),_=i(N=>{if(N)return`SET ${N}`},"getConfigurationParameters"),D=i(N=>(N.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:a}}});var Ic=C((hT,Oc)=>{"use strict";Oc.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((a,c)=>t.map(c,l=>{let u=l.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(l.name,a),orReplace:u,parameters:n(l.inputArgs),language:l.language,body:l.body})}).join(`
`),"getProceduresScript")})});var Pc=C((gT,Rc)=>{"use strict";Rc.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,d)=>p?" TEMPORARY":d?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let d=i(f=>f?`${f}
`:"","wrap"),h=[{key:"inherits",getValue:l("INHERITS")},{key:"partitionBounds",getValue:l("")},{key:"partitioning",getValue:o},{key:"usingMethod",getValue:l("USING")},{key:"storage_parameter",getValue:u},{key:"on_commit",getValue:c},{key:"selectStatement",getValue:l("AS")}].map(f=>d(f.getValue(p[f.key],p))).filter(Boolean).join("");return t.trim(h)?` ${t.trim(h)}`:""},"getTableOptions"),o=i((p,{isActivated:d})=>{if(p&&p.partitionMethod){let f=a(p,d)+` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${f}`}},"getPartitioning"),a=i((p,d)=>{let h=r(p.compositePartitionKey);return e(p.compositePartitionKey,h,d)},"getPartitionKeys"),c=i((p,d)=>{if(p&&d.temporary)return`ON COMMIT ${p}`},"getOnCommit"),l=i(p=>d=>{if(d)return`${p} ${d}`},"getBasicValue"),u=i(p=>{if(t.isEmpty(p))return"";let d=["ttl_storage_parameters"],h=["id",...d];return t.chain(p).toPairs().flatMap(([f,S])=>d.includes(f)?t.toPairs(S):[[f,S]]).reject(([f])=>t.includes(h,f)).map(([f,S])=>{if(!(!S&&S!==0))return`${f}=${S}`}).compact().join(`,
	`).trim().thru(f=>{if(f)return`WITH (
	${f}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var Lc=C((_T,Dc)=>{"use strict";Dc.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=["composite","enum","range_udt","domain"],c=i((f,S)=>{let y=s(f.name,f.schemaName),T=r(n.comment,{object:"TYPE",objectName:y,comment:o(f.comment)});switch(f.type){case"composite":return r(n.createCompositeType,{name:y,columnDefinitions:t.join(S,`,
	`),comment:f.comment?T:""});case"enum":return r(n.createEnumType,{name:y,values:t.map(f.enum,_=>`'${_}'`).join(", "),comment:f.comment?T:""});case"range_udt":return r(n.createRangeType,{name:y,subtype:f.rangeSubtype,options:u(f),comment:f.comment?T:""});case"domain":{let _=r(n.comment,{object:"DOMAIN",objectName:y,comment:o(f.comment)});return r(n.createDomainType,{name:y,underlyingType:f.underlyingType,notNull:f.nullable?"":" NOT NULL",collate:f.collation?`
	COLLATE ${f.collation}`:"",default:f.default?`
	DEFAULT ${f.default}`:"",constraints:p(f),comment:f.comment?_:""})}default:return""}},"getPlainUdt"),l=i(f=>a.includes(f.type),"isNotPlainType"),u=i(f=>{let S=i(T=>T?`	${T}`:"","wrap"),y=[{key:"operatorClass",getValue:d("SUBTYPE_OPCLASS")},{key:"collation",getValue:d("COLLATION")},{key:"canonicalFunction",getValue:d("CANONICAL")},{key:"subtypeDiffFunction",getValue:d("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:d("MULTIRANGE_TYPE_NAME")}].map(T=>S(T.getValue(f[T.key]))).filter(Boolean).join(`,
`);return t.trim(y)?`,
	`+t.trim(y):""},"getRangeOptions"),p=i(f=>t.map(f.checkConstraints,S=>S.name?`
	CONSTRAINT ${S.name} CHECK (${S.expression})`:`
	CHECK (${S.expression})`).join(""),"getDomainConstraints"),d=i(f=>S=>{if(S)return`${f}=${S}`},"getBasicValue");return{getUserDefinedType:i((f,S)=>e(c(f,S),{isActivated:f.isActivated}),"getUserDefinedType"),isNotPlainType:l}}});var Mc=C((TT,xc)=>{"use strict";xc.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:u,sortOrder:p,nullsOrder:d,opclass:h})=>{let f=p?` ${p}`:"",S=d?` ${d}`:"",y=h?` ${h}`:"";return`${e(u)}${y}${f}${S}`},"mapIndexKey"),o=i((u=[],p)=>{let d=r(u);return n(u,d,p,s)},"getIndexKeys"),a=i((u,p)=>{var O;let d=n(u.include||[],r(u.include||[]),p),h=["btree"],f=u.using_hash&&h.includes(u.index_method)?" USING HASH":"",S=(O=u.include)!=null&&O.length?` INCLUDE ${t.trim(d)}`:"",y=u.partitioning_expression||"",T=c(u),_=T?` WITH (
	${T})`:"",D=u.where?` WHERE ${u.where}`:"",N=u.visibility?` ${u.visibility}`:"";return t.compact([" ",f,S,y,_,D,N]).join(`
`)},"getIndexOptions"),c=i(u=>{let p=["id"];return t.chain(u.index_storage_parameter).toPairs().map(([d,h])=>{if(!(p.includes(d)||t.isNil(h)||h===""))return`${d}=${l(h)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(u=>t.isBoolean(u)?u?"ON":"OFF":u,"getValue");return{getIndexKeys:o,getIndexOptions:a}}});var kc=C((AT,qc)=>{"use strict";qc.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:o})=>{let a=i((A,b)=>`${A}(${b})`,"addLength"),c=i((A,b,x)=>t.isNumber(x)?`${A}(${b},${x})`:`${A}(${b})`,"addScalePrecision"),l=i((A,b)=>t.isNumber(b)?`${A}(${b})`:A,"addPrecision"),u=i((A,b)=>b?`${A} ${b}`:A,"addWithTimezone"),p=i(({type:A,typeModifier:b,srid:x})=>{let U=x?`, ${x}`:"";return b&&b!==""?`${A}(${b}${U})`:A},"addTypeModifier"),d=i((A,b)=>{let x=(b==null?void 0:b.map(U=>`[${(U==null?void 0:U.array_size_limit)??""}]`).join("").trim())||"";return`${A}${x}`},"addArrayDecorator"),h=i(A=>["char","varchar","bit","varbit"].includes(A),"canHaveLength"),f=i(A=>["numeric","decimal"].includes(A),"canHavePrecision"),S=i(A=>["time","timestamp"].includes(A),"canHaveTimePrecision"),y=i(A=>["numeric","decimal"].includes(A),"canHaveScale"),T=i(A=>["geography","geometry"].includes(A),"canHaveTypeModifier"),_=i((A,b)=>(h(A)&&t.isNumber(b.length)?A=a(A,b.length):f(A)&&y(A)&&t.isNumber(b.precision)?A=c(A,b.precision,b.scale):f(A)&&t.isNumber(b.precision)?A=l(A,b.precision):T(A)?A=p({type:A,typeModifier:b.typeModifier,srid:b.srid}):S(A)&&(t.isNumber(b.timePrecision)||b.timezone)&&(A=u(l(A,b.timePrecision),b.timezone)),d(A,b.array_type)),"decorateType"),D=i(A=>["char","varchar","text","bit","varbit"].includes(A),"isString"),N=i(A=>["date","time","timestamp","interval"].includes(A),"isDateTime");return{decorateType:_,decorateDefault:i((A,b,x)=>{let U=["current_timestamp","null"];return(D(A)||N(A))&&!U.includes(t.toLower(b))&&!x?s(b):b},"decorateDefault"),getColumnComments:i((A,b)=>t.chain(b).filter("comment").map(x=>{let U=e(r.comment,{object:"COLUMN",objectName:`${A}.${o(x.name)}`,comment:s(x.comment)});return n(U,x)}).join(`
`).value(),"getColumnComments")}}});var ee=C((bT,Bc)=>{"use strict";var xy=fc(),Fc=yc(),P=Ec();Bc.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:o,checkAllKeysDeactivated:a,divideIntoActivatedAndDeactivated:c,hasType:l,wrap:u,clean:p,wrapComment:d,getFunctionArguments:h,wrapInQuotes:f,getNamePrefixedWithSchemaName:S,getColumnsList:y,getViewData:T}=q()(n),_=Tc(),{generateConstraintsString:D,foreignKeysToString:N,foreignActiveKeysToString:O,createKeyConstraint:R,getConstraintsWarnings:A,additionalPropertiesForForeignKey:b}=Ac()({_:n,commentIfDeactivated:o,checkAllKeysDeactivated:a,assignTemplates:_,getColumnsList:y,wrapInQuotes:f}),x=bc()(n,p),{getFunctionsScript:U}=wc()({_:n,templates:P,assignTemplates:_,getFunctionArguments:h,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getProceduresScript:W}=Ic()({_:n,templates:P,assignTemplates:_,getFunctionArguments:h,getNamePrefixedWithSchemaName:S}),{getTableTemporaryValue:Se,getTableOptions:Te}=Pc()({_:n,checkAllKeysDeactivated:a,getColumnsList:y}),{getUserDefinedType:Ae,isNotPlainType:Re}=Lc()({_:n,commentIfDeactivated:o,assignTemplates:_,templates:P,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getIndexKeys:g,getIndexOptions:w}=Mc()({_:n,wrapInQuotes:f,checkAllKeysDeactivated:a,getColumnsList:y}),{decorateType:M,decorateDefault:$,getColumnComments:Y}=kc()({_:n,wrap:u,assignTemplates:_,templates:P,commentIfDeactivated:o,wrapInQuotes:f,wrapComment:d});return{createDatabase(m){if(!m.databaseName)return"";let{collate:E,characterClassification:v}=m;return _(P.createDatabase,{name:f(m.databaseName),template:m.template?`
	TEMPLATE ${m.template}`:"",encoding:m.encoding?`
	ENCODING = '${m.encoding}'`:"",collate:E?`
	LC_COLLATE = '${m.collate}'`:"",characterClassification:v?`
	LC_CTYPE = '${v}'`:""})},createSchema({schemaName:m,ifNotExist:E,comments:v,udfs:I,procedures:K}){let ne=_(P.comment,{object:"SCHEMA",objectName:f(m),comment:d(v)}),Z=_(P.createSchema,{name:f(m),ifNotExist:E?" IF NOT EXISTS":"",comment:v?ne:""}),j=U(m,I),ie=W(m,K);return n.chain([Z,j,ie]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:m,columns:E,checkConstraints:v,foreignKeyConstraints:I,schemaData:K,columnDefinitions:ne,keyConstraints:Z,inherits:j,description:ie,ifNotExist:pe,usingMethod:he,on_commit:z,partitioning:fe,storage_parameter:Ne,temporary:be,unlogged:Ce,selectStatement:ve,partitionOf:ce,partitionBounds:Le},we){let Nt=pe?" IF NOT EXISTS":"",Ke=S(m,K.schemaName),bt=_(P.comment,{object:"TABLE",objectName:Ke,comment:d(ie)}),ye=c(Z.filter(({errorMessage:Me})=>!Me).map(R(P,we)),Me=>Me.statement),er=A(Z.filter(({errorMessage:Me})=>Me)),xe=`${D(ye,we)}${er}`,si=ce?xe==null?void 0:xe.slice(1):xe,Ku=c(I,Me=>Me.statement),ii=D(Ku,we),Gu=`
`+Y(Ke,ne),Vu=ce?P.createTablePartitionOf:P.createTable,Hu=ce&&!xe?`
	`:`,
	`,oi=n.isEmpty(v)?"":u(n.join(v,`,
	`),Hu,""),ai=ce&&!si&&!oi&&!ii,Qu=ai?"":"(",Wu=ai?"":")",Yu=_(Vu,{temporary:Se(be,Ce),ifNotExist:Nt,name:Ke,columnDefinitions:ce?"":"	"+n.join(E,`,
	`),keyConstraints:si,checkConstraints:oi,foreignKeyConstraints:ii,options:Te({inherits:j,partitioning:fe,usingMethod:he,on_commit:z,storage_parameter:Ne,selectStatement:ve,partitionBounds:Le}),comment:ie?bt:"",partitionOf:ce?` PARTITION OF ${ce} `:"",columnDescriptions:Gu,openParenthesis:Qu,closeParenthesis:Wu});return o([Yu].map(n.trim).join(`

`).trim()+`
`,{isActivated:we})},convertColumnDefinition(m){let E=m.nullable?"":" NOT NULL",v=m.primaryKey?" "+R(P,!0)(m.primaryKeyOptions).statement:"",I=m.unique?" "+R(P,!0)(m.uniqueKeyOptions).statement:"",K=m.collationRule?` COLLATE "${m.collationRule}"`:"",ne=Array.isArray(m.array_type)&&m.array_type.length>0,Z=n.isUndefined(m.default)?"":" DEFAULT "+$(m.type,m.default,ne),j=m.dbVersion>=12&&m.generatedColumn&&m.columnGenerationExpression?_(P.generatedColumnClause,{generationExpression:m.columnGenerationExpression}):"";return o(_(P.columnDefinition,{name:f(m.name),type:M(m.type,m),generatedColumnClause:j,notNull:E,primaryKey:v,uniqueKey:I,collation:K,defaultValue:Z}),{isActivated:m.isActivated})},createIndex(m,E,v,I=!0){let K=E.unique&&E.index_method==="btree",ne=f(E.indxName),Z=K?" UNIQUE":"",j=E.concurrently?" CONCURRENTLY":"",ie=E.ifNotExist?" IF NOT EXISTS":"",pe=E.index_method?` USING ${n.toUpper(E.index_method)}`:"",he=g(E.index_method==="btree"?E.columns:n.map(E.columns,fe=>n.omit(fe,"sortOrder","nullsOrder")),I),z=w(E,I);return o(_(P.index,{unique:Z,concurrently:j,ifNotExist:ie,name:ne,using:pe,keys:he,options:z,tableName:S(m,E.schemaName)}),{isActivated:E.isActivated})},createCheckConstraint(m){return _(P.checkConstraint,{name:m.name?`CONSTRAINT ${f(m.name)}`:"",expression:n.trim(m.expression).replace(/^\(([\s\S]*)\)$/,"$1"),notValid:m.notValid?" NOT VALID":""})},createForeignKeyConstraint({name:m,foreignKey:E,primaryTable:v,primaryKey:I,primaryTableActivated:K,foreignTableActivated:ne,foreignSchemaName:Z,primarySchemaName:j,customProperties:ie,isActivated:pe},he,z){let fe=a(I),Ne=a(E),be=!fe&&!Ne&&K&&ne,{foreignOnDelete:Ce,foreignOnUpdate:ve,foreignMatch:ce}=b(ie),Le=_(P.createForeignKeyConstraint,{primaryTable:S(v,j||z.schemaName),name:m?`CONSTRAINT ${f(m)}`:"",foreignKey:be?N(E):O(E),primaryKey:be?N(I):O(I),onDelete:Ce?` ON DELETE ${Ce}`:"",onUpdate:ve?` ON UPDATE ${ve}`:"",match:ce?` MATCH ${ce}`:""});return{statement:n.trim(Le),isActivated:be&&pe}},createForeignKey({name:m,foreignTable:E,foreignKey:v,primaryTable:I,primaryKey:K,primaryTableActivated:ne,foreignTableActivated:Z,foreignSchemaName:j,primarySchemaName:ie,customProperties:pe,isActivated:he},z,fe){let Ne=a(K),be=a(v),Ce=!Ne&&!be&&ne&&Z,{foreignOnDelete:ve,foreignOnUpdate:ce,foreignMatch:Le}=b(pe),we=_(P.createForeignKey,{primaryTable:S(I,ie||fe.schemaName),foreignTable:S(E,j||fe.schemaName),name:m?f(m):"",foreignKey:Ce?N(v):O(v),primaryKey:Ce?N(K):O(K),onDelete:ve?` ON DELETE ${ve}`:"",onUpdate:ce?` ON UPDATE ${ce}`:"",match:Le?` MATCH ${Le}`:""});return{statement:n.trim(we),isActivated:Ce&&he}},createView(m,E,v){var we,Nt,Ke,bt;let I=S(m.name,m.schemaName),K=_(P.comment,{object:"VIEW",objectName:I,comment:d(m.comment)}),Z=a(m.keys||[])||!v,{columns:j,tables:ie}=T(m.keys),pe=j.map(ye=>ye.statement).join(`,
		`);if(!Z){let ye=c(j,xe=>xe.statement),er=ye.deactivatedItems.length?o(ye.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";pe=ye.activatedItems.join(`,
		`)+er}let he=n.trim(m.selectStatement)?n.trim(s(m.selectStatement)):_(P.viewSelectStatement,{tableName:ie.join(", "),keys:pe}),z=(we=m.viewOptions)!=null&&we.check_option?`check_option=${(Nt=m.viewOptions)==null?void 0:Nt.check_option}`:"",fe=(Ke=m.viewOptions)!=null&&Ke.security_barrier?"security_barrier":"",Ne=15,{getDbVersion:be}=q()(n),Ce=(bt=m.viewOptions)!=null&&bt.security_invoker&&be(E.dbVersion)>=Ne?"security_invoker":"",ve=z||fe||Ce?`
	WITH (${n.compact([z,fe,Ce]).join(",")})`:"",ce=i(ye=>ye.withCheckOption&&ye.checkTestingScope?`
	WITH ${ye.checkTestingScope} CHECK OPTION`:ye.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption");return[o(_(P.createView,{name:I,orReplace:m.orReplace?" OR REPLACE":"",temporary:m.temporary?" TEMPORARY":"",checkOption:ce(m),comment:m.comment?K:"",withOptions:ve,selectStatement:he}),{isActivated:!Z})].map(n.trim).join(`

`).trim()+`
`},dropView(m){let E={viewName:m};return _(P.dropView,E)},createViewIndex(){return""},createUdt(m){let E=n.map(m.properties,this.convertColumnDefinition);return Ae(m,E)},getDefaultType(m){return xy[m]},getTypesDescriptors(){return Fc},hasType(m){return l(Fc,m)},hydrateDatabase({modelData:m}){return m=n.get(m,"0",{}),{databaseName:m.database_name,encoding:m.encoding,template:m.template,collate:m.LC_COLLATE,characterClassification:m.LC_CTYPE,dbVersion:m.dbVersion}},hydrateColumn({columnDefinition:m,jsonSchema:E,schemaData:v,definitionJsonSchema:I={},parentJsonSchema:K}){let ne=n.includes(["char","varchar","text"],m.type)?E.collationRule:"",Z=["time","timestamp"],j=n.includes(Z,m.type)?E.timePrecision:"",ie=n.includes(Z,m.type)?E.timezone:"",pe=m.type==="interval"?E.intervalOptions:"",{getDbVersion:he}=q()(n),z=he(v.dbVersion),fe=n.omit(x.hydratePrimaryKeyOptions(n.first(E.primaryKeyOptions)||{},m.name,m.isActivated,K),"columns"),Ne=n.omit(x.hydrateUniqueOptions({options:n.first(E.uniqueKeyOptions)||{},columnName:m.name,isActivated:m.isActivated,jsonSchema:K,dbVersion:z}),"columns");return{name:m.name,type:m.type,primaryKey:x.isInlinePrimaryKey(E),primaryKeyOptions:fe,unique:x.isInlineUnique(E),uniqueKeyOptions:Ne,nullable:m.nullable,default:m.default,comment:E.refDescription||E.description||I.description,isActivated:m.isActivated,scale:m.scale,precision:m.precision,length:m.length,enum:E.enum,array_type:E.array_type,unit:E.unit,rangeSubtype:E.rangeSubtype,operatorClass:E.operatorClass,collation:E.collation,canonicalFunction:E.canonicalFunction,subtypeDiffFunction:E.subtypeDiffFunction,multiRangeType:E.multiRangeType,schemaName:v.schemaName,underlyingType:E.underlyingType,checkConstraints:E.checkConstraints,typeModifier:E.typeModifier,srid:E.srid,collationRule:ne,timePrecision:j,timezone:ie,intervalOptions:pe,dbVersion:z,generatedColumn:!!E.generatedColumn,columnGenerationExpression:E.columnGenerationExpression}},hydrateJsonSchemaColumn(m,E){return!m.$ref||n.isEmpty(E)||Re(E)?m:(m=n.omit(m,"$ref"),{...E,...m})},hydrateIndex(m,E,v){return{...m,schemaName:v.schemaName}},hydrateViewIndex(m){return{}},hydrateCheckConstraint(m){return{name:m.chkConstrName,expression:m.constrExpression,notValid:m.notValid}},hydrateSchema(m,E){let v=n.get(E,"modelData.0.dbVersion");return{schemaName:m.name,ifNotExist:m.ifNotExist,comments:m.description,udfs:(E==null?void 0:E.udfs)||[],procedures:(E==null?void 0:E.procedures)||[],dbVersion:v}},hydrateTable({tableData:m,entityData:E,jsonSchema:v}){let I=E[0],K=n.chain(I.inherits).map(({parentTable:z})=>n.get(m,`relatedSchemas[${z}]`,"")).compact().map(z=>z.code||z.collectionName).join(", ").thru(z=>z?`(${z})`:"").value(),ne=n.first(I.partitioning)||{},Z=x.getKeys(ne.compositePartitionKey,v),j=n.get(m,`relatedSchemas[${I.partitionOf}]`),ie=j?S(j.collectionName,j.bucketName):"",{getDbVersion:pe}=q()(n),he=pe(n.get(m,"dbData.dbVersion",""));return{...m,partitionOf:ie,keyConstraints:x.getTableKeyConstraints(v,he),inherits:K,selectStatement:n.trim(I.selectStatement),partitioning:n.assign({},ne,{compositePartitionKey:Z}),...n.pick(I,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","partitionBounds")}},hydrateViewColumn(m){return{name:m.name,tableName:m.entityName,alias:m.alias,isActivated:m.isActivated,dbName:m.dbName}},hydrateView({viewData:m,entityData:E,relatedSchemas:v}){let I=E[0];return{name:m.name,keys:m.keys,comment:I.description,orReplace:I.orReplace,temporary:I.temporary,recursive:I.recursive,viewOptions:I.viewOptions,selectStatement:I.selectStatement,withCheckOption:I.withCheckOption,checkTestingScope:I.withCheckOption?I.checkTestingScope:"",schemaName:m.schemaData.schemaName}},commentIfDeactivated(m,E,v){return m},alterColumnType(m,E,v,I){let K=v;return I.length?K+=`(${I.length})`:I.precision&&I.scale?K+=`(${I.precision},${I.scale})`:I.precision&&(K+=`(${I.precision})`),_(P.alterColumnType,{tableName:m,columnName:E,dataType:K})},setNotNullConstraint(m,E){return _(P.addNotNullConstraint,{tableName:m,columnName:E})},dropNotNullConstraint(m,E){return _(P.dropNotNullConstraint,{tableName:m,columnName:E})},renameColumn(m,E,v){return _(P.renameColumn,{tableName:m,oldColumnName:E,newColumnName:v})},addCheckConstraint(m,E,v){let I={tableName:m,constraintName:E,expression:v};return _(P.addCheckConstraint,I)},dropConstraint(m,E){let v={tableName:m,constraintName:E};return _(P.dropConstraint,v)},updateTableComment(m,E){let v={tableName:m,comment:E};return _(P.updateCommentOnTable,v)},dropTableComment(m){let E={tableName:m,comment:"NULL"};return _(P.updateCommentOnTable,E)},updateColumnComment(m,E){let v={columnName:m,comment:E};return _(P.updateCommentOnColumn,v)},dropColumnComment(m){let E={columnName:m,comment:"NULL"};return _(P.updateCommentOnColumn,E)},updateSchemaComment(m,E){let v={schemaName:m,comment:E};return _(P.updateCommentOnSchema,v)},dropSchemaComment(m){let E={schemaName:m,comment:"NULL"};return _(P.updateCommentOnSchema,E)},updateViewComment(m,E){let v={viewName:m,comment:E};return _(P.updateCommentOnView,v)},dropViewComment(m){let E={viewName:m,comment:"NULL"};return _(P.updateCommentOnView,E)},createSchemaOnly(m){let E={schemaName:m};return _(P.createSchemaOnly,E)},dropSchema(m){let E={schemaName:m};return _(P.dropSchema,E)},dropTable(m){let E={tableName:m};return _(P.dropTable,E)},addColumn(m,E){let v={tableName:m,columnDefinition:E};return _(P.addColumn,v)},dropColumn(m,E){let v={tableName:m,columnName:E};return _(P.dropColumn,v)},dropDomain(m){let E={udtName:m};return _(P.dropDomain,E)},dropType(m){let E={udtName:m};return _(P.dropType,E)},alterTypeAddAttribute(m,E){let v={udtName:m,columnDefinition:E};return _(P.alterTypeAddAttribute,v)},alterTypeDropAttribute(m,E){let v={udtName:m,attributeName:E};return _(P.alterTypeDropAttribute,v)},alterTypeRenameAttribute(m,E,v){let I={udtName:m,oldAttributeName:E,newAttributeName:v};return _(P.alterTypeRenameAttribute,I)},alterTypeChangeAttributeType(m,E,v){let I={udtName:m,attributeName:E,newDataType:v};return _(P.alterTypeChangeAttributeType,I)},dropForeignKey(m,E){let v={tableName:m,fkConstraintName:E};return _(P.dropForeignKey,v)},createKeyConstraint(m,E,v){let I=R(P,E)(v);return{statement:_(P.addPkConstraint,{constraintStatement:(I.statement||"").trim(),tableName:m}),isActivated:I.isActivated}},dropPkConstraint(m,E){let v={tableName:m,constraintName:E};return _(P.dropConstraint,v)}}}});var Kc=C((wT,$c)=>{"use strict";var{getModifySchemaCommentsScriptDtos:My}=mc(),{AlterScriptDto:Uc}=se(),qy=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q()(r),o=n.createSchemaOnly(s(e));return Uc.getInstance([o],!0,!1)},"getAddContainerScriptDto"),ky=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q()(r),o=n.dropSchema(s(e));return Uc.getInstance([o],!0,!0)},"getDeleteContainerScriptDto"),Fy=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...My(r,n)(e)]},"getModifyContainerScriptDtos");$c.exports={getAddContainerScriptDto:qy,getDeleteContainerScriptDto:ky,getModifyContainerScriptDtos:Fy}});var Vc=C((RT,Gc)=>{"use strict";var{AlterCollectionDto:IT}=Je(),{AlterScriptDto:jt}=se(),By=i(t=>e=>{var a;let r=(a=e==null?void 0:e.compMod)==null?void 0:a.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),Uy=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>o.old&&!o.new).map(o=>{let a=s(o.old.chkConstrName);return e.dropConstraint(n,a)}).map(o=>jt.getInstance([o],!0,!0))},"getDropCheckConstraintScriptDtos"),$y=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>o.new&&!o.old).map(o=>{let{chkConstrName:a,constrExpression:c}=o.new;return e.addCheckConstraint(n,s(a),c)}).map(o=>jt.getInstance([o],!0,!1))},"getAddCheckConstraintScriptDtos"),Ky=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=q()(t);return r.filter(o=>{if(o.old&&o.new){let a=o.old.constrExpression,c=o.new.constrExpression;return a!==c}return!1}).map(o=>{let{chkConstrName:a}=o.old,c=e.dropConstraint(n,s(a)),{chkConstrName:l,constrExpression:u}=o.new,p=e.addCheckConstraint(n,s(l),u);return[jt.getInstance([c],!0,!0),jt.getInstance([p],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),Gy=i((t,e)=>r=>{let{getFullTableName:n}=q()(t),s=n(r),o=By(t)(r),a=$y(t,e)(o,s),c=Uy(t,e)(o,s),l=Ky(t,e)(o,s);return[...a,...c,...l]},"getModifyCheckConstraintScriptDtos");Gc.exports={getModifyCheckConstraintScriptDtos:Gy}});var Wc=C((LT,Qc)=>{"use strict";var{AlterScriptDto:Hc}=se(),{AlterCollectionDto:DT}=Je(),Vy=i((t,e)=>r=>{var d;let{getFullTableName:n,wrapComment:s}=q()(t),o=(d=r==null?void 0:r.role.compMod)==null?void 0:d.description;if(!o)return;let{old:a,new:c}=o;if(!c||c===a)return;let l=n(r),u=s(c),p=e.updateTableComment(l,u);return Hc.getInstance([p],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),Hy=i((t,e)=>r=>{var u;let{getFullTableName:n}=q()(t),s=(u=r==null?void 0:r.role.compMod)==null?void 0:u.description;if(!s)return;let{old:o,new:a}=s;if(!o||a)return;let c=n(r),l=e.dropTableComment(c);return Hc.getInstance([l],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),Qy=i((t,e)=>r=>{let n=Vy(t,e)(r),s=Hy(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");Qc.exports={getModifyEntityCommentsScriptDtos:Qy}});var jc=C((MT,Yc)=>{"use strict";var{AlterScriptDto:Wy}=se(),Yy=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,o=r==null?void 0:r.length;return s!==o},"hasLengthChanged"),jy=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,o=r==null?void 0:r.precision,a=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==o||a!==c},"hasPrecisionOrScaleChanged"),zy=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=q()(t),a=s(r);return t.toPairs(r.properties).filter(([c,l])=>{let u=n(l.compMod,["type","mode"]);if(!u){let p=l.compMod.oldField.name,d=Yy(r,p,l),h=jy(r,p,l);return d||h}return u}).map(([c,l])=>{let u=l.compMod.newField.mode||l.compMod.newField.type,p=o(c),d=t.pick(l,["length","precision","scale"]);return e.alterColumnType(a,p,u,d)}).map(c=>Wy.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");Yc.exports={getUpdateTypesScriptDtos:zy}});var Zc=C((kT,Xc)=>{"use strict";var{AlterScriptDto:zc}=se(),Xy=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=q()(t),o=n(r),a=r.required||[],c=r.role.required||[],l=t.difference(a,c),u=t.difference(c,a),p=t.toPairs(r.properties).filter(([h,f])=>{let S=f.compMod.oldField.name,y=u.includes(S);return l.includes(h)&&!y}).map(([h])=>e.setNotNullConstraint(o,s(h))).map(h=>zc.getInstance([h],!0,!1)),d=t.toPairs(r.properties).filter(([h,f])=>{let S=f.compMod.oldField.name,y=u.includes(S),T=l.includes(h);return y&&!T}).map(([h])=>e.dropNotNullConstraint(o,s(h))).map(h=>zc.getInstance([h],!0,!0));return[...p,...d]},"getModifyNonNullColumnsScriptDtos");Xc.exports={getModifyNonNullColumnsScriptDtos:Xy}});var tu=C((BT,eu)=>{"use strict";var{AlterScriptDto:Jc}=se(),Zy=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=q()(t);return t.toPairs(r.properties).filter(([o,a])=>{var p;let c=a.description,l=a.compMod.oldField.name,u=(p=r.role.properties[l])==null?void 0:p.description;return c&&(!u||c!==u)}).map(([o,a])=>{let c=a.description,l=s(c),u=n(r,o);return e.updateColumnComment(u,l)}).map(o=>Jc.getInstance([o],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),Jy=i((t,e)=>r=>{let{getFullColumnName:n}=q()(t);return t.toPairs(r.properties).filter(([s,o])=>{var u;let a=o.description,c=o.compMod.oldField.name;return((u=r.role.properties[c])==null?void 0:u.description)&&!a}).map(([s,o])=>{let a=n(r,s);return e.dropColumnComment(a)}).map(s=>Jc.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),eg=i((t,e)=>r=>{let n=Zy(t,e)(r),s=Jy(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");eu.exports={getModifiedCommentOnColumnScriptDtos:eg}});var nu=C(($T,ru)=>{"use strict";var{AlterScriptDto:tg}=se(),rg=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=q()(t),a=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let l=o(c.compMod.oldField.name),u=o(c.compMod.newField.name);return e.renameColumn(a,l,u)}).map(c=>tg.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");ru.exports={getRenameColumnScriptDtos:rg}});var cu=C((YT,au)=>{"use strict";var{AlterScriptDto:ng}=se(),{AlterCollectionDto:GT,AlterCollectionColumnDto:VT,AlterCollectionRoleCompModPKDto:HT,AlterCollectionColumnPrimaryKeyOptionDto:QT,AlterCollectionRoleCompModPrimaryKey:WT}=Je(),et=1,gs=class gs{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(gs,"PkTransitionDto");var ae=gs,Es=class Es{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(Es,"PkScriptModificationDto");var tt=Es,ys=i(t=>`${t}_pkey`,"getDefaultConstraintName"),su=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),rt=i(t=>(t.primaryKeyOptions||[]).map(r=>su(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),zt=i(t=>[su(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),sg=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).old||[],s=n.flatMap(h=>h.compositePrimaryKey.map(f=>f.keyId));if(s.length!==et)return ae.noTransition();let o=s[0],a=Object.values(e.properties).find(h=>h.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return ae.noTransition();let l=rt(a),u=n.some(h=>{if(h.compositePrimaryKey.length!==et)return!1;let f=zt(h);return t(f).differenceWith(l,t.isEqual).isEmpty()});return ae.transition(!u)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),ig=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).new||[],s=n.flatMap(h=>h.compositePrimaryKey.map(f=>f.keyId));if(s.length!==et)return ae.noTransition();let o=s[0],a=Object.values(e.role.properties).find(h=>h.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return ae.noTransition();let l=rt(a),u=n.some(h=>{if(h.compositePrimaryKey.length!==et)return!1;let f=zt(h);return t(f).differenceWith(l,t.isEqual).isEmpty()});return ae.transition(!u)},"wasCompositePkChangedInTransitionFromRegularToComposite"),og=i((t,e)=>t.constraintName?t.constraintName:ys(e),"getConstraintNameForCompositePk"),ag=i(t=>(e,r,n)=>{let s=og(e,r),o=t.toPairs(n.role.properties).filter(([l,u])=>!!e.compositePrimaryKey.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated})),a="",c=[];return e.indexStorageParameters&&(a=e.indexStorageParameters),e.indexInclude&&(c=t.toPairs(n.role.properties).filter(([l,u])=>!!e.indexInclude.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:o,include:c,storageParameters:a}},"getCreateCompositePKDDLProviderConfig"),cg=i((t,e)=>r=>{var f,S;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=q()(t),a=((S=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:S.primaryKey)||{},c=a.new||[],l=a.old||[];if(c.length===0&&l.length===0)return[];let u=ig(t)(r);if(u.didTransitionHappen&&!u.wasPkChangedInTransition)return[];if(c.length===l.length&&t(l).differenceWith(c,t.isEqual).isEmpty())return[];let p=s(r),d=n(p),h=o(p);return c.map(y=>{let T=ag(t)(y,h,r),_=e.createKeyConstraint(d,r.isActivated,T);return new tt(_.statement,d,!1,_.isActivated)}).filter(y=>!!y.script)},"getAddCompositePkScriptDtos"),ug=i((t,e)=>r=>{var S,y;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=q()(t),c=((y=(S=r==null?void 0:r.role)==null?void 0:S.compMod)==null?void 0:y.primaryKey)||{},l=c.new||[],u=c.old||[];if(l.length===0&&u.length===0)return[];let p=sg(t)(r);if(p.didTransitionHappen&&!p.wasPkChangedInTransition)return[];if(l.length===u.length&&t(u).differenceWith(l,t.isEqual).isEmpty())return[];let d=s(r),h=n(d),f=o(d);return u.map(T=>{let _=ys(f);T.constraintName&&(_=T.constraintName);let D=a(_),N=e.dropPkConstraint(h,D);return new tt(N,h,!0,r.isActivated)}).filter(T=>!!T.script)},"getDropCompositePkScriptDtos"),lg=i((t,e)=>r=>{let n=ug(t,e)(r),s=cg(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),iu=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return ys(e)},"getConstraintNameForRegularPk"),pg=i(t=>(e,r,n,s)=>{let o=iu(r,n),a=[{name:e,isActivated:r.isActivated}],c="",l=[],u=r.primaryKeyOptions;if(u!=null&&u.length&&(u==null?void 0:u.length)>0){let p=u[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([d,h])=>!!p.indexInclude.find(f=>f.keyId===h.GUID)).map(([d,h])=>({name:d,isActivated:h.isActivated})))}return{name:o,keyType:"PRIMARY KEY",columns:a,include:l,storageParameters:c}},"getCreateRegularPKDDLProviderConfig"),mg=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);return o&&!a},"wasFieldChangedToBeARegularPk"),dg=i(t=>(e,r)=>{var f,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);if(!(o&&a))return ae.noTransition();let c=((S=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],u=c.old||[],p=u.some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),d=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID));if(o&&(p&&!d)){let y=rt(e),T=u.some(_=>{if(_.compositePrimaryKey.length!==et)return!1;let D=zt(_);return t(D).differenceWith(y,t.isEqual).isEmpty()});return ae.transition(!T)}return ae.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),fg=i(t=>(e,r)=>{var f,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=s.primaryKey&&!s.compositePrimaryKey,a=!!(e!=null&&e.primaryKey);if(!(o&&a))return ae.noTransition();let c=((S=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],p=(c.old||[]).some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),h=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID))&&!p;if(o&&h){let y=rt(s),T=l.some(_=>{if(_.compositePrimaryKey.length!==et)return!1;let D=zt(_);return t(D).differenceWith(y,t.isEqual).isEmpty()});return ae.transition(!T)}return ae.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),hg=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),a=!e.primaryKey&&!e.compositePrimaryKey;return o&&a},"isFieldNoLongerARegularPk"),ou=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},o=e.primaryKey&&!e.compositePrimaryKey,a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(o&&a))return!1;let c=rt(e),l=rt(s);return!t(l).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),yg=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=q()(t),a=s(r),c=n(a),l=o(a);return t.toPairs(r.properties).filter(([u,p])=>{if(mg(t)(p,r))return!0;let d=dg(t)(p,r);return d.didTransitionHappen?d.wasPkChangedInTransition:ou(t)(p,r)}).map(([u,p])=>{let d=pg(t)(u,p,l,r),h=e.createKeyConstraint(c,r.isActivated,d);return new tt(h.statement,c,!1,h.isActivated)}).filter(u=>!!u.script)},"getAddPkScriptDtos"),gg=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=q()(t),c=s(r),l=n(c),u=o(c);return t.toPairs(r.properties).filter(([p,d])=>{if(hg(t)(d,r))return!0;let h=fg(t)(d,r);return h.didTransitionHappen?h.wasPkChangedInTransition:ou(t)(d,r)}).map(([p,d])=>{let h=d.compMod.oldField.name,f=r.role.properties[h],S=a(iu(f,u)),y=e.dropPkConstraint(l,S);return new tt(y,l,!0,r.isActivated)}).filter(p=>!!p.script)},"getDropPkScriptDto"),Eg=i((t,e)=>r=>{let n=gg(t,e)(r),s=yg(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),_g=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),Sg=i((t,e)=>r=>{let n=lg(t,e)(r),s=Eg(t,e)(r),o=[...n,...s];return _g(o).map(c=>ng.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");au.exports={getModifyPkConstraintsScriptDtos:Sg}});var At=C((zT,uu)=>{"use strict";uu.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u})=>e({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u,getType:r}),"createColumnDefinitionBySchema")}}});var du=C((JT,mu)=>{"use strict";var{getModifyCheckConstraintScriptDtos:Tg}=Vc(),{getModifyEntityCommentsScriptDtos:Cg}=Wc(),{getUpdateTypesScriptDtos:Ag}=jc(),{getModifyNonNullColumnsScriptDtos:Ng}=Zc(),{getModifiedCommentOnColumnScriptDtos:bg}=tu(),{getRenameColumnScriptDtos:vg}=nu(),{AlterScriptDto:Xt}=se(),{AlterCollectionDto:ZT}=Je(),{getModifyPkConstraintsScriptDtos:wg}=cu(),Og=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{getEntityName:c}=q()(a),{createColumnDefinitionBySchema:l}=At()(t),u=ee()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),h={schemaName:o.compMod.keyspaceName,dbVersion:e},f={...o,...a.omit(o==null?void 0:o.role,"properties")||{}},S=a.toPairs(f.properties).map(([N,O])=>{let R=p({propertySchema:O,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return l({name:N,jsonSchema:O,parentJsonSchema:f,ddlProvider:u,schemaData:h,definitionJsonSchema:R})}),y=(f.chkConstr||[]).map(N=>u.createCheckConstraint(u.hydrateCheckConstraint(N))),T={name:c(f),columns:S.map(u.convertColumnDefinition),checkConstraints:y,foreignKeyConstraints:[],schemaData:h,columnDefinitions:S,dbData:{dbVersion:e}},_=u.hydrateTable({tableData:T,entityData:[f],jsonSchema:f}),D=u.createTable(_,f.isActivated);return Xt.getInstance([D],!0,!1)},"getAddCollectionScriptDto"),Ig=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getFullTableName:s}=q()(r),o=s(e),a=n.dropTable(o);return Xt.getInstance([a],!0,!0)},"getDeleteCollectionScriptDto"),Rg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),s=Tg(r,n)(e),o=Cg(r,n)(e),a=wg(r,n)(e);return[...s,...o,...a].filter(Boolean)},"getModifyCollectionScriptDtos"),lu=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(o,a)=>{var D;let c=t.require("lodash"),{getEntityName:l,getNamePrefixedWithSchemaName:u}=q()(c),{createColumnDefinitionBySchema:p}=At()(t),d=ee()(null,null,t),{getDefinitionByReference:h}=t.require("@hackolade/ddl-fe-utils"),f={...o,...c.omit(o==null?void 0:o.role,"properties")||{}},S=l(f),y=(D=f.compMod)==null?void 0:D.keyspaceName,T=u(S,y),_={schemaName:y,dbVersion:e};return c.toPairs(o.properties).filter(([N,O])=>a([N,O])).map(([N,O])=>{let R=h({propertySchema:O,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return p({name:N,jsonSchema:O,parentJsonSchema:f,ddlProvider:d,schemaData:_,definitionJsonSchema:R})}).map(d.convertColumnDefinition).map(N=>d.addColumn(T,N)).map(N=>Xt.getInstance([N],!0,!1)).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),Pg=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>lu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o,([a,c])=>!c.compMod),"getAddColumnScriptDtos"),pu=i(t=>(e,r)=>{var h;let n=t.require("lodash"),s=ee()(null,null,t),{getEntityName:o,getNamePrefixedWithSchemaName:a,wrapInQuotes:c}=q()(n),l={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},u=o(l),p=(h=l.compMod)==null?void 0:h.keyspaceName,d=a(u,p);return n.toPairs(e.properties).filter(([f,S])=>r([f,S])).map(([f])=>{let S=c(f);return s.dropColumn(d,S)}).map(f=>Xt.getInstance([f],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),Dg=i(t=>e=>pu(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),Lg=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash");return a.toPairs(o.properties).filter(([c,l])=>{let u=l.compMod.oldField.name,p=o.role.properties[u];return p.generatedColumn!==l.generatedColumn||p.columnGenerationExpression!==l.columnGenerationExpression}).flatMap(([c,l])=>{let u={...o,properties:a.fromPairs([[c,l]])},p=pu(t)(u,()=>!0),d=lu({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(u,()=>!0);return[...p,...d]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),xg=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),c=ee()(null,null,t),l=vg(a,c)(o),u=Lg({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o);if(u.length)return[...l,...u].filter(Boolean);let p=Ag(a,c)(o),d=Ng(a,c)(o),h=bg(a,c)(o);return[...l,...p,...d,...h].filter(Boolean)},"getModifyColumnScriptDtos");mu.exports={getAddCollectionScriptDto:Og,getDeleteCollectionScriptDto:Ig,getModifyCollectionScriptDtos:Rg,getAddColumnScriptDtos:Pg,getDeleteColumnScriptDtos:Dg,getModifyColumnScriptDtos:xg}});var hu=C((tC,fu)=>{"use strict";var{AlterScriptDto:$e}=se(),Mg=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=At()(t),l=ee()(null,null,t),{getDefinitionByReference:u}=t.require("@hackolade/ddl-fe-utils"),p={dbVersion:e},d=a.toPairs(o.properties||{}).map(([y,T])=>{let _=u({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:y,jsonSchema:T,parentJsonSchema:o,ddlProvider:l,schemaData:p,definitionJsonSchema:_})}),f={...c({name:o.code||o.name,jsonSchema:o,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:l,schemaData:p}),properties:d},S=l.createUdt(f);return $e.getInstance([S],!0,!1)},"getCreateUdtScriptDto"),qg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getUdtName:s,wrapInQuotes:o}=q()(r),a=o(s(e));if(e.type==="domain"){let c=n.dropDomain(a);return $e.getInstance([c],!0,!0)}else{let c=n.dropType(a);return $e.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),kg=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=At()(t),{getUdtName:l,wrapInQuotes:u}=q()(a),p=ee()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),h=u(l(o)),f={dbVersion:e};return a.toPairs(o.properties).filter(([S,y])=>!y.compMod).map(([S,y])=>{let T=d({propertySchema:y,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:S,jsonSchema:y,parentJsonSchema:{required:[]},ddlProvider:p,schemaData:f,definitionJsonSchema:T})}).map(p.convertColumnDefinition).map(S=>p.alterTypeAddAttribute(h,S)).map(S=>$e.getInstance([S],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),Fg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q()(r),o=s(e.code||e.name);return r.toPairs(e.properties).filter(([a,c])=>!c.compMod).map(([a])=>n.alterTypeDropAttribute(o,s(a))).map(a=>$e.getInstance([a],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),Bg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:o}=q()(r),a=o(e.code||e.name),c=r.values(e.properties).filter(u=>s(u.compMod,["name"])).map(u=>{let p=o(u.compMod.oldField.name),d=o(u.compMod.newField.name);return n.alterTypeRenameAttribute(a,p,d)}).map(u=>$e.getInstance([u],!0,!1)),l=r.toPairs(e.properties).filter(([u,p])=>s(p.compMod,["type","mode"])).map(([u,p])=>{let d=o(u),h=p.compMod.newField.mode||p.compMod.newField.type;return n.alterTypeChangeAttributeType(a,d,h)}).map(u=>$e.getInstance([u],!0,!1));return[...c,...l].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");fu.exports={getCreateUdtScriptDto:Mg,getDeleteUdtScriptDto:qg,getAddColumnToTypeScriptDtos:kg,getDeleteColumnFromTypeScriptDtos:Fg,getModifyColumnOfTypeScriptDtos:Bg}});var _u=C((nC,Eu)=>{"use strict";var{AlterScriptDto:yu}=se(),gu=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Ug=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=q()(t),o=gu(r);if(o.new&&o.new!==o.old){let a=s(o.new),c=n(r),l=e.updateViewComment(c,a);return yu.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),$g=i((t,e)=>r=>{let n=gu(r),{getFullViewName:s}=q()(t);if(n.old&&!n.new){let o=s(r),a=e.dropViewComment(o);return yu.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),Kg=i((t,e)=>r=>{let n=Ug(t,e)(r),s=$g(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");Eu.exports={getModifyViewCommentsScriptDtos:Kg}});var Cu=C((iC,Tu)=>{"use strict";var{getModifyViewCommentsScriptDtos:Gg}=_u(),{AlterScriptDto:Su}=se(),Vg=i(t=>e=>{let r=ee()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),o=r.createView(s,{},e.isActivated);return Su.getInstance([o],!0,!1)},"getAddViewScriptDto"),Hg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=q()(r),o=s(e.code||e.name),a=n.dropView(o);return Su.getInstance([a],!0,!0)},"getDeleteViewScriptDto"),Qg=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...Gg(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");Tu.exports={getAddViewScriptDto:Vg,getDeleteViewScriptDto:Hg,getModifyViewScriptDtos:Qg}});var Nu=C((aC,Au)=>{"use strict";var vs=class vs{isActivated;name};i(vs,"AlterRelationshipFKField");var _s=vs,ws=class ws{bucket;collection};i(ws,"AlterRelationshipParentDto");var Ss=ws,Os=class Os{bucket;collection};i(Os,"AlterRelationshipChildDto");var Ts=Os,Is=class Is{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(Is,"AlterRelationshipCustomProperties");var Cs=Is,Rs=class Rs{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(Rs,"AlterRelationshipRoleCompModDto");var As=Rs,Ps=class Ps{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(Ps,"AlterRelationshipRoleDto");var Ns=Ps,Ds=class Ds{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Ds,"AlterRelationshipDto");var bs=Ds;Au.exports={AlterRelationshipRoleCompModDto:As,AlterRelationshipRoleDto:Ns,AlterRelationshipDto:bs,AlterRelationshipFKField:_s,AlterRelationshipParentDto:Ss,AlterRelationshipChildDto:Ts,AlterRelationshipCustomProperties:Cs}});var Ru=C((lC,Iu)=>{"use strict";var{AlterScriptDto:Ls}=se(),{AlterRelationshipDto:uC}=Nu(),Zt=i(t=>t.role.name,"getRelationshipName"),Wg=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=q()(t),n=e.role.compMod,s=n.child.bucket.name,o=n.child.collection.name;return r(o,s)},"getFullChildTableName"),bu=i((t,e)=>r=>{var o,a,c,l,u;let n=r.role.compMod,s=((o=n.name)==null?void 0:o.new)||Zt(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(a=n.customProperties)==null?void 0:a.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((u=(l=(c=r.role)==null?void 0:c.compMod)==null?void 0:l.isActivated)!=null&&u.new)})},"getAddSingleForeignKeyStatementDto"),vu=i(t=>{var r,n,s,o,a,c,l,u,p,d,h;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||Zt(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(a=(o=e.parent)==null?void 0:o.collection)==null?void 0:a.fkFields)==null?void 0:c.length,(l=e.child)==null?void 0:l.bucket,(u=e.child)==null?void 0:u.collection,(h=(d=(p=e.child)==null?void 0:p.collection)==null?void 0:d.fkFields)==null?void 0:h.length].every(f=>!!f):!1},"canRelationshipBeAdded"),Yg=i((t,e)=>r=>r.filter(n=>vu(n)).map(n=>{let s=bu(t,e)(n);return Ls.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),wu=i((t,e)=>r=>{var d,h,f,S;let{wrapInQuotes:n}=q()(e),s=r.role.compMod,o=Wg(e)(r),a=((d=s.name)==null?void 0:d.old)||Zt(r)||"",c=n(a),l=t.dropForeignKey(o,c),u=!!((S=(f=(h=r.role)==null?void 0:h.compMod)==null?void 0:f.isActivated)!=null&&S.new),p=s.child.collection.isActivated;return{statement:l,isActivated:u&&p}},"getDeleteSingleForeignKeyStatementDto"),Ou=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||Zt(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(o=>!!o):!1},"canRelationshipBeDeleted"),jg=i((t,e)=>r=>r.filter(n=>Ou(n)).map(n=>{let s=wu(t,e)(n);return Ls.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),zg=i((t,e)=>r=>r.filter(n=>vu(n)&&Ou(n)).map(n=>{let s=wu(t,e)(n),o=bu(t,e)(n),a=o.isActivated&&s.isActivated;return Ls.getDropAndRecreateInstance(s.statement,o.statement,a)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");Iu.exports={getDeleteForeignKeyScriptDtos:jg,getModifyForeignKeyScriptDtos:zg,getAddForeignKeyScriptDtos:Yg}});var Du=C((mC,Pu)=>{"use strict";var Fs=class Fs{message;stack};i(Fs,"PluginError");var xs=Fs,Bs=class Bs{require};i(Bs,"App");var Ms=Bs,Us=class Us{log;clear};i(Us,"Logger");var qs=Us,$s=class $s{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i($s,"CoreData");var ks=$s;Pu.exports={App:Ms,CoreData:ks,Logger:qs,PluginError:xs}});var xu=C((fC,Lu)=>{"use strict";var zs=class zs{name;isActivated};i(zs,"ContainerJsonSchema");var Ks=zs,Xs=class Xs{backgroundColor};i(Xs,"ContainerStyles");var Gs=Xs,Zs=class Zs{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(Zs,"EntityData");var Vs=Zs,Js=class Js{$schema;type;GUID};i(Js,"InternalDefinitions");var Hs=Js,ei=class ei{$schema;type;GUID};i(ei,"ModelDefinitions");var Qs=ei,ti=class ti{$schema;type;GUID};i(ti,"ExternalDefinitions");var Ws=ti,ri=class ri{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(ri,"FieldJsonSchema");var Ys=ri,ni=class ni{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(ni,"EntityJsonSchema");var js=ni;Lu.exports={ContainerJsonSchema:Ks,ContainerStyles:Gs,EntityData:Vs,InternalDefinitions:Hs,ModelDefinitions:Qs,ExternalDefinitions:Ws,FieldJsonSchema:Ys,EntityJsonSchema:js}});var qu=C((AC,Mu)=>{"use strict";var{getAddContainerScriptDto:Xg,getDeleteContainerScriptDto:Zg,getModifyContainerScriptDtos:Jg}=Kc(),{getAddCollectionScriptDto:eE,getDeleteCollectionScriptDto:tE,getAddColumnScriptDtos:rE,getDeleteColumnScriptDtos:nE,getModifyColumnScriptDtos:sE,getModifyCollectionScriptDtos:iE}=du(),{getDeleteUdtScriptDto:oE,getCreateUdtScriptDto:aE,getAddColumnToTypeScriptDtos:cE,getDeleteColumnFromTypeScriptDtos:uE,getModifyColumnOfTypeScriptDtos:lE}=hu(),{getAddViewScriptDto:pE,getDeleteViewScriptDto:mE,getModifyViewScriptDtos:dE}=Cu(),{getModifyForeignKeyScriptDtos:fE,getDeleteForeignKeyScriptDtos:hE,getAddForeignKeyScriptDtos:yE}=Ru(),{AlterScriptDto:yC,ModificationScript:gC}=se(),{App:EC,CoreData:_C}=Du(),{InternalDefinitions:SC,ModelDefinitions:TC,ExternalDefinitions:CC}=xu(),gE=i(({collection:t,app:e})=>{var l,u,p,d,h,f,S,y,T,_,D,N;let r=(d=(p=(u=(l=t.properties)==null?void 0:l.containers)==null?void 0:u.properties)==null?void 0:p.added)==null?void 0:d.items,n=(y=(S=(f=(h=t.properties)==null?void 0:h.containers)==null?void 0:f.properties)==null?void 0:S.deleted)==null?void 0:y.items,s=(N=(D=(_=(T=t.properties)==null?void 0:T.containers)==null?void 0:_.properties)==null?void 0:D.modified)==null?void 0:N.items,o=[].concat(r).filter(Boolean).map(O=>Xg(e)(Object.keys(O.properties)[0])),a=[].concat(n).filter(Boolean).map(O=>Zg(e)(Object.keys(O.properties)[0])),c=[].concat(s).filter(Boolean).map(O=>Object.values(O.properties)[0]).flatMap(O=>Jg(e)(O));return[...o,...a,...c].filter(Boolean)},"getAlterContainersScriptDtos"),EE=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var h,f,S,y,T,_,D,N,O,R,A,b,x,U,W,Se,Te,Ae,Re,g,w,M,$,Y;let a=[].concat((y=(S=(f=(h=t.properties)==null?void 0:h.entities)==null?void 0:f.properties)==null?void 0:S.added)==null?void 0:y.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>{var E;return(E=m.compMod)==null?void 0:E.created}).map(eE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((N=(D=(_=(T=t.properties)==null?void 0:T.entities)==null?void 0:_.properties)==null?void 0:D.deleted)==null?void 0:N.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>{var E;return(E=m.compMod)==null?void 0:E.deleted}).map(tE(e)),l=[].concat((b=(A=(R=(O=t.properties)==null?void 0:O.entities)==null?void 0:R.properties)==null?void 0:A.modified)==null?void 0:b.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).flatMap(iE(e)),u=[].concat((Se=(W=(U=(x=t.properties)==null?void 0:x.entities)==null?void 0:U.properties)==null?void 0:W.added)==null?void 0:Se.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(rE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),p=[].concat((g=(Re=(Ae=(Te=t.properties)==null?void 0:Te.entities)==null?void 0:Ae.properties)==null?void 0:Re.deleted)==null?void 0:g.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(nE(e)),d=[].concat((Y=($=(M=(w=t.properties)==null?void 0:w.entities)==null?void 0:M.properties)==null?void 0:$.modified)==null?void 0:Y.items).filter(Boolean).map(m=>Object.values(m.properties)[0]).filter(m=>!m.compMod).flatMap(sE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}));return[...a,...c,...l,...u,...p,...d].filter(Boolean)},"getAlterCollectionsScriptDtos"),_E=i((t,e)=>{var o,a,c,l,u,p,d,h,f,S,y,T;let r=[].concat((l=(c=(a=(o=t.properties)==null?void 0:o.views)==null?void 0:a.properties)==null?void 0:c.added)==null?void 0:l.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).filter(_=>{var D;return((D=_.compMod)==null?void 0:D.created)&&_.selectStatement}).map(pE(e)),n=[].concat((h=(d=(p=(u=t.properties)==null?void 0:u.views)==null?void 0:p.properties)==null?void 0:d.deleted)==null?void 0:h.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).map(mE(e)),s=[].concat((T=(y=(S=(f=t.properties)==null?void 0:f.views)==null?void 0:S.properties)==null?void 0:y.modified)==null?void 0:T.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).flatMap(_=>dE(e)(_));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),SE=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var d,h,f,S,y,T,_,D,N,O,R,A,b,x,U,W,Se,Te,Ae,Re;let a=[].concat((S=(f=(h=(d=t.properties)==null?void 0:d.modelDefinitions)==null?void 0:h.properties)==null?void 0:f.added)==null?void 0:S.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var w;return(w=g.compMod)==null?void 0:w.created}).map(aE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((D=(_=(T=(y=t.properties)==null?void 0:y.modelDefinitions)==null?void 0:T.properties)==null?void 0:_.deleted)==null?void 0:D.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var w;return(w=g.compMod)==null?void 0:w.deleted}).map(oE(e)),l=[].concat((A=(R=(O=(N=t.properties)==null?void 0:N.modelDefinitions)==null?void 0:O.properties)==null?void 0:R.added)==null?void 0:A.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(cE({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),u=[].concat((W=(U=(x=(b=t.properties)==null?void 0:b.modelDefinitions)==null?void 0:x.properties)==null?void 0:U.deleted)==null?void 0:W.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(uE(e)),p=[].concat((Re=(Ae=(Te=(Se=t.properties)==null?void 0:Se.modelDefinitions)==null?void 0:Te.properties)==null?void 0:Ae.modified)==null?void 0:Re.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(lE(e));return[...c,...a,...l,...u,...p].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),TE=i(({collection:t,app:e})=>{var p,d,h,f,S,y,T,_,D,N,O,R;let r=e.require("lodash"),n=ee()(null,null,e),s=[].concat((f=(h=(d=(p=t.properties)==null?void 0:p.relationships)==null?void 0:d.properties)==null?void 0:h.added)==null?void 0:f.items).filter(Boolean).map(A=>Object.values(A.properties)[0]).filter(A=>{var b,x;return(x=(b=A==null?void 0:A.role)==null?void 0:b.compMod)==null?void 0:x.created}),o=[].concat((_=(T=(y=(S=t.properties)==null?void 0:S.relationships)==null?void 0:y.properties)==null?void 0:T.deleted)==null?void 0:_.items).filter(Boolean).map(A=>Object.values(A.properties)[0]).filter(A=>{var b,x;return(x=(b=A==null?void 0:A.role)==null?void 0:b.compMod)==null?void 0:x.deleted}),a=[].concat((R=(O=(N=(D=t.properties)==null?void 0:D.relationships)==null?void 0:N.properties)==null?void 0:O.modified)==null?void 0:R.items).filter(Boolean).map(A=>Object.values(A.properties)[0]).filter(A=>{var b,x;return(x=(b=A==null?void 0:A.role)==null?void 0:b.compMod)==null?void 0:x.modified}),c=hE(n,r)(o),l=yE(n,r)(s),u=fE(n,r)(a);return[...c,...l,...u].filter(Boolean)},"getAlterRelationshipsScriptDtos"),CE=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),AE=i((t,e)=>{var h;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),o=JSON.parse(t.externalDefinitions),a=(h=t.modelData[0])==null?void 0:h.dbVersion,c=gE({collection:r,app:e}),l=EE({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),u=_E(r,e),p=SE({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),d=TE({collection:r,app:e});return[...c,...p,...l,...u,...d].filter(Boolean).map(f=>CE(f)).filter(Boolean)},"getAlterScriptDtos");Mu.exports={getAlterScriptDtos:AE}});var Uu=C((vC,Bu)=>{"use strict";var{getAlterScriptDtos:Jt}=qu(),{AlterScriptDto:bC}=se(),ku=i(t=>(e,r)=>{let{commentIfDeactivated:n}=q()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(o=>n(o.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(o=>o.script):s.scripts.map(o=>n(o.script,{isActivated:!o.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),NE=i((t,e)=>{var o,a;let r=e.require("lodash"),n=Jt(t,e),s=(a=(o=t.options)==null?void 0:o.additionalOptions)==null?void 0:a.some(c=>c.id==="applyDropStatements"&&c.value);return ku(r)(n,s)},"buildEntityLevelAlterScript"),bE=i((t,e)=>Jt(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),Fu=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),vE=i((t,e)=>{var a,c;let r=Fu(t),n=e.require("lodash"),s=Jt(r,e),o=(c=(a=r.options)==null?void 0:a.additionalOptions)==null?void 0:c.some(l=>l.id==="applyDropStatements"&&l.value);return ku(n)(s,o)},"buildContainerLevelAlterScript"),wE=i((t,e)=>{let r=Fu(t);return Jt(r,e).some(s=>s.isActivated&&s.scripts.some(o=>o.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");Bu.exports={buildEntityLevelAlterScript:NE,doesEntityLevelAlterScriptContainDropStatements:bE,buildContainerLevelAlterScript:vE,doesContainerLevelAlterScriptContainDropStatements:wE}});var $u=tc(),{createLogger:OE}=tr(),IE=nc(),{buildEntityLevelAlterScript:RE,buildContainerLevelAlterScript:PE,doesContainerLevelAlterScriptContainDropStatements:DE,doesEntityLevelAlterScriptContainDropStatements:LE}=Uu();module.exports={generateScript(t,e,r,n){try{let s=RE(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=PE(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),$u.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=OE({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});IE.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){$u.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=DE(t,n);r(null,s)}else{let s=LE(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
