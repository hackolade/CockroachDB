"use strict";var yt=Object.defineProperty;var au=Object.getOwnPropertyDescriptor;var cu=Object.getOwnPropertyNames;var uu=Object.prototype.hasOwnProperty;var i=(t,e)=>yt(t,"name",{value:e,configurable:!0});var lu=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),pu=(t,e)=>{for(var r in e)yt(t,r,{get:e[r],enumerable:!0})},mu=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of cu(e))!uu.call(t,s)&&s!==r&&yt(t,s,{get:()=>e[s],enumerable:!(n=au(e,s))||n.enumerable});return t};var du=t=>mu(yt({},"__esModule",{value:!0}),t);var Gt=A((Ky,$s)=>{"use strict";var fu=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",o=""){e.progress({message:n,containerName:s,entityName:o})},error(n){e.log("error",hu(n),t)}}),"createLogger"),hu=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");$s.exports={createLogger:fu}});var Ht=A(Us=>{"use strict";Us.parse=function(t,e){return new Vt(t,e).parse()};var gt=class gt{constructor(e,r){this.source=e,this.transform=r||yu,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new gt(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(gt,"ArrayParser");var Vt=gt;function yu(t){return t}i(yu,"identity")});var Qt=A((Qy,Ks)=>{var gu=Ht();Ks.exports={create:function(t,e){return{parse:function(){return gu.parse(t,e)}}}}});var Hs=A((Wy,Vs)=>{"use strict";var Eu=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,_u=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Su=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Tu=/^-?infinity$/;Vs.exports=i(function(e){if(Tu.test(e))return Number(e.replace("i","I"));var r=Eu.exec(e);if(!r)return Cu(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=Gs(s));var o=parseInt(r[2],10)-1,a=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var d,f=Au(e);return f!=null?(d=new Date(Date.UTC(s,o,a,c,l,u,p)),Wt(s)&&d.setUTCFullYear(s),f!==0&&d.setTime(d.getTime()-f)):(d=new Date(s,o,a,c,l,u,p),Wt(s)&&d.setFullYear(s)),d},"parseDate");function Cu(t){var e=_u.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=Gs(r));var s=parseInt(e[2],10)-1,o=e[3],a=new Date(r,s,o);return Wt(r)&&a.setFullYear(r),a}}i(Cu,"getDate");function Au(t){if(t.endsWith("+00"))return 0;var e=Su.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(Au,"timeZoneOffset");function Gs(t){return-(t-1)}i(Gs,"bcYearToNegativeYear");function Wt(t){return t>=0&&t<100}i(Wt,"is0To99")});var Ws=A((jy,Qs)=>{Qs.exports=bu;var Nu=Object.prototype.hasOwnProperty;function bu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Nu.call(r,n)&&(t[n]=r[n])}return t}i(bu,"extend")});var zs=A((Xy,js)=>{"use strict";var Iu=Ws();js.exports=$e;function $e(t){if(!(this instanceof $e))return new $e(t);Iu(this,Fu(t))}i($e,"PostgresInterval");var Ou=["seconds","minutes","hours","days","months","years"];$e.prototype.toPostgres=function(){var t=Ou.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var wu={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},vu=["years","months","days"],Ru=["hours","minutes","seconds"];$e.prototype.toISOString=$e.prototype.toISO=function(){var t=vu.map(r,this).join(""),e=Ru.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+wu[n]}};var Yt="([+-]?\\d+)",Pu=Yt+"\\s+years?",Du=Yt+"\\s+mons?",Lu=Yt+"\\s+days?",Mu="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",xu=new RegExp([Pu,Du,Lu,Mu].map(function(t){return"("+t+")?"}).join("\\s*")),Ys={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},qu=["hours","minutes","seconds","milliseconds"];function ku(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(ku,"parseMilliseconds");function Fu(t){if(!t)return{};var e=xu.exec(t),r=e[8]==="-";return Object.keys(Ys).reduce(function(n,s){var o=Ys[s],a=e[o];return!a||(a=s==="milliseconds"?ku(a):parseInt(a,10),!a)||(r&&~qu.indexOf(s)&&(a*=-1),n[s]=a),n},{})}i(Fu,"parse")});var Zs=A((Jy,Xs)=>{"use strict";Xs.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var o=0;o<Math.floor(s/2);++o)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var ii=A((tg,si)=>{var et=Ht(),tt=Qt(),Et=Hs(),ei=zs(),ti=Zs();function _t(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(_t,"allowNull");function ri(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(ri,"parseBool");function Bu(t){return t?et.parse(t,ri):null}i(Bu,"parseBoolArray");function $u(t){return parseInt(t,10)}i($u,"parseBaseTenInt");function jt(t){return t?et.parse(t,_t($u)):null}i(jt,"parseIntegerArray");function Uu(t){return t?et.parse(t,_t(function(e){return ni(e).trim()})):null}i(Uu,"parseBigIntegerArray");var Ku=i(function(t){if(!t)return null;var e=tt.create(t,function(r){return r!==null&&(r=Jt(r)),r});return e.parse()},"parsePointArray"),zt=i(function(t){if(!t)return null;var e=tt.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),he=i(function(t){if(!t)return null;var e=tt.create(t);return e.parse()},"parseStringArray"),Xt=i(function(t){if(!t)return null;var e=tt.create(t,function(r){return r!==null&&(r=Et(r)),r});return e.parse()},"parseDateArray"),Gu=i(function(t){if(!t)return null;var e=tt.create(t,function(r){return r!==null&&(r=ei(r)),r});return e.parse()},"parseIntervalArray"),Vu=i(function(t){return t?et.parse(t,_t(ti)):null},"parseByteAArray"),Zt=i(function(t){return parseInt(t,10)},"parseInteger"),ni=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Js=i(function(t){return t?et.parse(t,_t(JSON.parse)):null},"parseJsonArray"),Jt=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Hu=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var o=Jt(e);return o.radius=parseFloat(r),o},"parseCircle"),Qu=i(function(t){t(20,ni),t(21,Zt),t(23,Zt),t(26,Zt),t(700,parseFloat),t(701,parseFloat),t(16,ri),t(1082,Et),t(1114,Et),t(1184,Et),t(600,Jt),t(651,he),t(718,Hu),t(1e3,Bu),t(1001,Vu),t(1005,jt),t(1007,jt),t(1028,jt),t(1016,Uu),t(1017,Ku),t(1021,zt),t(1022,zt),t(1231,zt),t(1014,he),t(1015,he),t(1008,he),t(1009,he),t(1040,he),t(1041,he),t(1115,Xt),t(1182,Xt),t(1185,Xt),t(1186,ei),t(1187,Gu),t(17,ti),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Js),t(3807,Js),t(3907,he),t(2951,he),t(791,he),t(1183,he),t(1270,he)},"init");si.exports={init:Qu}});var ai=A((ng,oi)=>{"use strict";var le=1e6;function Wu(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",o,a,c,l,u,p;{if(o=e%le,e=e/le>>>0,a=4294967296*o+r,r=a/le>>>0,c=""+(a-le*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%le,e=e/le>>>0,a=4294967296*o+r,r=a/le>>>0,c=""+(a-le*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(o=e%le,e=e/le>>>0,a=4294967296*o+r,r=a/le>>>0,c=""+(a-le*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}return o=e%le,a=4294967296*o+r,c=""+a%le,n+c+s}i(Wu,"readInt8");oi.exports=Wu});var mi=A((ig,pi)=>{var Yu=ai(),V=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(h,S,y){return h*Math.pow(2,y)+S};var o=r>>3,a=i(function(h){return n?~h&255:h},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=s(0,a(t[o])&c,l));for(var p=e+r>>3,d=o+1;d<p;d++)u=s(u,a(t[d]),8);var f=(e+r)%8;return f>0&&(u=s(u,a(t[p])>>8-f,f)),u},"parseBits"),li=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=V(t,1),o=V(t,r,1);if(o===0)return 0;var a=1,c=i(function(u,p,d){u===0&&(u=1);for(var f=1;f<=d;f++)a/=2,(p&1<<d-f)>0&&(u+=a);return u},"parsePrecisionBits"),l=V(t,e,r+1,!1,c);return o==Math.pow(2,r+1)-1?l===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,o-n)*l},"parseFloatFromBits"),ju=i(function(t){return V(t,1)==1?-1*(V(t,15,1,!0)+1):V(t,15,1)},"parseInt16"),ci=i(function(t){return V(t,1)==1?-1*(V(t,31,1,!0)+1):V(t,31,1)},"parseInt32"),zu=i(function(t){return li(t,23,8)},"parseFloat32"),Xu=i(function(t){return li(t,52,11)},"parseFloat64"),Zu=i(function(t){var e=V(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,V(t,16,16)),n=0,s=[],o=V(t,16),a=0;a<o;a++)n+=V(t,16,64+16*a)*r,r/=1e4;var c=Math.pow(10,V(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),ui=i(function(t,e){var r=V(e,1),n=V(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(o){this.usec=o},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),rt=i(function(t){for(var e=V(t,32),r=V(t,32,32),n=V(t,32,64),s=96,o=[],a=0;a<e;a++)o[a]=V(t,32,s),s+=32,s+=32;var c=i(function(u){var p=V(t,32,s);if(s+=32,p==4294967295)return null;var d;if(u==23||u==20)return d=V(t,p*8,s),s+=p*8,d;if(u==25)return d=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var d=[],f;if(u.length>1){var h=u.shift();for(f=0;f<h;f++)d[f]=l(u,p);u.unshift(h)}else for(f=0;f<u[0];f++)d[f]=c(p);return d},"parse");return l(o,n)},"parseArray"),Ju=i(function(t){return t.toString("utf8")},"parseText"),el=i(function(t){return t===null?null:V(t,8)>0},"parseBool"),tl=i(function(t){t(20,Yu),t(21,ju),t(23,ci),t(26,ci),t(1700,Zu),t(700,zu),t(701,Xu),t(16,el),t(1114,ui.bind(null,!1)),t(1184,ui.bind(null,!0)),t(1e3,rt),t(1007,rt),t(1016,rt),t(1008,rt),t(1009,rt),t(25,Ju)},"init");pi.exports={init:tl}});var fi=A((ag,di)=>{di.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var it=A(st=>{var rl=ii(),nl=mi(),sl=Qt(),il=fi();st.getTypeParser=ol;st.setTypeParser=al;st.arrayParser=sl;st.builtins=il;var nt={text:{},binary:{}};function hi(t){return String(t)}i(hi,"noParse");function ol(t,e){return e=e||"text",nt[e]&&nt[e][t]||hi}i(ol,"getTypeParser");function al(t,e,r){typeof e=="function"&&(r=e,e="text"),nt[e][t]=r}i(al,"setTypeParser");rl.init(function(t,e){nt.text[t]=e});nl.init(function(t,e){nt.binary[t]=e})});var ot=A((lg,er)=>{"use strict";er.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Ue=it(),cl=Ue.getTypeParser(20,"text"),ul=Ue.getTypeParser(1016,"text");er.exports.__defineSetter__("parseInt8",function(t){Ue.setTypeParser(20,"text",t?Ue.getTypeParser(23,"text"):cl),Ue.setTypeParser(1016,"text",t?Ue.getTypeParser(1007,"text"):ul)})});var at=A((pg,gi)=>{"use strict";var ll=ot();function pl(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(pl,"escapeElement");function yi(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+yi(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=pl(St(t[r]));return e=e+"}",e}i(yi,"arrayString");var St=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?ll.parseInputDatesAsUTC?fl(t):dl(t):Array.isArray(t)?yi(t):typeof t=="object"?ml(t,e):t.toString()},"prepareValue");function ml(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),St(t.toPostgres(St),e)}return JSON.stringify(t)}i(ml,"prepareObject");function ie(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(ie,"pad");function dl(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=ie(r,4)+"-"+ie(t.getMonth()+1,2)+"-"+ie(t.getDate(),2)+"T"+ie(t.getHours(),2)+":"+ie(t.getMinutes(),2)+":"+ie(t.getSeconds(),2)+"."+ie(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=ie(Math.floor(e/60),2)+":"+ie(e%60,2),n&&(s+=" BC"),s}i(dl,"dateToString");function fl(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=ie(e,4)+"-"+ie(t.getUTCMonth()+1,2)+"-"+ie(t.getUTCDate(),2)+"T"+ie(t.getUTCHours(),2)+":"+ie(t.getUTCMinutes(),2)+":"+ie(t.getUTCSeconds(),2)+"."+ie(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(fl,"dateToStringUTC");function hl(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(hl,"normalizeQueryConfig");var yl=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),gl=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");gi.exports={prepareValue:i(function(e){return St(e)},"prepareValueWrapper"),normalizeQueryConfig:hl,escapeIdentifier:yl,escapeLiteral:gl}});var _i=A((dg,Ei)=>{"use strict";var ct=require("crypto");function tr(t){return ct.createHash("md5").update(t,"utf-8").digest("hex")}i(tr,"md5");function El(t,e,r){var n=tr(e+t),s=tr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(El,"postgresMd5PasswordHash");function _l(t){return ct.createHash("sha256").update(t).digest()}i(_l,"sha256");function Sl(t,e){return ct.createHmac("sha256",t).update(e).digest()}i(Sl,"hmacSha256");async function Tl(t,e,r){return ct.pbkdf2Sync(t,e,r,32,"sha256")}i(Tl,"deriveKey");Ei.exports={postgresMd5PasswordHash:El,randomBytes:ct.randomBytes,deriveKey:Tl,sha256:_l,hmacSha256:Sl,md5:tr}});var Ai=A((hg,Ci)=>{var Si=require("crypto");Ci.exports={postgresMd5PasswordHash:Al,randomBytes:Cl,deriveKey:Il,sha256:Nl,hmacSha256:bl,md5:rr};var Ti=Si.webcrypto||globalThis.crypto,Ke=Ti.subtle,nr=new TextEncoder;function Cl(t){return Ti.getRandomValues(Buffer.alloc(t))}i(Cl,"randomBytes");async function rr(t){try{return Si.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?nr.encode(t):t,n=await Ke.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(rr,"md5");async function Al(t,e,r){var n=await rr(e+t),s=await rr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Al,"postgresMd5PasswordHash");async function Nl(t){return await Ke.digest("SHA-256",t)}i(Nl,"sha256");async function bl(t,e){let r=await Ke.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Ke.sign("HMAC",r,nr.encode(e))}i(bl,"hmacSha256");async function Il(t,e,r){let n=await Ke.importKey("raw",nr.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await Ke.deriveBits(s,n,32*8,["deriveBits"])}i(Il,"deriveKey")});var ir=A((gg,sr)=>{"use strict";var Ol=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Ol?sr.exports=_i():sr.exports=Ai()});var Oi=A((Eg,Ii)=>{"use strict";var Me=ir();function wl(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=Me.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(wl,"startSession");async function vl(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Dl(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,o="r="+n.nonce+",s="+n.salt+",i="+n.iteration,a="c=biws,r="+n.nonce,c=s+","+o+","+a,l=Buffer.from(n.salt,"base64"),u=await Me.deriveKey(e,l,n.iteration),p=await Me.hmacSha256(u,"Client Key"),d=await Me.sha256(p),f=await Me.hmacSha256(d,c),h=Ml(Buffer.from(p),Buffer.from(f)).toString("base64"),S=await Me.hmacSha256(u,"Server Key"),y=await Me.hmacSha256(S,c);t.message="SASLResponse",t.serverSignature=Buffer.from(y).toString("base64"),t.response=a+",p="+h}i(vl,"continueSession");function Rl(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Ll(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(Rl,"finalizeSession");function Pl(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Pl,"isPrintableChars");function Ni(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(Ni,"isBase64");function bi(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(bi,"parseAttributePairs");function Dl(t){let e=bi(t),r=e.get("r");if(r){if(!Pl(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!Ni(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let o=parseInt(s,10);return{nonce:r,salt:n,iteration:o}}i(Dl,"parseServerFirstMessage");function Ll(t){let r=bi(t).get("v");if(r){if(!Ni(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Ll,"parseServerFinalMessage");function Ml(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(Ml,"xorBuffers");Ii.exports={startSession:wl,continueSession:vl,finalizeSession:Rl}});var or=A((Sg,wi)=>{"use strict";var xl=it();function Tt(t){this._types=t||xl,this.text={},this.binary={}}i(Tt,"TypeOverrides");Tt.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Tt.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Tt.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};wi.exports=Tt});var Ri=A((Cg,vi)=>{"use strict";function ar(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let o=r.pathname.slice(1)||null;e.database=o?decodeURI(o):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let a=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=a.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=a.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=a.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(ar,"parse");vi.exports=ar;ar.parse=ar});var lr=A((Ng,Li)=>{"use strict";var ql=require("dns"),Di=ot(),Pi=Ri().parse,ce=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Di[t]},"val"),kl=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Di.ssl},"readSSLConfigFromEnvironment"),Ge=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),ye=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+Ge(n))},"add"),ur=class ur{constructor(e){e=typeof e=="string"?Pi(e):e||{},e.connectionString&&(e=Object.assign({},e,Pi(e.connectionString))),this.user=ce("user",e),this.database=ce("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(ce("port",e),10),this.host=ce("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:ce("password",e)}),this.binary=ce("binary",e),this.options=ce("options",e),this.ssl=typeof e.ssl>"u"?kl():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=ce("client_encoding",e),this.replication=ce("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=ce("application_name",e,"PGAPPNAME"),this.fallback_application_name=ce("fallback_application_name",e,!1),this.statement_timeout=ce("statement_timeout",e,!1),this.lock_timeout=ce("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=ce("idle_in_transaction_session_timeout",e,!1),this.query_timeout=ce("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];ye(r,this,"user"),ye(r,this,"password"),ye(r,this,"port"),ye(r,this,"application_name"),ye(r,this,"fallback_application_name"),ye(r,this,"connect_timeout"),ye(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(ye(r,n,"sslmode"),ye(r,n,"sslca"),ye(r,n,"sslkey"),ye(r,n,"sslcert"),ye(r,n,"sslrootcert"),this.database&&r.push("dbname="+Ge(this.database)),this.replication&&r.push("replication="+Ge(this.replication)),this.host&&r.push("host="+Ge(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+Ge(this.client_encoding)),ql.lookup(this.host,function(s,o){return s?e(s,null):(r.push("hostaddr="+Ge(o)),e(null,r.join(" ")))})}};i(ur,"ConnectionParameters");var cr=ur;Li.exports=cr});var qi=A((Ig,xi)=>{"use strict";var Fl=it(),Mi=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,mr=class mr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=Mi.exec(e.text):r=Mi.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var o=e[n];o!==null?r[n]=this._parsers[n](o):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var o=e[n],a=this.fields[n].name;o!==null?r[a]=this._parsers[n](o):r[a]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Fl.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(mr,"Result");var pr=mr;xi.exports=pr});var $i=A((wg,Bi)=>{"use strict";var{EventEmitter:Bl}=require("events"),ki=qi(),Fi=at(),fr=class fr extends Bl{constructor(e,r,n){super(),e=Fi.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new ki(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new ki(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Fi.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(fr,"Query");var dr=fr;Bi.exports=dr});var Gr=A(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.NoticeMessage=L.DataRowMessage=L.CommandCompleteMessage=L.ReadyForQueryMessage=L.NotificationResponseMessage=L.BackendKeyDataMessage=L.AuthenticationMD5Password=L.ParameterStatusMessage=L.ParameterDescriptionMessage=L.RowDescriptionMessage=L.Field=L.CopyResponse=L.CopyDataMessage=L.DatabaseError=L.copyDone=L.emptyQuery=L.replicationStart=L.portalSuspended=L.noData=L.closeComplete=L.bindComplete=L.parseComplete=void 0;L.parseComplete={name:"parseComplete",length:5};L.bindComplete={name:"bindComplete",length:5};L.closeComplete={name:"closeComplete",length:5};L.noData={name:"noData",length:5};L.portalSuspended={name:"portalSuspended",length:5};L.replicationStart={name:"replicationStart",length:4};L.emptyQuery={name:"emptyQuery",length:4};L.copyDone={name:"copyDone",length:4};var vr=class vr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(vr,"DatabaseError");var hr=vr;L.DatabaseError=hr;var Rr=class Rr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Rr,"CopyDataMessage");var yr=Rr;L.CopyDataMessage=yr;var Pr=class Pr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Pr,"CopyResponse");var gr=Pr;L.CopyResponse=gr;var Dr=class Dr{constructor(e,r,n,s,o,a,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=o,this.dataTypeModifier=a,this.format=c}};i(Dr,"Field");var Er=Dr;L.Field=Er;var Lr=class Lr{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Lr,"RowDescriptionMessage");var _r=Lr;L.RowDescriptionMessage=_r;var Mr=class Mr{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(Mr,"ParameterDescriptionMessage");var Sr=Mr;L.ParameterDescriptionMessage=Sr;var xr=class xr{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(xr,"ParameterStatusMessage");var Tr=xr;L.ParameterStatusMessage=Tr;var qr=class qr{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(qr,"AuthenticationMD5Password");var Cr=qr;L.AuthenticationMD5Password=Cr;var kr=class kr{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(kr,"BackendKeyDataMessage");var Ar=kr;L.BackendKeyDataMessage=Ar;var Fr=class Fr{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(Fr,"NotificationResponseMessage");var Nr=Fr;L.NotificationResponseMessage=Nr;var Br=class Br{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(Br,"ReadyForQueryMessage");var br=Br;L.ReadyForQueryMessage=br;var $r=class $r{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i($r,"CommandCompleteMessage");var Ir=$r;L.CommandCompleteMessage=Ir;var Ur=class Ur{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(Ur,"DataRowMessage");var Or=Ur;L.DataRowMessage=Or;var Kr=class Kr{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Kr,"NoticeMessage");var wr=Kr;L.NoticeMessage=wr});var Ui=A(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Writer=void 0;var Hr=class Hr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(Hr,"Writer");var Vr=Hr;Ct.Writer=Vr});var Gi=A(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.serialize=void 0;var Qr=Ui(),H=new Qr.Writer,$l=i(t=>{H.addInt16(3).addInt16(0);for(let n of Object.keys(t))H.addCString(n).addCString(t[n]);H.addCString("client_encoding").addCString("UTF8");var e=H.addCString("").flush(),r=e.length+4;return new Qr.Writer().addInt32(r).add(e).flush()},"startup"),Ul=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Kl=i(t=>H.addCString(t).flush(112),"password"),Gl=i(function(t,e){return H.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),H.flush(112)},"sendSASLInitialResponseMessage"),Vl=i(function(t){return H.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Hl=i(t=>H.addCString(t).flush(81),"query"),Ki=[],Ql=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ki;for(var n=r.length,s=H.addCString(e).addCString(t.text).addInt16(n),o=0;o<n;o++)s.addInt32(r[o]);return H.flush(80)},"parse"),Ve=new Qr.Writer,Wl=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(H.addInt16(0),Ve.addInt32(-1)):n instanceof Buffer?(H.addInt16(1),Ve.addInt32(n.length),Ve.add(n)):(H.addInt16(0),Ve.addInt32(Buffer.byteLength(n)),Ve.addString(n))}},"writeValues"),Yl=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Ki,o=s.length;return H.addCString(e).addCString(r),H.addInt16(o),Wl(s,t.valueMapper),H.addInt16(o),H.add(Ve.flush()),H.addInt16(n?1:0),H.flush(66)},"bind"),jl=Buffer.from([69,0,0,0,9,0,0,0,0,0]),zl=i(t=>{if(!t||!t.portal&&!t.rows)return jl;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,o=Buffer.allocUnsafe(1+s);return o[0]=69,o.writeInt32BE(s,1),o.write(e,5,"utf-8"),o[n+5]=0,o.writeUInt32BE(r,o.length-4),o},"execute"),Xl=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),Wr=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Zl=H.addCString("P").flush(68),Jl=H.addCString("S").flush(68),ep=i(t=>t.name?Wr(68,`${t.type}${t.name||""}`):t.type==="P"?Zl:Jl,"describe"),tp=i(t=>{let e=`${t.type}${t.name||""}`;return Wr(67,e)},"close"),rp=i(t=>H.add(t).flush(100),"copyData"),np=i(t=>Wr(102,t),"copyFail"),At=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),sp=At(72),ip=At(83),op=At(88),ap=At(99),cp={startup:$l,password:Kl,requestSsl:Ul,sendSASLInitialResponseMessage:Gl,sendSCRAMClientFinalMessage:Vl,query:Hl,parse:Ql,bind:Yl,execute:zl,describe:ep,close:tp,flush:()=>sp,sync:()=>ip,end:()=>op,copyData:rp,copyDone:()=>ap,copyFail:np,cancel:Xl};Nt.serialize=cp});var Vi=A(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.BufferReader=void 0;var up=Buffer.allocUnsafe(0),jr=class jr{constructor(e=0){this.offset=e,this.buffer=up,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(jr,"BufferReader");var Yr=jr;bt.BufferReader=Yr});var Wi=A(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.Parser=void 0;var Q=Gr(),lp=Vi(),zr=1,pp=4,Hi=zr+pp,Qi=Buffer.allocUnsafe(0),Zr=class Zr{constructor(e){if(this.buffer=Qi,this.bufferLength=0,this.bufferOffset=0,this.reader=new lp.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Hi<=n;){let o=this.buffer[s],a=this.buffer.readUInt32BE(s+zr),c=zr+a;if(c+s<=n){let l=this.handlePacket(s+Hi,o,a,this.buffer);r(l),s+=c}else break}s===n?(this.buffer=Qi,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let o=this.buffer.byteLength*2;for(;r>=o;)o*=2;s=Buffer.allocUnsafe(o)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return Q.bindComplete;case 49:return Q.parseComplete;case 51:return Q.closeComplete;case 110:return Q.noData;case 115:return Q.portalSuspended;case 99:return Q.copyDone;case 87:return Q.replicationStart;case 73:return Q.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new Q.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new Q.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new Q.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new Q.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let o=this.reader.byte()!==0,a=this.reader.int16(),c=new Q.CopyResponse(r,s,o,a);for(let l=0;l<a;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.cstring(),a=this.reader.cstring();return new Q.NotificationResponseMessage(r,s,o,a)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Q.RowDescriptionMessage(r,s);for(let a=0;a<s;a++)o.fields[a]=this.parseField();return o}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),o=this.reader.int16(),a=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new Q.Field(e,r,n,s,o,a,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Q.ParameterDescriptionMessage(r,s);for(let a=0;a<s;a++)o.dataTypeIDs[a]=this.reader.int32();return o}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),o=new Array(s);for(let a=0;a<s;a++){let c=this.reader.int32();o[a]=c===-1?null:this.reader.string(c)}return new Q.DataRowMessage(r,o)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),o=this.reader.cstring();return new Q.ParameterStatusMessage(r,s,o)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o=this.reader.int32();return new Q.BackendKeyDataMessage(r,s,o)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),o={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:o.length===8&&(o.name="authenticationCleartextPassword");break;case 5:if(o.length===12){o.name="authenticationMD5Password";let c=this.reader.bytes(4);return new Q.AuthenticationMD5Password(r,c)}break;case 10:o.name="authenticationSASL",o.mechanisms=[];let a;do a=this.reader.cstring(),a&&o.mechanisms.push(a);while(a);break;case 11:o.name="authenticationSASLContinue",o.data=this.reader.string(r-8);break;case 12:o.name="authenticationSASLFinal",o.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return o}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let o={},a=this.reader.string(1);for(;a!=="\0";)o[a]=this.reader.cstring(),a=this.reader.string(1);let c=o.M,l=s==="notice"?new Q.NoticeMessage(r,c):new Q.DatabaseError(c,r,s);return l.severity=o.S,l.code=o.C,l.detail=o.D,l.hint=o.H,l.position=o.P,l.internalPosition=o.p,l.internalQuery=o.q,l.where=o.W,l.schema=o.s,l.table=o.t,l.column=o.c,l.dataType=o.d,l.constraint=o.n,l.file=o.F,l.line=o.L,l.routine=o.R,l}};i(Zr,"Parser");var Xr=Zr;It.Parser=Xr});var Jr=A(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.DatabaseError=ve.serialize=ve.parse=void 0;var mp=Gr();Object.defineProperty(ve,"DatabaseError",{enumerable:!0,get:function(){return mp.DatabaseError}});var dp=Gi();Object.defineProperty(ve,"serialize",{enumerable:!0,get:function(){return dp.serialize}});var fp=Wi();function hp(t,e){let r=new fp.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(hp,"parse");ve.parse=hp});var Yi={};pu(Yi,{default:()=>yp});var yp,ji=lu(()=>{yp={}});var zi=A((Kg,en)=>{en.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(ji(),du(Yi));return new n(e)}},"getStream");en.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var nn=A((Hg,Xi)=>{"use strict";var Vg=require("net"),gp=require("events").EventEmitter,{parse:Ep,serialize:te}=Jr(),{getStream:_p,getSecureStream:Sp}=zi(),Tp=te.flush(),Cp=te.sync(),Ap=te.end(),rn=class rn extends gp{constructor(e){super(),e=e||{},this.stream=e.stream||_p(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(o){n._ending&&(o.code==="ECONNRESET"||o.code==="EPIPE")||n.emit("error",o)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(o){var a=o.toString("utf8");switch(a){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{n.stream=Sp(c)}catch(u){return n.emit("error",u)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){Ep(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(te.requestSsl())}startup(e){this.stream.write(te.startup(e))}cancel(e,r){this._send(te.cancel(e,r))}password(e){this._send(te.password(e))}sendSASLInitialResponseMessage(e,r){this._send(te.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(te.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(te.query(e))}parse(e){this._send(te.parse(e))}bind(e){this._send(te.bind(e))}execute(e){this._send(te.execute(e))}flush(){this.stream.writable&&this.stream.write(Tp)}sync(){this._ending=!0,this._send(Cp)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Ap,()=>{this.stream.end()})}close(e){this._send(te.close(e))}describe(e){this._send(te.describe(e))}sendCopyFromChunk(e){this._send(te.copyData(e))}endCopyFrom(){this._send(te.copyDone())}sendCopyFail(e){this._send(te.copyFail(e))}};i(rn,"Connection");var tn=rn;Xi.exports=tn});var to=A((Wg,eo)=>{"use strict";var{Transform:Np}=require("stream"),{StringDecoder:bp}=require("string_decoder"),Re=Symbol("last"),Ot=Symbol("decoder");function Ip(t,e,r){let n;if(this.overflow){if(n=this[Ot].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[Re]+=this[Ot].write(t),n=this[Re].split(this.matcher);this[Re]=n.pop();for(let s=0;s<n.length;s++)try{Ji(this,this.mapper(n[s]))}catch(o){return r(o)}if(this.overflow=this[Re].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(Ip,"transform");function Op(t){if(this[Re]+=this[Ot].end(),this[Re])try{Ji(this,this.mapper(this[Re]))}catch(e){return t(e)}t()}i(Op,"flush");function Ji(t,e){e!==void 0&&t.push(e)}i(Ji,"push");function Zi(t){return t}i(Zi,"noop");function wp(t,e,r){switch(t=t||/\r?\n/,e=e||Zi,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Zi)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Ip,r.flush=Op,r.readableObjectMode=!0;let n=new Np(r);return n[Re]="",n[Ot]=new bp("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,o){this._writableState.errorEmitted=!1,o(s)},n}i(wp,"split");eo.exports=wp});var so=A((jg,Ie)=>{"use strict";var ro=require("path"),vp=require("stream").Stream,Rp=to(),no=require("util"),Pp=5432,wt=process.platform==="win32",ut=process.stderr,Dp=56,Lp=7,Mp=61440,xp=32768;function qp(t){return(t&Mp)==xp}i(qp,"isRegFile");var He=["host","port","database","user","password"],sn=He.length,kp=He[sn-1];function on(){var t=ut instanceof vp&&ut.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);ut.write(no.format.apply(no,e))}}i(on,"warn");Object.defineProperty(Ie.exports,"isWin",{get:function(){return wt},set:function(t){wt=t}});Ie.exports.warnTo=function(t){var e=ut;return ut=t,e};Ie.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(wt?ro.join(e.APPDATA||"./","postgresql","pgpass.conf"):ro.join(e.HOME||"./",".pgpass"));return r};Ie.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:wt?!0:(e=e||"<unkn>",qp(t.mode)?t.mode&(Dp|Lp)?(on('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(on('WARNING: password file "%s" is not a plain file',e),!1))};var Fp=Ie.exports.match=function(t,e){return He.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||Pp)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Ie.exports.getPassword=function(t,e,r){var n,s=e.pipe(Rp());function o(l){var u=Bp(l);u&&$p(u)&&Fp(t,u)&&(n=u[kp],s.end())}i(o,"onLine");var a=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(l){e.destroy(),on("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),s.on("data",o).on("end",a).on("error",c)};var Bp=Ie.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,o=0,a={},c=!1,l=i(function(p,d,f){var h=t.substring(d,f);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(h=h.replace(/\\([:\\])/g,"$1")),a[He[p]]=h},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=n==sn-1,c){l(n,s);break}u>=0&&e==":"&&r!=="\\"&&(l(n,s,u+1),s=u+2,n+=1)}return a=Object.keys(a).length===sn?a:null,a},$p=Ie.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<He.length;r+=1){var n=e[r],s=t[He[r]]||"",o=n(s);if(!o)return!1}return!0}});var oo=A((Zg,an)=>{"use strict";var Xg=require("path"),io=require("fs"),vt=so();an.exports=function(t,e){var r=vt.getFileName();io.stat(r,function(n,s){if(n||!vt.usePgPass(s,r))return e(void 0);var o=io.createReadStream(r);vt.getPassword(t,o,e)})};an.exports.warnTo=vt.warnTo});var lo=A((Jg,uo)=>{"use strict";var Up=require("events").EventEmitter,ao=at(),cn=Oi(),Kp=or(),Gp=lr(),co=$i(),Vp=ot(),Hp=nn(),Qp=ir(),un=class un extends Up{constructor(e){super(),this.connectionParameters=new Gp(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Kp(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Hp({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Vp.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{oo()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Qp.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=cn.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await cn.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{cn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return ao.escapeIdentifier(e)}escapeLiteral(e){return ao.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,o,a,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,o=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(a=this.connectionParameters.query_timeout,s=new co(e,r,n),s.callback||(o=new this._Promise((u,p)=>{s.callback=(d,f)=>d?p(d):u(f)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=s.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),l(u),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},a),s.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),o):(this.queryQueue.push(s),this._pulseQueryQueue(),o):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),o)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(un,"Client");var Rt=un;Rt.Query=co;uo.exports=Rt});var ho=A((tE,fo)=>{"use strict";var Wp=require("events").EventEmitter,po=i(function(){},"NOOP"),mo=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),mn=class mn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(mn,"IdleItem");var ln=mn,dn=class dn{constructor(e){this.callback=e}};i(dn,"PendingItem");var Qe=dn;function Yp(){throw new Error("Release called on client which has already been released to the pool.")}i(Yp,"throwOnDoubleRelease");function Pt(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(a,c){a?r(a):n(c)},"cb"),o=new t(function(a,c){n=a,r=c}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:s,result:o}}i(Pt,"promisify");function jp(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(jp,"makeIdleListener");var fn=class fn extends Wp{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||hn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=mo(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Pt(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Qe(r.callback)),n;let s=i((c,l,u)=>{clearTimeout(a),r.callback(c,l,u)},"queueCallback"),o=new Qe(s),a=setTimeout(()=>{mo(this._pendingQueue,c=>c.callback===s),o.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(o),n}return this.newClient(new Qe(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=jp(this,r);this.log("checking client timeout");let s,o=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),o=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(s&&clearTimeout(s),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(c=>c!==r),o&&(a.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(a,void 0,po);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Qe((u,p,d)=>d()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,o=>{if(o)return e.release(o),r.callback(o,void 0,po);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Yp(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let o;this.options.idleTimeoutMillis&&(o=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&o.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new ln(e,r,o)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let o=Pt(this.Promise,e);return setImmediate(function(){return o.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),o.result}typeof r=="function"&&(n=r,r=void 0);let s=Pt(this.Promise,n);return n=s.callback,this.connect((o,a)=>{if(o)return n(o);let c=!1,l=i(u=>{c||(c=!0,a.release(u),n(u))},"onError");a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,p)=>{if(this.log("query dispatched"),a.removeListener("error",l),!c)return c=!0,a.release(u),u?n(u):n(void 0,p)})}catch(u){return a.release(u),n(u)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Pt(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(fn,"Pool");var pn=fn;fo.exports=pn});var Eo=A((nE,go)=>{"use strict";var yo=require("events").EventEmitter,zp=require("util"),yn=at(),We=go.exports=function(t,e,r){yo.call(this),t=yn.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};zp.inherits(We,yo);var Xp={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};We.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=Xp[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};We.prototype.then=function(t,e){return this._getPromise().then(t,e)};We.prototype.catch=function(t){return this._getPromise().catch(t)};We.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};We.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(o,a,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),o)return e.handleError(o);e._emitRowEvents&&(c.length>1?a.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):a.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(yn.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let o=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(o)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(o){return o?r(o):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let o=new Error("Query values must be an array");return r(o)}var s=this.values.map(yn.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var Ao=A((iE,Co)=>{"use strict";var _o;try{_o=require("pg-native")}catch(t){throw t}var Zp=or(),So=require("events").EventEmitter,Jp=require("util"),em=lr(),To=Eo(),pe=Co.exports=function(t){So.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Zp(t.types),this.native=new _o({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new em(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};pe.Query=To;Jp.inherits(pe,So);pe.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};pe.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(o){e._queryable=!1,e._errorAllQueries(o),e.emit("error",o)}),e.native.on("notification",function(o){e.emit("notification",{channel:o.relname,payload:o.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};pe.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};pe.prototype.query=function(t,e,r){var n,s,o,a,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")o=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(o=this.connectionParameters.query_timeout,n=new To(t,e,r),!n.callback){let l,u;s=new this._Promise((p,d)=>{l=p,u=d}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,d)=>p?u(p):l(d)}return o&&(c=n.callback,a=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),c(l),n.callback=()=>{};var u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},o),n.callback=(l,u)=>{clearTimeout(a),c(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};pe.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(o=>o?s(o):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};pe.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};pe.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};pe.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};pe.prototype.ref=function(){};pe.prototype.unref=function(){};pe.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};pe.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var gn=A((aE,No)=>{"use strict";No.exports=Ao()});var hn=A((cE,lt)=>{"use strict";var tm=lo(),rm=ot(),nm=nn(),sm=ho(),{DatabaseError:im}=Jr(),{escapeIdentifier:om,escapeLiteral:am}=at(),cm=i(t=>{var e;return e=class extends sm{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),En=i(function(t){this.defaults=rm,this.Client=t,this.Query=this.Client.Query,this.Pool=cm(this.Client),this._pools=[],this.Connection=nm,this.types=it(),this.DatabaseError=im,this.escapeIdentifier=om,this.escapeLiteral=am},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?lt.exports=new En(gn()):(lt.exports=new En(tm),Object.defineProperty(lt.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new En(gn())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(lt.exports,"native",{value:t}),t}}))});var Io=A((lE,bo)=>{"use strict";var Ye=require("fs"),um=hn(),lm="The server does not support SSL connections",pm="28000",mm=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,o){e.info("Certificate",{hostname:s,cert:{subject:o.subject,issuer:o.issuer,valid_from:o.valid_from,valid_to:o.valid_to}})}};return Ye.existsSync(t.certAuthority)&&(n.ca=Ye.readFileSync(t.certAuthority).toString()),Ye.existsSync(t.clientCert)&&(n.cert=Ye.readFileSync(t.clientCert).toString()),Ye.existsSync(t.clientPrivateKey)&&(n.key=Ye.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),dm=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),fm=i(async(t,e,r)=>{let n=!1;if(t.ssh){let{options:a}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...a},n=!0}t=Object.assign({},t,{sslType:dm(t.sslType)});let s={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:mm(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await _n(s,r),isSshTunnel:n}},"createClient"),hm=i((t,e,r)=>{var n;if(r.message===lm&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),_n({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===pm&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),_n({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),_n=i((t,e)=>{let r=new um.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return hm(t,e,n)})},"createConnectionPool");bo.exports={createClient:fm}});var Sn=A((mE,vo)=>{"use strict";var Oo=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),wo={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
		SELECT tables.table_name, tables.table_type
		FROM information_schema.tables AS tables
		INNER JOIN (
			SELECT pg_class.relname AS table_name,
				   pg_namespace.nspname AS table_schema
			FROM pg_catalog.pg_class AS pg_class
				INNER JOIN pg_catalog.pg_namespace AS pg_namespace
				ON (pg_namespace.oid = pg_class.relnamespace)
			WHERE (pg_class.relispartition = false OR pg_class.relispartition IS NULL) AND pg_class.relkind = ANY ('{"r","v","t","m","p"}')
		) AS catalog_table_data
		ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
		WHERE tables.table_schema = $1;
	`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1, $2)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:`
    SELECT indexname,
           index_id,
           index_method,
           index_unique,
           number_of_keys,
           where_expression,
           array_agg(attname ORDER BY ord)::text[] AS columns,
           array_agg(coll ORDER BY ord) AS collations,
           array_agg(opclass ORDER BY ord) AS opclasses,
           array_agg(expression ORDER BY ord) AS expressions,
           array_agg(ascending ORDER BY ord) AS ascendings,
           array_agg(nulls_first ORDER BY ord) AS nulls_first,
           reloptions AS storage_parameters
    FROM (
        SELECT ct.oid AS table_oid,
            c.relname AS indexname,
            m.amname AS index_method,
            indexes.indisunique AS index_unique,
            indexes.ord,
            attribute.attname,
            c.reloptions,
            indexes.indnkeyatts AS number_of_keys,
            ti.index_id AS index_id,
            pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
            CASE
                WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
            END AS coll,
            CASE
                WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
            END AS opclass,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 1 = 1 THEN 'DESC' ELSE 'ASC'
        END AS ascending,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 2 = 2 THEN 'NULLS FIRST' ELSE 'NULLS LAST'
        END AS nulls_first,
        pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
        FROM
            (
                SELECT *,
                    generate_series(1,array_length(i.indkey,1)) AS ord,
                    unnest(i.indkey) AS key,
                    unnest(i.indcollation) AS coll,
                    unnest(i.indclass) AS class,
                    unnest(i.indoption) AS option
                FROM pg_catalog.pg_index i
            ) indexes
        JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
        JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
        JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
        LEFT JOIN pg_catalog.pg_attribute attribute
            ON (attribute.attrelid=indexes.indrelid AND attribute.attnum=indexes.key)
        LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
        LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
        LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
        LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
        INNER JOIN crdb_internal.table_indexes ti ON (
            indexes.indrelid = ti.descriptor_id
            AND c.relname = ti.index_name
        )
    ) s2
    WHERE table_oid = $1
    GROUP BY
        indexname,
        index_id,
        index_method,
        index_unique,
        reloptions,
        number_of_keys,
        where_expression;
    `,GET_TABLE_INDEX_PARTITIONING_DATA:`
        SELECT
            partitions.name AS partition_name,
            partitions.index_id,
            parent_name,
            column_names,
            list_value,
            range_value,
            index_name
        FROM crdb_internal.partitions
            INNER JOIN crdb_internal.table_indexes
                ON partitions.table_id = table_indexes.descriptor_id
                    AND partitions.index_id = table_indexes.index_id
        WHERE table_indexes.descriptor_id = $1;
    `,GET_TABLE_INDEX_CREATE_INFO:`
        SELECT index_name,
               is_sharded,
               is_visible,
               create_statement
        FROM crdb_internal.table_indexes WHERE descriptor_id = $1;
    `,GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:Oo(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:Oo(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND (
                (pg_type.typtype = 'c' AND (pg_class.relkind = 'c' OR pg_class.relkind IS NULL))
                OR pg_type.typtype = 'e'
                OR pg_type.typtype = 'r'
            )
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;"},ym=i(t=>(Object.entries(wo).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");vo.exports={getQueryName:ym,...wo}});var Po=A((fE,Ro)=>{"use strict";var gm=Sn(),xe=null,Dt=null;Ro.exports={initializeClient(t,e){xe=t,Dt=e,xe.on("error",r=>e.error(r))},isClientInitialized(){return!!xe},releaseClient(){return xe?new Promise(t=>{xe.end(()=>{xe=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=gm.getQueryName(t);Dt.info("Execute query",{queryName:n,params:e});let s=Date.now(),o=await xe.query(t,e),a=Date.now()-s;Dt.info("Query executed",{queryName:n,params:e,duration:a,rowsCount:o.rowCount});let c=o.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,Dt.error(n),null}}}});var Mo=A((hE,Lo)=>{"use strict";var Do=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...Do(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");Lo.exports={getJsonSchema:Do}});var An=A((gE,xo)=>{"use strict";var qe=null,Em=i(t=>{qe=t.require("lodash")},"setDependencies"),Tn={column_default:"default",is_nullable:{keyword:"required",map:(t,e,r)=>({YES:!1,NO:!0})[r]},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e,r)=>r!==-1&&Om(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:{keyword:"length",map:(t,e,r)=>Number(r)},description:"description"},_m=i((t,e,r)=>{let n=Tn[e];if(!n||typeof n=="string")return r;let s=n.check||((c,l,u)=>!0),o=n.map||((c,l,u)=>u),a="";return s(t,e,r)&&(a=r),o(t,e,a)},"getColumnValue"),Sm=i(t=>e=>qe.chain(e).toPairs().map(([r,n])=>{var s;return[((s=Tn[r])==null?void 0:s.keyword)||Tn[r],_m(e,r,n)]}).filter(([r,n])=>r&&!qe.isNil(n)).fromPairs().thru(Tm(t)).value(),"mapColumnData"),Tm=i(t=>e=>({...e,...Cm(t,e)}),"setColumnType"),Cm=i((t,e)=>e.type==="ARRAY"?Am(t,e):e.type==="USER-DEFINED"?Cn(t,e.udt_name):Cn(t,e.type),"getType"),Am=i((t,e)=>({...Cn(t,e.udt_name.slice(1)),array_type:qe.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Cn=i((t,e)=>{switch(e){case"bigserial":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"numeric":case"dec":case"decimal":return{type:"numeric",mode:"decimal"};case"int2":case"smallint":return{type:"numeric",mode:"int2"};case"int4":case"integer":return{type:"numeric",mode:"int4"};case"int":case"int8":case"int64":case"bigint":return{type:"numeric",mode:"int"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return qe.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Nm=i((t,e)=>{let r=qe.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],o=bm(s),a=Im(o);return{...n,subtype:a}})},"setSubtypeFromSampledJsonValues"),bm=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Im=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),Om=i(t=>qe.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");xo.exports={setDependencies:Em,mapColumnData:Sm,setSubtypeFromSampledJsonValues:Nm}});var pt=A((_E,qo)=>{"use strict";var wm=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],je=null,vm=i(t=>{je=t.require("lodash")},"setDependencies"),Rm=i(t=>je.chain(t).toPairs().reject(([e,r])=>je.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Pm=i(t=>e=>{var r;return(r=je.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Dm=i(t=>/\s|\W/.test(t)||je.includes(wm,je.toUpper(t))?`"${t}"`:t,"wrapInQuotes");qo.exports={clearEmptyPropertiesInObject:Rm,setDependencies:vm,getColumnNameByPosition:Pm,wrapInQuotes:Dm}});var Bo=A((TE,Fo)=>{"use strict";var{getColumnNameByPosition:Lm}=pt(),Nn=null,Mm=i(t=>{Nn=t.require("lodash")},"setDependencies"),ko=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),xm=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";default:return""}},"prepareMatch"),qm=i((t,e,r,n)=>Nn.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Nn.map(s.table_columns_positions,Lm(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:ko(s.relationship_on_delete),relationshipOnUpdate:ko(s.relationship_on_update),relationshipMatch:xm(s.relationship_match)}})),"prepareForeignKeys");Fo.exports={setDependencies:Mm,prepareForeignKeys:qm}});var Ko=A((AE,Uo)=>{"use strict";var Lt=null,km=i(t=>{Lt=t.require("lodash")},"setDependencies"),$o=i(t=>Lt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Fm(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Fm=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Bm=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),$m=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Um=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Km=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:$o(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Lt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Bm(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Um(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:$m(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Gm=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Lt.toLower(t.external_language),inputArgs:$o(e),body:t.routine_definition}),"mapProcedureData");Uo.exports={setDependencies:km,mapFunctionData:Km,mapProcedureData:Gm}});var Qo=A((bE,Ho)=>{"use strict";var Vm=i(t=>e=>{if(!e)return null;let r=Qm(e),n=Wm(t)(e),s=Ym(e);return[{partitionMethod:r,compositePartitionKey:n,partitioning_expression:s}]},"preparePartition"),bn=i((t={})=>t.list_value?"LIST":t.range_value?"RANGE":"","getPartitionMethodByRow"),Go=i((t=[])=>t.filter(e=>!e.parent_name),"getParentPartitionRows"),Hm=i((t=[],e=null)=>t.filter(r=>r.parent_name===e),"getChildPartitionRows"),Qm=i((t=[])=>{let e=Go(t);if(!e.length)return"";let r=e[0];return bn(r)},"getPartitionMethod"),Wm=i(t=>(e=[])=>{let n=e.filter(s=>!s.parent_name).flatMap(s=>(s.column_names||"").split(",").map(a=>a.trim()));return t.uniq(n)},"getCompositePartitionKey"),Ym=i(t=>{let e=Go(t);if(!e.length)return"";let r=e[0],n=bn(r),s=r.column_names||"",o=e.map(a=>Vo({partition:a,paddingFactor:1,partitionResult:t})).join(`,
`);return`PARTITION BY ${n} (${s}) (
${o}
)`},"getPartitionExpression"),Vo=i(({partition:t,partitionResult:e,paddingFactor:r})=>{let n=t.list_value?"VALUES IN":"VALUES FROM",s=t.list_value||t.range_value||"",o="	".repeat(r),a=`${o}PARTITION ${t.partition_name} ${n} ${s}`,c=Hm(e,t.partition_name);if(c.length){let l=c.map(f=>Vo({partition:f,partitionResult:e,paddingFactor:r+1})).join(`,
`),u=c[0],p=bn(u),d=u.column_names||"";return a+` PARTITION BY ${p} (${d}) (
`+l+`
`+o+")"}return a},"getSinglePartitionExpression");Ho.exports={preparePartition:Vm}});var Xo=A((OE,zo)=>{"use strict";var{clearEmptyPropertiesInObject:Mt,getColumnNameByPosition:Wo}=pt(),{preparePartition:jm}=Qo(),G=null,zm=i(t=>{G=t.require("lodash")},"setDependencies"),Xm=i(t=>{let e={};for(let r of Object.keys(t))r.startsWith("ttl")?(e.ttl_storage_parameters||(e.ttl_storage_parameters={}),e.ttl_storage_parameters[r]=t[r]):e[r]=t[r];return e},"groupTtlStorageParams"),Yo=i((t,e)=>{if(!t&&!e)return null;let r=Ed(t),n=Mt(r),s=Xm(n);return Mt(s)},"prepareStorageParameters"),In=i(t=>G.split(t,"="),"splitByEqualitySymbol"),Zm=i(t=>G.find(t,{type:"json"}),"checkHaveJsonTypes"),Jm=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),ed=i((t,e,r)=>G.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,nd(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,td(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,rd(s,e)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),td=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:G.map(t.constraint_keys,Wo(e)),indexStorageParameters:G.join(t.storage_parameters,",")}),"getPrimaryKeyConstraint"),rd=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:G.map(t.constraint_keys,Wo(e)),indexStorageParameters:G.join(t.storage_parameters,","),indexComment:t.description}),"getUniqueKeyConstraint"),nd=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,notValid:t.notValid,constrDescription:t.description}),"getCheckConstraint"),sd=i((t,e=[])=>e.find(n=>n.index_name===t)||{}||{},"getIndexCreateInfoRowByName"),id=i(t=>{switch(t.toUpperCase()){case"INVERTED":return"gin";case"PREFIX":return"btree";default:return t}},"parseIndexMethod"),od=i((t,e)=>(t||[]).filter(r=>r.index_name===e.indexname&&r.index_id===e.index_id),"getIndexPartitioningRows"),ad=i(({tableIndexesResult:t,tableIndexesCreateInfoResult:e=[],tableIndexesPartitioningResult:r})=>G.map(t,n=>{let s=sd(n.indexname,e),o=s.create_statement,a=md(n,o),c=G.slice(a,0,n.number_of_keys),l=G.chain(a).slice(n.number_of_keys).map(y=>G.pick(y,"name")).value(),u=s.is_visible?"VISIBLE":"NOT VISIBLE",p=!!s.is_sharded,d=od(r,n),h=(jm(G)(d)||[{}])[0].partitioning_expression,S={indxName:n.indexname,index_method:id(n.index_method),unique:n.index_unique??!1,index_storage_parameter:fd(n.storage_parameters,o),where:n.where_expression||"",partitioning_expression:h,include:l,columns:c,using_hash:p,visibility:u};return Mt(S)}),"prepareTableIndexes"),cd=i(({createStatement:t,columnName:e})=>{let r=["(",","],n=0;for(;n<t.length;){let s=t.indexOf(e,n);if(s===-1)return-1;let o=t.charAt(s-1);if(t.charAt(s+e.length).match(/\s/)&&r.includes(o))return s;n=s+e.length}},"getIndexColumnDefinitionStart"),ud=i(({createStatement:t,columnDefinitionStart:e})=>{let r=t.substring(e),n=r.indexOf(","),s=r.indexOf(")");return n===-1?e+s:e+Math.min(n,s)},"getColumnDefinitionEnd"),ld=i(({createStatement:t,columnName:e})=>{let r=cd({columnName:e,createStatement:t});if(r===-1)return"";let n=ud({columnDefinitionStart:r,createStatement:t});return n===-1?"":t.substring(r,n)},"getIndexColumnQueryDefinition"),pd=i(({indexData:t,itemIndex:e,columnName:r,createStatement:n})=>{let s=G.get(t,`opclasses.${e}`,"");if(s)return s;let o=ld({columnName:r,createStatement:n});if(!o)return"";let a=o.substring(r.length).trim();return a?a.toUpperCase().replaceAll("ASC","").replaceAll("DESC","").replaceAll("NULLS FIRST","").replaceAll("NULLS LAST","").toLowerCase().trim():""},"getIndexColumnOpClass"),md=i((t,e)=>G.chain(t.columns).map((r,n)=>{if(!r)return;let s=G.get(t,`ascendings.${n}`,"ASC"),o=G.get(t,`nulls_first.${n}`,"NULLS FIRST"),a=pd({columnName:r,createStatement:e,itemIndex:n,indexData:t}),c=G.get(t,`collations.${n}`,"");return{name:r,sortOrder:s,nullsOrder:o,opclass:a,collation:c}}).compact().value(),"mapIndexColumns"),jo=i(t=>{let e={fillfactor:t.fillfactor,bucket_count:t.bucket_count,geometry_max_x:t.geometry_max_x,geometry_max_y:t.geometry_max_y,geometry_min_x:t.geometry_min_x,geometry_min_y:t.geometry_min_y,s2_level_mod:t.s2_level_mod,s2_max_cells:t.s2_max_cells,s2_max_level:t.s2_max_level};return Mt(e)},"hydrateIndexStorageParameters"),dd=i(t=>{let e=/\s+with\s+\(.*?\)/im,r=t.match(e);if(!(r!=null&&r.length))return null;let n=r[0],s=7,o=n.length-1,a=n.substring(s,o).split(",").map(l=>l.trim()),c=G.fromPairs(G.map(a,l=>In(l)));return jo(c)},"parseIndexStorageParametersFromDdl"),fd=i((t,e)=>{if(!t)return dd(e);let r=G.fromPairs(G.map(t,n=>In(n)));return jo(r)},"getIndexStorageParameters"),hd=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Yo(t==null?void 0:t.reloptions,e),o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,partitionBounds:o}},"prepareTableLevelData"),yd=i(t=>{switch(gd(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),gd=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),Ed=i(t=>G.chain(t).map(In).map(([e,r])=>[e,yd(r)]).fromPairs().value()||{},"prepareOptions"),_d=i((t,e)=>G.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");zo.exports={prepareStorageParameters:Yo,setDependencies:zm,checkHaveJsonTypes:Zm,prepareTableConstraints:ed,prepareTableLevelData:hd,prepareTableIndexes:ad,getSampleDocSize:Jm,prepareTableInheritance:_d}});var Jo=A((vE,Zo)=>{"use strict";var{mapColumnData:Sd}=An(),On=null,Td=i(t=>{On=t.require("lodash")},"setDependencies"),Cd=i(t=>On.chain(t).map(e=>{switch(e.type){case"e":return Ad(e);case"r":return Nd(e);case"c":return bd(e);default:return null}}).compact().value(),"getUserDefinedTypes"),Ad=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Nd=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),bd=i(t=>{let e=On.map(t.columns,Sd([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Id=i(t=>t.type==="c","isTypeComposite");Zo.exports={setDependencies:Td,getUserDefinedTypes:Cd,isTypeComposite:Id}});var ta=A((PE,ea)=>{"use strict";var{clearEmptyPropertiesInObject:Od,wrapInQuotes:wd}=pt(),Oe=null,vd=i(t=>{Oe=t.require("lodash")},"setDependencies"),wn=" (v)",Rd=i(t=>t==="VIEW","isViewByTableType"),Pd=i(t=>Oe.endsWith(t,wn),"isViewByName"),Dd=i(t=>t.slice(0,-wn.length),"removeViewNameSuffix"),Ld=i(t=>`${t}${wn}`,"setViewSuffix"),Md=i((t,e,r={})=>{let n=Oe.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${wd(t)} AS ${n}`:""},"generateCreateViewScript"),xd=i((t,e)=>{let r={withCheckOption:t.check_option!=="NONE"||Oe.isNil(t.check_option),checkTestingScope:qd(t.check_option),viewOptions:Oe.fromPairs(Oe.map(e==null?void 0:e.view_options,Fd)),temporary:(e==null?void 0:e.persistence)==="t",recursive:kd(t),description:e==null?void 0:e.description};return Od(r)},"prepareViewData"),qd=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),kd=i(t=>Oe.startsWith(Oe.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Fd=i(t=>Oe.split(t,"="),"splitByEqualitySymbol");ea.exports={setDependencies:vd,isViewByTableType:Rd,isViewByName:Pd,removeViewNameSuffix:Dd,generateCreateViewScript:Md,setViewSuffix:Ld,prepareViewData:xd}});var sa=A((LE,na)=>{"use strict";var Bd=i((t,e)=>[$d,Ud].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),$d=i((t,e)=>{var o,a,c;if(((c=(a=(o=e.primaryKey)==null?void 0:o[0])==null?void 0:a.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Kd(t,s,n),entityLevel:Qd(e)}},"reorganizePrimaryKeys"),Ud=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let a=s.compositeUniqueKey[0];return{attributes:Vd(r,a,s),entityLevel:Wd(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Kd=i((t,e,r)=>t.map(n=>n.name!==e?n:Gd(n,r)),"setAttributesPrimaryKeyData"),Gd=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:ra(e)}),"setPrimaryKeyData"),Vd=i((t,e,r)=>t.map(n=>n.name!==e?n:Hd(n,r)),"setAttributesUniqueKeyData"),Hd=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:ra(e)}),"setUniqueKeyData"),ra=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexComment:t.indexComment}],"getOptions"),Qd=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Wd=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");na.exports={reorganizeConstraints:Bd}});var Rn=A((xE,ca)=>{"use strict";var{createClient:Yd}=Io(),k=Po(),{getJsonSchema:ia}=Mo(),{setDependencies:jd,mapColumnData:zd,setSubtypeFromSampledJsonValues:Xd}=An(),{setDependencies:Zd,clearEmptyPropertiesInObject:oa}=pt(),{setDependencies:Jd,prepareForeignKeys:ef}=Bo(),{setDependencies:tf,mapFunctionData:rf,mapProcedureData:nf}=Ko(),{setDependencies:sf,checkHaveJsonTypes:of,prepareTableConstraints:af,getSampleDocSize:cf,prepareTableLevelData:uf,prepareTableIndexes:lf}=Xo(),{setDependencies:pf,getUserDefinedTypes:mf,isTypeComposite:df}=Jo(),{setDependencies:ff,isViewByTableType:hf,isViewByName:yf,removeViewNameSuffix:gf,generateCreateViewScript:Ef,setViewSuffix:_f,prepareViewData:Sf}=ta(),F=Sn(),{reorganizeConstraints:Tf}=sa(),vn=!1,J=null,ge=null,aa=14;ca.exports={setDependencies(t){J=t.require("lodash"),Zd(t),sf(t),jd(t),Jd(t),ff(t),tf(t),pf(t)},async connect(t,e,r){k.isClientInitialized()&&await this.disconnect(e);let{client:n,isSshTunnel:s}=await Yd(t,e,r);k.initializeClient(n,r),vn=s,ge=r,aa=await this._getServerVersion()},async disconnect(t){vn&&(await t.closeConsumer(),vn=!1),await k.releaseClient()},pingDb(){return k.query(F.PING)},applyScript(t){return k.query(t)},async getDatabaseNames(){return J.map(await k.query(F.GET_DATABASES),"database_name")},async logVersion(){let t=await k.queryTolerant(F.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved"},async getAllSchemasNames(){return(await k.query(F.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!Cf(e))},async getTablesNames(t){let e=await k.query(F.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!J.includes(r,n)).map(({table_name:n,table_type:s})=>hf(s)?_f(n):n)},async getDbLevelData(){var n,s,o;ge.progress("Get database data");let t=(n=await k.queryTolerant(F.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await k.queryTolerant(F.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(o=await k.queryTolerant(F.GET_DB_COLLATE_NAME,[],!0))==null?void 0:o.default_collate_name;return oa({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r){let n=await this._retrieveUserDefinedTypes(t),s=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0),o=s==null?void 0:s.oid,[a,c]=J.partition(e,yf),l=c.map(d=>({tableName:d})),u=await mt(J.uniq(l),J.bind(this._retrieveSingleTableData,this,r,o,t,n));return{views:await mt(a,J.bind(this._retrieveSingleViewData,this,o,t)),tables:u,modelDefinitions:ia(n)}},async retrieveSchemaLevelData(t,e){var u;if(e)return ge.info("Functions and procedures ignored"),{functions:[],procedures:[]};ge.progress("Get Functions and Procedures",t);let r=(u=await k.queryTolerant(F.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,n=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await k.queryTolerant(Af(aa),[r]),[o,a]=J.partition(J.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await mt(o,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),f=J.find(s,{function_name:p.name});return rf(p,d,f)}),l=await mt(a,async p=>{let d=await k.queryTolerant(F.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),f=J.find(s,{function_name:p.name});return nf(p,d,f)});return{functions:c,procedures:l}},async _retrieveUserDefinedTypes(t){ge.progress("Get User-Defined Types",t);let e=await k.queryTolerant(F.GET_USER_DEFINED_TYPES,[t]),r=await mt(e,async n=>df(n)?{...n,columns:await k.queryTolerant(F.GET_COMPOSITE_TYPE_COLUMNS,[n.pg_class_oid])}:n);return mf(r)},async _retrieveSingleTableData(t,e,r,n,{tableName:s}){ge.progress("Get table data",r,s);let o=await k.queryTolerant(F.GET_TABLE_LEVEL_DATA,[s,e],!0),a=o==null?void 0:o.oid,c=await k.queryTolerant(F.GET_TABLE_TOAST_OPTIONS,[s,e],!0),l=await this._getTableColumns(s,r,a),p=await k.queryTolerant(F.GET_DESCRIPTION_BY_OID,[a,"pg_class"],!0),d=await k.queryTolerant(F.GET_TABLE_CONSTRAINTS,[a]),f=await k.queryTolerant(F.GET_TABLE_INDEXES,[a]),h=await k.queryTolerant(F.GET_TABLE_INDEX_PARTITIONING_DATA,[a]),S=await k.queryTolerant(F.GET_TABLE_INDEX_CREATE_INFO,[a]),y=await k.queryTolerant(F.GET_TABLE_FOREIGN_KEYS,[a]);ge.info("Table data retrieved",{schemaName:r,tableName:s,columnTypes:l.map(_e=>_e.data_type)});let T=uf(o,c),E=Nf(p),P=af(d,l,f),N=lf({tableIndexesResult:f,tableIndexesCreateInfoResult:S,tableIndexesPartitioningResult:h}),w=ef(y,s,r,l),D={description:E,Indxs:N,...T,...P},C=oa(D),b=l.map(zd(n)),q=of(b),B=[];q&&(B=await this._getDocuments(r,s,b,t),b=Xd(b,B));let{attributes:W,entityLevel:Ee}=Tf(b,C);return{name:s,entityLevel:Ee,jsonSchema:ia(W),documents:B,relationships:w}},async _getTableColumns(t,e,r){ge.progress("Get columns",e,t);let n=await k.query(F.GET_TABLE_COLUMNS,[t,e]),s=await k.queryTolerant(F.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return J.map(n,o=>({...o,ordinal_position:Number(o.ordinal_position),...J.find(s,{name:o.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;ge.progress("Sampling table",t,e);let s=`${t}.${e}`,o=((p=await k.queryTolerant(F.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,a=cf(o,n),c=r.filter(({type:d})=>J.includes(["json","jsonb"],d)),l=J.map(c,"name").join(", "),u=await k.queryTolerant(F.GET_SAMPLED_DATA_SIZE(s,l),[a],!0);return ge.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:u==null?void 0:u._hackolade_tmp_sampling_tbl_size}),await k.queryTolerant(F.GET_SAMPLED_DATA(s,l),[a])},async _retrieveSingleViewData(t,e,r){ge.progress("Get view data",e,r),r=gf(r);let n=await k.query(F.GET_VIEW_DATA,[r,e],!0),s=!n.view_definition&&await k.queryTolerant(F.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),o=await k.queryTolerant(F.GET_VIEW_OPTIONS,[r,t],!0),a=Ef(r,n,s),c=Sf(n,o);return a?{name:r,data:c,ddl:{script:a,type:"postgres"}}:(ge.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:c,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await k.queryTolerant(F.GET_VERSION_AS_NUM,[],!0),e=J.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var Cf=i(t=>!!(J.startsWith(t,"pg_")||J.includes(["information_schema"],t)),"isSystemSchema"),Af=i(t=>t===10?F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:F.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),Nf=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),mt=i((t,e)=>Promise.all(J.map(t,e)),"mapPromises")});var la=A((kE,ua)=>{"use strict";var{createLogger:xt}=Gt(),X=Rn();ua.exports={async disconnect(t,e,r,n){let s=n.require("@hackolade/ssh-service");await X.disconnect(s),r()},async testConnection(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Pn("Test connection",t,e);let o=xt({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s,o),await X.pingDb(),await X.logVersion(),r()}catch(o){e.log("error",ke(o),"Test connection instance log"),r(ke(o))}finally{await X.disconnect(s)}},async getDatabases(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Pn("Get databases",t,e);let o=xt({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s,o),await X.logVersion();let a=await X.getDatabaseNames();return e.log("info",a,"All databases list",t.hiddenKeys),r(null,a)}catch(o){return e.log("error",o),r(ke(o))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Pn("Get DB table names",t,e);let o=xt({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});X.setDependencies(n),await X.connect(t,s,o),await X.logVersion();let c=await(await X.getAllSchemasNames()).reduce(async(l,u)=>{let p=await l;try{let d=await X.getTablesNames(u);return p.concat({dbName:u,dbCollections:d,isEmpty:d.length===0})}catch(d){return o.info(`Error reading database "${u}"`),o.error(d),p.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(o){e.log("error",ke(o),"Get DB collections names"),r(ke(o)),await X.disconnect(s)}},async getDbCollectionsData(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let o=xt({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});o.progress("Start reverse engineering...");let a=t.collectionData.collections,c=t.collectionData.dataBaseNames,l=await X.getDbLevelData(),{packages:u,relationships:p}=await Promise.all(c.map(async d=>{let{tables:f,views:h,modelDefinitions:S}=await X.retrieveEntitiesData(d,a[d],t.recordSamplingSettings),{functions:y,procedures:T}=await X.retrieveSchemaLevelData(d,t.ignoreUdfUdpTriggers);return o.progress("Schema data fetched successfully",d),{schemaName:d,tables:f,views:h,functions:y,procedures:T,modelDefinitions:S}})).then(d=>{let f=d.flatMap(({tables:S})=>S.map(y=>y.relationships)).flat();return{packages:d.flatMap(({schemaName:S,tables:y,views:T,functions:E,procedures:P,modelDefinitions:N})=>{let w={UDFs:E,Procedures:P},D=y.map(C=>({dbName:S,collectionName:C.name,documents:C.documents,views:[],emptyBucket:!1,entityLevel:C.entityLevel,validation:{jsonSchema:C.jsonSchema},bucketInfo:w,modelDefinitions:N})).sort(C=>n.require("lodash").isEmpty(C.entityLevel.inherits)?-1:1);if(T!=null&&T.length){let C={dbName:S,views:T,emptyBucket:!1};return[...D,C]}return D}),relationships:f}}).then(({packages:d,relationships:f})=>({packages:bf(d),relationships:f}));o.info("The data is processed and sent to the application",{packagesLength:u==null?void 0:u.length,relationshipsLength:p==null?void 0:p.length}),r(null,u,l,p)}catch(o){e.log("error",ke(o),"Retrieve tables data"),r(ke(o))}finally{await X.disconnect(s)}}};var ke=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Pn=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),bf=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var ma=A((BE,pa)=>{"use strict";var qt=Rn(),If=i(async(t,e,r)=>{try{let n=r.require("@hackolade/ssh-service");qt.setDependencies(r),await qt.connect(t,n,e),await qt.logVersion(),await qt.applyScript(Of(t.script))}catch(n){throw e.error(n),wf(n)}},"applyToInstance"),Of=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),wf=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");pa.exports={applyToInstance:If}});var ne=A((UE,da)=>{"use strict";var Mn=class Mn{script;isDropScript};i(Mn,"ModificationScript");var Dn=Mn,xn=class xn{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(o=>({isDropScript:n,script:o}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(xn,"AlterScriptDto");var Ln=xn;da.exports={ModificationScript:Dn,AlterScriptDto:Ln}});var ze=A((GE,fa)=>{"use strict";var Kn=class Kn{id;constraintName;indexStorageParameters;indexInclude};i(Kn,"AlterCollectionColumnPrimaryKeyOptionDto");var qn=Kn,Gn=class Gn{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(Gn,"AlterCollectionColumnDto");var kn=Gn,Vn=class Vn extends qn{compositePrimaryKey};i(Vn,"AlterCollectionRoleCompModPKDto");var Fn=Vn,Hn=class Hn{new;old};i(Hn,"AlterCollectionRoleCompModPrimaryKey");var Bn=Hn,Qn=class Qn{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;bucketId;compMod;name;roleType;patternProperties};i(Qn,"AlterCollectionRoleDto");var $n=Qn,Wn=class Wn{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(Wn,"AlterCollectionDto");var Un=Wn;fa.exports={AlterCollectionDto:Un,AlterCollectionRoleDto:$n,AlterCollectionColumnDto:kn,AlterCollectionRoleCompModPrimaryKey:Bn,AlterCollectionRoleCompModPKDto:Fn}});var ya=A((HE,ha)=>{"use strict";var vf=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),Rf=Object.values(vf);ha.exports={ReservedWordsAsArray:Rf}});var x=A((YE,ga)=>{"use strict";var{AlterCollectionDto:QE,AlterCollectionRoleDto:WE}=ze(),{ReservedWordsAsArray:Pf}=ya(),Df=/\t|\n|'|\f|\r/gm;ga.exports=t=>{let e=i(g=>t.get(g,"[0].code")||t.get(g,"[0].name",""),"getDbName"),r=i(g=>g&&(g.code||g.collectionName)||"","getEntityName"),n=i(g=>g&&(g.code||g.name)||"","getViewName"),s=i(g=>Object.assign({},t.get(g,"[0]",{}),{name:e(g)}),"getDbData"),o=i(g=>t.get(g,"[0].viewOn"),"getViewOn"),a=i((g,O="	")=>g.split(`
`).map(M=>O+M).join(`
`),"tab"),c=i((g,O)=>Object.keys(g).map(t.toLower).includes(t.toLower(O)),"hasType"),l=i(g=>({...g,...t.omit(g==null?void 0:g.role,"properties")||{}}),"getSchemaOfAlterCollection"),u=i(g=>{var $;let O=r(g),M=($=g.compMod)==null?void 0:$.keyspaceName;return B(O,M)},"getFullCollectionName"),p=i(g=>Object.entries(g).filter(([O,M])=>!t.isNil(M)).reduce((O,[M,$])=>({...O,[M]:$}),{}),"clean"),d=i(g=>g.every(O=>t.get(O,"isActivated",!0)),"checkAllKeysActivated"),f=i(g=>g.length?g.every(O=>!t.get(O,"isActivated",!0)):!1,"checkAllKeysDeactivated"),h=i((g,O)=>{let M=g.filter(Y=>t.get(Y,"isActivated",!0)).map(O),$=g.filter(Y=>!t.get(Y,"isActivated",!0)).map(O);return{activatedItems:M,deactivatedItems:$}},"divideIntoActivatedAndDeactivated"),S=i((g,{isActivated:O,isPartOfLine:M,inlineComment:$="--"})=>g?O!==!1?g:M?"/* "+g+" */":g.includes(`
`)?`/*
`+g+` */
`:$+" "+g:"","commentIfDeactivated"),y=i((g,O="'",M="'")=>{let $=g[0];return g[g.length-1]===O&&$===M?g:`${O}${g}${M}`},"wrap"),T=i((g,O)=>O.some(M=>(g==null?void 0:g.oldField[M])!==(g==null?void 0:g.newField[M])),"checkFieldPropertiesChanged"),E=i(g=>{var Y;let O={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},M=r(O),$=(Y=O.compMod)==null?void 0:Y.keyspaceName;return B(M,$)},"getFullTableName"),P=i((g,O)=>`${E(g)}.${W(O)}`,"getFullColumnName"),N=i(g=>{var Y;let O={...g,...t.omit(g==null?void 0:g.role,"properties")||{}},M=n(O),$=(Y=O.compMod)==null?void 0:Y.keyspaceName;return B(M,$)},"getFullViewName"),w=i(g=>g.code||g.name,"getUdtName"),D=i((g="")=>{let O=g.match(/\d+/);return Number(t.get(O,[0],0))},"getDbVersion"),C=i((g="")=>g.replace(Df,O=>`\\${O}`),"prepareComment"),b=i(g=>`E'${C(JSON.stringify(g)).slice(1,-1)}'`,"wrapComment"),q=i(g=>t.map(g,O=>{let M=O.defaultExpression?`DEFAULT ${O.defaultExpression}`:"";return t.trim(`${O.argumentMode} ${O.argumentName||""} ${O.argumentType} ${M}`)}).join(", "),"getFunctionArguments"),B=i((g,O)=>O?`${W(O)}.${W(g)}`:W(g),"getNamePrefixedWithSchemaName"),W=i(g=>/\s|\W/.test(g)||t.includes(Pf,t.toUpper(g))?`"${g}"`:g,"wrapInQuotes"),Ee=i(({name:g})=>W(g),"columnMapToString"),_e=i((g,O,M,$=Ee)=>{var m;let Y=h(g,$),U=(m=Y==null?void 0:Y.deactivatedItems)!=null&&m.length?S(Y.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!O&&M?" ("+Y.activatedItems.join(", ")+U+")":" ("+g.map($).join(", ")+")"},"getColumnsList"),Te=i(g=>g?g.alias?`${W(g.name)} as ${W(g.alias)}`:W(g.name):"","getKeyWithAlias");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:o,tab:a,hasType:c,clean:p,checkAllKeysActivated:d,checkAllKeysDeactivated:f,divideIntoActivatedAndDeactivated:h,commentIfDeactivated:S,wrap:y,checkFieldPropertiesChanged:T,getFullTableName:E,getFullColumnName:P,getFullViewName:N,getUdtName:w,getDbVersion:D,wrapComment:b,getFunctionArguments:q,getNamePrefixedWithSchemaName:B,wrapInQuotes:W,getColumnsList:_e,getViewData:i(g=>Array.isArray(g)?g.reduce((O,M)=>{if(!M.tableName)return O.columns.push(Te(M)),O;let $=`${W(M.dbName)}.${W(M.tableName)}`;return O.tables.includes($)||O.tables.push($),O.columns.push({statement:`${$}.${Te(M)}`,isActivated:M.isActivated}),O},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getSchemaOfAlterCollection:l,getFullCollectionName:u}}});var Ta=A((zE,Sa)=>{"use strict";var{AlterScriptDto:Ea}=ne(),_a=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Lf=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=x()(t),o=_a(r);if(o.new&&o.new!==o.old){let a=n(o.new),c=s(r.role.name),l=e.updateSchemaComment(c,a);return Ea.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),Mf=i((t,e)=>r=>{let{wrapInQuotes:n}=x()(t),s=_a(r);if(s.old&&!s.new){let o=n(r.role.name),a=e.dropSchemaComment(o);return Ea.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),xf=i((t,e)=>r=>{let n=Lf(t,e)(r),s=Mf(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");Sa.exports={getModifySchemaCommentsScriptDtos:xf}});var Aa=A((ZE,Ca)=>{"use strict";Ca.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var ba=A((JE,Na)=>{"use strict";Na.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},int:{},int2:{},int4:{},decimal:{},float:{},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var Oa=A((e_,Ia)=>{"use strict";Ia.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${collate}${characterClassification};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",generatedColumnClause:" GENERATED ALWAYS AS (${generationExpression}) STORED",columnDefinition:"${name} ${type}${collation}${generatedColumnClause}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})${notValid}",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON ${tableName}${using}${keys}${options};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}"}});var Ra=A((t_,va)=>{"use strict";var wa=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),qf=i(t=>t.match(wa("gi"))||[],"getAllTemplates"),kf=i(t=>(t.match(wa("i"))||[])[1],"parseTemplate"),Ff=i((t,e)=>qf(t).reduce((r,n)=>{let s=kf(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");va.exports=Ff});var Da=A((n_,Pa)=>{"use strict";var Bf=i(({index:t,numberOfStatements:e,lastIndexOfActivatedStatement:r,delimiter:n})=>{let s=t===e-1,o=t===r;return s?"":o?" --"+n:n},"getDelimiter"),$f=i(({statements:t=[],delimiter:e=",",indent:r=`
`})=>{let n=t.findLastIndex(o=>!o.startsWith("--")),s=t.length;return t.map((o,a)=>{let c=Bf({index:a,numberOfStatements:s,lastIndexOfActivatedStatement:n,delimiter:e});return o+c}).join(r)},"joinActivatedAndDeactivatedStatements");Pa.exports={joinActivatedAndDeactivatedStatements:$f}});var Ma=A((i_,La)=>{"use strict";La.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:o})=>({generateConstraintsString:i((f,h)=>{var E,P;let S=e(((f==null?void 0:f.deactivatedItems)||[]).join(`,
	`),{isActivated:!h,isPartOfLine:!0}),y=(E=f==null?void 0:f.activatedItems)!=null&&E.length?`,
	`+f.activatedItems.join(`,
	`):"",T=(P=f==null?void 0:f.deactivatedItems)!=null&&P.length?`
	`+S:"";return y+T},"generateConstraintsString"),foreignKeysToString:i(f=>{if(Array.isArray(f)){let h=f.filter(T=>t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),S=f.filter(T=>!t.get(T,"isActivated",!0)).map(T=>s(t.trim(T.name))),y=S.length?e(S,{isActivated:!1,isPartOfLine:!0}):"";return h.join(", ")+y}return f},"foreignKeysToString"),foreignActiveKeysToString:i(f=>f.map(h=>t.trim(h.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((f,h)=>S=>{let y=s(t.trim(S.name)),T=r(S.columns||[]),E=t.isEmpty(S.columns)?"":o(S.columns,T,h),P=S.include.length?` INCLUDE${o(S.include,T,h)}`:"",N=S.storageParameters?` WITH (${S.storageParameters})`:"";return{statement:n(f.createKeyConstraint,{constraintName:S.name?`CONSTRAINT ${y} `:"",keyType:S.keyType,columns:E,includeNonKey:P,storageParameters:N}),isActivated:!T}},"createKeyConstraint"),getConstraintsWarnings:i((f=[])=>t.isEmpty(f)?"":`
	`+f.map(h=>{let S=h.name?` [constraint name: ${h.name}]`:"";return`-- ${h.errorMessage}${S}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(f=>{let h=t.get(f,"relationshipOnDelete",""),S=t.get(f,"relationshipOnUpdate",""),y=t.get(f,"relationshipMatch","");return{foreignOnDelete:h,foreignOnUpdate:S,foreignMatch:y}},"additionalPropertiesForForeignKey")})});var qa=A((a_,xa)=>{"use strict";xa.exports=(t,e)=>{let r=i((y,T)=>Object.entries(y.properties).map(T),"mapProperties"),n=i(y=>y.compositeUniqueKey?!1:!!y.unique,"isUniqueKey"),s=i(y=>{var T,E;return n(y)&&(((T=y.uniqueKeyOptions)==null?void 0:T.length)===1&&!((E=t.first(y.uniqueKeyOptions))!=null&&E.constraintName)||t.isEmpty(y.uniqueKeyOptions))},"isInlineUnique"),o=i(y=>y.compositeUniqueKey||y.compositePrimaryKey?!1:!!y.primaryKey,"isPrimaryKey"),a=i(y=>{var T;return o(y)&&!((T=t.first(y.primaryKeyOptions))!=null&&T.constraintName)},"isInlinePrimaryKey"),c=i(({options:y,columnName:T,isActivated:E,jsonSchema:P,dbVersion:N})=>e({keyType:"UNIQUE",name:y.constraintName,columns:[{name:T,isActivated:E}],include:d(y.indexInclude||[],P),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydrateUniqueOptions"),l=i((y,T,E,P)=>e({keyType:"PRIMARY KEY",name:y.constraintName,columns:[{name:T,isActivated:E}],include:d(y.indexInclude||[],P),storageParameters:y.indexStorageParameters,comment:y.indexComment}),"hydratePrimaryKeyOptions"),u=i((y,T)=>Object.keys(T).find(E=>T[E].GUID===y),"findName"),p=i((y,T)=>t.get(Object.values(T).find(E=>E.GUID===y),"isActivated",!0),"checkIfActivated"),d=i((y,T)=>t.map(y,E=>({name:u(E.keyId,T.properties),isActivated:p(E.keyId,T.properties)})),"getKeys"),f=i(y=>Array.isArray(y.primaryKey)?y.primaryKey.map(T=>t.isEmpty(T.compositePrimaryKey)?{name:T.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...l(T,null,null,y),columns:d(T.compositePrimaryKey,y)}):[],"getCompositePrimaryKeys"),h=i((y,T)=>Array.isArray(y.uniqueKey)?y.uniqueKey.map(E=>t.isEmpty(E.compositeUniqueKey)?{name:E.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...c({options:E,columnName:null,isActivated:null,jsonSchema:y,dbVersion:T}),columns:d(E.compositeUniqueKey,y)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i((y,T)=>{if(!y.properties)return[];let E=r(y,([N,w])=>{if(!(!o(w)||a(w)))return l(t.first(w.primaryKeyOptions),N,w.isActivated,y)}).filter(Boolean),P=t.flatten(r(y,([N,w])=>!n(w)||s(w)?[]:(w.uniqueKeyOptions||[]).map(D=>c({options:D,columnName:N,isActivated:w.isActivated,jsonSchema:y,dbVersion:T})))).filter(Boolean);return[...E,...f(y),...P,...h(y,T)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:a,getKeys:d,hydratePrimaryKeyOptions:l,hydrateUniqueOptions:c}}});var Fa=A((u_,ka)=>{"use strict";ka.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=i((N,w)=>t.map(w,D=>{let C=D.functionOrReplace?" OR REPLACE":"",b=r(e.createFunction,{name:s(D.name,N),orReplace:C,parameters:n(D.functionArguments),returnType:D.functionReturnsSetOf?`SETOF ${D.functionReturnType}`:D.functionReturnType,language:D.functionLanguage,properties:c(D),definition:D.functionBody}),q=D.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(D.name,N),comment:o(D.functionDescription)}):"";return[b,q].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(N=>{let w=i(D=>D?`	${D}
`:"","wrap");return[{key:"functionWindow",getValue:l},{key:"functionVolatility",getValue:u},{key:"functionLeakProof",getValue:p},{key:"functionNullArgs",getValue:d},{key:"functionSqlSecurity",getValue:f},{key:"functionParallel",getValue:h},{key:"functionExecutionCost",getValue:S},{key:"functionExecutionRows",getValue:y},{key:"functionSupportFunction",getValue:T},{key:"functionConfigurationParameters",getValue:E}].map(D=>w(D.getValue(N[D.key],N))).filter(Boolean).join("")},"getProperties"),l=i((N,w)=>w.language!=="c"||!N?"":"WINDOW","getWindow"),u=i(N=>N,"getVolatility"),p=i(N=>N?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),d=i(N=>N,"getNullArgs"),f=i(N=>{if(N)return`SECURITY ${N}`},"getSqlSecurity"),h=i(N=>{if(N)return`PARALLEL ${N}`},"getParallel"),S=i(N=>{if(N)return`COST ${N}`},"getExecutionCost"),y=i((N,w)=>!N||!w.functionReturnsSetOf&&!P(w)?"":`ROWS ${N}`,"getExecutionRows"),T=i(N=>{if(N)return`SUPPORT ${N}`},"getSupportFunction"),E=i(N=>{if(N)return`SET ${N}`},"getConfigurationParameters"),P=i(N=>(N.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:a}}});var $a=A((p_,Ba)=>{"use strict";Ba.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((a,c)=>t.map(c,l=>{let u=l.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(l.name,a),orReplace:u,parameters:n(l.inputArgs),language:l.language,body:l.body})}).join(`
`),"getProceduresScript")})});var Ka=A((d_,Ua)=>{"use strict";Ua.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,d)=>p?" TEMPORARY":d?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let d=i(h=>h?`${h}
`:"","wrap"),f=[{key:"inherits",getValue:l("INHERITS")},{key:"partitionBounds",getValue:l("")},{key:"partitioning",getValue:o},{key:"usingMethod",getValue:l("USING")},{key:"storage_parameter",getValue:u},{key:"on_commit",getValue:c},{key:"selectStatement",getValue:l("AS")}].map(h=>d(h.getValue(p[h.key],p))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),o=i((p,{isActivated:d})=>{if(p&&p.partitionMethod){let h=a(p,d)+` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${h}`}},"getPartitioning"),a=i((p,d)=>{let f=r(p.compositePartitionKey);return e(p.compositePartitionKey,f,d)},"getPartitionKeys"),c=i((p,d)=>{if(p&&d.temporary)return`ON COMMIT ${p}`},"getOnCommit"),l=i(p=>d=>{if(d)return`${p} ${d}`},"getBasicValue"),u=i(p=>{if(t.isEmpty(p))return"";let d=["ttl_storage_parameters"],f=["id",...d];return t.chain(p).toPairs().flatMap(([h,S])=>d.includes(h)?t.toPairs(S):[[h,S]]).reject(([h])=>t.includes(f,h)).map(([h,S])=>{if(!(!S&&S!==0))return`${h}=${S}`}).compact().join(`,
	`).trim().thru(h=>{if(h)return`WITH (
	${h}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var Va=A((h_,Ga)=>{"use strict";Ga.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:o})=>{let a=["composite","enum","range_udt","domain"],c=i((h,S)=>{let y=s(h.name,h.schemaName),T=r(n.comment,{object:"TYPE",objectName:y,comment:o(h.comment)});switch(h.type){case"composite":return r(n.createCompositeType,{name:y,columnDefinitions:t.join(S,`,
	`),comment:h.comment?T:""});case"enum":return r(n.createEnumType,{name:y,values:t.map(h.enum,E=>`'${E}'`).join(", "),comment:h.comment?T:""});case"range_udt":return r(n.createRangeType,{name:y,subtype:h.rangeSubtype,options:u(h),comment:h.comment?T:""});case"domain":{let E=r(n.comment,{object:"DOMAIN",objectName:y,comment:o(h.comment)});return r(n.createDomainType,{name:y,underlyingType:h.underlyingType,notNull:h.nullable?"":" NOT NULL",collate:h.collation?`
	COLLATE ${h.collation}`:"",default:h.default?`
	DEFAULT ${h.default}`:"",constraints:p(h),comment:h.comment?E:""})}default:return""}},"getPlainUdt"),l=i(h=>a.includes(h.type),"isNotPlainType"),u=i(h=>{let S=i(T=>T?`	${T}`:"","wrap"),y=[{key:"operatorClass",getValue:d("SUBTYPE_OPCLASS")},{key:"collation",getValue:d("COLLATION")},{key:"canonicalFunction",getValue:d("CANONICAL")},{key:"subtypeDiffFunction",getValue:d("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:d("MULTIRANGE_TYPE_NAME")}].map(T=>S(T.getValue(h[T.key]))).filter(Boolean).join(`,
`);return t.trim(y)?`,
	`+t.trim(y):""},"getRangeOptions"),p=i(h=>t.map(h.checkConstraints,S=>S.name?`
	CONSTRAINT ${S.name} CHECK (${S.expression})`:`
	CHECK (${S.expression})`).join(""),"getDomainConstraints"),d=i(h=>S=>{if(S)return`${h}=${S}`},"getBasicValue");return{getUserDefinedType:i((h,S)=>e(c(h,S),{isActivated:h.isActivated}),"getUserDefinedType"),isNotPlainType:l}}});var Qa=A((g_,Ha)=>{"use strict";Ha.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:u,sortOrder:p,nullsOrder:d,opclass:f})=>{let h=p?` ${p}`:"",S=d?` ${d}`:"",y=f?` ${f}`:"";return`${e(u)}${y}${h}${S}`},"mapIndexKey"),o=i((u=[],p)=>{let d=r(u);return n(u,d,p,s)},"getIndexKeys"),a=i((u,p)=>{var w;let d=n(u.include||[],r(u.include||[]),p),f=["btree"],h=u.using_hash&&f.includes(u.index_method)?" USING HASH":"",S=(w=u.include)!=null&&w.length?` INCLUDE ${t.trim(d)}`:"",y=u.partitioning_expression||"",T=c(u),E=T?` WITH (
	${T})`:"",P=u.where?` WHERE ${u.where}`:"",N=u.visibility?` ${u.visibility}`:"";return t.compact([" ",h,S,y,E,P,N]).join(`
`)},"getIndexOptions"),c=i(u=>{let p=["id"];return t.chain(u.index_storage_parameter).toPairs().map(([d,f])=>{if(!(p.includes(d)||t.isNil(f)||f===""))return`${d}=${l(f)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(u=>t.isBoolean(u)?u?"ON":"OFF":u,"getValue");return{getIndexKeys:o,getIndexOptions:a}}});var Ya=A((__,Wa)=>{"use strict";Wa.exports=({_:t,assignTemplates:e,templates:r,commentIfDeactivated:n,wrapComment:s,wrapInQuotes:o})=>{let a=i((C,b)=>`${C}(${b})`,"addLength"),c=i((C,b,q)=>t.isNumber(q)?`${C}(${b},${q})`:`${C}(${b})`,"addScalePrecision"),l=i((C,b)=>t.isNumber(b)?`${C}(${b})`:C,"addPrecision"),u=i((C,b)=>b?`${C} ${b}`:C,"addWithTimezone"),p=i(({type:C,typeModifier:b,srid:q})=>{let B=q?`, ${q}`:"";return b&&b!==""?`${C}(${b}${B})`:C},"addTypeModifier"),d=i((C,b)=>{let q=(b==null?void 0:b.map(B=>`[${(B==null?void 0:B.array_size_limit)??""}]`).join("").trim())||"";return`${C}${q}`},"addArrayDecorator"),f=i(C=>["char","varchar","bit","varbit"].includes(C),"canHaveLength"),h=i(C=>["numeric","decimal"].includes(C),"canHavePrecision"),S=i(C=>["time","timestamp"].includes(C),"canHaveTimePrecision"),y=i(C=>["numeric","decimal"].includes(C),"canHaveScale"),T=i(C=>["geography","geometry"].includes(C),"canHaveTypeModifier"),E=i((C,b)=>(f(C)&&t.isNumber(b.length)?C=a(C,b.length):h(C)&&y(C)&&t.isNumber(b.precision)?C=c(C,b.precision,b.scale):h(C)&&t.isNumber(b.precision)?C=l(C,b.precision):T(C)?C=p({type:C,typeModifier:b.typeModifier,srid:b.srid}):S(C)&&(t.isNumber(b.timePrecision)||b.timezone)&&(C=u(l(C,b.timePrecision),b.timezone)),d(C,b.array_type)),"decorateType"),P=i(C=>["char","varchar","text","bit","varbit"].includes(C),"isString"),N=i(C=>["date","time","timestamp","interval"].includes(C),"isDateTime");return{decorateType:E,decorateDefault:i((C,b,q)=>{let B=["current_timestamp","current_user","null"];return(P(C)||N(C))&&!B.includes(t.toLower(b))&&!q?s(b):b},"decorateDefault"),getColumnComments:i((C,b)=>t.chain(b).filter("comment").map(q=>{let B=e(r.comment,{object:"COLUMN",objectName:`${C}.${o(q.name)}`,comment:s(q.comment)});return n(B,q)}).join(`
`).value(),"getColumnComments")}}});var ee=A((T_,za)=>{"use strict";var Uf=Aa(),ja=ba(),R=Oa();za.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:o,checkAllKeysDeactivated:a,divideIntoActivatedAndDeactivated:c,hasType:l,wrap:u,clean:p,wrapComment:d,getFunctionArguments:f,wrapInQuotes:h,getNamePrefixedWithSchemaName:S,getColumnsList:y,getViewData:T}=x()(n),E=Ra(),{joinActivatedAndDeactivatedStatements:P}=Da(),{generateConstraintsString:N,foreignKeysToString:w,foreignActiveKeysToString:D,createKeyConstraint:C,getConstraintsWarnings:b,additionalPropertiesForForeignKey:q}=Ma()({_:n,commentIfDeactivated:o,checkAllKeysDeactivated:a,assignTemplates:E,getColumnsList:y,wrapInQuotes:h}),B=qa()(n,p),{getFunctionsScript:W}=Fa()({_:n,templates:R,assignTemplates:E,getFunctionArguments:f,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getProceduresScript:Ee}=$a()({_:n,templates:R,assignTemplates:E,getFunctionArguments:f,getNamePrefixedWithSchemaName:S}),{getTableTemporaryValue:_e,getTableOptions:Te}=Ka()({_:n,checkAllKeysDeactivated:a,getColumnsList:y}),{getUserDefinedType:we,isNotPlainType:g}=Va()({_:n,commentIfDeactivated:o,assignTemplates:E,templates:R,getNamePrefixedWithSchemaName:S,wrapComment:d}),{getIndexKeys:O,getIndexOptions:M}=Qa()({_:n,wrapInQuotes:h,checkAllKeysDeactivated:a,getColumnsList:y}),{decorateType:$,decorateDefault:Y,getColumnComments:U}=Ya()({_:n,wrap:u,assignTemplates:E,templates:R,commentIfDeactivated:o,wrapInQuotes:h,wrapComment:d});return{createDatabase(m){if(!m.databaseName)return"";let{collate:_,characterClassification:I}=m;return E(R.createDatabase,{name:h(m.databaseName),template:m.template?`
	TEMPLATE ${m.template}`:"",encoding:m.encoding?`
	ENCODING = '${m.encoding}'`:"",collate:_?`
	LC_COLLATE = '${m.collate}'`:"",characterClassification:I?`
	LC_CTYPE = '${I}'`:""})},createSchema({schemaName:m,ifNotExist:_,comments:I,udfs:v,procedures:K}){let re=E(R.comment,{object:"SCHEMA",objectName:h(m),comment:d(I)}),Z=E(R.createSchema,{name:h(m),ifNotExist:_?" IF NOT EXISTS":"",comment:I?re:""}),j=W(m,v),se=Ee(m,K);return n.chain([Z,j,se]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:m,columns:_,checkConstraints:I,foreignKeyConstraints:v,schemaData:K,columnDefinitions:re,keyConstraints:Z,inherits:j,description:se,ifNotExist:ue,usingMethod:de,on_commit:z,partitioning:me,storage_parameter:Ce,temporary:Ae,unlogged:Se,selectStatement:Ne,partitionOf:ae,partitionBounds:Pe},be){let ft=ue?" IF NOT EXISTS":"",Be=S(m,K.schemaName),ht=E(R.comment,{object:"TABLE",objectName:Be,comment:d(se)}),fe=c(Z.filter(({errorMessage:Le})=>!Le).map(C(R,be)),Le=>Le.statement),Kt=b(Z.filter(({errorMessage:Le})=>Le)),De=`${N(fe,be)}${Kt}`,qs=ae?De==null?void 0:De.slice(1):De,Jc=c(v,Le=>Le.statement),ks=N(Jc,be),eu=`
`+U(Be,re),tu=ae?R.createTablePartitionOf:R.createTable,ru=ae&&!De?`
	`:`,
	`,Fs=n.isEmpty(I)?"":u(n.join(I,`,
	`),ru,""),Bs=ae&&!qs&&!Fs&&!ks,nu=Bs?"":"(",su=Bs?"":")",iu=P({statements:_,indent:`
	`}),ou=E(tu,{temporary:_e(Ae,Se),ifNotExist:ft,name:Be,columnDefinitions:ae?"":"	"+iu,keyConstraints:qs,checkConstraints:Fs,foreignKeyConstraints:ks,options:Te({inherits:j,partitioning:me,usingMethod:de,on_commit:z,storage_parameter:Ce,selectStatement:Ne,partitionBounds:Pe}),comment:se?ht:"",partitionOf:ae?` PARTITION OF ${ae} `:"",columnDescriptions:eu,openParenthesis:nu,closeParenthesis:su});return o([ou].map(n.trim).join(`

`).trim()+`
`,{isActivated:be})},convertColumnDefinition(m){let _=m.nullable?"":" NOT NULL",I=m.primaryKey?" "+C(R,!0)(m.primaryKeyOptions).statement:"",v=m.unique?" "+C(R,!0)(m.uniqueKeyOptions).statement:"",K=m.collationRule?` COLLATE "${m.collationRule}"`:"",re=Array.isArray(m.array_type)&&m.array_type.length>0,Z=n.isUndefined(m.default)?"":" DEFAULT "+Y(m.type,m.default,re),j=m.dbVersion>=12&&m.generatedColumn&&m.columnGenerationExpression?E(R.generatedColumnClause,{generationExpression:m.columnGenerationExpression}):"";return o(E(R.columnDefinition,{name:h(m.name),type:$(m.type,m),generatedColumnClause:j,notNull:_,primaryKey:I,uniqueKey:v,collation:K,defaultValue:Z}),{isActivated:m.isActivated})},createIndex(m,_,I,v=!0){let K=_.unique&&_.index_method==="btree",re=h(_.indxName),Z=K?" UNIQUE":"",j=_.concurrently?" CONCURRENTLY":"",se=_.ifNotExist?" IF NOT EXISTS":"",ue=_.index_method?` USING ${n.toUpper(_.index_method)}`:"",de=O(_.index_method==="btree"?_.columns:n.map(_.columns,me=>n.omit(me,"sortOrder","nullsOrder")),v),z=M(_,v);return o(E(R.index,{unique:Z,concurrently:j,ifNotExist:se,name:re,using:ue,keys:de,options:z,tableName:S(m,_.schemaName)}),{isActivated:_.isActivated})},createCheckConstraint(m){return E(R.checkConstraint,{name:m.name?`CONSTRAINT ${h(m.name)}`:"",expression:n.trim(m.expression).replace(/^\(([\s\S]*)\)$/,"$1"),notValid:m.notValid?" NOT VALID":""})},createForeignKeyConstraint({name:m,foreignKey:_,primaryTable:I,primaryKey:v,primaryTableActivated:K,foreignTableActivated:re,foreignSchemaName:Z,primarySchemaName:j,customProperties:se,isActivated:ue},de,z){let me=a(v),Ce=a(_),Ae=!me&&!Ce&&K&&re,{foreignOnDelete:Se,foreignOnUpdate:Ne,foreignMatch:ae}=q(se),Pe=E(R.createForeignKeyConstraint,{primaryTable:S(I,j||z.schemaName),name:m?`CONSTRAINT ${h(m)}`:"",foreignKey:Ae?w(_):D(_),primaryKey:Ae?w(v):D(v),onDelete:Se?` ON DELETE ${Se}`:"",onUpdate:Ne?` ON UPDATE ${Ne}`:"",match:ae?` MATCH ${ae}`:""});return{statement:n.trim(Pe),isActivated:Ae&&ue}},createForeignKey({name:m,foreignTable:_,foreignKey:I,primaryTable:v,primaryKey:K,primaryTableActivated:re,foreignTableActivated:Z,foreignSchemaName:j,primarySchemaName:se,customProperties:ue,isActivated:de},z,me){let Ce=a(K),Ae=a(I),Se=!Ce&&!Ae&&re&&Z,{foreignOnDelete:Ne,foreignOnUpdate:ae,foreignMatch:Pe}=q(ue),be=E(R.createForeignKey,{primaryTable:S(v,se||me.schemaName),foreignTable:S(_,j||me.schemaName),name:m?h(m):"",foreignKey:Se?w(I):D(I),primaryKey:Se?w(K):D(K),onDelete:Ne?` ON DELETE ${Ne}`:"",onUpdate:ae?` ON UPDATE ${ae}`:"",match:Pe?` MATCH ${Pe}`:""});return{statement:n.trim(be),isActivated:Se&&de}},createView(m,_,I){var be,ft,Be,ht;let v=S(m.name,m.schemaName),K=E(R.comment,{object:"VIEW",objectName:v,comment:d(m.comment)}),Z=a(m.keys||[])||!I,{columns:j,tables:se}=T(m.keys),ue=j.map(fe=>fe.statement).join(`,
		`);if(!Z){let fe=c(j,De=>De.statement),Kt=fe.deactivatedItems.length?o(fe.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";ue=fe.activatedItems.join(`,
		`)+Kt}let de=n.trim(m.selectStatement)?n.trim(s(m.selectStatement)):E(R.viewSelectStatement,{tableName:se.join(", "),keys:ue}),z=(be=m.viewOptions)!=null&&be.check_option?`check_option=${(ft=m.viewOptions)==null?void 0:ft.check_option}`:"",me=(Be=m.viewOptions)!=null&&Be.security_barrier?"security_barrier":"",Ce=15,{getDbVersion:Ae}=x()(n),Se=(ht=m.viewOptions)!=null&&ht.security_invoker&&Ae(_.dbVersion)>=Ce?"security_invoker":"",Ne=z||me||Se?`
	WITH (${n.compact([z,me,Se]).join(",")})`:"",ae=i(fe=>fe.withCheckOption&&fe.checkTestingScope?`
	WITH ${fe.checkTestingScope} CHECK OPTION`:fe.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption");return[o(E(R.createView,{name:v,orReplace:m.orReplace?" OR REPLACE":"",temporary:m.temporary?" TEMPORARY":"",checkOption:ae(m),comment:m.comment?K:"",withOptions:Ne,selectStatement:de}),{isActivated:!Z})].map(n.trim).join(`

`).trim()+`
`},dropView(m){let _={viewName:m};return E(R.dropView,_)},createViewIndex(){return""},createUdt(m){let _=n.map(m.properties,this.convertColumnDefinition);return we(m,_)},getDefaultType(m){return Uf[m]},getTypesDescriptors(){return ja},hasType(m){return l(ja,m)},hydrateDatabase({modelData:m}){return m=n.get(m,"0",{}),{databaseName:m.database_name,encoding:m.encoding,template:m.template,collate:m.LC_COLLATE,characterClassification:m.LC_CTYPE,dbVersion:m.dbVersion}},hydrateColumn({columnDefinition:m,jsonSchema:_,schemaData:I,definitionJsonSchema:v={},parentJsonSchema:K}){let re=n.includes(["char","varchar","text"],m.type)?_.collationRule:"",Z=["time","timestamp"],j=n.includes(Z,m.type)?_.timePrecision:"",se=n.includes(Z,m.type)?_.timezone:"",ue=m.type==="interval"?_.intervalOptions:"",{getDbVersion:de}=x()(n),z=de(I.dbVersion),me=n.omit(B.hydratePrimaryKeyOptions(n.first(_.primaryKeyOptions)||{},m.name,m.isActivated,K),"columns"),Ce=n.omit(B.hydrateUniqueOptions({options:n.first(_.uniqueKeyOptions)||{},columnName:m.name,isActivated:m.isActivated,jsonSchema:K,dbVersion:z}),"columns");return{name:m.name,type:m.type,primaryKey:B.isInlinePrimaryKey(_),primaryKeyOptions:me,unique:B.isInlineUnique(_),uniqueKeyOptions:Ce,nullable:m.nullable,default:m.default,comment:_.refDescription||_.description||v.description,isActivated:m.isActivated,scale:m.scale,precision:m.precision,length:m.length,enum:_.enum,array_type:_.array_type,unit:_.unit,rangeSubtype:_.rangeSubtype,operatorClass:_.operatorClass,collation:_.collation,canonicalFunction:_.canonicalFunction,subtypeDiffFunction:_.subtypeDiffFunction,multiRangeType:_.multiRangeType,schemaName:I.schemaName,underlyingType:_.underlyingType,checkConstraints:_.checkConstraints,typeModifier:_.typeModifier,srid:_.srid,collationRule:re,timePrecision:j,timezone:se,intervalOptions:ue,dbVersion:z,generatedColumn:!!_.generatedColumn,columnGenerationExpression:_.columnGenerationExpression}},hydrateJsonSchemaColumn(m,_){return!m.$ref||n.isEmpty(_)||g(_)?m:(m=n.omit(m,"$ref"),{..._,...m})},hydrateIndex(m,_,I){return{...m,schemaName:I.schemaName}},hydrateViewIndex(m){return{}},hydrateCheckConstraint(m){return{name:m.chkConstrName,expression:m.constrExpression,notValid:m.notValid}},hydrateSchema(m,_){let I=n.get(_,"modelData.0.dbVersion");return{schemaName:m.name,ifNotExist:m.ifNotExist,comments:m.description,udfs:(_==null?void 0:_.udfs)||[],procedures:(_==null?void 0:_.procedures)||[],dbVersion:I}},hydrateTable({tableData:m,entityData:_,jsonSchema:I}){let v=_[0],K=n.chain(v.inherits).map(({parentTable:z})=>n.get(m,`relatedSchemas[${z}]`,"")).compact().map(z=>z.code||z.collectionName).join(", ").thru(z=>z?`(${z})`:"").value(),re=n.first(v.partitioning)||{},Z=B.getKeys(re.compositePartitionKey,I),j=n.get(m,`relatedSchemas[${v.partitionOf}]`),se=j?S(j.collectionName,j.bucketName):"",{getDbVersion:ue}=x()(n),de=ue(n.get(m,"dbData.dbVersion",""));return{...m,partitionOf:se,keyConstraints:B.getTableKeyConstraints(I,de),inherits:K,selectStatement:n.trim(v.selectStatement),partitioning:n.assign({},re,{compositePartitionKey:Z}),...n.pick(v,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","partitionBounds")}},hydrateViewColumn(m){return{name:m.name,tableName:m.entityName,alias:m.alias,isActivated:m.isActivated,dbName:m.dbName}},hydrateView({viewData:m,entityData:_,relatedSchemas:I}){let v=_[0];return{name:m.name,keys:m.keys,comment:v.description,orReplace:v.orReplace,temporary:v.temporary,recursive:v.recursive,viewOptions:v.viewOptions,selectStatement:v.selectStatement,withCheckOption:v.withCheckOption,checkTestingScope:v.withCheckOption?v.checkTestingScope:"",schemaName:m.schemaData.schemaName}},commentIfDeactivated(m,_,I){return m},alterColumnType(m,_,I,v){let K=I;return v.length?K+=`(${v.length})`:v.precision&&v.scale?K+=`(${v.precision},${v.scale})`:v.precision&&(K+=`(${v.precision})`),E(R.alterColumnType,{tableName:m,columnName:_,dataType:K})},setNotNullConstraint(m,_){return E(R.addNotNullConstraint,{tableName:m,columnName:_})},dropNotNullConstraint(m,_){return E(R.dropNotNullConstraint,{tableName:m,columnName:_})},renameColumn(m,_,I){return E(R.renameColumn,{tableName:m,oldColumnName:_,newColumnName:I})},addCheckConstraint(m,_,I){let v={tableName:m,constraintName:_,expression:I};return E(R.addCheckConstraint,v)},dropConstraint(m,_){let I={tableName:m,constraintName:_};return E(R.dropConstraint,I)},updateTableComment(m,_){let I={tableName:m,comment:_};return E(R.updateCommentOnTable,I)},dropTableComment(m){let _={tableName:m,comment:"NULL"};return E(R.updateCommentOnTable,_)},updateColumnComment(m,_){let I={columnName:m,comment:_};return E(R.updateCommentOnColumn,I)},dropColumnComment(m){let _={columnName:m,comment:"NULL"};return E(R.updateCommentOnColumn,_)},updateSchemaComment(m,_){let I={schemaName:m,comment:_};return E(R.updateCommentOnSchema,I)},dropSchemaComment(m){let _={schemaName:m,comment:"NULL"};return E(R.updateCommentOnSchema,_)},updateViewComment(m,_){let I={viewName:m,comment:_};return E(R.updateCommentOnView,I)},dropViewComment(m){let _={viewName:m,comment:"NULL"};return E(R.updateCommentOnView,_)},createSchemaOnly(m){let _={schemaName:m};return E(R.createSchemaOnly,_)},dropSchema(m){let _={schemaName:m};return E(R.dropSchema,_)},dropTable(m){let _={tableName:m};return E(R.dropTable,_)},addColumn(m,_){let I={tableName:m,columnDefinition:_};return E(R.addColumn,I)},dropColumn(m,_){let I={tableName:m,columnName:_};return E(R.dropColumn,I)},dropDomain(m){let _={udtName:m};return E(R.dropDomain,_)},dropType(m){let _={udtName:m};return E(R.dropType,_)},alterTypeAddAttribute(m,_){let I={udtName:m,columnDefinition:_};return E(R.alterTypeAddAttribute,I)},alterTypeDropAttribute(m,_){let I={udtName:m,attributeName:_};return E(R.alterTypeDropAttribute,I)},alterTypeRenameAttribute(m,_,I){let v={udtName:m,oldAttributeName:_,newAttributeName:I};return E(R.alterTypeRenameAttribute,v)},alterTypeChangeAttributeType(m,_,I){let v={udtName:m,attributeName:_,newDataType:I};return E(R.alterTypeChangeAttributeType,v)},dropForeignKey(m,_){let I={tableName:m,fkConstraintName:_};return E(R.dropForeignKey,I)},createKeyConstraint(m,_,I){let v=C(R,_)(I);return{statement:E(R.addPkConstraint,{constraintStatement:(v.statement||"").trim(),tableName:m}),isActivated:v.isActivated}},dropPkConstraint(m,_){let I={tableName:m,constraintName:_};return E(R.dropConstraint,I)}}}});var Ja=A((A_,Za)=>{"use strict";var{getModifySchemaCommentsScriptDtos:Kf}=Ta(),{AlterScriptDto:Xa}=ne(),Gf=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=x()(r),o=n.createSchemaOnly(s(e));return Xa.getInstance([o],!0,!1)},"getAddContainerScriptDto"),Vf=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=x()(r),o=n.dropSchema(s(e));return Xa.getInstance([o],!0,!0)},"getDeleteContainerScriptDto"),Hf=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...Kf(r,n)(e)]},"getModifyContainerScriptDtos");Za.exports={getAddContainerScriptDto:Gf,getDeleteContainerScriptDto:Vf,getModifyContainerScriptDtos:Hf}});var tc=A((I_,ec)=>{"use strict";var{AlterCollectionDto:b_}=ze(),{AlterScriptDto:kt}=ne(),Qf=i(t=>e=>{var a;let r=(a=e==null?void 0:e.compMod)==null?void 0:a.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),Wf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=x()(t);return r.filter(o=>o.old&&!o.new).map(o=>{let a=s(o.old.chkConstrName);return e.dropConstraint(n,a)}).map(o=>kt.getInstance([o],!0,!0))},"getDropCheckConstraintScriptDtos"),Yf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=x()(t);return r.filter(o=>o.new&&!o.old).map(o=>{let{chkConstrName:a,constrExpression:c}=o.new;return e.addCheckConstraint(n,s(a),c)}).map(o=>kt.getInstance([o],!0,!1))},"getAddCheckConstraintScriptDtos"),jf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=x()(t);return r.filter(o=>{if(o.old&&o.new){let a=o.old.constrExpression,c=o.new.constrExpression;return a!==c}return!1}).map(o=>{let{chkConstrName:a}=o.old,c=e.dropConstraint(n,s(a)),{chkConstrName:l,constrExpression:u}=o.new,p=e.addCheckConstraint(n,s(l),u);return[kt.getInstance([c],!0,!0),kt.getInstance([p],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),zf=i((t,e)=>r=>{let{getFullTableName:n}=x()(t),s=n(r),o=Qf(t)(r),a=Yf(t,e)(o,s),c=Wf(t,e)(o,s),l=jf(t,e)(o,s);return[...a,...c,...l]},"getModifyCheckConstraintScriptDtos");ec.exports={getModifyCheckConstraintScriptDtos:zf}});var sc=A((v_,nc)=>{"use strict";var{AlterScriptDto:rc}=ne(),{AlterCollectionDto:w_}=ze(),Xf=i((t,e)=>r=>{var d;let{getFullTableName:n,wrapComment:s}=x()(t),o=(d=r==null?void 0:r.role.compMod)==null?void 0:d.description;if(!o)return;let{old:a,new:c}=o;if(!c||c===a)return;let l=n(r),u=s(c),p=e.updateTableComment(l,u);return rc.getInstance([p],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),Zf=i((t,e)=>r=>{var u;let{getFullTableName:n}=x()(t),s=(u=r==null?void 0:r.role.compMod)==null?void 0:u.description;if(!s)return;let{old:o,new:a}=s;if(!o||a)return;let c=n(r),l=e.dropTableComment(c);return rc.getInstance([l],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),Jf=i((t,e)=>r=>{let n=Xf(t,e)(r),s=Zf(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");nc.exports={getModifyEntityCommentsScriptDtos:Jf}});var oc=A((P_,ic)=>{"use strict";var{AlterScriptDto:eh}=ne(),th=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,o=r==null?void 0:r.length;return s!==o},"hasLengthChanged"),rh=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,o=r==null?void 0:r.precision,a=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==o||a!==c},"hasPrecisionOrScaleChanged"),nh=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=x()(t),a=s(r);return t.toPairs(r.properties).filter(([c,l])=>{let u=n(l.compMod,["type","mode"]);if(!u){let p=l.compMod.oldField.name,d=th(r,p,l),f=rh(r,p,l);return d||f}return u}).map(([c,l])=>{let u=l.compMod.newField.mode||l.compMod.newField.type,p=o(c),d=t.pick(l,["length","precision","scale"]);return e.alterColumnType(a,p,u,d)}).map(c=>eh.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");ic.exports={getUpdateTypesScriptDtos:nh}});var uc=A((L_,cc)=>{"use strict";var{AlterScriptDto:ac}=ne(),sh=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=x()(t),o=n(r),a=r.required||[],c=r.role.required||[],l=t.difference(a,c),u=t.difference(c,a),p=t.toPairs(r.properties).filter(([f,h])=>{let S=h.compMod.oldField.name,y=u.includes(S);return l.includes(f)&&!y}).map(([f])=>e.setNotNullConstraint(o,s(f))).map(f=>ac.getInstance([f],!0,!1)),d=t.toPairs(r.properties).filter(([f,h])=>{let S=h.compMod.oldField.name,y=u.includes(S),T=l.includes(f);return y&&!T}).map(([f])=>e.dropNotNullConstraint(o,s(f))).map(f=>ac.getInstance([f],!0,!0));return[...p,...d]},"getModifyNonNullColumnsScriptDtos");cc.exports={getModifyNonNullColumnsScriptDtos:sh}});var mc=A((x_,pc)=>{"use strict";var{AlterScriptDto:lc}=ne(),ih=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=x()(t);return t.toPairs(r.properties).filter(([o,a])=>{var p;let c=a.description,l=a.compMod.oldField.name,u=(p=r.role.properties[l])==null?void 0:p.description;return c&&(!u||c!==u)}).map(([o,a])=>{let c=a.description,l=s(c),u=n(r,o);return e.updateColumnComment(u,l)}).map(o=>lc.getInstance([o],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),oh=i((t,e)=>r=>{let{getFullColumnName:n}=x()(t);return t.toPairs(r.properties).filter(([s,o])=>{var u;let a=o.description,c=o.compMod.oldField.name;return((u=r.role.properties[c])==null?void 0:u.description)&&!a}).map(([s,o])=>{let a=n(r,s);return e.dropColumnComment(a)}).map(s=>lc.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),ah=i((t,e)=>r=>{let n=ih(t,e)(r),s=oh(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");pc.exports={getModifiedCommentOnColumnScriptDtos:ah}});var fc=A((k_,dc)=>{"use strict";var{AlterScriptDto:ch}=ne(),uh=i((t,e)=>r=>{let{checkFieldPropertiesChanged:n,getFullTableName:s,wrapInQuotes:o}=x()(t),a=s(r);return t.values(r.properties).filter(c=>n(c.compMod,["name"])).map(c=>{let l=o(c.compMod.oldField.name),u=o(c.compMod.newField.name);return e.renameColumn(a,l,u)}).map(c=>ch.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");dc.exports={getRenameColumnScriptDtos:uh}});var _c=A((V_,Ec)=>{"use strict";var{AlterScriptDto:lh}=ne(),{AlterCollectionDto:B_,AlterCollectionColumnDto:$_,AlterCollectionRoleCompModPKDto:U_,AlterCollectionColumnPrimaryKeyOptionDto:K_,AlterCollectionRoleCompModPrimaryKey:G_}=ze(),Xe=1,jn=class jn{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(jn,"PkTransitionDto");var oe=jn,zn=class zn{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(zn,"PkScriptModificationDto");var Ze=zn,Yn=i(t=>`${t}_pkey`,"getDefaultConstraintName"),hc=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),Je=i(t=>(t.primaryKeyOptions||[]).map(r=>hc(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),Ft=i(t=>[hc(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),ph=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).old||[],s=n.flatMap(f=>f.compositePrimaryKey.map(h=>h.keyId));if(s.length!==Xe)return oe.noTransition();let o=s[0],a=Object.values(e.properties).find(f=>f.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return oe.noTransition();let l=Je(a),u=n.some(f=>{if(f.compositePrimaryKey.length!==Xe)return!1;let h=Ft(f);return t(h).differenceWith(l,t.isEqual).isEmpty()});return oe.transition(!u)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),mh=i(t=>e=>{var p,d;let n=(((d=(p=e==null?void 0:e.role)==null?void 0:p.compMod)==null?void 0:d.primaryKey)||{}).new||[],s=n.flatMap(f=>f.compositePrimaryKey.map(h=>h.keyId));if(s.length!==Xe)return oe.noTransition();let o=s[0],a=Object.values(e.role.properties).find(f=>f.GUID===o);if(!a||!((a==null?void 0:a.primaryKey)&&!(a!=null&&a.compositePrimaryKey)))return oe.noTransition();let l=Je(a),u=n.some(f=>{if(f.compositePrimaryKey.length!==Xe)return!1;let h=Ft(f);return t(h).differenceWith(l,t.isEqual).isEmpty()});return oe.transition(!u)},"wasCompositePkChangedInTransitionFromRegularToComposite"),dh=i((t,e)=>t.constraintName?t.constraintName:Yn(e),"getConstraintNameForCompositePk"),fh=i(t=>(e,r,n)=>{let s=dh(e,r),o=t.toPairs(n.role.properties).filter(([l,u])=>!!e.compositePrimaryKey.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated})),a="",c=[];return e.indexStorageParameters&&(a=e.indexStorageParameters),e.indexInclude&&(c=t.toPairs(n.role.properties).filter(([l,u])=>!!e.indexInclude.find(p=>p.keyId===u.GUID)).map(([l,u])=>({name:l,isActivated:u.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:o,include:c,storageParameters:a}},"getCreateCompositePKDDLProviderConfig"),hh=i((t,e)=>r=>{var h,S;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=x()(t),a=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},c=a.new||[],l=a.old||[];if(c.length===0&&l.length===0)return[];let u=mh(t)(r);if(u.didTransitionHappen&&!u.wasPkChangedInTransition)return[];if(c.length===l.length&&t(l).differenceWith(c,t.isEqual).isEmpty())return[];let p=s(r),d=n(p),f=o(p);return c.map(y=>{let T=fh(t)(y,f,r),E=e.createKeyConstraint(d,r.isActivated,T);return new Ze(E.statement,d,!1,E.isActivated)}).filter(y=>!!y.script)},"getAddCompositePkScriptDtos"),yh=i((t,e)=>r=>{var S,y;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=x()(t),c=((y=(S=r==null?void 0:r.role)==null?void 0:S.compMod)==null?void 0:y.primaryKey)||{},l=c.new||[],u=c.old||[];if(l.length===0&&u.length===0)return[];let p=ph(t)(r);if(p.didTransitionHappen&&!p.wasPkChangedInTransition)return[];if(l.length===u.length&&t(u).differenceWith(l,t.isEqual).isEmpty())return[];let d=s(r),f=n(d),h=o(d);return u.map(T=>{let E=Yn(h);T.constraintName&&(E=T.constraintName);let P=a(E),N=e.dropPkConstraint(f,P);return new Ze(N,f,!0,r.isActivated)}).filter(T=>!!T.script)},"getDropCompositePkScriptDtos"),gh=i((t,e)=>r=>{let n=yh(t,e)(r),s=hh(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),yc=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return Yn(e)},"getConstraintNameForRegularPk"),Eh=i(t=>(e,r,n,s)=>{let o=yc(r,n),a=[{name:e,isActivated:r.isActivated}],c="",l=[],u=r.primaryKeyOptions;if(u!=null&&u.length&&(u==null?void 0:u.length)>0){let p=u[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([d,f])=>!!p.indexInclude.find(h=>h.keyId===f.GUID)).map(([d,f])=>({name:d,isActivated:f.isActivated})))}return{name:o,keyType:"PRIMARY KEY",columns:a,include:l,storageParameters:c}},"getCreateRegularPKDDLProviderConfig"),_h=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);return o&&!a},"wasFieldChangedToBeARegularPk"),Sh=i(t=>(e,r)=>{var h,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=e.primaryKey&&!e.compositePrimaryKey,a=!!(s!=null&&s.primaryKey);if(!(o&&a))return oe.noTransition();let c=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],u=c.old||[],p=u.some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),d=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID));if(o&&(p&&!d)){let y=Je(e),T=u.some(E=>{if(E.compositePrimaryKey.length!==Xe)return!1;let P=Ft(E);return t(P).differenceWith(y,t.isEqual).isEmpty()});return oe.transition(!T)}return oe.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),Th=i(t=>(e,r)=>{var h,S;let n=e.compMod.oldField.name,s=r.role.properties[n],o=s.primaryKey&&!s.compositePrimaryKey,a=!!(e!=null&&e.primaryKey);if(!(o&&a))return oe.noTransition();let c=((S=(h=r==null?void 0:r.role)==null?void 0:h.compMod)==null?void 0:S.primaryKey)||{},l=c.new||[],p=(c.old||[]).some(y=>y.compositePrimaryKey.some(T=>T.keyId===s.GUID)),f=l.some(y=>y.compositePrimaryKey.some(T=>T.keyId===e.GUID))&&!p;if(o&&f){let y=Je(s),T=l.some(E=>{if(E.compositePrimaryKey.length!==Xe)return!1;let P=Ft(E);return t(P).differenceWith(y,t.isEqual).isEmpty()});return oe.transition(!T)}return oe.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),Ch=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),a=!e.primaryKey&&!e.compositePrimaryKey;return o&&a},"isFieldNoLongerARegularPk"),gc=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},o=e.primaryKey&&!e.compositePrimaryKey,a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(o&&a))return!1;let c=Je(e),l=Je(s);return!t(l).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),Ah=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o}=x()(t),a=s(r),c=n(a),l=o(a);return t.toPairs(r.properties).filter(([u,p])=>{if(_h(t)(p,r))return!0;let d=Sh(t)(p,r);return d.didTransitionHappen?d.wasPkChangedInTransition:gc(t)(p,r)}).map(([u,p])=>{let d=Eh(t)(u,p,l,r),f=e.createKeyConstraint(c,r.isActivated,d);return new Ze(f.statement,c,!1,f.isActivated)}).filter(u=>!!u.script)},"getAddPkScriptDtos"),Nh=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:o,wrapInQuotes:a}=x()(t),c=s(r),l=n(c),u=o(c);return t.toPairs(r.properties).filter(([p,d])=>{if(Ch(t)(d,r))return!0;let f=Th(t)(d,r);return f.didTransitionHappen?f.wasPkChangedInTransition:gc(t)(d,r)}).map(([p,d])=>{let f=d.compMod.oldField.name,h=r.role.properties[f],S=a(yc(h,u)),y=e.dropPkConstraint(l,S);return new Ze(y,l,!0,r.isActivated)}).filter(p=>!!p.script)},"getDropPkScriptDto"),bh=i((t,e)=>r=>{let n=Nh(t,e)(r),s=Ah(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),Ih=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),Oh=i((t,e)=>r=>{let n=gh(t,e)(r),s=bh(t,e)(r),o=[...n,...s];return Ih(o).map(c=>lh.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");Ec.exports={getModifyPkConstraintsScriptDtos:Oh}});var dt=A((Q_,Sc)=>{"use strict";Sc.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u})=>e({name:s,jsonSchema:o,parentJsonSchema:a,ddlProvider:c,schemaData:l,definitionJsonSchema:u,getType:r}),"createColumnDefinitionBySchema")}}});var Nc=A((j_,Ac)=>{"use strict";var{getModifyCheckConstraintScriptDtos:wh}=tc(),{getModifyEntityCommentsScriptDtos:vh}=sc(),{getUpdateTypesScriptDtos:Rh}=oc(),{getModifyNonNullColumnsScriptDtos:Ph}=uc(),{getModifiedCommentOnColumnScriptDtos:Dh}=mc(),{getRenameColumnScriptDtos:Lh}=fc(),{AlterScriptDto:Bt}=ne(),{AlterCollectionDto:Y_}=ze(),{getModifyPkConstraintsScriptDtos:Mh}=_c(),xh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{getEntityName:c}=x()(a),{createColumnDefinitionBySchema:l}=dt()(t),u=ee()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),f={schemaName:o.compMod.keyspaceName,dbVersion:e},h={...o,...a.omit(o==null?void 0:o.role,"properties")||{}},S=a.toPairs(h.properties).map(([N,w])=>{let D=p({propertySchema:w,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return l({name:N,jsonSchema:w,parentJsonSchema:h,ddlProvider:u,schemaData:f,definitionJsonSchema:D})}),y=(h.chkConstr||[]).map(N=>u.createCheckConstraint(u.hydrateCheckConstraint(N))),T={name:c(h),columns:S.map(u.convertColumnDefinition),checkConstraints:y,foreignKeyConstraints:[],schemaData:f,columnDefinitions:S,dbData:{dbVersion:e}},E=u.hydrateTable({tableData:T,entityData:[h],jsonSchema:h}),P=u.createTable(E,h.isActivated);return Bt.getInstance([P],!0,!1)},"getAddCollectionScriptDto"),qh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getFullTableName:s}=x()(r),o=s(e),a=n.dropTable(o);return Bt.getInstance([a],!0,!0)},"getDeleteCollectionScriptDto"),kh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),s=wh(r,n)(e),o=vh(r,n)(e),a=Mh(r,n)(e);return[...s,...o,...a].filter(Boolean)},"getModifyCollectionScriptDtos"),Tc=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>(o,a)=>{var P;let c=t.require("lodash"),{getEntityName:l,getNamePrefixedWithSchemaName:u}=x()(c),{createColumnDefinitionBySchema:p}=dt()(t),d=ee()(null,null,t),{getDefinitionByReference:f}=t.require("@hackolade/ddl-fe-utils"),h={...o,...c.omit(o==null?void 0:o.role,"properties")||{}},S=l(h),y=(P=h.compMod)==null?void 0:P.keyspaceName,T=u(S,y),E={schemaName:y,dbVersion:e};return c.toPairs(o.properties).filter(([N,w])=>a([N,w])).map(([N,w])=>{let D=f({propertySchema:w,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return p({name:N,jsonSchema:w,parentJsonSchema:h,ddlProvider:d,schemaData:E,definitionJsonSchema:D})}).map(d.convertColumnDefinition).map(N=>d.addColumn(T,N)).map(N=>Bt.getInstance([N],!0,!1)).filter(Boolean)},"getAddColumnsByConditionScriptDtos"),Fh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>Tc({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o,([a,c])=>!c.compMod),"getAddColumnScriptDtos"),Cc=i(t=>(e,r)=>{var f;let n=t.require("lodash"),s=ee()(null,null,t),{getEntityName:o,getNamePrefixedWithSchemaName:a,wrapInQuotes:c}=x()(n),l={...e,...n.omit(e==null?void 0:e.role,"properties")||{}},u=o(l),p=(f=l.compMod)==null?void 0:f.keyspaceName,d=a(u,p);return n.toPairs(e.properties).filter(([h,S])=>r([h,S])).map(([h])=>{let S=c(h);return s.dropColumn(d,S)}).map(h=>Bt.getInstance([h],!0,!0)).filter(Boolean)},"getDeleteColumnsByConditionScriptDtos"),Bh=i(t=>e=>Cc(t)(e,([r,n])=>!n.compMod),"getDeleteColumnScriptDtos"),$h=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash");return a.toPairs(o.properties).filter(([c,l])=>{let u=l.compMod.oldField.name,p=o.role.properties[u];return p.generatedColumn!==l.generatedColumn||p.columnGenerationExpression!==l.columnGenerationExpression}).flatMap(([c,l])=>{let u={...o,properties:a.fromPairs([[c,l]])},p=Cc(t)(u,()=>!0),d=Tc({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(u,()=>!0);return[...p,...d]}).filter(Boolean)},"getDropAndRecreateColumnsScriptDtos"),Uh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),c=ee()(null,null,t),l=Lh(a,c)(o),u=$h({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})(o);if(u.length)return[...l,...u].filter(Boolean);let p=Rh(a,c)(o),d=Ph(a,c)(o),f=Dh(a,c)(o);return[...l,...p,...d,...f].filter(Boolean)},"getModifyColumnScriptDtos");Ac.exports={getAddCollectionScriptDto:xh,getDeleteCollectionScriptDto:qh,getModifyCollectionScriptDtos:kh,getAddColumnScriptDtos:Fh,getDeleteColumnScriptDtos:Bh,getModifyColumnScriptDtos:Uh}});var Ic=A((X_,bc)=>{"use strict";var{AlterScriptDto:Fe}=ne(),Kh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=dt()(t),l=ee()(null,null,t),{getDefinitionByReference:u}=t.require("@hackolade/ddl-fe-utils"),p={dbVersion:e},d=a.toPairs(o.properties||{}).map(([y,T])=>{let E=u({propertySchema:T,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:y,jsonSchema:T,parentJsonSchema:o,ddlProvider:l,schemaData:p,definitionJsonSchema:E})}),h={...c({name:o.code||o.name,jsonSchema:o,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:l,schemaData:p}),properties:d},S=l.createUdt(h);return Fe.getInstance([S],!0,!1)},"getCreateUdtScriptDto"),Gh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getUdtName:s,wrapInQuotes:o}=x()(r),a=o(s(e));if(e.type==="domain"){let c=n.dropDomain(a);return Fe.getInstance([c],!0,!0)}else{let c=n.dropType(a);return Fe.getInstance([c],!0,!0)}},"getDeleteUdtScriptDto"),Vh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>o=>{let a=t.require("lodash"),{createColumnDefinitionBySchema:c}=dt()(t),{getUdtName:l,wrapInQuotes:u}=x()(a),p=ee()(null,null,t),{getDefinitionByReference:d}=t.require("@hackolade/ddl-fe-utils"),f=u(l(o)),h={dbVersion:e};return a.toPairs(o.properties).filter(([S,y])=>!y.compMod).map(([S,y])=>{let T=d({propertySchema:y,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:S,jsonSchema:y,parentJsonSchema:{required:[]},ddlProvider:p,schemaData:h,definitionJsonSchema:T})}).map(p.convertColumnDefinition).map(S=>p.alterTypeAddAttribute(f,S)).map(S=>Fe.getInstance([S],!0,!1)).filter(Boolean)},"getAddColumnToTypeScriptDtos"),Hh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=x()(r),o=s(e.code||e.name);return r.toPairs(e.properties).filter(([a,c])=>!c.compMod).map(([a])=>n.alterTypeDropAttribute(o,s(a))).map(a=>Fe.getInstance([a],!0,!0)).filter(Boolean)},"getDeleteColumnFromTypeScriptDtos"),Qh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{checkFieldPropertiesChanged:s,wrapInQuotes:o}=x()(r),a=o(e.code||e.name),c=r.values(e.properties).filter(u=>s(u.compMod,["name"])).map(u=>{let p=o(u.compMod.oldField.name),d=o(u.compMod.newField.name);return n.alterTypeRenameAttribute(a,p,d)}).map(u=>Fe.getInstance([u],!0,!1)),l=r.toPairs(e.properties).filter(([u,p])=>s(p.compMod,["type","mode"])).map(([u,p])=>{let d=o(u),f=p.compMod.newField.mode||p.compMod.newField.type;return n.alterTypeChangeAttributeType(a,d,f)}).map(u=>Fe.getInstance([u],!0,!1));return[...c,...l].filter(Boolean)},"getModifyColumnOfTypeScriptDtos");bc.exports={getCreateUdtScriptDto:Kh,getDeleteUdtScriptDto:Gh,getAddColumnToTypeScriptDtos:Vh,getDeleteColumnFromTypeScriptDtos:Hh,getModifyColumnOfTypeScriptDtos:Qh}});var Rc=A((J_,vc)=>{"use strict";var{AlterScriptDto:Oc}=ne(),wc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),Wh=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=x()(t),o=wc(r);if(o.new&&o.new!==o.old){let a=s(o.new),c=n(r),l=e.updateViewComment(c,a);return Oc.getInstance([l],!0,!1)}},"getUpsertCommentsScriptDto"),Yh=i((t,e)=>r=>{let n=wc(r),{getFullViewName:s}=x()(t);if(n.old&&!n.new){let o=s(r),a=e.dropViewComment(o);return Oc.getInstance([a],!0,!0)}},"getDropCommentsScriptDto"),jh=i((t,e)=>r=>{let n=Wh(t,e)(r),s=Yh(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");vc.exports={getModifyViewCommentsScriptDtos:jh}});var Lc=A((tS,Dc)=>{"use strict";var{getModifyViewCommentsScriptDtos:zh}=Rc(),{AlterScriptDto:Pc}=ne(),Xh=i(t=>e=>{let r=ee()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),o=r.createView(s,{},e.isActivated);return Pc.getInstance([o],!0,!1)},"getAddViewScriptDto"),Zh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=x()(r),o=s(e.code||e.name),a=n.dropView(o);return Pc.getInstance([a],!0,!0)},"getDeleteViewScriptDto"),Jh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...zh(r,n)(e)].filter(Boolean)},"getModifyViewScriptDtos");Dc.exports={getAddViewScriptDto:Xh,getDeleteViewScriptDto:Zh,getModifyViewScriptDtos:Jh}});var xc=A((nS,Mc)=>{"use strict";var ss=class ss{isActivated;name};i(ss,"AlterRelationshipFKField");var Xn=ss,is=class is{bucket;collection};i(is,"AlterRelationshipParentDto");var Zn=is,os=class os{bucket;collection};i(os,"AlterRelationshipChildDto");var Jn=os,as=class as{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(as,"AlterRelationshipCustomProperties");var es=as,cs=class cs{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(cs,"AlterRelationshipRoleCompModDto");var ts=cs,us=class us{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(us,"AlterRelationshipRoleDto");var rs=us,ls=class ls{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(ls,"AlterRelationshipDto");var ns=ls;Mc.exports={AlterRelationshipRoleCompModDto:ts,AlterRelationshipRoleDto:rs,AlterRelationshipDto:ns,AlterRelationshipFKField:Xn,AlterRelationshipParentDto:Zn,AlterRelationshipChildDto:Jn,AlterRelationshipCustomProperties:es}});var Uc=A((oS,$c)=>{"use strict";var{AlterScriptDto:ps}=ne(),{AlterRelationshipDto:iS}=xc(),$t=i(t=>t.role.name,"getRelationshipName"),ey=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=x()(t),n=e.role.compMod,s=n.child.bucket.name,o=n.child.collection.name;return r(o,s)},"getFullChildTableName"),qc=i((t,e)=>r=>{var o,a,c,l,u;let n=r.role.compMod,s=((o=n.name)==null?void 0:o.new)||$t(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(a=n.customProperties)==null?void 0:a.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((u=(l=(c=r.role)==null?void 0:c.compMod)==null?void 0:l.isActivated)!=null&&u.new)})},"getAddSingleForeignKeyStatementDto"),kc=i(t=>{var r,n,s,o,a,c,l,u,p,d,f;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||$t(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(a=(o=e.parent)==null?void 0:o.collection)==null?void 0:a.fkFields)==null?void 0:c.length,(l=e.child)==null?void 0:l.bucket,(u=e.child)==null?void 0:u.collection,(f=(d=(p=e.child)==null?void 0:p.collection)==null?void 0:d.fkFields)==null?void 0:f.length].every(h=>!!h):!1},"canRelationshipBeAdded"),ty=i((t,e)=>r=>r.filter(n=>kc(n)).map(n=>{let s=qc(t,e)(n);return ps.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),Fc=i((t,e)=>r=>{var d,f,h,S;let{wrapInQuotes:n}=x()(e),s=r.role.compMod,o=ey(e)(r),a=((d=s.name)==null?void 0:d.old)||$t(r)||"",c=n(a),l=t.dropForeignKey(o,c),u=!!((S=(h=(f=r.role)==null?void 0:f.compMod)==null?void 0:h.isActivated)!=null&&S.new),p=s.child.collection.isActivated;return{statement:l,isActivated:u&&p}},"getDeleteSingleForeignKeyStatementDto"),Bc=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||$t(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(o=>!!o):!1},"canRelationshipBeDeleted"),ry=i((t,e)=>r=>r.filter(n=>Bc(n)).map(n=>{let s=Fc(t,e)(n);return ps.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),ny=i((t,e)=>r=>r.filter(n=>kc(n)&&Bc(n)).map(n=>{let s=Fc(t,e)(n),o=qc(t,e)(n),a=o.isActivated&&s.isActivated;return ps.getDropAndRecreateInstance(s.statement,o.statement,a)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");$c.exports={getDeleteForeignKeyScriptDtos:ry,getModifyForeignKeyScriptDtos:ny,getAddForeignKeyScriptDtos:ty}});var Gc=A((cS,Kc)=>{"use strict";var ys=class ys{message;stack};i(ys,"PluginError");var ms=ys,gs=class gs{require};i(gs,"App");var ds=gs,Es=class Es{log;clear};i(Es,"Logger");var fs=Es,_s=class _s{jsonSchema;modelDefinitions;internalDefinitions;externalDefinitions;containerData;entityData;entities;views;viewData;relationships;collectionRefsDefinitionsMap;isUpdateScript;level;host;clusterId;accessToken;applyToInstanceQueryRequestTimeout;script;hiddenKeys;options;modelData};i(_s,"CoreData");var hs=_s;Kc.exports={App:ds,CoreData:hs,Logger:fs,PluginError:ms}});var Hc=A((lS,Vc)=>{"use strict";var ws=class ws{name;isActivated};i(ws,"ContainerJsonSchema");var Ss=ws,vs=class vs{backgroundColor};i(vs,"ContainerStyles");var Ts=vs,Rs=class Rs{collectionName;isActivated;bucketId;additionalProperties;tableIfNotExists};i(Rs,"EntityData");var Cs=Rs,Ps=class Ps{$schema;type;GUID};i(Ps,"InternalDefinitions");var As=Ps,Ds=class Ds{$schema;type;GUID};i(Ds,"ModelDefinitions");var Ns=Ds,Ls=class Ls{$schema;type;GUID};i(Ls,"ExternalDefinitions");var bs=Ls,Ms=class Ms{type;isActivated;mode;subtype;compositeKey;compositePartitionKey;compositeClusteringKey;compositePrimaryKey;compositeUniqueKey;GUID};i(Ms,"FieldJsonSchema");var Is=Ms,xs=class xs{$schema;type;title;properties;isActivated;additionalProperties;tableIfNotExists;GUID};i(xs,"EntityJsonSchema");var Os=xs;Vc.exports={ContainerJsonSchema:Ss,ContainerStyles:Ts,EntityData:Cs,InternalDefinitions:As,ModelDefinitions:Ns,ExternalDefinitions:bs,FieldJsonSchema:Is,EntityJsonSchema:Os}});var Wc=A((_S,Qc)=>{"use strict";var{getAddContainerScriptDto:sy,getDeleteContainerScriptDto:iy,getModifyContainerScriptDtos:oy}=Ja(),{getAddCollectionScriptDto:ay,getDeleteCollectionScriptDto:cy,getAddColumnScriptDtos:uy,getDeleteColumnScriptDtos:ly,getModifyColumnScriptDtos:py,getModifyCollectionScriptDtos:my}=Nc(),{getDeleteUdtScriptDto:dy,getCreateUdtScriptDto:fy,getAddColumnToTypeScriptDtos:hy,getDeleteColumnFromTypeScriptDtos:yy,getModifyColumnOfTypeScriptDtos:gy}=Ic(),{getAddViewScriptDto:Ey,getDeleteViewScriptDto:_y,getModifyViewScriptDtos:Sy}=Lc(),{getModifyForeignKeyScriptDtos:Ty,getDeleteForeignKeyScriptDtos:Cy,getAddForeignKeyScriptDtos:Ay}=Uc(),{AlterScriptDto:mS,ModificationScript:dS}=ne(),{App:fS,CoreData:hS}=Gc(),{InternalDefinitions:yS,ModelDefinitions:gS,ExternalDefinitions:ES}=Hc(),Ny=i(({collection:t,app:e})=>{var l,u,p,d,f,h,S,y,T,E,P,N;let r=(d=(p=(u=(l=t.properties)==null?void 0:l.containers)==null?void 0:u.properties)==null?void 0:p.added)==null?void 0:d.items,n=(y=(S=(h=(f=t.properties)==null?void 0:f.containers)==null?void 0:h.properties)==null?void 0:S.deleted)==null?void 0:y.items,s=(N=(P=(E=(T=t.properties)==null?void 0:T.containers)==null?void 0:E.properties)==null?void 0:P.modified)==null?void 0:N.items,o=[].concat(r).filter(Boolean).map(w=>sy(e)(Object.keys(w.properties)[0])),a=[].concat(n).filter(Boolean).map(w=>iy(e)(Object.keys(w.properties)[0])),c=[].concat(s).filter(Boolean).map(w=>Object.values(w.properties)[0]).flatMap(w=>oy(e)(w));return[...o,...a,...c].filter(Boolean)},"getAlterContainersScriptDtos"),by=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var f,h,S,y,T,E,P,N,w,D,C,b,q,B,W,Ee,_e,Te,we,g,O,M,$,Y;let a=[].concat((y=(S=(h=(f=t.properties)==null?void 0:f.entities)==null?void 0:h.properties)==null?void 0:S.added)==null?void 0:y.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>{var m;return(m=U.compMod)==null?void 0:m.created}).map(ay({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((N=(P=(E=(T=t.properties)==null?void 0:T.entities)==null?void 0:E.properties)==null?void 0:P.deleted)==null?void 0:N.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>{var m;return(m=U.compMod)==null?void 0:m.deleted}).map(cy(e)),l=[].concat((b=(C=(D=(w=t.properties)==null?void 0:w.entities)==null?void 0:D.properties)==null?void 0:C.modified)==null?void 0:b.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).flatMap(my(e)),u=[].concat((Ee=(W=(B=(q=t.properties)==null?void 0:q.entities)==null?void 0:B.properties)==null?void 0:W.added)==null?void 0:Ee.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).flatMap(uy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),p=[].concat((g=(we=(Te=(_e=t.properties)==null?void 0:_e.entities)==null?void 0:Te.properties)==null?void 0:we.deleted)==null?void 0:g.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).flatMap(ly(e)),d=[].concat((Y=($=(M=(O=t.properties)==null?void 0:O.entities)==null?void 0:M.properties)==null?void 0:$.modified)==null?void 0:Y.items).filter(Boolean).map(U=>Object.values(U.properties)[0]).filter(U=>!U.compMod).flatMap(py({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}));return[...a,...c,...l,...u,...p,...d].filter(Boolean)},"getAlterCollectionsScriptDtos"),Iy=i((t,e)=>{var o,a,c,l,u,p,d,f,h,S,y,T;let r=[].concat((l=(c=(a=(o=t.properties)==null?void 0:o.views)==null?void 0:a.properties)==null?void 0:c.added)==null?void 0:l.items).filter(Boolean).map(E=>Object.values(E.properties)[0]).map(E=>({...E,...E.role||{}})).filter(E=>{var P;return((P=E.compMod)==null?void 0:P.created)&&E.selectStatement}).map(Ey(e)),n=[].concat((f=(d=(p=(u=t.properties)==null?void 0:u.views)==null?void 0:p.properties)==null?void 0:d.deleted)==null?void 0:f.items).filter(Boolean).map(E=>Object.values(E.properties)[0]).map(E=>({...E,...E.role||{}})).map(_y(e)),s=[].concat((T=(y=(S=(h=t.properties)==null?void 0:h.views)==null?void 0:S.properties)==null?void 0:y.modified)==null?void 0:T.items).filter(Boolean).map(E=>Object.values(E.properties)[0]).map(E=>({...E,...E.role||{}})).flatMap(E=>Sy(e)(E));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),Oy=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})=>{var d,f,h,S,y,T,E,P,N,w,D,C,b,q,B,W,Ee,_e,Te,we;let a=[].concat((S=(h=(f=(d=t.properties)==null?void 0:d.modelDefinitions)==null?void 0:f.properties)==null?void 0:h.added)==null?void 0:S.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var O;return(O=g.compMod)==null?void 0:O.created}).map(fy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),c=[].concat((P=(E=(T=(y=t.properties)==null?void 0:y.modelDefinitions)==null?void 0:T.properties)==null?void 0:E.deleted)==null?void 0:P.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>{var O;return(O=g.compMod)==null?void 0:O.deleted}).map(dy(e)),l=[].concat((C=(D=(w=(N=t.properties)==null?void 0:N.modelDefinitions)==null?void 0:w.properties)==null?void 0:D.added)==null?void 0:C.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(hy({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o})),u=[].concat((W=(B=(q=(b=t.properties)==null?void 0:b.modelDefinitions)==null?void 0:q.properties)==null?void 0:B.deleted)==null?void 0:W.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(yy(e)),p=[].concat((we=(Te=(_e=(Ee=t.properties)==null?void 0:Ee.modelDefinitions)==null?void 0:_e.properties)==null?void 0:Te.modified)==null?void 0:we.items).filter(Boolean).map(g=>Object.values(g.properties)[0]).filter(g=>!g.compMod).map(g=>({...g,...e.require("lodash").omit(g.role,"properties")||{}})).filter(g=>g.childType==="composite").flatMap(gy(e));return[...c,...a,...l,...u,...p].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),wy=i(({collection:t,app:e})=>{var p,d,f,h,S,y,T,E,P,N,w,D;let r=e.require("lodash"),n=ee()(null,null,e),s=[].concat((h=(f=(d=(p=t.properties)==null?void 0:p.relationships)==null?void 0:d.properties)==null?void 0:f.added)==null?void 0:h.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,q;return(q=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:q.created}),o=[].concat((E=(T=(y=(S=t.properties)==null?void 0:S.relationships)==null?void 0:y.properties)==null?void 0:T.deleted)==null?void 0:E.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,q;return(q=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:q.deleted}),a=[].concat((D=(w=(N=(P=t.properties)==null?void 0:P.relationships)==null?void 0:N.properties)==null?void 0:w.modified)==null?void 0:D.items).filter(Boolean).map(C=>Object.values(C.properties)[0]).filter(C=>{var b,q;return(q=(b=C==null?void 0:C.role)==null?void 0:b.compMod)==null?void 0:q.modified}),c=Cy(n,r)(o),l=Ay(n,r)(s),u=Ty(n,r)(a);return[...c,...l,...u].filter(Boolean)},"getAlterRelationshipsScriptDtos"),vy=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),Ry=i((t,e)=>{var f;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),o=JSON.parse(t.externalDefinitions),a=(f=t.modelData[0])==null?void 0:f.dbVersion,c=Ny({collection:r,app:e}),l=by({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),u=Iy(r,e),p=Oy({collection:r,app:e,dbVersion:a,modelDefinitions:n,internalDefinitions:s,externalDefinitions:o}),d=wy({collection:r,app:e});return[...c,...p,...l,...u,...d].filter(Boolean).map(h=>vy(h)).filter(Boolean)},"getAlterScriptDtos");Qc.exports={getAlterScriptDtos:Ry}});var Xc=A((CS,zc)=>{"use strict";var{getAlterScriptDtos:Ut}=Wc(),{AlterScriptDto:TS}=ne(),Yc=i(t=>(e,r)=>{let{commentIfDeactivated:n}=x()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(o=>n(o.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(o=>o.script):s.scripts.map(o=>n(o.script,{isActivated:!o.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),Py=i((t,e)=>{var o,a;let r=e.require("lodash"),n=Ut(t,e),s=(a=(o=t.options)==null?void 0:o.additionalOptions)==null?void 0:a.some(c=>c.id==="applyDropStatements"&&c.value);return Yc(r)(n,s)},"buildEntityLevelAlterScript"),Dy=i((t,e)=>Ut(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),jc=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),Ly=i((t,e)=>{var a,c;let r=jc(t),n=e.require("lodash"),s=Ut(r,e),o=(c=(a=r.options)==null?void 0:a.additionalOptions)==null?void 0:c.some(l=>l.id==="applyDropStatements"&&l.value);return Yc(n)(s,o)},"buildContainerLevelAlterScript"),My=i((t,e)=>{let r=jc(t);return Ut(r,e).some(s=>s.isActivated&&s.scripts.some(o=>o.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");zc.exports={buildEntityLevelAlterScript:Py,doesEntityLevelAlterScriptContainDropStatements:Dy,buildContainerLevelAlterScript:Ly,doesContainerLevelAlterScriptContainDropStatements:My}});var Zc=la(),{createLogger:xy}=Gt(),qy=ma(),{buildEntityLevelAlterScript:ky,buildContainerLevelAlterScript:Fy,doesContainerLevelAlterScriptContainDropStatements:By,doesEntityLevelAlterScriptContainDropStatements:$y}=Xc();module.exports={generateScript(t,e,r,n){try{let s=ky(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=Fy(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"CockroachDB Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),Zc.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=xy({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});qy.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){Zc.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=By(t,n);r(null,s)}else{let s=$y(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
