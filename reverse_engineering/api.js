"use strict";var Ce=Object.defineProperty;var $i=Object.getOwnPropertyDescriptor;var zi=Object.getOwnPropertyNames;var Yi=Object.prototype.hasOwnProperty;var i=(t,e)=>Ce(t,"name",{value:e,configurable:!0});var Ji=(t,e)=>()=>(t&&(e=t(t=0)),e);var h=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Zi=(t,e)=>{for(var r in e)Ce(t,r,{get:e[r],enumerable:!0})},Xi=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of zi(e))!Yi.call(t,s)&&s!==r&&Ce(t,s,{get:()=>e[s],enumerable:!(n=$i(e,s))||n.enumerable});return t};var ea=t=>Xi(Ce({},"__esModule",{value:!0}),t);var Yr=h((Th,zr)=>{"use strict";var ta=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",ra(n),t)}}),"createLogger"),ra=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");zr.exports={createLogger:ta}});var Zr=h((bh,Jr)=>{var ie=1e3,ae=ie*60,oe=ae*60,ce=oe*24,na=ce*365.25;Jr.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return sa(t);if(r==="number"&&isNaN(t)===!1)return e.long?aa(t):ia(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function sa(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*na;case"days":case"day":case"d":return r*ce;case"hours":case"hour":case"hrs":case"hr":case"h":return r*oe;case"minutes":case"minute":case"mins":case"min":case"m":return r*ae;case"seconds":case"second":case"secs":case"sec":case"s":return r*ie;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}i(sa,"parse");function ia(t){return t>=ce?Math.round(t/ce)+"d":t>=oe?Math.round(t/oe)+"h":t>=ae?Math.round(t/ae)+"m":t>=ie?Math.round(t/ie)+"s":t+"ms"}i(ia,"fmtShort");function aa(t){return Oe(t,ce,"day")||Oe(t,oe,"hour")||Oe(t,ae,"minute")||Oe(t,ie,"second")||t+" ms"}i(aa,"fmtLong");function Oe(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}i(Oe,"plural")});var tt=h((g,Xr)=>{g=Xr.exports=et.debug=et.default=et;g.coerce=pa;g.disable=ua;g.enable=ca;g.enabled=la;g.humanize=Zr();g.names=[];g.skips=[];g.formatters={};var Xe;function oa(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return g.colors[Math.abs(e)%g.colors.length]}i(oa,"selectColor");function et(t){function e(){if(e.enabled){var r=e,n=+new Date,s=n-(Xe||n);r.diff=s,r.prev=Xe,r.curr=n,Xe=n;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=g.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(u,p){if(u==="%%")return u;c++;var f=g.formatters[p];if(typeof f=="function"){var m=a[c];u=f.call(r,m),a.splice(c,1),c--}return u}),g.formatArgs.call(r,a);var l=e.log||g.log||console.log.bind(console);l.apply(r,a)}}return i(e,"debug"),e.namespace=t,e.enabled=g.enabled(t),e.useColors=g.useColors(),e.color=oa(t),typeof g.init=="function"&&g.init(e),e}i(et,"createDebug");function ca(t){g.save(t),g.names=[],g.skips=[];for(var e=(typeof t=="string"?t:"").split(/[\s,]+/),r=e.length,n=0;n<r;n++)e[n]&&(t=e[n].replace(/\*/g,".*?"),t[0]==="-"?g.skips.push(new RegExp("^"+t.substr(1)+"$")):g.names.push(new RegExp("^"+t+"$")))}i(ca,"enable");function ua(){g.enable("")}i(ua,"disable");function la(t){var e,r;for(e=0,r=g.skips.length;e<r;e++)if(g.skips[e].test(t))return!1;for(e=0,r=g.names.length;e<r;e++)if(g.names[e].test(t))return!0;return!1}i(la,"enabled");function pa(t){return t instanceof Error?t.stack||t.message:t}i(pa,"coerce")});var rn=h((I,tn)=>{I=tn.exports=tt();I.log=da;I.formatArgs=fa;I.save=ma;I.load=en;I.useColors=ha;I.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:_a();I.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function ha(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}i(ha,"useColors");I.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function fa(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+I.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(a){a!=="%%"&&(n++,a==="%c"&&(s=n))}),t.splice(s,0,r)}}i(fa,"formatArgs");function da(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}i(da,"log");function ma(t){try{t==null?I.storage.removeItem("debug"):I.storage.debug=t}catch{}}i(ma,"save");function en(){var t;try{t=I.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}i(en,"load");I.enable(en());function _a(){try{return window.localStorage}catch{}}i(_a,"localstorage")});var on=h((C,an)=>{var nn=require("tty"),ue=require("util");C=an.exports=tt();C.init=ba;C.log=Sa;C.formatArgs=Ea;C.save=Ta;C.load=sn;C.useColors=ga;C.colors=[6,2,3,4,5,1];C.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(s,a){return a.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});var $=parseInt(process.env.DEBUG_FD,10)||2;$!==1&&$!==2&&ue.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var ya=$===1?process.stdout:$===2?process.stderr:va($);function ga(){return"colors"in C.inspectOpts?!!C.inspectOpts.colors:nn.isatty($)}i(ga,"useColors");C.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,ue.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};C.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,ue.inspect(t,this.inspectOpts)};function Ea(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,s="  \x1B[3"+n+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push("\x1B[3"+n+"m+"+C.humanize(this.diff)+"\x1B[0m")}else t[0]=new Date().toUTCString()+" "+e+" "+t[0]}i(Ea,"formatArgs");function Sa(){return ya.write(ue.format.apply(ue,arguments)+`
`)}i(Sa,"log");function Ta(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}i(Ta,"save");function sn(){return process.env.DEBUG}i(sn,"load");function va(t){var e,r=process.binding("tty_wrap");switch(r.guessHandleType(t)){case"TTY":e=new nn.WriteStream(t),e._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=require("fs");e=new n.SyncWriteStream(t,{autoClose:!1}),e._type="fs";break;case"PIPE":case"TCP":var s=require("net");e=new s.Socket({fd:t,readable:!1,writable:!0}),e.readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}i(va,"createWritableStdioStream");function ba(t){t.inspectOpts={};for(var e=Object.keys(C.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=C.inspectOpts[e[r]]}i(ba,"init");C.enable(sn())});var nt=h((Rh,rt)=>{typeof process<"u"&&process.type==="renderer"?rt.exports=rn():rt.exports=on()});var cn=h(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.default=null});var _n=h((Nh,mn)=>{var ln=9007199254740991,wa="[object Arguments]",Aa="[object Function]",Ca="[object GeneratorFunction]",Oa=/^(?:0|[1-9]\d*)$/;function pn(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}i(pn,"apply");function Ra(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}i(Ra,"baseTimes");var le=Object.prototype,pe=le.hasOwnProperty,hn=le.toString,Ia=le.propertyIsEnumerable,un=Math.max;function Na(t,e){var r=Ua(t)||Ba(t)?Ra(t.length,String):[],n=r.length,s=!!n;for(var a in t)(e||pe.call(t,a))&&!(s&&(a=="length"||dn(a,n)))&&r.push(a);return r}i(Na,"arrayLikeKeys");function xa(t,e,r,n){return t===void 0||it(t,le[r])&&!pe.call(n,r)?e:t}i(xa,"assignInDefaults");function Pa(t,e,r){var n=t[e];(!(pe.call(t,e)&&it(n,r))||r===void 0&&!(e in t))&&(t[e]=r)}i(Pa,"assignValue");function La(t){if(!ot(t))return ka(t);var e=Fa(t),r=[];for(var n in t)n=="constructor"&&(e||!pe.call(t,n))||r.push(n);return r}i(La,"baseKeysIn");function fn(t,e){return e=un(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=un(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=a,pn(t,this,o)}}i(fn,"baseRest");function Ma(t,e,r,n){r||(r={});for(var s=-1,a=e.length;++s<a;){var o=e[s],c=n?n(r[o],t[o],o,r,t):void 0;Pa(r,o,c===void 0?t[o]:c)}return r}i(Ma,"copyObject");function qa(t){return fn(function(e,r){var n=-1,s=r.length,a=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(a=t.length>3&&typeof a=="function"?(s--,a):void 0,o&&Da(r[0],r[1],o)&&(a=s<3?void 0:a,s=1),e=Object(e);++n<s;){var c=r[n];c&&t(e,c,n,a)}return e})}i(qa,"createAssigner");function dn(t,e){return e=e??ln,!!e&&(typeof t=="number"||Oa.test(t))&&t>-1&&t%1==0&&t<e}i(dn,"isIndex");function Da(t,e,r){if(!ot(r))return!1;var n=typeof e;return(n=="number"?at(r)&&dn(e,r.length):n=="string"&&e in r)?it(r[e],t):!1}i(Da,"isIterateeCall");function Fa(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||le;return t===r}i(Fa,"isPrototype");function ka(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}i(ka,"nativeKeysIn");function it(t,e){return t===e||t!==t&&e!==e}i(it,"eq");function Ba(t){return Ga(t)&&pe.call(t,"callee")&&(!Ia.call(t,"callee")||hn.call(t)==wa)}i(Ba,"isArguments");var Ua=Array.isArray;function at(t){return t!=null&&Ha(t.length)&&!Qa(t)}i(at,"isArrayLike");function Ga(t){return Wa(t)&&at(t)}i(Ga,"isArrayLikeObject");function Qa(t){var e=ot(t)?hn.call(t):"";return e==Aa||e==Ca}i(Qa,"isFunction");function Ha(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ln}i(Ha,"isLength");function ot(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}i(ot,"isObject");function Wa(t){return!!t&&typeof t=="object"}i(Wa,"isObjectLike");var ja=qa(function(t,e,r,n){Ma(e,Ka(e),t,n)}),Va=fn(function(t){return t.push(void 0,xa),pn(ja,void 0,t)});function Ka(t){return at(t)?Na(t,!0):La(t)}i(Ka,"keysIn");mn.exports=Va});var gn=h((Ph,yn)=>{var $a=require("util"),za=_n(),Ya=nt()("tunnel-ssh-config"),ct=i(function(t,e){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=t,this.extra=e},"ConfigError");$a.inherits(ct,Error);function Ja(t){var e=process.env;if(za(t||{},{username:e.TUNNELSSH_USER||e.USER||e.USERNAME||"root",port:22,host:null,srcPort:0,srcHost:"127.0.0.1",dstPort:null,dstHost:"127.0.0.1",localHost:"127.0.0.1",localPort:t.dstPort,agent:process.env.SSH_AUTH_SOCK}),!t.host)throw new ct("host not set");if(!t.dstPort)throw new ct("dstPort not set");return Ya("ssh-config",function(){var r=["password","privateKey"];return Object.keys(t).reduce(function(n,s){return r.indexOf(s)===-1?n[s]=t[s]:n[s]="***HIDDEN***",n},{})}()),t}i(Ja,"createConfig");yn.exports=Ja});var Sn=h((Mh,En)=>{var Za=require("net"),ut=nt()("tunnel-ssh"),Xa=cn().Client,eo=gn(),to=require("events"),ro=i(function(){},"noop");function no(t,e){var r=new Xa;return e.on("close",r.end.bind(r)),r.on("ready",function(){ut("sshConnection:ready"),e.emit("sshConnection",r,e),r.forwardOut(t.srcHost,t.srcPort,t.dstHost,t.dstPort,function(n,s){if(n){e.emit("error",n),ut("Destination port:",n);return}ut("sshStream:create"),e.emit("sshStream",s),e.pipe(s).pipe(e)})}),r}i(no,"bindSSHConnection");function so(t,e){return e.reduce(function(r,n){return delete r[n],r},Object.assign({},t))}i(so,"omit");function io(t){var e,r=[],n=0;return e=Za.createServer(function(s){var a;n++,s.on("error",e.emit.bind(e,"error")),s.on("close",function(){n--,n===0&&(t.keepAlive||setTimeout(function(){n===0&&e.close()},2))}),e.emit("netConnection",s,e),a=no(t,s),a.on("error",e.emit.bind(e,"error")),s.on("sshStream",function(o){o.on("error",function(){e.close()})}),r.push(a,s);try{a.connect(so(t,["localPort","localHost"]))}catch(o){e.emit("error",o)}}),e.on("close",function(){r.forEach(function(s){s.end()})}),e}i(io,"createServer");function ao(t,e){var r,n;e||(e=ro);try{n=eo(t),r=io(n),r.listen(n.localPort,n.localHost,function(s){e(s,r)})}catch(s){r=new to.EventEmitter,setImmediate(function(){e(s),r.emit("error",s)})}return r}i(ao,"tunnel");En.exports=ao});var pt=h(Tn=>{"use strict";Tn.parse=function(t,e){return new lt(t,e).parse()};var Re=class Re{constructor(e,r){this.source=e,this.transform=r||oo,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new Re(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Re,"ArrayParser");var lt=Re;function oo(t){return t}i(oo,"identity")});var ht=h((kh,vn)=>{var co=pt();vn.exports={create:function(t,e){return{parse:function(){return co.parse(t,e)}}}}});var An=h((Bh,wn)=>{"use strict";var uo=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,lo=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,po=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,ho=/^-?infinity$/;wn.exports=i(function(e){if(ho.test(e))return Number(e.replace("i","I"));var r=uo.exec(e);if(!r)return fo(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=bn(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var f,m=mo(e);return m!=null?(f=new Date(Date.UTC(s,a,o,c,l,u,p)),ft(s)&&f.setUTCFullYear(s),m!==0&&f.setTime(f.getTime()-m)):(f=new Date(s,a,o,c,l,u,p),ft(s)&&f.setFullYear(s)),f},"parseDate");function fo(t){var e=lo.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=bn(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return ft(r)&&o.setFullYear(r),o}}i(fo,"getDate");function mo(t){if(t.endsWith("+00"))return 0;var e=po.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(mo,"timeZoneOffset");function bn(t){return-(t-1)}i(bn,"bcYearToNegativeYear");function ft(t){return t>=0&&t<100}i(ft,"is0To99")});var On=h((Gh,Cn)=>{Cn.exports=yo;var _o=Object.prototype.hasOwnProperty;function yo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)_o.call(r,n)&&(t[n]=r[n])}return t}i(yo,"extend")});var Nn=h((Hh,In)=>{"use strict";var go=On();In.exports=z;function z(t){if(!(this instanceof z))return new z(t);go(this,No(t))}i(z,"PostgresInterval");var Eo=["seconds","minutes","hours","days","months","years"];z.prototype.toPostgres=function(){var t=Eo.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var So={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},To=["years","months","days"],vo=["hours","minutes","seconds"];z.prototype.toISOString=z.prototype.toISO=function(){var t=To.map(r,this).join(""),e=vo.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+So[n]}};var dt="([+-]?\\d+)",bo=dt+"\\s+years?",wo=dt+"\\s+mons?",Ao=dt+"\\s+days?",Co="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Oo=new RegExp([bo,wo,Ao,Co].map(function(t){return"("+t+")?"}).join("\\s*")),Rn={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Ro=["hours","minutes","seconds","milliseconds"];function Io(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Io,"parseMilliseconds");function No(t){if(!t)return{};var e=Oo.exec(t),r=e[8]==="-";return Object.keys(Rn).reduce(function(n,s){var a=Rn[s],o=e[a];return!o||(o=s==="milliseconds"?Io(o):parseInt(o,10),!o)||(r&&~Ro.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(No,"parse")});var Pn=h((jh,xn)=>{"use strict";xn.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Bn=h((Kh,kn)=>{var he=pt(),fe=ht(),Ie=An(),Mn=Nn(),qn=Pn();function Ne(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Ne,"allowNull");function Dn(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(Dn,"parseBool");function xo(t){return t?he.parse(t,Dn):null}i(xo,"parseBoolArray");function Po(t){return parseInt(t,10)}i(Po,"parseBaseTenInt");function mt(t){return t?he.parse(t,Ne(Po)):null}i(mt,"parseIntegerArray");function Lo(t){return t?he.parse(t,Ne(function(e){return Fn(e).trim()})):null}i(Lo,"parseBigIntegerArray");var Mo=i(function(t){if(!t)return null;var e=fe.create(t,function(r){return r!==null&&(r=Et(r)),r});return e.parse()},"parsePointArray"),_t=i(function(t){if(!t)return null;var e=fe.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),q=i(function(t){if(!t)return null;var e=fe.create(t);return e.parse()},"parseStringArray"),yt=i(function(t){if(!t)return null;var e=fe.create(t,function(r){return r!==null&&(r=Ie(r)),r});return e.parse()},"parseDateArray"),qo=i(function(t){if(!t)return null;var e=fe.create(t,function(r){return r!==null&&(r=Mn(r)),r});return e.parse()},"parseIntervalArray"),Do=i(function(t){return t?he.parse(t,Ne(qn)):null},"parseByteAArray"),gt=i(function(t){return parseInt(t,10)},"parseInteger"),Fn=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Ln=i(function(t){return t?he.parse(t,Ne(JSON.parse)):null},"parseJsonArray"),Et=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Fo=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=Et(e);return a.radius=parseFloat(r),a},"parseCircle"),ko=i(function(t){t(20,Fn),t(21,gt),t(23,gt),t(26,gt),t(700,parseFloat),t(701,parseFloat),t(16,Dn),t(1082,Ie),t(1114,Ie),t(1184,Ie),t(600,Et),t(651,q),t(718,Fo),t(1e3,xo),t(1001,Do),t(1005,mt),t(1007,mt),t(1028,mt),t(1016,Lo),t(1017,Mo),t(1021,_t),t(1022,_t),t(1231,_t),t(1014,q),t(1015,q),t(1008,q),t(1009,q),t(1040,q),t(1041,q),t(1115,yt),t(1182,yt),t(1185,yt),t(1186,Mn),t(1187,qo),t(17,qn),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Ln),t(3807,Ln),t(3907,q),t(2951,q),t(791,q),t(1183,q),t(1270,q)},"init");kn.exports={init:ko}});var Gn=h((zh,Un)=>{"use strict";var P=1e6;function Bo(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,l,u,p;{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}{if(a=e%P,e=e/P>>>0,o=4294967296*a+r,r=o/P>>>0,c=""+(o-P*r),r===0&&e===0)return n+c+s;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";s=l+c+s}return a=e%P,o=4294967296*a+r,c=""+o%P,n+c+s}i(Bo,"readInt8");Un.exports=Bo});var Vn=h((Jh,jn)=>{var Uo=Gn(),T=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(E,M,x){return E*Math.pow(2,x)+M};var a=r>>3,o=i(function(E){return n?~E&255:E},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=s(0,o(t[a])&c,l));for(var p=e+r>>3,f=a+1;f<p;f++)u=s(u,o(t[f]),8);var m=(e+r)%8;return m>0&&(u=s(u,o(t[p])>>8-m,m)),u},"parseBits"),Wn=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=T(t,1),a=T(t,r,1);if(a===0)return 0;var o=1,c=i(function(u,p,f){u===0&&(u=1);for(var m=1;m<=f;m++)o/=2,(p&1<<f-m)>0&&(u+=o);return u},"parsePrecisionBits"),l=T(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?l===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*l},"parseFloatFromBits"),Go=i(function(t){return T(t,1)==1?-1*(T(t,15,1,!0)+1):T(t,15,1)},"parseInt16"),Qn=i(function(t){return T(t,1)==1?-1*(T(t,31,1,!0)+1):T(t,31,1)},"parseInt32"),Qo=i(function(t){return Wn(t,23,8)},"parseFloat32"),Ho=i(function(t){return Wn(t,52,11)},"parseFloat64"),Wo=i(function(t){var e=T(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,T(t,16,16)),n=0,s=[],a=T(t,16),o=0;o<a;o++)n+=T(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,T(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),Hn=i(function(t,e){var r=T(e,1),n=T(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),de=i(function(t){for(var e=T(t,32),r=T(t,32,32),n=T(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=T(t,32,s),s+=32,s+=32;var c=i(function(u){var p=T(t,32,s);if(s+=32,p==4294967295)return null;var f;if(u==23||u==20)return f=T(t,p*8,s),s+=p*8,f;if(u==25)return f=t.toString(this.encoding,s>>3,(s+=p<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var f=[],m;if(u.length>1){var E=u.shift();for(m=0;m<E;m++)f[m]=l(u,p);u.unshift(E)}else for(m=0;m<u[0];m++)f[m]=c(p);return f},"parse");return l(a,n)},"parseArray"),jo=i(function(t){return t.toString("utf8")},"parseText"),Vo=i(function(t){return t===null?null:T(t,8)>0},"parseBool"),Ko=i(function(t){t(20,Uo),t(21,Go),t(23,Qn),t(26,Qn),t(1700,Wo),t(700,Qo),t(701,Ho),t(16,Vo),t(1114,Hn.bind(null,!1)),t(1184,Hn.bind(null,!0)),t(1e3,de),t(1007,de),t(1016,de),t(1008,de),t(1009,de),t(25,jo)},"init");jn.exports={init:Ko}});var $n=h((Xh,Kn)=>{Kn.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var ye=h(_e=>{var $o=Bn(),zo=Vn(),Yo=ht(),Jo=$n();_e.getTypeParser=Zo;_e.setTypeParser=Xo;_e.arrayParser=Yo;_e.builtins=Jo;var me={text:{},binary:{}};function zn(t){return String(t)}i(zn,"noParse");function Zo(t,e){return e=e||"text",me[e]&&me[e][t]||zn}i(Zo,"getTypeParser");function Xo(t,e,r){typeof e=="function"&&(r=e,e="text"),me[e][t]=r}i(Xo,"setTypeParser");$o.init(function(t,e){me.text[t]=e});zo.init(function(t,e){me.binary[t]=e})});var ge=h((rf,St)=>{"use strict";St.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Y=ye(),ec=Y.getTypeParser(20,"text"),tc=Y.getTypeParser(1016,"text");St.exports.__defineSetter__("parseInt8",function(t){Y.setTypeParser(20,"text",t?Y.getTypeParser(23,"text"):ec),Y.setTypeParser(1016,"text",t?Y.getTypeParser(1007,"text"):tc)})});var Ee=h((nf,Jn)=>{"use strict";var rc=ge();function nc(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(nc,"escapeElement");function Yn(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+Yn(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=nc(xe(t[r]));return e=e+"}",e}i(Yn,"arrayString");var xe=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?rc.parseInputDatesAsUTC?ac(t):ic(t):Array.isArray(t)?Yn(t):typeof t=="object"?sc(t,e):t.toString()},"prepareValue");function sc(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),xe(t.toPostgres(xe),e)}return JSON.stringify(t)}i(sc,"prepareObject");function R(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(R,"pad");function ic(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=R(r,4)+"-"+R(t.getMonth()+1,2)+"-"+R(t.getDate(),2)+"T"+R(t.getHours(),2)+":"+R(t.getMinutes(),2)+":"+R(t.getSeconds(),2)+"."+R(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=R(Math.floor(e/60),2)+":"+R(e%60,2),n&&(s+=" BC"),s}i(ic,"dateToString");function ac(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=R(e,4)+"-"+R(t.getUTCMonth()+1,2)+"-"+R(t.getUTCDate(),2)+"T"+R(t.getUTCHours(),2)+":"+R(t.getUTCMinutes(),2)+":"+R(t.getUTCSeconds(),2)+"."+R(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(ac,"dateToStringUTC");function oc(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(oc,"normalizeQueryConfig");var cc=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),uc=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");Jn.exports={prepareValue:i(function(e){return xe(e)},"prepareValueWrapper"),normalizeQueryConfig:oc,escapeIdentifier:cc,escapeLiteral:uc}});var Xn=h((af,Zn)=>{"use strict";var Se=require("crypto");function Tt(t){return Se.createHash("md5").update(t,"utf-8").digest("hex")}i(Tt,"md5");function lc(t,e,r){var n=Tt(e+t),s=Tt(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(lc,"postgresMd5PasswordHash");function pc(t){return Se.createHash("sha256").update(t).digest()}i(pc,"sha256");function hc(t,e){return Se.createHmac("sha256",t).update(e).digest()}i(hc,"hmacSha256");async function fc(t,e,r){return Se.pbkdf2Sync(t,e,r,32,"sha256")}i(fc,"deriveKey");Zn.exports={postgresMd5PasswordHash:lc,randomBytes:Se.randomBytes,deriveKey:fc,sha256:pc,hmacSha256:hc,md5:Tt}});var ns=h((cf,rs)=>{var es=require("crypto");rs.exports={postgresMd5PasswordHash:mc,randomBytes:dc,deriveKey:gc,sha256:_c,hmacSha256:yc,md5:vt};var ts=es.webcrypto||globalThis.crypto,J=ts.subtle,bt=new TextEncoder;function dc(t){return ts.getRandomValues(Buffer.alloc(t))}i(dc,"randomBytes");async function vt(t){try{return es.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?bt.encode(t):t,n=await J.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(vt,"md5");async function mc(t,e,r){var n=await vt(e+t),s=await vt(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(mc,"postgresMd5PasswordHash");async function _c(t){return await J.digest("SHA-256",t)}i(_c,"sha256");async function yc(t,e){let r=await J.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await J.sign("HMAC",r,bt.encode(e))}i(yc,"hmacSha256");async function gc(t,e,r){let n=await J.importKey("raw",bt.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await J.deriveBits(s,n,32*8,["deriveBits"])}i(gc,"deriveKey")});var At=h((lf,wt)=>{"use strict";var Ec=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Ec?wt.exports=Xn():wt.exports=ns()});var os=h((pf,as)=>{"use strict";var H=At();function Sc(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=H.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(Sc,"startSession");async function Tc(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=wc(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,l=Buffer.from(n.salt,"base64"),u=await H.deriveKey(e,l,n.iteration),p=await H.hmacSha256(u,"Client Key"),f=await H.sha256(p),m=await H.hmacSha256(f,c),E=Cc(Buffer.from(p),Buffer.from(m)).toString("base64"),M=await H.hmacSha256(u,"Server Key"),x=await H.hmacSha256(M,c);t.message="SASLResponse",t.serverSignature=Buffer.from(x).toString("base64"),t.response=o+",p="+E}i(Tc,"continueSession");function vc(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Ac(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(vc,"finalizeSession");function bc(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(bc,"isPrintableChars");function ss(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(ss,"isBase64");function is(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(is,"parseAttributePairs");function wc(t){let e=is(t),r=e.get("r");if(r){if(!bc(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!ss(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(wc,"parseServerFirstMessage");function Ac(t){let r=is(t).get("v");if(r){if(!ss(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Ac,"parseServerFinalMessage");function Cc(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(Cc,"xorBuffers");as.exports={startSession:Sc,continueSession:Tc,finalizeSession:vc}});var Ct=h((ff,cs)=>{"use strict";var Oc=ye();function Pe(t){this._types=t||Oc,this.text={},this.binary={}}i(Pe,"TypeOverrides");Pe.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Pe.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Pe.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};cs.exports=Pe});var ls=h((mf,us)=>{"use strict";function Ot(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(Ot,"parse");us.exports=Ot;Ot.parse=Ot});var Nt=h((yf,fs)=>{"use strict";var Rc=require("dns"),hs=ge(),ps=ls().parse,N=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||hs[t]},"val"),Ic=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return hs.ssl},"readSSLConfigFromEnvironment"),Z=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),D=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+Z(n))},"add"),It=class It{constructor(e){e=typeof e=="string"?ps(e):e||{},e.connectionString&&(e=Object.assign({},e,ps(e.connectionString))),this.user=N("user",e),this.database=N("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(N("port",e),10),this.host=N("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:N("password",e)}),this.binary=N("binary",e),this.options=N("options",e),this.ssl=typeof e.ssl>"u"?Ic():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=N("client_encoding",e),this.replication=N("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=N("application_name",e,"PGAPPNAME"),this.fallback_application_name=N("fallback_application_name",e,!1),this.statement_timeout=N("statement_timeout",e,!1),this.lock_timeout=N("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=N("idle_in_transaction_session_timeout",e,!1),this.query_timeout=N("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];D(r,this,"user"),D(r,this,"password"),D(r,this,"port"),D(r,this,"application_name"),D(r,this,"fallback_application_name"),D(r,this,"connect_timeout"),D(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(D(r,n,"sslmode"),D(r,n,"sslca"),D(r,n,"sslkey"),D(r,n,"sslcert"),D(r,n,"sslrootcert"),this.database&&r.push("dbname="+Z(this.database)),this.replication&&r.push("replication="+Z(this.replication)),this.host&&r.push("host="+Z(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+Z(this.client_encoding)),Rc.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+Z(a)),e(null,r.join(" ")))})}};i(It,"ConnectionParameters");var Rt=It;fs.exports=Rt});var _s=h((Ef,ms)=>{"use strict";var Nc=ye(),ds=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Pt=class Pt{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=ds.exec(e.text):r=ds.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=Nc.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(Pt,"Result");var xt=Pt;ms.exports=xt});var Ss=h((Tf,Es)=>{"use strict";var{EventEmitter:xc}=require("events"),ys=_s(),gs=Ee(),Mt=class Mt extends xc{constructor(e,r,n){super(),e=gs.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new ys(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new ys(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:gs.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(Mt,"Query");var Lt=Mt;Es.exports=Lt});var ur=h(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.NoticeMessage=d.DataRowMessage=d.CommandCompleteMessage=d.ReadyForQueryMessage=d.NotificationResponseMessage=d.BackendKeyDataMessage=d.AuthenticationMD5Password=d.ParameterStatusMessage=d.ParameterDescriptionMessage=d.RowDescriptionMessage=d.Field=d.CopyResponse=d.CopyDataMessage=d.DatabaseError=d.copyDone=d.emptyQuery=d.replicationStart=d.portalSuspended=d.noData=d.closeComplete=d.bindComplete=d.parseComplete=void 0;d.parseComplete={name:"parseComplete",length:5};d.bindComplete={name:"bindComplete",length:5};d.closeComplete={name:"closeComplete",length:5};d.noData={name:"noData",length:5};d.portalSuspended={name:"portalSuspended",length:5};d.replicationStart={name:"replicationStart",length:4};d.emptyQuery={name:"emptyQuery",length:4};d.copyDone={name:"copyDone",length:4};var zt=class zt extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(zt,"DatabaseError");var qt=zt;d.DatabaseError=qt;var Yt=class Yt{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Yt,"CopyDataMessage");var Dt=Yt;d.CopyDataMessage=Dt;var Jt=class Jt{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Jt,"CopyResponse");var Ft=Jt;d.CopyResponse=Ft;var Zt=class Zt{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(Zt,"Field");var kt=Zt;d.Field=kt;var Xt=class Xt{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Xt,"RowDescriptionMessage");var Bt=Xt;d.RowDescriptionMessage=Bt;var er=class er{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(er,"ParameterDescriptionMessage");var Ut=er;d.ParameterDescriptionMessage=Ut;var tr=class tr{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(tr,"ParameterStatusMessage");var Gt=tr;d.ParameterStatusMessage=Gt;var rr=class rr{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(rr,"AuthenticationMD5Password");var Qt=rr;d.AuthenticationMD5Password=Qt;var nr=class nr{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(nr,"BackendKeyDataMessage");var Ht=nr;d.BackendKeyDataMessage=Ht;var sr=class sr{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(sr,"NotificationResponseMessage");var Wt=sr;d.NotificationResponseMessage=Wt;var ir=class ir{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(ir,"ReadyForQueryMessage");var jt=ir;d.ReadyForQueryMessage=jt;var ar=class ar{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(ar,"CommandCompleteMessage");var Vt=ar;d.CommandCompleteMessage=Vt;var or=class or{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(or,"DataRowMessage");var Kt=or;d.DataRowMessage=Kt;var cr=class cr{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(cr,"NoticeMessage");var $t=cr;d.NoticeMessage=$t});var Ts=h(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.Writer=void 0;var pr=class pr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(pr,"Writer");var lr=pr;Le.Writer=lr});var bs=h(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.serialize=void 0;var hr=Ts(),v=new hr.Writer,Pc=i(t=>{v.addInt16(3).addInt16(0);for(let n of Object.keys(t))v.addCString(n).addCString(t[n]);v.addCString("client_encoding").addCString("UTF8");var e=v.addCString("").flush(),r=e.length+4;return new hr.Writer().addInt32(r).add(e).flush()},"startup"),Lc=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Mc=i(t=>v.addCString(t).flush(112),"password"),qc=i(function(t,e){return v.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),v.flush(112)},"sendSASLInitialResponseMessage"),Dc=i(function(t){return v.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Fc=i(t=>v.addCString(t).flush(81),"query"),vs=[],kc=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||vs;for(var n=r.length,s=v.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return v.flush(80)},"parse"),X=new hr.Writer,Bc=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(v.addInt16(0),X.addInt32(-1)):n instanceof Buffer?(v.addInt16(1),X.addInt32(n.length),X.add(n)):(v.addInt16(0),X.addInt32(Buffer.byteLength(n)),X.addString(n))}},"writeValues"),Uc=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||vs,a=s.length;return v.addCString(e).addCString(r),v.addInt16(a),Bc(s,t.valueMapper),v.addInt16(a),v.add(X.flush()),v.addInt16(n?1:0),v.flush(66)},"bind"),Gc=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Qc=i(t=>{if(!t||!t.portal&&!t.rows)return Gc;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),Hc=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),fr=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Wc=v.addCString("P").flush(68),jc=v.addCString("S").flush(68),Vc=i(t=>t.name?fr(68,`${t.type}${t.name||""}`):t.type==="P"?Wc:jc,"describe"),Kc=i(t=>{let e=`${t.type}${t.name||""}`;return fr(67,e)},"close"),$c=i(t=>v.add(t).flush(100),"copyData"),zc=i(t=>fr(102,t),"copyFail"),Me=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),Yc=Me(72),Jc=Me(83),Zc=Me(88),Xc=Me(99),eu={startup:Pc,password:Mc,requestSsl:Lc,sendSASLInitialResponseMessage:qc,sendSCRAMClientFinalMessage:Dc,query:Fc,parse:kc,bind:Uc,execute:Qc,describe:Vc,close:Kc,flush:()=>Yc,sync:()=>Jc,end:()=>Zc,copyData:$c,copyDone:()=>Xc,copyFail:zc,cancel:Hc};qe.serialize=eu});var ws=h(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.BufferReader=void 0;var tu=Buffer.allocUnsafe(0),mr=class mr{constructor(e=0){this.offset=e,this.buffer=tu,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(mr,"BufferReader");var dr=mr;De.BufferReader=dr});var Os=h(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Parser=void 0;var b=ur(),ru=ws(),_r=1,nu=4,As=_r+nu,Cs=Buffer.allocUnsafe(0),gr=class gr{constructor(e){if(this.buffer=Cs,this.bufferLength=0,this.bufferOffset=0,this.reader=new ru.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+As<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+_r),c=_r+o;if(c+s<=n){let l=this.handlePacket(s+As,a,o,this.buffer);r(l),s+=c}else break}s===n?(this.buffer=Cs,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return b.bindComplete;case 49:return b.parseComplete;case 51:return b.closeComplete;case 110:return b.noData;case 115:return b.portalSuspended;case 99:return b.copyDone;case 87:return b.replicationStart;case 73:return b.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new b.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new b.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new b.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new b.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new b.CopyResponse(r,s,a,o);for(let l=0;l<o;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new b.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new b.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new b.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new b.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new b.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new b.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new b.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new b.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,l=s==="notice"?new b.NoticeMessage(r,c):new b.DatabaseError(c,r,s);return l.severity=a.S,l.code=a.C,l.detail=a.D,l.hint=a.H,l.position=a.P,l.internalPosition=a.p,l.internalQuery=a.q,l.where=a.W,l.schema=a.s,l.table=a.t,l.column=a.c,l.dataType=a.d,l.constraint=a.n,l.file=a.F,l.line=a.L,l.routine=a.R,l}};i(gr,"Parser");var yr=gr;Fe.Parser=yr});var Er=h(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.DatabaseError=G.serialize=G.parse=void 0;var su=ur();Object.defineProperty(G,"DatabaseError",{enumerable:!0,get:function(){return su.DatabaseError}});var iu=bs();Object.defineProperty(G,"serialize",{enumerable:!0,get:function(){return iu.serialize}});var au=Os();function ou(t,e){let r=new au.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(ou,"parse");G.parse=ou});var Rs={};Zi(Rs,{default:()=>cu});var cu,Is=Ji(()=>{cu={}});var Ns=h((qf,Sr)=>{Sr.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Is(),ea(Rs));return new n(e)}},"getStream");Sr.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var br=h((kf,xs)=>{"use strict";var Ff=require("net"),uu=require("events").EventEmitter,{parse:lu,serialize:O}=Er(),{getStream:pu,getSecureStream:hu}=Ns(),fu=O.flush(),du=O.sync(),mu=O.end(),vr=class vr extends uu{constructor(e){super(),e=e||{},this.stream=e.stream||pu(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{n.stream=hu(c)}catch(u){return n.emit("error",u)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){lu(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(O.requestSsl())}startup(e){this.stream.write(O.startup(e))}cancel(e,r){this._send(O.cancel(e,r))}password(e){this._send(O.password(e))}sendSASLInitialResponseMessage(e,r){this._send(O.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(O.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(O.query(e))}parse(e){this._send(O.parse(e))}bind(e){this._send(O.bind(e))}execute(e){this._send(O.execute(e))}flush(){this.stream.writable&&this.stream.write(fu)}sync(){this._ending=!0,this._send(du)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(mu,()=>{this.stream.end()})}close(e){this._send(O.close(e))}describe(e){this._send(O.describe(e))}sendCopyFromChunk(e){this._send(O.copyData(e))}endCopyFrom(){this._send(O.copyDone())}sendCopyFail(e){this._send(O.copyFail(e))}};i(vr,"Connection");var Tr=vr;xs.exports=Tr});var qs=h((Uf,Ms)=>{"use strict";var{Transform:_u}=require("stream"),{StringDecoder:yu}=require("string_decoder"),Q=Symbol("last"),ke=Symbol("decoder");function gu(t,e,r){let n;if(this.overflow){if(n=this[ke].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[Q]+=this[ke].write(t),n=this[Q].split(this.matcher);this[Q]=n.pop();for(let s=0;s<n.length;s++)try{Ls(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[Q].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(gu,"transform");function Eu(t){if(this[Q]+=this[ke].end(),this[Q])try{Ls(this,this.mapper(this[Q]))}catch(e){return t(e)}t()}i(Eu,"flush");function Ls(t,e){e!==void 0&&t.push(e)}i(Ls,"push");function Ps(t){return t}i(Ps,"noop");function Su(t,e,r){switch(t=t||/\r?\n/,e=e||Ps,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Ps)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=gu,r.flush=Eu,r.readableObjectMode=!0;let n=new _u(r);return n[Q]="",n[ke]=new yu("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(Su,"split");Ms.exports=Su});var ks=h((Qf,B)=>{"use strict";var Ds=require("path"),Tu=require("stream").Stream,vu=qs(),Fs=require("util"),bu=5432,Be=process.platform==="win32",Te=process.stderr,wu=56,Au=7,Cu=61440,Ou=32768;function Ru(t){return(t&Cu)==Ou}i(Ru,"isRegFile");var ee=["host","port","database","user","password"],wr=ee.length,Iu=ee[wr-1];function Ar(){var t=Te instanceof Tu&&Te.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);Te.write(Fs.format.apply(Fs,e))}}i(Ar,"warn");Object.defineProperty(B.exports,"isWin",{get:function(){return Be},set:function(t){Be=t}});B.exports.warnTo=function(t){var e=Te;return Te=t,e};B.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Be?Ds.join(e.APPDATA||"./","postgresql","pgpass.conf"):Ds.join(e.HOME||"./",".pgpass"));return r};B.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Be?!0:(e=e||"<unkn>",Ru(t.mode)?t.mode&(wu|Au)?(Ar('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Ar('WARNING: password file "%s" is not a plain file',e),!1))};var Nu=B.exports.match=function(t,e){return ee.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||bu)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};B.exports.getPassword=function(t,e,r){var n,s=e.pipe(vu());function a(l){var u=xu(l);u&&Pu(u)&&Nu(t,u)&&(n=u[Iu],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(l){e.destroy(),Ar("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var xu=B.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,l=i(function(p,f,m){var E=t.substring(f,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(E=E.replace(/\\([:\\])/g,"$1")),o[ee[p]]=E},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=n==wr-1,c){l(n,s);break}u>=0&&e==":"&&r!=="\\"&&(l(n,s,u+1),s=u+2,n+=1)}return o=Object.keys(o).length===wr?o:null,o},Pu=B.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<ee.length;r+=1){var n=e[r],s=t[ee[r]]||"",a=n(s);if(!a)return!1}return!0}});var Us=h((jf,Cr)=>{"use strict";var Wf=require("path"),Bs=require("fs"),Ue=ks();Cr.exports=function(t,e){var r=Ue.getFileName();Bs.stat(r,function(n,s){if(n||!Ue.usePgPass(s,r))return e(void 0);var a=Bs.createReadStream(r);Ue.getPassword(t,a,e)})};Cr.exports.warnTo=Ue.warnTo});var Ws=h((Vf,Hs)=>{"use strict";var Lu=require("events").EventEmitter,Gs=Ee(),Or=os(),Mu=Ct(),qu=Nt(),Qs=Ss(),Du=ge(),Fu=br(),ku=At(),Rr=class Rr extends Lu{constructor(e){super(),this.connectionParameters=new qu(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Mu(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Fu({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Du.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{Us()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await ku.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Or.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Or.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Or.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Gs.escapeIdentifier(e)}escapeLiteral(e){return Gs.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new Qs(e,r,n),s.callback||(a=new this._Promise((u,p)=>{s.callback=(f,m)=>f?p(f):u(m)}).catch(u=>{throw Error.captureStackTrace(u),u}))),o&&(l=s.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),l(u),s.callback=()=>{};var p=this.queryQueue.indexOf(s);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),s.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(Rr,"Client");var Ge=Rr;Ge.Query=Qs;Hs.exports=Ge});var $s=h(($f,Ks)=>{"use strict";var Bu=require("events").EventEmitter,js=i(function(){},"NOOP"),Vs=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),xr=class xr{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(xr,"IdleItem");var Ir=xr,Pr=class Pr{constructor(e){this.callback=e}};i(Pr,"PendingItem");var te=Pr;function Uu(){throw new Error("Release called on client which has already been released to the pool.")}i(Uu,"throwOnDoubleRelease");function Qe(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(Qe,"promisify");function Gu(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(Gu,"makeIdleListener");var Lr=class Lr extends Bu{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Mr().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=Vs(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Qe(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new te(r.callback)),n;let s=i((c,l,u)=>{clearTimeout(o),r.callback(c,l,u)},"queueCallback"),a=new te(s),o=setTimeout(()=>{Vs(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new te(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=Gu(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,js);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new te((u,p,f)=>f()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,js);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Uu(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Ir(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Qe(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=Qe(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,l=i(u=>{c||(c=!0,o.release(u),n(u))},"onError");o.once("error",l),this.log("dispatching query");try{o.query(e,r,(u,p)=>{if(this.log("query dispatched"),o.removeListener("error",l),!c)return c=!0,o.release(u),u?n(u):n(void 0,p)})}catch(u){return o.release(u),n(u)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Qe(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(Lr,"Pool");var Nr=Lr;Ks.exports=Nr});var Js=h((Yf,Ys)=>{"use strict";var zs=require("events").EventEmitter,Qu=require("util"),qr=Ee(),re=Ys.exports=function(t,e,r){zs.call(this),t=qr.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};Qu.inherits(re,zs);var Hu={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};re.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=Hu[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};re.prototype.then=function(t,e){return this._getPromise().then(t,e)};re.prototype.catch=function(t){return this._getPromise().catch(t)};re.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};re.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):o.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(qr.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(qr.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var ri=h((Zf,ti)=>{"use strict";var Zs;try{Zs=require("pg-native")}catch(t){throw t}var Wu=Ct(),Xs=require("events").EventEmitter,ju=require("util"),Vu=Nt(),ei=Js(),L=ti.exports=function(t){Xs.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Wu(t.types),this.native=new Zs({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Vu(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};L.Query=ei;ju.inherits(L,Xs);L.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};L.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};L.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};L.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new ei(t,e,r),!n.callback){let l,u;s=new this._Promise((p,f)=>{l=p,u=f}).catch(p=>{throw Error.captureStackTrace(p),p}),n.callback=(p,f)=>p?u(p):l(f)}return a&&(c=n.callback,o=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),c(l),n.callback=()=>{};var u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),n.callback=(l,u)=>{clearTimeout(o),c(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};L.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};L.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};L.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};L.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};L.prototype.ref=function(){};L.prototype.unref=function(){};L.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};L.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Dr=h((ed,ni)=>{"use strict";ni.exports=ri()});var Mr=h((td,ve)=>{"use strict";var Ku=Ws(),$u=ge(),zu=br(),Yu=$s(),{DatabaseError:Ju}=Er(),{escapeIdentifier:Zu,escapeLiteral:Xu}=Ee(),el=i(t=>{var e;return e=class extends Yu{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),Fr=i(function(t){this.defaults=$u,this.Client=t,this.Query=this.Client.Query,this.Pool=el(this.Client),this._pools=[],this.Connection=zu,this.types=ye(),this.DatabaseError=Ju,this.escapeIdentifier=Zu,this.escapeLiteral=Xu},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ve.exports=new Fr(Dr()):(ve.exports=new Fr(Ku),Object.defineProperty(ve.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new Fr(Dr())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ve.exports,"native",{value:t}),t}}))});var ii=h((nd,si)=>{"use strict";var W=require("fs"),tl=Sn(),rl=Mr(),nl="The server does not support SSL connections",sl="28000",il=i(t=>{let e={username:t.ssh_user,host:t.ssh_host,port:t.ssh_port,dstHost:t.host,dstPort:t.port,localHost:"127.0.0.1",localPort:t.port,keepAlive:!0};return t.ssh_method==="privateKey"?Object.assign({},e,{privateKey:W.readFileSync(t.ssh_key_file),passphrase:t.ssh_key_passphrase}):Object.assign({},e,{password:t.ssh_password})},"getSshConfig"),al=i(t=>new Promise((e,r)=>{tl(il(t),(n,s)=>{n?r(n):e({tunnel:s,info:Object.assign({},t,{host:"127.0.0.1"})})})}),"connectViaSsh"),ol=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return W.existsSync(t.certAuthority)&&(n.ca=W.readFileSync(t.certAuthority).toString()),W.existsSync(t.clientCert)&&(n.cert=W.readFileSync(t.clientCert).toString()),W.existsSync(t.clientPrivateKey)&&(n.key=W.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),cl=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),ul=i(async(t,e)=>{let r=null;if(t.ssh){let{info:a,tunnel:o}=await al(t);r=o,t=a}t=Object.assign({},t,{sslType:cl(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:ol(t,e),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await kr(n,e),sshTunnel:r}},"createClient"),ll=i((t,e,r)=>{var n;if(r.message===nl&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),kr({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===sl&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),kr({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),kr=i((t,e)=>{let r=new rl.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return ll(t,e,n)})},"createConnectionPool");si.exports={createClient:ul}});var Br=h((id,ci)=>{"use strict";var ai=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),oi={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
		SELECT tables.table_name, tables.table_type
		FROM information_schema.tables AS tables
		INNER JOIN (
			SELECT pg_class.relname AS table_name,
				   pg_namespace.nspname AS table_schema
			FROM pg_catalog.pg_class AS pg_class
				INNER JOIN pg_catalog.pg_namespace AS pg_namespace
				ON (pg_namespace.oid = pg_class.relnamespace)
			WHERE (pg_class.relispartition = false OR pg_class.relispartition IS NULL) AND pg_class.relkind = ANY ('{"r","v","t","m","p"}')
		) AS catalog_table_data
		ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
		WHERE tables.table_schema = $1;
	`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1, $2)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:`
    SELECT indexname,
           index_id,
           index_method,
           index_unique,
           number_of_keys,
           where_expression,
           array_agg(attname ORDER BY ord)::text[] AS columns,
           array_agg(coll ORDER BY ord) AS collations,
           array_agg(opclass ORDER BY ord) AS opclasses,
           array_agg(expression ORDER BY ord) AS expressions,
           array_agg(ascending ORDER BY ord) AS ascendings,
           array_agg(nulls_first ORDER BY ord) AS nulls_first,
           reloptions AS storage_parameters
    FROM (
        SELECT ct.oid AS table_oid,
            c.relname AS indexname,
            m.amname AS index_method,
            indexes.indisunique AS index_unique,
            indexes.ord,
            attribute.attname,
            c.reloptions,
            indexes.indnkeyatts AS number_of_keys,
            ti.index_id AS index_id,
            pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
            CASE
                WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
            END AS coll,
            CASE
                WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
            END AS opclass,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 1 = 1 THEN 'DESC' ELSE 'ASC'
        END AS ascending,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 2 = 2 THEN 'NULLS FIRST' ELSE 'NULLS LAST'
        END AS nulls_first,
        pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
        FROM
            (
                SELECT *,
                    generate_series(1,array_length(i.indkey,1)) AS ord,
                    unnest(i.indkey) AS key,
                    unnest(i.indcollation) AS coll,
                    unnest(i.indclass) AS class,
                    unnest(i.indoption) AS option
                FROM pg_catalog.pg_index i
            ) indexes
        JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
        JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
        JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
        LEFT JOIN pg_catalog.pg_attribute attribute
            ON (attribute.attrelid=indexes.indrelid AND attribute.attnum=indexes.key)
        LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
        LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
        LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
        LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
        INNER JOIN crdb_internal.table_indexes ti ON (
            indexes.indrelid = ti.descriptor_id
            AND c.relname = ti.index_name
        )
    ) s2
    WHERE table_oid = $1
    GROUP BY
        indexname,
        index_id,
        index_method,
        index_unique,
        reloptions,
        number_of_keys,
        where_expression;
    `,GET_TABLE_INDEX_PARTITIONING_DATA:`
        SELECT
            partitions.name AS partition_name,
            partitions.index_id,
            parent_name,
            column_names,
            list_value,
            range_value,
            index_name
        FROM crdb_internal.partitions
            INNER JOIN crdb_internal.table_indexes
                ON partitions.table_id = table_indexes.descriptor_id
                    AND partitions.index_id = table_indexes.index_id
        WHERE table_indexes.descriptor_id = $1;
    `,GET_TABLE_INDEX_CREATE_INFO:`
        SELECT index_name,
               is_sharded,
               is_visible,
               create_statement
        FROM crdb_internal.table_indexes WHERE descriptor_id = $1;
    `,GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:ai(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:ai(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND (
                (pg_type.typtype = 'c' AND (pg_class.relkind = 'c' OR pg_class.relkind IS NULL))
                OR pg_type.typtype = 'e'
                OR pg_type.typtype = 'r'
            )
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;"},pl=i(t=>(Object.entries(oi).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");ci.exports={getQueryName:pl,...oi}});var li=h((od,ui)=>{"use strict";var hl=Br(),j=null,He=null;ui.exports={initializeClient(t,e){j=t,He=e,j.on("error",r=>e.error(r))},isClientInitialized(){return!!j},releaseClient(){return j?new Promise(t=>{j.end(()=>{j=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=hl.getQueryName(t);He.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await j.query(t,e),o=Date.now()-s;He.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,He.error(n),null}}}});var fi=h((cd,hi)=>{"use strict";var pi=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...pi(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");hi.exports={getJsonSchema:pi}});var Qr=h((ld,di)=>{"use strict";var V=null,fl=i(t=>{V=t.require("lodash")},"setDependencies"),Ur={column_default:"default",is_nullable:{keyword:"required",map:(t,e,r)=>({YES:!1,NO:!0})[r]},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e,r)=>r!==-1&&vl(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:{keyword:"length",map:(t,e,r)=>Number(r)},description:"description"},dl=i((t,e,r)=>{let n=Ur[e];if(!n||typeof n=="string")return r;let s=n.check||((c,l,u)=>!0),a=n.map||((c,l,u)=>u),o="";return s(t,e,r)&&(o=r),a(t,e,o)},"getColumnValue"),ml=i(t=>e=>V.chain(e).toPairs().map(([r,n])=>{var s;return[((s=Ur[r])==null?void 0:s.keyword)||Ur[r],dl(e,r,n)]}).filter(([r,n])=>r&&!V.isNil(n)).fromPairs().thru(_l(t)).value(),"mapColumnData"),_l=i(t=>e=>({...e,...yl(t,e)}),"setColumnType"),yl=i((t,e)=>e.type==="ARRAY"?gl(t,e):e.type==="USER-DEFINED"?Gr(t,e.udt_name):Gr(t,e.type),"getType"),gl=i((t,e)=>({...Gr(t,e.udt_name.slice(1)),array_type:V.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Gr=i((t,e)=>{switch(e){case"bigserial":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"numeric":case"dec":case"decimal":return{type:"numeric",mode:"decimal"};case"int2":case"smallint":return{type:"numeric",mode:"int2"};case"int4":case"integer":return{type:"numeric",mode:"int4"};case"int":case"int8":case"int64":case"bigint":return{type:"numeric",mode:"int"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return V.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),El=i((t,e)=>{let r=V.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=Sl(s),o=Tl(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),Sl=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),Tl=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),vl=i(t=>V.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");di.exports={setDependencies:fl,mapColumnData:ml,setSubtypeFromSampledJsonValues:El}});var be=h((hd,mi)=>{"use strict";var bl=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],ne=null,wl=i(t=>{ne=t.require("lodash")},"setDependencies"),Al=i(t=>ne.chain(t).toPairs().reject(([e,r])=>ne.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Cl=i(t=>e=>{var r;return(r=ne.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Ol=i(t=>/\s|\W/.test(t)||ne.includes(bl,ne.toUpper(t))?`"${t}"`:t,"wrapInQuotes");mi.exports={clearEmptyPropertiesInObject:Al,setDependencies:wl,getColumnNameByPosition:Cl,wrapInQuotes:Ol}});var gi=h((dd,yi)=>{"use strict";var{getColumnNameByPosition:Rl}=be(),Hr=null,Il=i(t=>{Hr=t.require("lodash")},"setDependencies"),_i=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Nl=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";default:return""}},"prepareMatch"),xl=i((t,e,r,n)=>Hr.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:Hr.map(s.table_columns_positions,Rl(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:_i(s.relationship_on_delete),relationshipOnUpdate:_i(s.relationship_on_update),relationshipMatch:Nl(s.relationship_match)}})),"prepareForeignKeys");yi.exports={setDependencies:Il,prepareForeignKeys:xl}});var Ti=h((_d,Si)=>{"use strict";var We=null,Pl=i(t=>{We=t.require("lodash")},"setDependencies"),Ei=i(t=>We.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Ll(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Ll=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Ml=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),ql=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Dl=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Fl=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:Ei(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:We.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Ml(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Dl(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:ql(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),kl=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:We.toLower(t.external_language),inputArgs:Ei(e),body:t.routine_definition}),"mapProcedureData");Si.exports={setDependencies:Pl,mapFunctionData:Fl,mapProcedureData:kl}});var Ai=h((gd,wi)=>{"use strict";var Bl=i(t=>e=>{if(!e)return null;let r=Gl(e),n=Ql(t)(e),s=Hl(e);return[{partitionMethod:r,compositePartitionKey:n,partitioning_expression:s}]},"preparePartition"),Wr=i((t={})=>t.list_value?"LIST":t.range_value?"RANGE":"","getPartitionMethodByRow"),vi=i((t=[])=>t.filter(e=>!e.parent_name),"getParentPartitionRows"),Ul=i((t=[],e=null)=>t.filter(r=>r.parent_name===e),"getChildPartitionRows"),Gl=i((t=[])=>{let e=vi(t);if(!e.length)return"";let r=e[0];return Wr(r)},"getPartitionMethod"),Ql=i(t=>(e=[])=>{let n=e.filter(s=>!s.parent_name).flatMap(s=>(s.column_names||"").split(",").map(o=>o.trim()));return t.uniq(n)},"getCompositePartitionKey"),Hl=i(t=>{let e=vi(t);if(!e.length)return"";let r=e[0],n=Wr(r),s=r.column_names||"",a=e.map(o=>bi({partition:o,paddingFactor:1,partitionResult:t})).join(`,
`);return`PARTITION BY ${n} (${s}) (
${a}
)`},"getPartitionExpression"),bi=i(({partition:t,partitionResult:e,paddingFactor:r})=>{let n=t.list_value?"VALUES IN":"VALUES FROM",s=t.list_value||t.range_value||"",a="	".repeat(r),o=`${a}PARTITION ${t.partition_name} ${n} ${s}`,c=Ul(e,t.partition_name);if(c.length){let l=c.map(m=>bi({partition:m,partitionResult:e,paddingFactor:r+1})).join(`,
`),u=c[0],p=Wr(u),f=u.column_names||"";return o+` PARTITION BY ${p} (${f}) (
`+l+`
`+a+")"}return o},"getSinglePartitionExpression");wi.exports={preparePartition:Bl}});var Ni=h((Sd,Ii)=>{"use strict";var{clearEmptyPropertiesInObject:je,getColumnNameByPosition:Ci}=be(),{preparePartition:Wl}=Ai(),S=null,jl=i(t=>{S=t.require("lodash")},"setDependencies"),Vl=i(t=>{let e={};for(let r of Object.keys(t))r.startsWith("ttl")?(e.ttl_storage_parameters||(e.ttl_storage_parameters={}),e.ttl_storage_parameters[r]=t[r]):e[r]=t[r];return e},"groupTtlStorageParams"),Oi=i((t,e)=>{if(!t&&!e)return null;let r=fp(t),n=je(r),s=Vl(n);return je(s)},"prepareStorageParameters"),jr=i(t=>S.split(t,"="),"splitByEqualitySymbol"),Kl=i(t=>S.find(t,{type:"json"}),"checkHaveJsonTypes"),$l=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),zl=i((t,e,r)=>S.reduce(t,(n,s)=>{switch(s.constraint_type){case"c":return{...n,chkConstr:[...n.chkConstr,Zl(s)]};case"p":return{...n,primaryKey:[...n.primaryKey,Yl(s,e)]};case"u":return{...n,uniqueKey:[...n.uniqueKey,Jl(s,e)]};default:return n}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Yl=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:S.map(t.constraint_keys,Ci(e)),indexStorageParameters:S.join(t.storage_parameters,",")}),"getPrimaryKeyConstraint"),Jl=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:S.map(t.constraint_keys,Ci(e)),indexStorageParameters:S.join(t.storage_parameters,","),indexComment:t.description}),"getUniqueKeyConstraint"),Zl=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,notValid:t.notValid,constrDescription:t.description}),"getCheckConstraint"),Xl=i((t,e=[])=>e.find(n=>n.index_name===t)||{}||{},"getIndexCreateInfoRowByName"),ep=i(t=>{switch(t.toUpperCase()){case"INVERTED":return"gin";case"PREFIX":return"btree";default:return t}},"parseIndexMethod"),tp=i((t,e)=>(t||[]).filter(r=>r.index_name===e.indexname&&r.index_id===e.index_id),"getIndexPartitioningRows"),rp=i(({tableIndexesResult:t,tableIndexesCreateInfoResult:e=[],tableIndexesPartitioningResult:r})=>S.map(t,n=>{let s=Xl(n.indexname,e),a=s.create_statement,o=op(n,a),c=S.slice(o,0,n.number_of_keys),l=S.chain(o).slice(n.number_of_keys).map(x=>S.pick(x,"name")).value(),u=s.is_visible?"VISIBLE":"NOT VISIBLE",p=!!s.is_sharded,f=tp(r,n),E=(Wl(S)(f)||[{}])[0].partitioning_expression,M={indxName:n.indexname,index_method:ep(n.index_method),unique:n.index_unique??!1,index_storage_parameter:up(n.storage_parameters,a),where:n.where_expression||"",partitioning_expression:E,include:l,columns:c,using_hash:p,visibility:u};return je(M)}),"prepareTableIndexes"),np=i(({createStatement:t,columnName:e})=>{let r=["(",","],n=0;for(;n<t.length;){let s=t.indexOf(e,n);if(s===-1)return-1;let a=t.charAt(s-1);if(t.charAt(s+e.length).match(/\s/)&&r.includes(a))return s;n=s+e.length}},"getIndexColumnDefinitionStart"),sp=i(({createStatement:t,columnDefinitionStart:e})=>{let r=t.substring(e),n=r.indexOf(","),s=r.indexOf(")");return n===-1?e+s:e+Math.min(n,s)},"getColumnDefinitionEnd"),ip=i(({createStatement:t,columnName:e})=>{let r=np({columnName:e,createStatement:t});if(r===-1)return"";let n=sp({columnDefinitionStart:r,createStatement:t});return n===-1?"":t.substring(r,n)},"getIndexColumnQueryDefinition"),ap=i(({indexData:t,itemIndex:e,columnName:r,createStatement:n})=>{let s=S.get(t,`opclasses.${e}`,"");if(s)return s;let a=ip({columnName:r,createStatement:n});if(!a)return"";let o=a.substring(r.length).trim();return o?o.toUpperCase().replaceAll("ASC","").replaceAll("DESC","").replaceAll("NULLS FIRST","").replaceAll("NULLS LAST","").toLowerCase().trim():""},"getIndexColumnOpClass"),op=i((t,e)=>S.chain(t.columns).map((r,n)=>{if(!r)return;let s=S.get(t,`ascendings.${n}`,"ASC"),a=S.get(t,`nulls_first.${n}`,"NULLS FIRST"),o=ap({columnName:r,createStatement:e,itemIndex:n,indexData:t}),c=S.get(t,`collations.${n}`,"");return{name:r,sortOrder:s,nullsOrder:a,opclass:o,collation:c}}).compact().value(),"mapIndexColumns"),Ri=i(t=>{let e={fillfactor:t.fillfactor,bucket_count:t.bucket_count,geometry_max_x:t.geometry_max_x,geometry_max_y:t.geometry_max_y,geometry_min_x:t.geometry_min_x,geometry_min_y:t.geometry_min_y,s2_level_mod:t.s2_level_mod,s2_max_cells:t.s2_max_cells,s2_max_level:t.s2_max_level};return je(e)},"hydrateIndexStorageParameters"),cp=i(t=>{let e=/\s+with\s+\(.*?\)/im,r=t.match(e);if(!(r!=null&&r.length))return null;let n=r[0],s=7,a=n.length-1,o=n.substring(s,a).split(",").map(l=>l.trim()),c=S.fromPairs(S.map(o,l=>jr(l)));return Ri(c)},"parseIndexStorageParametersFromDdl"),up=i((t,e)=>{if(!t)return cp(e);let r=S.fromPairs(S.map(t,n=>jr(n)));return Ri(r)},"getIndexStorageParameters"),lp=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Oi(t==null?void 0:t.reloptions,e),a=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,partitionBounds:a}},"prepareTableLevelData"),pp=i(t=>{switch(hp(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),hp=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),fp=i(t=>S.chain(t).map(jr).map(([e,r])=>[e,pp(r)]).fromPairs().value()||{},"prepareOptions"),dp=i((t,e)=>S.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");Ii.exports={prepareStorageParameters:Oi,setDependencies:jl,checkHaveJsonTypes:Kl,prepareTableConstraints:zl,prepareTableLevelData:lp,prepareTableIndexes:rp,getSampleDocSize:$l,prepareTableInheritance:dp}});var Pi=h((vd,xi)=>{"use strict";var{mapColumnData:mp}=Qr(),Vr=null,_p=i(t=>{Vr=t.require("lodash")},"setDependencies"),yp=i(t=>Vr.chain(t).map(e=>{switch(e.type){case"e":return gp(e);case"r":return Ep(e);case"c":return Sp(e);default:return null}}).compact().value(),"getUserDefinedTypes"),gp=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Ep=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Sp=i(t=>{let e=Vr.map(t.columns,mp([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Tp=i(t=>t.type==="c","isTypeComposite");xi.exports={setDependencies:_p,getUserDefinedTypes:yp,isTypeComposite:Tp}});var Mi=h((wd,Li)=>{"use strict";var{clearEmptyPropertiesInObject:vp,wrapInQuotes:bp}=be(),U=null,wp=i(t=>{U=t.require("lodash")},"setDependencies"),Kr=" (v)",Ap=i(t=>t==="VIEW","isViewByTableType"),Cp=i(t=>U.endsWith(t,Kr),"isViewByName"),Op=i(t=>t.slice(0,-Kr.length),"removeViewNameSuffix"),Rp=i(t=>`${t}${Kr}`,"setViewSuffix"),Ip=i((t,e,r={})=>{let n=U.trim(e.view_definition||r.definition||"");return n?`CREATE VIEW ${bp(t)} AS ${n}`:""},"generateCreateViewScript"),Np=i((t,e)=>{let r={withCheckOption:t.check_option!=="NONE"||U.isNil(t.check_option),checkTestingScope:xp(t.check_option),viewOptions:U.fromPairs(U.map(e==null?void 0:e.view_options,Lp)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Pp(t),description:e==null?void 0:e.description};return vp(r)},"prepareViewData"),xp=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Pp=i(t=>U.startsWith(U.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Lp=i(t=>U.split(t,"="),"splitByEqualitySymbol");Li.exports={setDependencies:wp,isViewByTableType:Ap,isViewByName:Cp,removeViewNameSuffix:Op,generateCreateViewScript:Ip,setViewSuffix:Rp,prepareViewData:Np}});var Fi=h((Cd,Di)=>{"use strict";var Mp=i((t,e)=>[qp,Dp].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),qp=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Fp(t,s,n),entityLevel:Gp(e)}},"reorganizePrimaryKeys"),Dp=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:Bp(r,o,s),entityLevel:Qp(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Fp=i((t,e,r)=>t.map(n=>n.name!==e?n:kp(n,r)),"setAttributesPrimaryKeyData"),kp=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:qi(e)}),"setPrimaryKeyData"),Bp=i((t,e,r)=>t.map(n=>n.name!==e?n:Up(n,r)),"setAttributesUniqueKeyData"),Up=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:qi(e)}),"setUniqueKeyData"),qi=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexComment:t.indexComment}],"getOptions"),Gp=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Qp=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Di.exports={reorganizeConstraints:Mp}});var Qi=h((Rd,Gi)=>{"use strict";var{createClient:Hp}=ii(),_=li(),{getJsonSchema:ki}=fi(),{setDependencies:Wp,mapColumnData:jp,setSubtypeFromSampledJsonValues:Vp}=Qr(),{setDependencies:Kp,clearEmptyPropertiesInObject:Bi}=be(),{setDependencies:$p,prepareForeignKeys:zp}=gi(),{setDependencies:Yp,mapFunctionData:Jp,mapProcedureData:Zp}=Ti(),{setDependencies:Xp,checkHaveJsonTypes:eh,prepareTableConstraints:th,getSampleDocSize:rh,prepareTableLevelData:nh,prepareTableIndexes:sh}=Ni(),{setDependencies:ih,getUserDefinedTypes:ah,isTypeComposite:oh}=Pi(),{setDependencies:ch,isViewByTableType:uh,isViewByName:lh,removeViewNameSuffix:ph,generateCreateViewScript:hh,setViewSuffix:fh,prepareViewData:dh}=Mi(),y=Br(),{reorganizeConstraints:mh}=Fi(),Ve=null,A=null,F=null,Ui=14;Gi.exports={setDependencies(t){A=t.require("lodash"),Kp(t),Xp(t),Wp(t),$p(t),ch(t),Yp(t),ih(t)},async connect(t,e){_.isClientInitialized()&&await this.disconnect();let{client:r,sshTunnel:n}=await Hp(t,e);_.initializeClient(r,e),Ve=n,F=e,Ui=await this._getServerVersion()},async disconnect(){Ve&&(Ve.close(),Ve=null),await _.releaseClient()},pingDb(){return _.query(y.PING)},applyScript(t){return _.query(t)},async getDatabaseNames(){return A.map(await _.query(y.GET_DATABASES),"database_name")},async logVersion(){let t=await _.queryTolerant(y.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved"},async getAllSchemasNames(){return(await _.query(y.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!_h(e))},async getTablesNames(t){let e=await _.query(y.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!A.includes(r,n)).map(({table_name:n,table_type:s})=>uh(s)?fh(n):n)},async getDbLevelData(){var n,s,a;F.progress("Get database data");let t=(n=await _.queryTolerant(y.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await _.queryTolerant(y.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(a=await _.queryTolerant(y.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return Bi({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r){let n=await this._retrieveUserDefinedTypes(t),s=await _.queryTolerant(y.GET_NAMESPACE_OID,[t],!0),a=s==null?void 0:s.oid,[o,c]=A.partition(e,lh),l=c.map(f=>({tableName:f})),u=await we(A.uniq(l),A.bind(this._retrieveSingleTableData,this,r,a,t,n));return{views:await we(o,A.bind(this._retrieveSingleViewData,this,a,t)),tables:u,modelDefinitions:ki(n)}},async retrieveSchemaLevelData(t,e){var u;if(e)return F.info("Functions and procedures ignored"),{functions:[],procedures:[]};F.progress("Get Functions and Procedures",t);let r=(u=await _.queryTolerant(y.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,n=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await _.queryTolerant(yh(Ui),[r]),[a,o]=A.partition(A.filter(n,"routine_type"),{routine_type:"FUNCTION"}),c=await we(a,async p=>{let f=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),m=A.find(s,{function_name:p.name});return Jp(p,f,m)}),l=await we(o,async p=>{let f=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),m=A.find(s,{function_name:p.name});return Zp(p,f,m)});return{functions:c,procedures:l}},async _retrieveUserDefinedTypes(t){F.progress("Get User-Defined Types",t);let e=await _.queryTolerant(y.GET_USER_DEFINED_TYPES,[t]),r=await we(e,async n=>oh(n)?{...n,columns:await _.queryTolerant(y.GET_COMPOSITE_TYPE_COLUMNS,[n.pg_class_oid])}:n);return ah(r)},async _retrieveSingleTableData(t,e,r,n,{tableName:s}){F.progress("Get table data",r,s);let a=await _.queryTolerant(y.GET_TABLE_LEVEL_DATA,[s,e],!0),o=a==null?void 0:a.oid,c=await _.queryTolerant(y.GET_TABLE_TOAST_OPTIONS,[s,e],!0),l=await this._getTableColumns(s,r,o),p=await _.queryTolerant(y.GET_DESCRIPTION_BY_OID,[o,"pg_class"],!0),f=await _.queryTolerant(y.GET_TABLE_CONSTRAINTS,[o]),m=await _.queryTolerant(y.GET_TABLE_INDEXES,[o]),E=await _.queryTolerant(y.GET_TABLE_INDEX_PARTITIONING_DATA,[o]),M=await _.queryTolerant(y.GET_TABLE_INDEX_CREATE_INFO,[o]),x=await _.queryTolerant(y.GET_TABLE_FOREIGN_KEYS,[o]);F.info("Table data retrieved",{schemaName:r,tableName:s,columnTypes:l.map(Ki=>Ki.data_type)});let $e=nh(a,c),ze=gh(p),Ye=th(f,l,m),Je=sh({tableIndexesResult:m,tableIndexesCreateInfoResult:M,tableIndexesPartitioningResult:E}),Ae=zp(x,s,r,l),k={description:ze,Indxs:Je,...$e,...Ye},Hi=Bi(k),se=l.map(jp(n)),Wi=eh(se),Ze=[];Wi&&(Ze=await this._getDocuments(r,s,se,t),se=Vp(se,Ze));let{attributes:ji,entityLevel:Vi}=mh(se,Hi);return{name:s,entityLevel:Vi,jsonSchema:ki(ji),documents:Ze,relationships:Ae}},async _getTableColumns(t,e,r){F.progress("Get columns",e,t);let n=await _.query(y.GET_TABLE_COLUMNS,[t,e]),s=await _.queryTolerant(y.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return A.map(n,a=>({...a,ordinal_position:Number(a.ordinal_position),...A.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var p;F.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((p=await _.queryTolerant(y.GET_ROWS_COUNT(s),[],!0))==null?void 0:p.quantity)||0,o=rh(a,n),c=r.filter(({type:f})=>A.includes(["json","jsonb"],f)),l=A.map(c,"name").join(", "),u=await _.queryTolerant(y.GET_SAMPLED_DATA_SIZE(s,l),[o],!0);return F.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:u==null?void 0:u._hackolade_tmp_sampling_tbl_size}),await _.queryTolerant(y.GET_SAMPLED_DATA(s,l),[o])},async _retrieveSingleViewData(t,e,r){F.progress("Get view data",e,r),r=ph(r);let n=await _.query(y.GET_VIEW_DATA,[r,e],!0),s=!n.view_definition&&await _.queryTolerant(y.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),a=await _.queryTolerant(y.GET_VIEW_OPTIONS,[r,t],!0),o=hh(r,n,s),c=dh(n,a);return o?{name:r,data:c,ddl:{script:o,type:"postgres"}}:(F.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:c,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await _.queryTolerant(y.GET_VERSION_AS_NUM,[],!0),e=A.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var _h=i(t=>!!(A.startsWith(t,"pg_")||A.includes(["information_schema"],t)),"isSystemSchema"),yh=i(t=>t===10?y.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:y.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),gh=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),we=i((t,e)=>Promise.all(A.map(t,e)),"mapPromises")});var{createLogger:Ke}=Yr(),w=Qi();module.exports={async disconnect(t,e,r,n){await w.disconnect(),r()},async testConnection(t,e,r,n){try{$r("Test connection",t,e);let s=Ke({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.pingDb(),await w.logVersion(),r()}catch(s){e.log("error",K(s),"Test connection instance log"),r(K(s))}finally{await w.disconnect()}},async getDatabases(t,e,r,n){try{$r("Get databases",t,e);let s=Ke({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.logVersion();let a=await w.getDatabaseNames();return e.log("info",a,"All databases list",t.hiddenKeys),r(null,a)}catch(s){return e.log("error",s),r(K(s))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){try{$r("Get DB table names",t,e);let s=Ke({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(n),await w.connect(t,s),await w.logVersion();let o=await(await w.getAllSchemasNames()).reduce(async(c,l)=>{let u=await c;try{let p=await w.getTablesNames(l);return u.concat({dbName:l,dbCollections:p,isEmpty:p.length===0})}catch(p){return s.info(`Error reading database "${l}"`),s.error(p),u.concat({dbName:l,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,o)}catch(s){e.log("error",K(s),"Get DB collections names"),r(K(s)),await w.disconnect()}},async getDbCollectionsData(t,e,r,n){try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let s=Ke({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});s.progress("Start reverse engineering...");let a=t.collectionData.collections,o=t.collectionData.dataBaseNames,c=await w.getDbLevelData(),{packages:l,relationships:u}=await Promise.all(o.map(async p=>{let{tables:f,views:m,modelDefinitions:E}=await w.retrieveEntitiesData(p,a[p],t.recordSamplingSettings),{functions:M,procedures:x}=await w.retrieveSchemaLevelData(p,t.ignoreUdfUdpTriggers);return s.progress("Schema data fetched successfully",p),{schemaName:p,tables:f,views:m,functions:M,procedures:x,modelDefinitions:E}})).then(p=>{let f=p.flatMap(({tables:E})=>E.map(M=>M.relationships)).flat();return{packages:p.flatMap(({schemaName:E,tables:M,views:x,functions:$e,procedures:ze,modelDefinitions:Ye})=>{let Je={UDFs:$e,Procedures:ze},Ae=M.map(k=>({dbName:E,collectionName:k.name,documents:k.documents,views:[],emptyBucket:!1,entityLevel:k.entityLevel,validation:{jsonSchema:k.jsonSchema},bucketInfo:Je,modelDefinitions:Ye})).sort(k=>n.require("lodash").isEmpty(k.entityLevel.inherits)?-1:1);if(x!=null&&x.length){let k={dbName:E,views:x,emptyBucket:!1};return[...Ae,k]}return Ae}),relationships:f}}).then(({packages:p,relationships:f})=>({packages:Eh(p),relationships:f}));s.info("The data is processed and sent to the application",{packagesLength:l==null?void 0:l.length,relationshipsLength:u==null?void 0:u.length}),r(null,l,c,u)}catch(s){e.log("error",K(s),"Retrieve tables data"),r(K(s))}finally{await w.disconnect()}}};var K=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),$r=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Eh=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages");
