"use strict";var _e=Object.defineProperty;var ri=Object.getOwnPropertyDescriptor;var si=Object.getOwnPropertyNames;var ni=Object.prototype.hasOwnProperty;var i=(t,e)=>_e(t,"name",{value:e,configurable:!0});var ii=(t,e)=>()=>(t&&(e=t(t=0)),e);var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ai=(t,e)=>{for(var r in e)_e(t,r,{get:e[r],enumerable:!0})},oi=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of si(e))!ni.call(t,n)&&n!==r&&_e(t,n,{get:()=>e[n],enumerable:!(s=ri(e,n))||s.enumerable});return t};var ci=t=>oi(_e({},"__esModule",{value:!0}),t);var Ir=d((bl,Rr)=>{"use strict";var ui=i(({title:t,logger:e,hiddenKeys:r})=>({info(s,n={}){e.log("info",{message:s,...n},t,r)},progress(s,n="",a=""){e.progress({message:s,containerName:n,entityName:a})},error(s){e.log("error",li(s),t)}}),"createLogger"),li=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Rr.exports={createLogger:ui}});var Qe=d(Or=>{"use strict";Or.parse=function(t,e){return new Ge(t,e).parse()};var ye=class ye{constructor(e,r){this.source=e,this.transform=r||pi,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,s,n;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new ye(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(r.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(n&&this.newEntry(!0),n=!n):r.value===","&&!n?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(ye,"ArrayParser");var Ge=ye;function pi(t){return t}i(pi,"identity")});var He=d((Cl,Nr)=>{var hi=Qe();Nr.exports={create:function(t,e){return{parse:function(){return hi.parse(t,e)}}}}});var Lr=d((Rl,Pr)=>{"use strict";var di=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,fi=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,mi=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,_i=/^-?infinity$/;Pr.exports=i(function(e){if(_i.test(e))return Number(e.replace("i","I"));var r=di.exec(e);if(!r)return yi(e)||null;var s=!!r[8],n=parseInt(r[1],10);s&&(n=xr(n));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var h,m=gi(e);return m!=null?(h=new Date(Date.UTC(n,a,o,c,l,u,p)),je(n)&&h.setUTCFullYear(n),m!==0&&h.setTime(h.getTime()-m)):(h=new Date(n,a,o,c,l,u,p),je(n)&&h.setFullYear(n)),h},"parseDate");function yi(t){var e=fi.exec(t);if(e){var r=parseInt(e[1],10),s=!!e[4];s&&(r=xr(r));var n=parseInt(e[2],10)-1,a=e[3],o=new Date(r,n,a);return je(r)&&o.setFullYear(r),o}}i(yi,"getDate");function gi(t){if(t.endsWith("+00"))return 0;var e=mi.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var s=r==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}i(gi,"timeZoneOffset");function xr(t){return-(t-1)}i(xr,"bcYearToNegativeYear");function je(t){return t>=0&&t<100}i(je,"is0To99")});var qr=d((Ol,Mr)=>{Mr.exports=Si;var Ei=Object.prototype.hasOwnProperty;function Si(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Ei.call(r,s)&&(t[s]=r[s])}return t}i(Si,"extend")});var kr=d((xl,Fr)=>{"use strict";var Ti=qr();Fr.exports=V;function V(t){if(!(this instanceof V))return new V(t);Ti(this,Li(t))}i(V,"PostgresInterval");var bi=["seconds","minutes","hours","days","months","years"];V.prototype.toPostgres=function(){var t=bi.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var wi={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Ai=["years","months","days"],vi=["hours","minutes","seconds"];V.prototype.toISOString=V.prototype.toISO=function(){var t=Ai.map(r,this).join(""),e=vi.map(r,this).join("");return"P"+t+"T"+e;function r(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+wi[s]}};var Ve="([+-]?\\d+)",Ci=Ve+"\\s+years?",Ri=Ve+"\\s+mons?",Ii=Ve+"\\s+days?",Oi="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Ni=new RegExp([Ci,Ri,Ii,Oi].map(function(t){return"("+t+")?"}).join("\\s*")),Dr={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},xi=["hours","minutes","seconds","milliseconds"];function Pi(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Pi,"parseMilliseconds");function Li(t){if(!t)return{};var e=Ni.exec(t),r=e[8]==="-";return Object.keys(Dr).reduce(function(s,n){var a=Dr[n],o=e[a];return!o||(o=n==="milliseconds"?Pi(o):parseInt(o,10),!o)||(r&&~xi.indexOf(n)&&(o*=-1),s[n]=o),s},{})}i(Li,"parse")});var Ur=d((Ll,Br)=>{"use strict";Br.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",s=0;s<e.length;)if(e[s]!=="\\")r+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))r+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var a=0;a<Math.floor(n/2);++a)r+="\\";s+=Math.floor(n/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Kr=d((ql,Wr)=>{var re=Qe(),se=He(),ge=Lr(),Qr=kr(),Hr=Ur();function Ee(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Ee,"allowNull");function jr(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(jr,"parseBool");function Mi(t){return t?re.parse(t,jr):null}i(Mi,"parseBoolArray");function qi(t){return parseInt(t,10)}i(qi,"parseBaseTenInt");function We(t){return t?re.parse(t,Ee(qi)):null}i(We,"parseIntegerArray");function Di(t){return t?re.parse(t,Ee(function(e){return Vr(e).trim()})):null}i(Di,"parseBigIntegerArray");var Fi=i(function(t){if(!t)return null;var e=se.create(t,function(r){return r!==null&&(r=ze(r)),r});return e.parse()},"parsePointArray"),Ke=i(function(t){if(!t)return null;var e=se.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),P=i(function(t){if(!t)return null;var e=se.create(t);return e.parse()},"parseStringArray"),$e=i(function(t){if(!t)return null;var e=se.create(t,function(r){return r!==null&&(r=ge(r)),r});return e.parse()},"parseDateArray"),ki=i(function(t){if(!t)return null;var e=se.create(t,function(r){return r!==null&&(r=Qr(r)),r});return e.parse()},"parseIntervalArray"),Bi=i(function(t){return t?re.parse(t,Ee(Hr)):null},"parseByteAArray"),Ye=i(function(t){return parseInt(t,10)},"parseInteger"),Vr=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Gr=i(function(t){return t?re.parse(t,Ee(JSON.parse)):null},"parseJsonArray"),ze=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Ui=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",s=!1,n=2;n<t.length-1;n++){if(s||(e+=t[n]),t[n]===")"){s=!0;continue}else if(!s)continue;t[n]!==","&&(r+=t[n])}var a=ze(e);return a.radius=parseFloat(r),a},"parseCircle"),Gi=i(function(t){t(20,Vr),t(21,Ye),t(23,Ye),t(26,Ye),t(700,parseFloat),t(701,parseFloat),t(16,jr),t(1082,ge),t(1114,ge),t(1184,ge),t(600,ze),t(651,P),t(718,Ui),t(1e3,Mi),t(1001,Bi),t(1005,We),t(1007,We),t(1028,We),t(1016,Di),t(1017,Fi),t(1021,Ke),t(1022,Ke),t(1231,Ke),t(1014,P),t(1015,P),t(1008,P),t(1009,P),t(1040,P),t(1041,P),t(1115,$e),t(1182,$e),t(1185,$e),t(1186,Qr),t(1187,ki),t(17,Hr),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Gr),t(3807,Gr),t(3907,P),t(2951,P),t(791,P),t(1183,P),t(1270,P)},"init");Wr.exports={init:Gi}});var Yr=d((Fl,$r)=>{"use strict";var O=1e6;function Qi(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),s="";e<0&&(e=~e+(r===0),r=~r+1>>>0,s="-");var n="",a,o,c,l,u,p;{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}return a=e%O,o=4294967296*a+r,c=""+o%O,s+c+n}i(Qi,"readInt8");$r.exports=Qi});var es=d((Bl,Xr)=>{var Hi=Yr(),E=i(function(t,e,r,s,n){r=r||0,s=s||!1,n=n||function(b,I,x){return b*Math.pow(2,x)+I};var a=r>>3,o=i(function(b){return s?~b&255:b},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=n(0,o(t[a])&c,l));for(var p=e+r>>3,h=a+1;h<p;h++)u=n(u,o(t[h]),8);var m=(e+r)%8;return m>0&&(u=n(u,o(t[p])>>8-m,m)),u},"parseBits"),Zr=i(function(t,e,r){var s=Math.pow(2,r-1)-1,n=E(t,1),a=E(t,r,1);if(a===0)return 0;var o=1,c=i(function(u,p,h){u===0&&(u=1);for(var m=1;m<=h;m++)o/=2,(p&1<<h-m)>0&&(u+=o);return u},"parsePrecisionBits"),l=E(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?l===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,a-s)*l},"parseFloatFromBits"),ji=i(function(t){return E(t,1)==1?-1*(E(t,15,1,!0)+1):E(t,15,1)},"parseInt16"),zr=i(function(t){return E(t,1)==1?-1*(E(t,31,1,!0)+1):E(t,31,1)},"parseInt32"),Vi=i(function(t){return Zr(t,23,8)},"parseFloat32"),Wi=i(function(t){return Zr(t,52,11)},"parseFloat64"),Ki=i(function(t){var e=E(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,E(t,16,16)),s=0,n=[],a=E(t,16),o=0;o<a;o++)s+=E(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,E(t,16,48));return(e===0?1:-1)*Math.round(s*c)/c},"parseNumeric"),Jr=i(function(t,e){var r=E(e,1),s=E(e,63,1),n=new Date((r===0?1:-1)*s/1e3+9466848e5);return t||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(a){this.usec=a},n.getUTCMicroSeconds=function(){return this.usec},n},"parseDate"),ne=i(function(t){for(var e=E(t,32),r=E(t,32,32),s=E(t,32,64),n=96,a=[],o=0;o<e;o++)a[o]=E(t,32,n),n+=32,n+=32;var c=i(function(u){var p=E(t,32,n);if(n+=32,p==4294967295)return null;var h;if(u==23||u==20)return h=E(t,p*8,n),n+=p*8,h;if(u==25)return h=t.toString(this.encoding,n>>3,(n+=p<<3)>>3),h;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var h=[],m;if(u.length>1){var b=u.shift();for(m=0;m<b;m++)h[m]=l(u,p);u.unshift(b)}else for(m=0;m<u[0];m++)h[m]=c(p);return h},"parse");return l(a,s)},"parseArray"),$i=i(function(t){return t.toString("utf8")},"parseText"),Yi=i(function(t){return t===null?null:E(t,8)>0},"parseBool"),zi=i(function(t){t(20,Hi),t(21,ji),t(23,zr),t(26,zr),t(1700,Ki),t(700,Vi),t(701,Wi),t(16,Yi),t(1114,Jr.bind(null,!1)),t(1184,Jr.bind(null,!0)),t(1e3,ne),t(1007,ne),t(1016,ne),t(1008,ne),t(1009,ne),t(25,$i)},"init");Xr.exports={init:zi}});var rs=d((Gl,ts)=>{ts.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var oe=d(ae=>{var Ji=Kr(),Zi=es(),Xi=He(),ea=rs();ae.getTypeParser=ta;ae.setTypeParser=ra;ae.arrayParser=Xi;ae.builtins=ea;var ie={text:{},binary:{}};function ss(t){return String(t)}i(ss,"noParse");function ta(t,e){return e=e||"text",ie[e]&&ie[e][t]||ss}i(ta,"getTypeParser");function ra(t,e,r){typeof e=="function"&&(r=e,e="text"),ie[e][t]=r}i(ra,"setTypeParser");Ji.init(function(t,e){ie.text[t]=e});Zi.init(function(t,e){ie.binary[t]=e})});var ce=d((jl,Je)=>{"use strict";Je.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var W=oe(),sa=W.getTypeParser(20,"text"),na=W.getTypeParser(1016,"text");Je.exports.__defineSetter__("parseInt8",function(t){W.setTypeParser(20,"text",t?W.getTypeParser(23,"text"):sa),W.setTypeParser(1016,"text",t?W.getTypeParser(1007,"text"):na)})});var ue=d((Vl,is)=>{"use strict";var ia=ce();function aa(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(aa,"escapeElement");function ns(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+ns(t[r]);else if(ArrayBuffer.isView(t[r])){var s=t[r];if(!(s instanceof Buffer)){var n=Buffer.from(s.buffer,s.byteOffset,s.byteLength);n.length===s.byteLength?s=n:s=n.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=aa(Se(t[r]));return e=e+"}",e}i(ns,"arrayString");var Se=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?ia.parseInputDatesAsUTC?ua(t):ca(t):Array.isArray(t)?ns(t):typeof t=="object"?oa(t,e):t.toString()},"prepareValue");function oa(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Se(t.toPostgres(Se),e)}return JSON.stringify(t)}i(oa,"prepareObject");function C(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(C,"pad");function ca(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),s=r<1;s&&(r=Math.abs(r)+1);var n=C(r,4)+"-"+C(t.getMonth()+1,2)+"-"+C(t.getDate(),2)+"T"+C(t.getHours(),2)+":"+C(t.getMinutes(),2)+":"+C(t.getSeconds(),2)+"."+C(t.getMilliseconds(),3);return e<0?(n+="-",e*=-1):n+="+",n+=C(Math.floor(e/60),2)+":"+C(e%60,2),s&&(n+=" BC"),n}i(ca,"dateToString");function ua(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var s=C(e,4)+"-"+C(t.getUTCMonth()+1,2)+"-"+C(t.getUTCDate(),2)+"T"+C(t.getUTCHours(),2)+":"+C(t.getUTCMinutes(),2)+":"+C(t.getUTCSeconds(),2)+"."+C(t.getUTCMilliseconds(),3);return s+="+00:00",r&&(s+=" BC"),s}i(ua,"dateToStringUTC");function la(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(la,"normalizeQueryConfig");var pa=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),ha=i(function(t){for(var e=!1,r="'",s=0;s<t.length;s++){var n=t[s];n==="'"?r+=n+n:n==="\\"?(r+=n+n,e=!0):r+=n}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");is.exports={prepareValue:i(function(e){return Se(e)},"prepareValueWrapper"),normalizeQueryConfig:la,escapeIdentifier:pa,escapeLiteral:ha}});var os=d((Kl,as)=>{"use strict";var le=require("crypto");function Ze(t){return le.createHash("md5").update(t,"utf-8").digest("hex")}i(Ze,"md5");function da(t,e,r){var s=Ze(e+t),n=Ze(Buffer.concat([Buffer.from(s),r]));return"md5"+n}i(da,"postgresMd5PasswordHash");function fa(t){return le.createHash("sha256").update(t).digest()}i(fa,"sha256");function ma(t,e){return le.createHmac("sha256",t).update(e).digest()}i(ma,"hmacSha256");async function _a(t,e,r){return le.pbkdf2Sync(t,e,r,32,"sha256")}i(_a,"deriveKey");as.exports={postgresMd5PasswordHash:da,randomBytes:le.randomBytes,deriveKey:_a,sha256:fa,hmacSha256:ma,md5:Ze}});var ps=d((Yl,ls)=>{var cs=require("crypto");ls.exports={postgresMd5PasswordHash:ga,randomBytes:ya,deriveKey:Ta,sha256:Ea,hmacSha256:Sa,md5:Xe};var us=cs.webcrypto||globalThis.crypto,K=us.subtle,et=new TextEncoder;function ya(t){return us.getRandomValues(Buffer.alloc(t))}i(ya,"randomBytes");async function Xe(t){try{return cs.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?et.encode(t):t,s=await K.digest("MD5",r);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}}i(Xe,"md5");async function ga(t,e,r){var s=await Xe(e+t),n=await Xe(Buffer.concat([Buffer.from(s),r]));return"md5"+n}i(ga,"postgresMd5PasswordHash");async function Ea(t){return await K.digest("SHA-256",t)}i(Ea,"sha256");async function Sa(t,e){let r=await K.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await K.sign("HMAC",r,et.encode(e))}i(Sa,"hmacSha256");async function Ta(t,e,r){let s=await K.importKey("raw",et.encode(t),"PBKDF2",!1,["deriveBits"]),n={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await K.deriveBits(n,s,32*8,["deriveBits"])}i(Ta,"deriveKey")});var rt=d((Jl,tt)=>{"use strict";var ba=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;ba?tt.exports=os():tt.exports=ps()});var ms=d((Zl,fs)=>{"use strict";var G=rt();function wa(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=G.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(wa,"startSession");async function Aa(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let s=Ra(r);if(s.nonce.startsWith(t.clientNonce)){if(s.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var n="n=*,r="+t.clientNonce,a="r="+s.nonce+",s="+s.salt+",i="+s.iteration,o="c=biws,r="+s.nonce,c=n+","+a+","+o,l=Buffer.from(s.salt,"base64"),u=await G.deriveKey(e,l,s.iteration),p=await G.hmacSha256(u,"Client Key"),h=await G.sha256(p),m=await G.hmacSha256(h,c),b=Oa(Buffer.from(p),Buffer.from(m)).toString("base64"),I=await G.hmacSha256(u,"Server Key"),x=await G.hmacSha256(I,c);t.message="SASLResponse",t.serverSignature=Buffer.from(x).toString("base64"),t.response=o+",p="+b}i(Aa,"continueSession");function va(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Ia(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(va,"finalizeSession");function Ca(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Ca,"isPrintableChars");function hs(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(hs,"isBase64");function ds(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],s=e.substring(2);return[r,s]}))}i(ds,"parseAttributePairs");function Ra(t){let e=ds(t),r=e.get("r");if(r){if(!Ca(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!hs(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(n,10);return{nonce:r,salt:s,iteration:a}}i(Ra,"parseServerFirstMessage");function Ia(t){let r=ds(t).get("v");if(r){if(!hs(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Ia,"parseServerFinalMessage");function Oa(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,s)=>t[s]^e[s]))}i(Oa,"xorBuffers");fs.exports={startSession:wa,continueSession:Aa,finalizeSession:va}});var st=d((ep,_s)=>{"use strict";var Na=oe();function Te(t){this._types=t||Na,this.text={},this.binary={}}i(Te,"TypeOverrides");Te.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};Te.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};Te.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};_s.exports=Te});var gs=d((rp,ys)=>{"use strict";function nt(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,s=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),s=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let n=s?"":r.hostname;e.host?n&&/^%2f/i.test(n)&&(r.pathname=n+r.pathname):e.host=decodeURIComponent(n),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(nt,"parse");ys.exports=nt;nt.parse=nt});var ot=d((np,Ts)=>{"use strict";var xa=require("dns"),Ss=ce(),Es=gs().parse,R=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Ss[t]},"val"),Pa=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Ss.ssl},"readSSLConfigFromEnvironment"),$=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),L=i(function(t,e,r){var s=e[r];s!=null&&t.push(r+"="+$(s))},"add"),at=class at{constructor(e){e=typeof e=="string"?Es(e):e||{},e.connectionString&&(e=Object.assign({},e,Es(e.connectionString))),this.user=R("user",e),this.database=R("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(R("port",e),10),this.host=R("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:R("password",e)}),this.binary=R("binary",e),this.options=R("options",e),this.ssl=typeof e.ssl>"u"?Pa():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=R("client_encoding",e),this.replication=R("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=R("application_name",e,"PGAPPNAME"),this.fallback_application_name=R("fallback_application_name",e,!1),this.statement_timeout=R("statement_timeout",e,!1),this.lock_timeout=R("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=R("idle_in_transaction_session_timeout",e,!1),this.query_timeout=R("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];L(r,this,"user"),L(r,this,"password"),L(r,this,"port"),L(r,this,"application_name"),L(r,this,"fallback_application_name"),L(r,this,"connect_timeout"),L(r,this,"options");var s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(L(r,s,"sslmode"),L(r,s,"sslca"),L(r,s,"sslkey"),L(r,s,"sslcert"),L(r,s,"sslrootcert"),this.database&&r.push("dbname="+$(this.database)),this.replication&&r.push("replication="+$(this.replication)),this.host&&r.push("host="+$(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+$(this.client_encoding)),xa.lookup(this.host,function(n,a){return n?e(n,null):(r.push("hostaddr="+$(a)),e(null,r.join(" ")))})}};i(at,"ConnectionParameters");var it=at;Ts.exports=it});var As=d((ap,ws)=>{"use strict";var La=oe(),bs=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,ut=class ut{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=bs.exec(e.text):r=bs.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),s=0,n=e.length;s<n;s++){var a=e[s];a!==null?r[s]=this._parsers[s](a):r[s]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},s=0,n=e.length;s<n;s++){var a=e[s],o=this.fields[s].name;a!==null?r[o]=this._parsers[s](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},s=0;s<e.length;s++){var n=e[s];r[n.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[s]=La.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(ut,"Result");var ct=ut;ws.exports=ct});var Is=d((cp,Rs)=>{"use strict";var{EventEmitter:Ma}=require("events"),vs=As(),Cs=ue(),pt=class pt extends Ma{constructor(e,r,s){super(),e=Cs.normalizeQueryConfig(e,r,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new vs(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new vs(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Cs.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(pt,"Query");var lt=pt;Rs.exports=lt});var Ut=d(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.NoticeMessage=f.DataRowMessage=f.CommandCompleteMessage=f.ReadyForQueryMessage=f.NotificationResponseMessage=f.BackendKeyDataMessage=f.AuthenticationMD5Password=f.ParameterStatusMessage=f.ParameterDescriptionMessage=f.RowDescriptionMessage=f.Field=f.CopyResponse=f.CopyDataMessage=f.DatabaseError=f.copyDone=f.emptyQuery=f.replicationStart=f.portalSuspended=f.noData=f.closeComplete=f.bindComplete=f.parseComplete=void 0;f.parseComplete={name:"parseComplete",length:5};f.bindComplete={name:"bindComplete",length:5};f.closeComplete={name:"closeComplete",length:5};f.noData={name:"noData",length:5};f.portalSuspended={name:"portalSuspended",length:5};f.replicationStart={name:"replicationStart",length:4};f.emptyQuery={name:"emptyQuery",length:4};f.copyDone={name:"copyDone",length:4};var Ct=class Ct extends Error{constructor(e,r,s){super(e),this.length=r,this.name=s}};i(Ct,"DatabaseError");var ht=Ct;f.DatabaseError=ht;var Rt=class Rt{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Rt,"CopyDataMessage");var dt=Rt;f.CopyDataMessage=dt;var It=class It{constructor(e,r,s,n){this.length=e,this.name=r,this.binary=s,this.columnTypes=new Array(n)}};i(It,"CopyResponse");var ft=It;f.CopyResponse=ft;var Ot=class Ot{constructor(e,r,s,n,a,o,c){this.name=e,this.tableID=r,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(Ot,"Field");var mt=Ot;f.Field=mt;var Nt=class Nt{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Nt,"RowDescriptionMessage");var _t=Nt;f.RowDescriptionMessage=_t;var xt=class xt{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(xt,"ParameterDescriptionMessage");var yt=xt;f.ParameterDescriptionMessage=yt;var Pt=class Pt{constructor(e,r,s){this.length=e,this.parameterName=r,this.parameterValue=s,this.name="parameterStatus"}};i(Pt,"ParameterStatusMessage");var gt=Pt;f.ParameterStatusMessage=gt;var Lt=class Lt{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(Lt,"AuthenticationMD5Password");var Et=Lt;f.AuthenticationMD5Password=Et;var Mt=class Mt{constructor(e,r,s){this.length=e,this.processID=r,this.secretKey=s,this.name="backendKeyData"}};i(Mt,"BackendKeyDataMessage");var St=Mt;f.BackendKeyDataMessage=St;var qt=class qt{constructor(e,r,s,n){this.length=e,this.processId=r,this.channel=s,this.payload=n,this.name="notification"}};i(qt,"NotificationResponseMessage");var Tt=qt;f.NotificationResponseMessage=Tt;var Dt=class Dt{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(Dt,"ReadyForQueryMessage");var bt=Dt;f.ReadyForQueryMessage=bt;var Ft=class Ft{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(Ft,"CommandCompleteMessage");var wt=Ft;f.CommandCompleteMessage=wt;var kt=class kt{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(kt,"DataRowMessage");var At=kt;f.DataRowMessage=At;var Bt=class Bt{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Bt,"NoticeMessage");var vt=Bt;f.NoticeMessage=vt});var Os=d(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.Writer=void 0;var Qt=class Qt{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(Qt,"Writer");var Gt=Qt;be.Writer=Gt});var xs=d(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.serialize=void 0;var Ht=Os(),S=new Ht.Writer,qa=i(t=>{S.addInt16(3).addInt16(0);for(let s of Object.keys(t))S.addCString(s).addCString(t[s]);S.addCString("client_encoding").addCString("UTF8");var e=S.addCString("").flush(),r=e.length+4;return new Ht.Writer().addInt32(r).add(e).flush()},"startup"),Da=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Fa=i(t=>S.addCString(t).flush(112),"password"),ka=i(function(t,e){return S.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),S.flush(112)},"sendSASLInitialResponseMessage"),Ba=i(function(t){return S.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Ua=i(t=>S.addCString(t).flush(81),"query"),Ns=[],Ga=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ns;for(var s=r.length,n=S.addCString(e).addCString(t.text).addInt16(s),a=0;a<s;a++)n.addInt32(r[a]);return S.flush(80)},"parse"),Y=new Ht.Writer,Qa=i(function(t,e){for(let r=0;r<t.length;r++){let s=e?e(t[r],r):t[r];s==null?(S.addInt16(0),Y.addInt32(-1)):s instanceof Buffer?(S.addInt16(1),Y.addInt32(s.length),Y.add(s)):(S.addInt16(0),Y.addInt32(Buffer.byteLength(s)),Y.addString(s))}},"writeValues"),Ha=i((t={})=>{let e=t.portal||"",r=t.statement||"",s=t.binary||!1,n=t.values||Ns,a=n.length;return S.addCString(e).addCString(r),S.addInt16(a),Qa(n,t.valueMapper),S.addInt16(a),S.add(Y.flush()),S.addInt16(s?1:0),S.flush(66)},"bind"),ja=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Va=i(t=>{if(!t||!t.portal&&!t.rows)return ja;let e=t.portal||"",r=t.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,a=Buffer.allocUnsafe(1+n);return a[0]=69,a.writeInt32BE(n,1),a.write(e,5,"utf-8"),a[s+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),Wa=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),jt=i((t,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=t,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},"cstringMessage"),Ka=S.addCString("P").flush(68),$a=S.addCString("S").flush(68),Ya=i(t=>t.name?jt(68,`${t.type}${t.name||""}`):t.type==="P"?Ka:$a,"describe"),za=i(t=>{let e=`${t.type}${t.name||""}`;return jt(67,e)},"close"),Ja=i(t=>S.add(t).flush(100),"copyData"),Za=i(t=>jt(102,t),"copyFail"),we=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),Xa=we(72),eo=we(83),to=we(88),ro=we(99),so={startup:qa,password:Fa,requestSsl:Da,sendSASLInitialResponseMessage:ka,sendSCRAMClientFinalMessage:Ba,query:Ua,parse:Ga,bind:Ha,execute:Va,describe:Ya,close:za,flush:()=>Xa,sync:()=>eo,end:()=>to,copyData:Ja,copyDone:()=>ro,copyFail:Za,cancel:Wa};Ae.serialize=so});var Ps=d(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.BufferReader=void 0;var no=Buffer.allocUnsafe(0),Wt=class Wt{constructor(e=0){this.offset=e,this.buffer=no,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(Wt,"BufferReader");var Vt=Wt;ve.BufferReader=Vt});var qs=d(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Parser=void 0;var T=Ut(),io=Ps(),Kt=1,ao=4,Ls=Kt+ao,Ms=Buffer.allocUnsafe(0),Yt=class Yt{constructor(e){if(this.buffer=Ms,this.bufferLength=0,this.bufferOffset=0,this.reader=new io.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+Ls<=s;){let a=this.buffer[n],o=this.buffer.readUInt32BE(n+Kt),c=Kt+o;if(c+n<=s){let l=this.handlePacket(n+Ls,a,o,this.buffer);r(l),n+=c}else break}n===s?(this.buffer=Ms,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let n;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;n=Buffer.allocUnsafe(a)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,s,n){switch(r){case 50:return T.bindComplete;case 49:return T.parseComplete;case 51:return T.closeComplete;case 110:return T.noData;case 115:return T.portalSuspended;case 99:return T.copyDone;case 87:return T.replicationStart;case 73:return T.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:return new T.DatabaseError("received invalid response: "+r.toString(16),s,"error")}}parseReadyForQueryMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new T.ReadyForQueryMessage(r,n)}parseCommandCompleteMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new T.CommandCompleteMessage(r,n)}parseCopyData(e,r,s){let n=s.slice(e,e+(r-4));return new T.CopyDataMessage(r,n)}parseCopyInMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyInResponse")}parseCopyOutMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyOutResponse")}parseCopyMessage(e,r,s,n){this.reader.setBuffer(e,s);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new T.CopyResponse(r,n,a,o);for(let l=0;l<o;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new T.NotificationResponseMessage(r,n,a,o)}parseRowDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new T.RowDescriptionMessage(r,n);for(let o=0;o<n;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),s=this.reader.int16(),n=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new T.Field(e,r,s,n,a,o,c)}parseParameterDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new T.ParameterDescriptionMessage(r,n);for(let o=0;o<n;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new Array(n);for(let o=0;o<n;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new T.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),a=this.reader.cstring();return new T.ParameterStatusMessage(r,n,a)}parseBackendKeyData(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a=this.reader.int32();return new T.BackendKeyDataMessage(r,n,a)}parseAuthenticationResponse(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a={name:"authenticationOk",length:r};switch(n){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new T.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return a}parseErrorMessage(e,r,s,n){this.reader.setBuffer(e,s);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,l=n==="notice"?new T.NoticeMessage(r,c):new T.DatabaseError(c,r,n);return l.severity=a.S,l.code=a.C,l.detail=a.D,l.hint=a.H,l.position=a.P,l.internalPosition=a.p,l.internalQuery=a.q,l.where=a.W,l.schema=a.s,l.table=a.t,l.column=a.c,l.dataType=a.d,l.constraint=a.n,l.file=a.F,l.line=a.L,l.routine=a.R,l}};i(Yt,"Parser");var $t=Yt;Ce.Parser=$t});var zt=d(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.DatabaseError=B.serialize=B.parse=void 0;var oo=Ut();Object.defineProperty(B,"DatabaseError",{enumerable:!0,get:function(){return oo.DatabaseError}});var co=xs();Object.defineProperty(B,"serialize",{enumerable:!0,get:function(){return co.serialize}});var uo=qs();function lo(t,e){let r=new uo.Parser;return t.on("data",s=>r.parse(s,e)),new Promise(s=>t.on("end",()=>s()))}i(lo,"parse");B.parse=lo});var Ds={};ai(Ds,{default:()=>po});var po,Fs=ii(()=>{po={}});var ks=d((bp,Jt)=>{Jt.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:s}=(Fs(),ci(Ds));return new s(e)}},"getStream");Jt.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var er=d((vp,Bs)=>{"use strict";var Ap=require("net"),ho=require("events").EventEmitter,{parse:fo,serialize:v}=zt(),{getStream:mo,getSecureStream:_o}=ks(),yo=v.flush(),go=v.sync(),Eo=v.end(),Xt=class Xt extends ho{constructor(e){super(),e=e||{},this.stream=e.stream||mo(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(s){s==="message"&&(r._emitMessage=!0)})}connect(e,r){var s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=i(function(a){s._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||s.emit("error",a)},"reportStreamError");if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:s.stream};s.ssl!==!0&&(Object.assign(c,s.ssl),"key"in s.ssl&&(c.key=s.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{s.stream=_o(c)}catch(u){return s.emit("error",u)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){fo(e,r=>{var s=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(s,r)})}requestSsl(){this.stream.write(v.requestSsl())}startup(e){this.stream.write(v.startup(e))}cancel(e,r){this._send(v.cancel(e,r))}password(e){this._send(v.password(e))}sendSASLInitialResponseMessage(e,r){this._send(v.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(v.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(v.query(e))}parse(e){this._send(v.parse(e))}bind(e){this._send(v.bind(e))}execute(e){this._send(v.execute(e))}flush(){this.stream.writable&&this.stream.write(yo)}sync(){this._ending=!0,this._send(go)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Eo,()=>{this.stream.end()})}close(e){this._send(v.close(e))}describe(e){this._send(v.describe(e))}sendCopyFromChunk(e){this._send(v.copyData(e))}endCopyFrom(){this._send(v.copyDone())}sendCopyFail(e){this._send(v.copyFail(e))}};i(Xt,"Connection");var Zt=Xt;Bs.exports=Zt});var Hs=d((Rp,Qs)=>{"use strict";var{Transform:So}=require("stream"),{StringDecoder:To}=require("string_decoder"),U=Symbol("last"),Re=Symbol("decoder");function bo(t,e,r){let s;if(this.overflow){if(s=this[Re].write(t).split(this.matcher),s.length===1)return r();s.shift(),this.overflow=!1}else this[U]+=this[Re].write(t),s=this[U].split(this.matcher);this[U]=s.pop();for(let n=0;n<s.length;n++)try{Gs(this,this.mapper(s[n]))}catch(a){return r(a)}if(this.overflow=this[U].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(bo,"transform");function wo(t){if(this[U]+=this[Re].end(),this[U])try{Gs(this,this.mapper(this[U]))}catch(e){return t(e)}t()}i(wo,"flush");function Gs(t,e){e!==void 0&&t.push(e)}i(Gs,"push");function Us(t){return t}i(Us,"noop");function Ao(t,e,r){switch(t=t||/\r?\n/,e=e||Us,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Us)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=bo,r.flush=wo,r.readableObjectMode=!0;let s=new So(r);return s[U]="",s[Re]=new To("utf8"),s.matcher=t,s.mapper=e,s.maxLength=r.maxLength,s.skipOverflow=r.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,a){this._writableState.errorEmitted=!1,a(n)},s}i(Ao,"split");Qs.exports=Ao});var Ws=d((Op,D)=>{"use strict";var js=require("path"),vo=require("stream").Stream,Co=Hs(),Vs=require("util"),Ro=5432,Ie=process.platform==="win32",pe=process.stderr,Io=56,Oo=7,No=61440,xo=32768;function Po(t){return(t&No)==xo}i(Po,"isRegFile");var z=["host","port","database","user","password"],tr=z.length,Lo=z[tr-1];function rr(){var t=pe instanceof vo&&pe.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);pe.write(Vs.format.apply(Vs,e))}}i(rr,"warn");Object.defineProperty(D.exports,"isWin",{get:function(){return Ie},set:function(t){Ie=t}});D.exports.warnTo=function(t){var e=pe;return pe=t,e};D.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Ie?js.join(e.APPDATA||"./","postgresql","pgpass.conf"):js.join(e.HOME||"./",".pgpass"));return r};D.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Ie?!0:(e=e||"<unkn>",Po(t.mode)?t.mode&(Io|Oo)?(rr('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(rr('WARNING: password file "%s" is not a plain file',e),!1))};var Mo=D.exports.match=function(t,e){return z.slice(0,-1).reduce(function(r,s,n){return n==1&&Number(t[s]||Ro)===Number(e[s])?r&&!0:r&&(e[s]==="*"||e[s]===t[s])},!0)};D.exports.getPassword=function(t,e,r){var s,n=e.pipe(Co());function a(l){var u=qo(l);u&&Do(u)&&Mo(t,u)&&(s=u[Lo],n.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(s)},"onEnd"),c=i(function(l){e.destroy(),rr("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),n.on("data",a).on("end",o).on("error",c)};var qo=D.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",s=0,n=0,a=0,o={},c=!1,l=i(function(p,h,m){var b=t.substring(h,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(b=b.replace(/\\([:\\])/g,"$1")),o[z[p]]=b},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=s==tr-1,c){l(s,n);break}u>=0&&e==":"&&r!=="\\"&&(l(s,n,u+1),n=u+2,s+=1)}return o=Object.keys(o).length===tr?o:null,o},Do=D.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<z.length;r+=1){var s=e[r],n=t[z[r]]||"",a=s(n);if(!a)return!1}return!0}});var $s=d((Pp,sr)=>{"use strict";var xp=require("path"),Ks=require("fs"),Oe=Ws();sr.exports=function(t,e){var r=Oe.getFileName();Ks.stat(r,function(s,n){if(s||!Oe.usePgPass(n,r))return e(void 0);var a=Ks.createReadStream(r);Oe.getPassword(t,a,e)})};sr.exports.warnTo=Oe.warnTo});var Zs=d((Lp,Js)=>{"use strict";var Fo=require("events").EventEmitter,Ys=ue(),nr=ms(),ko=st(),Bo=ot(),zs=Is(),Uo=ce(),Go=er(),Qo=rt(),ir=class ir extends Fo{constructor(e){super(),this.connectionParameters=new Bo(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new ko(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Go({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Uo.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(s=>{process.nextTick(()=>{s.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){r.ssl?s.requestSsl():s.startup(r.getStartupConf())}),s.on("sslconnect",function(){s.startup(r.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,s)=>{this._connect(n=>{n?s(n):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{r.emit("error",s)});else if(this.password!==null)e();else try{$s()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await Qo.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=nr.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await nr.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{nr.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(r.application_name=s),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,s){return this._types.setTypeParser(e,r,s)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Ys.escapeIdentifier(e)}escapeLiteral(e){return Ys.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,s){var n,a,o,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=n=e,typeof r=="function"&&(n.callback=n.callback||r)):(o=this.connectionParameters.query_timeout,n=new zs(e,r,s),n.callback||(a=new this._Promise((u,p)=>{n.callback=(h,m)=>h?p(h):u(m)}).catch(u=>{throw Error.captureStackTrace(u),u}))),o&&(l=n.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),l(u),n.callback=()=>{};var p=this.queryQueue.indexOf(n);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),n.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(n),this._pulseQueryQueue(),a):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(ir,"Client");var Ne=ir;Ne.Query=zs;Js.exports=Ne});var rn=d((qp,tn)=>{"use strict";var Ho=require("events").EventEmitter,Xs=i(function(){},"NOOP"),en=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),cr=class cr{constructor(e,r,s){this.client=e,this.idleListener=r,this.timeoutId=s}};i(cr,"IdleItem");var ar=cr,ur=class ur{constructor(e){this.callback=e}};i(ur,"PendingItem");var J=ur;function jo(){throw new Error("Release called on client which has already been released to the pool.")}i(jo,"throwOnDoubleRelease");function xe(t,e){if(e)return{callback:e,result:void 0};let r,s,n=i(function(o,c){o?r(o):s(c)},"cb"),a=new t(function(o,c){s=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:n,result:a}}i(xe,"promisify");function Vo(t,e){return i(function r(s){s.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",s)}),t._remove(e),t.emit("error",s,e)},"idleListener")}i(Vo,"makeIdleListener");var lr=class lr extends Ho{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||pr().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let s=r.client;s.ref&&s.ref();let n=r.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=en(this._idle,s=>s.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(s=>s!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let r=xe(this.Promise,e),s=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new J(r.callback)),s;let n=i((c,l,u)=>{clearTimeout(o),r.callback(c,l,u)},"queueCallback"),a=new J(n),o=setTimeout(()=>{en(this._pendingQueue,c=>c.callback===n),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),s}return this.newClient(new J(r.callback)),s}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let s=Vo(this,r);this.log("checking client timeout");let n,a=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(n&&clearTimeout(n),r.on("error",s),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,Xs);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new J((u,p,h)=>h()),s,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,s,!0)}})}_acquireClient(e,r,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),r.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,Xs);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let s=!1;return n=>{s&&jo(),s=!0,this._release(e,r,n)}}_release(e,r,s){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new ar(e,r,a)),this._pulseQueue()}query(e,r,s){if(typeof e=="function"){let a=xe(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(s=r,r=void 0);let n=xe(this.Promise,s);return s=n.callback,this.connect((a,o)=>{if(a)return s(a);let c=!1,l=i(u=>{c||(c=!0,o.release(u),s(u))},"onError");o.once("error",l),this.log("dispatching query");try{o.query(e,r,(u,p)=>{if(this.log("query dispatched"),o.removeListener("error",l),!c)return c=!0,o.release(u),u?s(u):s(void 0,p)})}catch(u){return o.release(u),s(u)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let r=xe(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(lr,"Pool");var or=lr;tn.exports=or});var an=d((Fp,nn)=>{"use strict";var sn=require("events").EventEmitter,Wo=require("util"),hr=ue(),Z=nn.exports=function(t,e,r){sn.call(this),t=hr.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};Wo.inherits(Z,sn);var Ko={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Z.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var s=Ko[r]||r;t[s]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Z.prototype.then=function(t,e){return this._getPromise().then(t,e)};Z.prototype.catch=function(t){return this._getPromise().catch(t)};Z.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Z.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):o.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var s=(this.values||[]).map(hr.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,s,r)}return t.native.prepare(this.name,this.text,s.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,s,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var n=this.values.map(hr.prepareValue);t.native.query(this.text,n,r)}else t.native.query(this.text,r)}});var pn=d((Bp,ln)=>{"use strict";var on;try{on=require("pg-native")}catch(t){throw t}var $o=st(),cn=require("events").EventEmitter,Yo=require("util"),zo=ot(),un=an(),N=ln.exports=function(t){cn.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new $o(t.types),this.native=new on({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new zo(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};N.Query=un;Yo.inherits(N,cn);N.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};N.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(s,function(n){if(n)return e.native.end(),t(n);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};N.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(s=>{s?r(s):e()})})};N.prototype.query=function(t,e,r){var s,n,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,n=s=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,s=new un(t,e,r),!s.callback){let l,u;n=new this._Promise((p,h)=>{l=p,u=h}).catch(p=>{throw Error.captureStackTrace(p),p}),s.callback=(p,h)=>p?u(p):l(h)}return a&&(c=s.callback,o=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),c(l),s.callback=()=>{};var u=this._queryQueue.indexOf(s);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),s.callback=(l,u)=>{clearTimeout(o),c(l,u)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};N.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(s,n){t=i(a=>a?n(a):s(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};N.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};N.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};N.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};N.prototype.ref=function(){};N.prototype.unref=function(){};N.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};N.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var dr=d((Gp,hn)=>{"use strict";hn.exports=pn()});var pr=d((Qp,he)=>{"use strict";var Jo=Zs(),Zo=ce(),Xo=er(),ec=rn(),{DatabaseError:tc}=zt(),{escapeIdentifier:rc,escapeLiteral:sc}=ue(),nc=i(t=>{var e;return e=class extends ec{constructor(s){super(s,t)}},i(e,"BoundPool"),e},"poolFactory"),fr=i(function(t){this.defaults=Zo,this.Client=t,this.Query=this.Client.Query,this.Pool=nc(this.Client),this._pools=[],this.Connection=Xo,this.types=oe(),this.DatabaseError=tc,this.escapeIdentifier=rc,this.escapeLiteral=sc},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?he.exports=new fr(dr()):(he.exports=new fr(Jo),Object.defineProperty(he.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new fr(dr())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(he.exports,"native",{value:t}),t}}))});var fn=d((jp,dn)=>{"use strict";var X=require("fs"),ic=pr(),ac="The server does not support SSL connections",oc="28000",cc=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let s={checkServerIdentity(n,a){e.info("Certificate",{hostname:n,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return X.existsSync(t.certAuthority)&&(s.ca=X.readFileSync(t.certAuthority).toString()),X.existsSync(t.clientCert)&&(s.cert=X.readFileSync(t.clientCert).toString()),X.existsSync(t.clientPrivateKey)&&(s.key=X.readFileSync(t.clientPrivateKey).toString()),s},"getSslOptions"),uc=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),lc=i(async(t,e,r)=>{let s=!1;if(t.ssh){let{options:o}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...o},s=!0}t=Object.assign({},t,{sslType:uc(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:cc(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType};return{client:await mr(n,r),isSshTunnel:s}},"createClient"),pc=i((t,e,r)=>{var s;if(r.message===ac&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),mr({...t,isRetry:!0,ssl:!1},e);if(((s=r.code)==null?void 0:s.toString())===oc&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),mr({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),mr=i((t,e)=>{let r=new ic.Pool(t);return r.connect().then(s=>(s.release(),r)).catch(async s=>{if(await r.end(),t.isRetry)throw s;return pc(t,e,s)})},"createConnectionPool");dn.exports={createClient:lc}});var _r=d((Wp,yn)=>{"use strict";var mn=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),_n={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
		SELECT tables.table_name, tables.table_type
		FROM information_schema.tables AS tables
		INNER JOIN (
			SELECT pg_class.relname AS table_name,
				   pg_namespace.nspname AS table_schema
			FROM pg_catalog.pg_class AS pg_class
				INNER JOIN pg_catalog.pg_namespace AS pg_namespace
				ON (pg_namespace.oid = pg_class.relnamespace)
			WHERE (pg_class.relispartition = false OR pg_class.relispartition IS NULL) AND pg_class.relkind = ANY ('{"r","v","t","m","p"}')
		) AS catalog_table_data
		ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
		WHERE tables.table_schema = $1;
	`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1, $2)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_SAMPLED_DATA_SIZE:(t,e)=>`
        SELECT sum(pg_column_size(_hackolade_tmp_sampling_tbl.*)) AS _hackolade_tmp_sampling_tbl_size 
        FROM (SELECT ${e} FROM ${t} LIMIT $1) AS _hackolade_tmp_sampling_tbl;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:`
    SELECT indexname,
           index_id,
           index_method,
           index_unique,
           number_of_keys,
           where_expression,
           array_agg(attname ORDER BY ord)::text[] AS columns,
           array_agg(coll ORDER BY ord) AS collations,
           array_agg(opclass ORDER BY ord) AS opclasses,
           array_agg(expression ORDER BY ord) AS expressions,
           array_agg(ascending ORDER BY ord) AS ascendings,
           array_agg(nulls_first ORDER BY ord) AS nulls_first,
           reloptions AS storage_parameters
    FROM (
        SELECT ct.oid AS table_oid,
            c.relname AS indexname,
            m.amname AS index_method,
            indexes.indisunique AS index_unique,
            indexes.ord,
            attribute.attname,
            c.reloptions,
            indexes.indnkeyatts AS number_of_keys,
            ti.index_id AS index_id,
            pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
            CASE
                WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
            END AS coll,
            CASE
                WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
            END AS opclass,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 1 = 1 THEN 'DESC' ELSE 'ASC'
        END AS ascending,
        CASE
            WHEN NOT m.amcanorder THEN ''
            WHEN indexes.indoption[indexes.ord - 1] & 2 = 2 THEN 'NULLS FIRST' ELSE 'NULLS LAST'
        END AS nulls_first,
        pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
        FROM
            (
                SELECT *,
                    generate_series(1,array_length(i.indkey,1)) AS ord,
                    unnest(i.indkey) AS key,
                    unnest(i.indcollation) AS coll,
                    unnest(i.indclass) AS class,
                    unnest(i.indoption) AS option
                FROM pg_catalog.pg_index i
            ) indexes
        JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
        JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
        JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
        LEFT JOIN pg_catalog.pg_attribute attribute
            ON (attribute.attrelid=indexes.indrelid AND attribute.attnum=indexes.key)
        LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
        LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
        LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
        LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
        INNER JOIN crdb_internal.table_indexes ti ON (
            indexes.indrelid = ti.descriptor_id
            AND c.relname = ti.index_name
        )
    ) s2
    WHERE table_oid = $1
    GROUP BY
        indexname,
        index_id,
        index_method,
        index_unique,
        reloptions,
        number_of_keys,
        where_expression;
    `,GET_TABLE_INDEX_PARTITIONING_DATA:`
        SELECT
            partitions.name AS partition_name,
            partitions.index_id,
            parent_name,
            column_names,
            list_value,
            range_value,
            index_name
        FROM crdb_internal.partitions
            INNER JOIN crdb_internal.table_indexes
                ON partitions.table_id = table_indexes.descriptor_id
                    AND partitions.index_id = table_indexes.index_id
        WHERE table_indexes.descriptor_id = $1;
    `,GET_TABLE_INDEX_CREATE_INFO:`
        SELECT index_name,
               is_sharded,
               is_visible,
               create_statement
        FROM crdb_internal.table_indexes WHERE descriptor_id = $1;
    `,GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:mn(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:mn(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND (
                (pg_type.typtype = 'c' AND (pg_class.relkind = 'c' OR pg_class.relkind IS NULL))
                OR pg_type.typtype = 'e'
                OR pg_type.typtype = 'r'
            )
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;"},hc=i(t=>(Object.entries(_n).find(([r,s])=>t===s)||[])[0]||"Custom query","getQueryName");yn.exports={getQueryName:hc,..._n}});var En=d(($p,gn)=>{"use strict";var dc=_r(),Q=null,Pe=null;gn.exports={initializeClient(t,e){Q=t,Pe=e,Q.on("error",r=>e.error(r))},isClientInitialized(){return!!Q},releaseClient(){return Q?new Promise(t=>{Q.end(()=>{Q=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let s=dc.getQueryName(t);Pe.info("Execute query",{queryName:s,params:e});let n=Date.now(),a=await Q.query(t,e),o=Date.now()-n;Pe.info("Query executed",{queryName:s,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(s){return s.query=t,s.params=e,Pe.error(s),null}}}});var bn=d((Yp,Tn)=>{"use strict";var Sn=i(t=>{let e=t.reduce((s,n)=>n.properties?{...s,[n.name]:{...n,...Sn(n.properties)}}:{...s,[n.name]:n},{}),r=Object.entries(e).filter(([s,n])=>n.required).map(([s])=>s);return{properties:e,required:r}},"getJsonSchema");Tn.exports={getJsonSchema:Sn}});var Er=d((Jp,wn)=>{"use strict";var H=null,fc=i(t=>{H=t.require("lodash")},"setDependencies"),yr={column_default:"default",is_nullable:{keyword:"required",map:(t,e,r)=>({YES:!1,NO:!0})[r]},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e,r)=>r!==-1&&wc(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:{keyword:"length",map:(t,e,r)=>Number(r)},description:"description"},mc=i((t,e,r)=>{let s=yr[e];if(!s||typeof s=="string")return r;let n=s.check||((c,l,u)=>!0),a=s.map||((c,l,u)=>u),o="";return n(t,e,r)&&(o=r),a(t,e,o)},"getColumnValue"),_c=i(t=>e=>H.chain(e).toPairs().map(([r,s])=>{var n;return[((n=yr[r])==null?void 0:n.keyword)||yr[r],mc(e,r,s)]}).filter(([r,s])=>r&&!H.isNil(s)).fromPairs().thru(yc(t)).value(),"mapColumnData"),yc=i(t=>e=>({...e,...gc(t,e)}),"setColumnType"),gc=i((t,e)=>e.type==="ARRAY"?Ec(t,e):e.type==="USER-DEFINED"?gr(t,e.udt_name):gr(t,e.type),"getType"),Ec=i((t,e)=>({...gr(t,e.udt_name.slice(1)),array_type:H.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),gr=i((t,e)=>{switch(e){case"bigserial":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"numeric":case"dec":case"decimal":return{type:"numeric",mode:"decimal"};case"int2":case"smallint":return{type:"numeric",mode:"int2"};case"int4":case"integer":return{type:"numeric",mode:"int4"};case"int":case"int8":case"int64":case"bigint":return{type:"numeric",mode:"int"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return H.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Sc=i((t,e)=>{let r=H.first(e)||{};return t.map(s=>{if(s.type!=="json")return s;let n=r[s.name],a=Tc(n),o=bc(a);return{...s,subtype:o}})},"setSubtypeFromSampledJsonValues"),Tc=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),bc=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),wc=i(t=>H.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");wn.exports={setDependencies:fc,mapColumnData:_c,setSubtypeFromSampledJsonValues:Sc}});var de=d((Xp,An)=>{"use strict";var Ac=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],ee=null,vc=i(t=>{ee=t.require("lodash")},"setDependencies"),Cc=i(t=>ee.chain(t).toPairs().reject(([e,r])=>ee.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Rc=i(t=>e=>{var r;return(r=ee.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Ic=i(t=>/\s|\W/.test(t)||ee.includes(Ac,ee.toUpper(t))?`"${t}"`:t,"wrapInQuotes");An.exports={clearEmptyPropertiesInObject:Cc,setDependencies:vc,getColumnNameByPosition:Rc,wrapInQuotes:Ic}});var Rn=d((th,Cn)=>{"use strict";var{getColumnNameByPosition:Oc}=de(),Sr=null,Nc=i(t=>{Sr=t.require("lodash")},"setDependencies"),vn=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),xc=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";default:return""}},"prepareMatch"),Pc=i((t,e,r,s)=>Sr.map(t,n=>({relationshipName:n.relationship_name,dbName:n.foreign_table_schema,parentCollection:n.foreign_table_name,parentField:n.foreign_columns,childDbName:r,childCollection:e,childField:Sr.map(n.table_columns_positions,Oc(s)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:vn(n.relationship_on_delete),relationshipOnUpdate:vn(n.relationship_on_update),relationshipMatch:xc(n.relationship_match)}})),"prepareForeignKeys");Cn.exports={setDependencies:Nc,prepareForeignKeys:Pc}});var Nn=d((sh,On)=>{"use strict";var Le=null,Lc=i(t=>{Le=t.require("lodash")},"setDependencies"),In=i(t=>Le.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Mc(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Mc=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),qc=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),Dc=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Fc=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),kc=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:In(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:Le.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:qc(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Fc(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:Dc(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Bc=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:Le.toLower(t.external_language),inputArgs:In(e),body:t.routine_definition}),"mapProcedureData");On.exports={setDependencies:Lc,mapFunctionData:kc,mapProcedureData:Bc}});var Mn=d((ih,Ln)=>{"use strict";var Uc=i(t=>e=>{if(!e)return null;let r=Qc(e),s=Hc(t)(e),n=jc(e);return[{partitionMethod:r,compositePartitionKey:s,partitioning_expression:n}]},"preparePartition"),Tr=i((t={})=>t.list_value?"LIST":t.range_value?"RANGE":"","getPartitionMethodByRow"),xn=i((t=[])=>t.filter(e=>!e.parent_name),"getParentPartitionRows"),Gc=i((t=[],e=null)=>t.filter(r=>r.parent_name===e),"getChildPartitionRows"),Qc=i((t=[])=>{let e=xn(t);if(!e.length)return"";let r=e[0];return Tr(r)},"getPartitionMethod"),Hc=i(t=>(e=[])=>{let s=e.filter(n=>!n.parent_name).flatMap(n=>(n.column_names||"").split(",").map(o=>o.trim()));return t.uniq(s)},"getCompositePartitionKey"),jc=i(t=>{let e=xn(t);if(!e.length)return"";let r=e[0],s=Tr(r),n=r.column_names||"",a=e.map(o=>Pn({partition:o,paddingFactor:1,partitionResult:t})).join(`,
`);return`PARTITION BY ${s} (${n}) (
${a}
)`},"getPartitionExpression"),Pn=i(({partition:t,partitionResult:e,paddingFactor:r})=>{let s=t.list_value?"VALUES IN":"VALUES FROM",n=t.list_value||t.range_value||"",a="	".repeat(r),o=`${a}PARTITION ${t.partition_name} ${s} ${n}`,c=Gc(e,t.partition_name);if(c.length){let l=c.map(m=>Pn({partition:m,partitionResult:e,paddingFactor:r+1})).join(`,
`),u=c[0],p=Tr(u),h=u.column_names||"";return o+` PARTITION BY ${p} (${h}) (
`+l+`
`+a+")"}return o},"getSinglePartitionExpression");Ln.exports={preparePartition:Uc}});var Bn=d((oh,kn)=>{"use strict";var{clearEmptyPropertiesInObject:Me,getColumnNameByPosition:qn}=de(),{preparePartition:Vc}=Mn(),g=null,Wc=i(t=>{g=t.require("lodash")},"setDependencies"),Kc=i(t=>{let e={};for(let r of Object.keys(t))r.startsWith("ttl")?(e.ttl_storage_parameters||(e.ttl_storage_parameters={}),e.ttl_storage_parameters[r]=t[r]):e[r]=t[r];return e},"groupTtlStorageParams"),Dn=i((t,e)=>{if(!t&&!e)return null;let r=fu(t),s=Me(r),n=Kc(s);return Me(n)},"prepareStorageParameters"),br=i(t=>g.split(t,"="),"splitByEqualitySymbol"),$c=i(t=>g.find(t,{type:"json"}),"checkHaveJsonTypes"),Yc=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),zc=i((t,e,r)=>g.reduce(t,(s,n)=>{switch(n.constraint_type){case"c":return{...s,chkConstr:[...s.chkConstr,Xc(n)]};case"p":return{...s,primaryKey:[...s.primaryKey,Jc(n,e)]};case"u":return{...s,uniqueKey:[...s.uniqueKey,Zc(n,e)]};default:return s}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Jc=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:g.map(t.constraint_keys,qn(e)),indexStorageParameters:g.join(t.storage_parameters,",")}),"getPrimaryKeyConstraint"),Zc=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:g.map(t.constraint_keys,qn(e)),indexStorageParameters:g.join(t.storage_parameters,","),indexComment:t.description}),"getUniqueKeyConstraint"),Xc=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,notValid:t.notValid,constrDescription:t.description}),"getCheckConstraint"),eu=i((t,e=[])=>e.find(s=>s.index_name===t)||{}||{},"getIndexCreateInfoRowByName"),tu=i(t=>{switch(t.toUpperCase()){case"INVERTED":return"gin";case"PREFIX":return"btree";default:return t}},"parseIndexMethod"),ru=i((t,e)=>(t||[]).filter(r=>r.index_name===e.indexname&&r.index_id===e.index_id),"getIndexPartitioningRows"),su=i(({tableIndexesResult:t,tableIndexesCreateInfoResult:e=[],tableIndexesPartitioningResult:r})=>g.map(t,s=>{let n=eu(s.indexname,e),a=n.create_statement,o=cu(s,a),c=g.slice(o,0,s.number_of_keys),l=g.chain(o).slice(s.number_of_keys).map(x=>g.pick(x,"name")).value(),u=n.is_visible?"VISIBLE":"NOT VISIBLE",p=!!n.is_sharded,h=ru(r,s),b=(Vc(g)(h)||[{}])[0].partitioning_expression,I={indxName:s.indexname,index_method:tu(s.index_method),unique:s.index_unique??!1,index_storage_parameter:lu(s.storage_parameters,a),where:s.where_expression||"",partitioning_expression:b,include:l,columns:c,using_hash:p,visibility:u};return Me(I)}),"prepareTableIndexes"),nu=i(({createStatement:t,columnName:e})=>{let r=["(",","],s=0;for(;s<t.length;){let n=t.indexOf(e,s);if(n===-1)return-1;let a=t.charAt(n-1);if(t.charAt(n+e.length).match(/\s/)&&r.includes(a))return n;s=n+e.length}},"getIndexColumnDefinitionStart"),iu=i(({createStatement:t,columnDefinitionStart:e})=>{let r=t.substring(e),s=r.indexOf(","),n=r.indexOf(")");return s===-1?e+n:e+Math.min(s,n)},"getColumnDefinitionEnd"),au=i(({createStatement:t,columnName:e})=>{let r=nu({columnName:e,createStatement:t});if(r===-1)return"";let s=iu({columnDefinitionStart:r,createStatement:t});return s===-1?"":t.substring(r,s)},"getIndexColumnQueryDefinition"),ou=i(({indexData:t,itemIndex:e,columnName:r,createStatement:s})=>{let n=g.get(t,`opclasses.${e}`,"");if(n)return n;let a=au({columnName:r,createStatement:s});if(!a)return"";let o=a.substring(r.length).trim();return o?o.toUpperCase().replaceAll("ASC","").replaceAll("DESC","").replaceAll("NULLS FIRST","").replaceAll("NULLS LAST","").toLowerCase().trim():""},"getIndexColumnOpClass"),cu=i((t,e)=>g.chain(t.columns).map((r,s)=>{if(!r)return;let n=g.get(t,`ascendings.${s}`,"ASC"),a=g.get(t,`nulls_first.${s}`,"NULLS FIRST"),o=ou({columnName:r,createStatement:e,itemIndex:s,indexData:t}),c=g.get(t,`collations.${s}`,"");return{name:r,sortOrder:n,nullsOrder:a,opclass:o,collation:c}}).compact().value(),"mapIndexColumns"),Fn=i(t=>{let e={fillfactor:t.fillfactor,bucket_count:t.bucket_count,geometry_max_x:t.geometry_max_x,geometry_max_y:t.geometry_max_y,geometry_min_x:t.geometry_min_x,geometry_min_y:t.geometry_min_y,s2_level_mod:t.s2_level_mod,s2_max_cells:t.s2_max_cells,s2_max_level:t.s2_max_level};return Me(e)},"hydrateIndexStorageParameters"),uu=i(t=>{let e=/\s+with\s+\(.*?\)/im,r=t.match(e);if(!(r!=null&&r.length))return null;let s=r[0],n=7,a=s.length-1,o=s.substring(n,a).split(",").map(l=>l.trim()),c=g.fromPairs(g.map(o,l=>br(l)));return Fn(c)},"parseIndexStorageParametersFromDdl"),lu=i((t,e)=>{if(!t)return uu(e);let r=g.fromPairs(g.map(t,s=>br(s)));return Fn(r)},"getIndexStorageParameters"),pu=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",s=(t==null?void 0:t.relpersistence)==="u",n=Dn(t==null?void 0:t.reloptions,e),a=t.partition_expr;return{temporary:r,unlogged:s,storage_parameter:n,partitionBounds:a}},"prepareTableLevelData"),hu=i(t=>{switch(du(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),du=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),fu=i(t=>g.chain(t).map(br).map(([e,r])=>[e,hu(r)]).fromPairs().value()||{},"prepareOptions"),mu=i((t,e)=>g.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");kn.exports={prepareStorageParameters:Dn,setDependencies:Wc,checkHaveJsonTypes:$c,prepareTableConstraints:zc,prepareTableLevelData:pu,prepareTableIndexes:su,getSampleDocSize:Yc,prepareTableInheritance:mu}});var Gn=d((uh,Un)=>{"use strict";var{mapColumnData:_u}=Er(),wr=null,yu=i(t=>{wr=t.require("lodash")},"setDependencies"),gu=i(t=>wr.chain(t).map(e=>{switch(e.type){case"e":return Eu(e);case"r":return Su(e);case"c":return Tu(e);default:return null}}).compact().value(),"getUserDefinedTypes"),Eu=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Su=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Tu=i(t=>{let e=wr.map(t.columns,_u([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),bu=i(t=>t.type==="c","isTypeComposite");Un.exports={setDependencies:yu,getUserDefinedTypes:gu,isTypeComposite:bu}});var Hn=d((ph,Qn)=>{"use strict";var{clearEmptyPropertiesInObject:wu,wrapInQuotes:Au}=de(),F=null,vu=i(t=>{F=t.require("lodash")},"setDependencies"),Ar=" (v)",Cu=i(t=>t==="VIEW","isViewByTableType"),Ru=i(t=>F.endsWith(t,Ar),"isViewByName"),Iu=i(t=>t.slice(0,-Ar.length),"removeViewNameSuffix"),Ou=i(t=>`${t}${Ar}`,"setViewSuffix"),Nu=i((t,e,r={})=>{let s=F.trim(e.view_definition||r.definition||"");return s?`CREATE VIEW ${Au(t)} AS ${s}`:""},"generateCreateViewScript"),xu=i((t,e)=>{let r={withCheckOption:t.check_option!=="NONE"||F.isNil(t.check_option),checkTestingScope:Pu(t.check_option),viewOptions:F.fromPairs(F.map(e==null?void 0:e.view_options,Mu)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Lu(t),description:e==null?void 0:e.description};return wu(r)},"prepareViewData"),Pu=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Lu=i(t=>F.startsWith(F.trim(t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),Mu=i(t=>F.split(t,"="),"splitByEqualitySymbol");Qn.exports={setDependencies:vu,isViewByTableType:Cu,isViewByName:Ru,removeViewNameSuffix:Iu,generateCreateViewScript:Nu,setViewSuffix:Ou,prepareViewData:xu}});var Wn=d((dh,Vn)=>{"use strict";var qu=i((t,e)=>[Du,Fu].reduce(({attributes:r,entityLevel:s},n)=>n(r,s),{attributes:t,entityLevel:e}),"reorganizeConstraints"),Du=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let s=e.primaryKey[0],n=s.compositePrimaryKey[0];return{attributes:ku(t,n,s),entityLevel:Qu(e)}},"reorganizePrimaryKeys"),Fu=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:s},n)=>{if(!(n.compositeUniqueKey.length===1))return{attributes:r,entityLevel:s};let o=n.compositeUniqueKey[0];return{attributes:Uu(r,o,n),entityLevel:Hu(s,n)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),ku=i((t,e,r)=>t.map(s=>s.name!==e?s:Bu(s,r)),"setAttributesPrimaryKeyData"),Bu=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:jn(e)}),"setPrimaryKeyData"),Uu=i((t,e,r)=>t.map(s=>s.name!==e?s:Gu(s,r)),"setAttributesUniqueKeyData"),Gu=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:jn(e)}),"setUniqueKeyData"),jn=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexComment:t.indexComment}],"getOptions"),Qu=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Hu=i((t,e)=>{let r=t.uniqueKey.filter(s=>s.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Vn.exports={reorganizeConstraints:qu}});var Jn=d((mh,zn)=>{"use strict";var{createClient:ju}=fn(),_=En(),{getJsonSchema:Kn}=bn(),{setDependencies:Vu,mapColumnData:Wu,setSubtypeFromSampledJsonValues:Ku}=Er(),{setDependencies:$u,clearEmptyPropertiesInObject:$n}=de(),{setDependencies:Yu,prepareForeignKeys:zu}=Rn(),{setDependencies:Ju,mapFunctionData:Zu,mapProcedureData:Xu}=Nn(),{setDependencies:el,checkHaveJsonTypes:tl,prepareTableConstraints:rl,getSampleDocSize:sl,prepareTableLevelData:nl,prepareTableIndexes:il}=Bn(),{setDependencies:al,getUserDefinedTypes:ol,isTypeComposite:cl}=Gn(),{setDependencies:ul,isViewByTableType:ll,isViewByName:pl,removeViewNameSuffix:hl,generateCreateViewScript:dl,setViewSuffix:fl,prepareViewData:ml}=Hn(),y=_r(),{reorganizeConstraints:_l}=Wn(),vr=!1,A=null,M=null,Yn=14;zn.exports={setDependencies(t){A=t.require("lodash"),$u(t),el(t),Vu(t),Yu(t),ul(t),Ju(t),al(t)},async connect(t,e,r){_.isClientInitialized()&&await this.disconnect(e);let{client:s,isSshTunnel:n}=await ju(t,e,r);_.initializeClient(s,r),vr=n,M=r,Yn=await this._getServerVersion()},async disconnect(t){vr&&(await t.closeConsumer(),vr=!1),await _.releaseClient()},pingDb(){return _.query(y.PING)},applyScript(t){return _.query(t)},async getDatabaseNames(){return A.map(await _.query(y.GET_DATABASES),"database_name")},async logVersion(){let t=await _.queryTolerant(y.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved"},async getAllSchemasNames(){return(await _.query(y.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!yl(e))},async getTablesNames(t){let e=await _.query(y.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:s})=>!A.includes(r,s)).map(({table_name:s,table_type:n})=>ll(n)?fl(s):s)},async getDbLevelData(){var s,n,a;M.progress("Get database data");let t=(s=await _.queryTolerant(y.GET_DB_NAME,[],!0))==null?void 0:s.current_database,e=(n=await _.queryTolerant(y.GET_DB_ENCODING,[],!0))==null?void 0:n.server_encoding,r=(a=await _.queryTolerant(y.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return $n({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r){let s=await this._retrieveUserDefinedTypes(t),n=await _.queryTolerant(y.GET_NAMESPACE_OID,[t],!0),a=n==null?void 0:n.oid,[o,c]=A.partition(e,pl),l=c.map(h=>({tableName:h})),u=await fe(A.uniq(l),A.bind(this._retrieveSingleTableData,this,r,a,t,s));return{views:await fe(o,A.bind(this._retrieveSingleViewData,this,a,t)),tables:u,modelDefinitions:Kn(s)}},async retrieveSchemaLevelData(t,e){var u;if(e)return M.info("Functions and procedures ignored"),{functions:[],procedures:[]};M.progress("Get Functions and Procedures",t);let r=(u=await _.queryTolerant(y.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,s=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES,[t]),n=await _.queryTolerant(gl(Yn),[r]),[a,o]=A.partition(A.filter(s,"routine_type"),{routine_type:"FUNCTION"}),c=await fe(a,async p=>{let h=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),m=A.find(n,{function_name:p.name});return Zu(p,h,m)}),l=await fe(o,async p=>{let h=await _.queryTolerant(y.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[p.specific_name]),m=A.find(n,{function_name:p.name});return Xu(p,h,m)});return{functions:c,procedures:l}},async _retrieveUserDefinedTypes(t){M.progress("Get User-Defined Types",t);let e=await _.queryTolerant(y.GET_USER_DEFINED_TYPES,[t]),r=await fe(e,async s=>cl(s)?{...s,columns:await _.queryTolerant(y.GET_COMPOSITE_TYPE_COLUMNS,[s.pg_class_oid])}:s);return ol(r)},async _retrieveSingleTableData(t,e,r,s,{tableName:n}){M.progress("Get table data",r,n);let a=await _.queryTolerant(y.GET_TABLE_LEVEL_DATA,[n,e],!0),o=a==null?void 0:a.oid,c=await _.queryTolerant(y.GET_TABLE_TOAST_OPTIONS,[n,e],!0),l=await this._getTableColumns(n,r,o),p=await _.queryTolerant(y.GET_DESCRIPTION_BY_OID,[o,"pg_class"],!0),h=await _.queryTolerant(y.GET_TABLE_CONSTRAINTS,[o]),m=await _.queryTolerant(y.GET_TABLE_INDEXES,[o]),b=await _.queryTolerant(y.GET_TABLE_INDEX_PARTITIONING_DATA,[o]),I=await _.queryTolerant(y.GET_TABLE_INDEX_CREATE_INFO,[o]),x=await _.queryTolerant(y.GET_TABLE_FOREIGN_KEYS,[o]);M.info("Table data retrieved",{schemaName:r,tableName:n,columnTypes:l.map(ti=>ti.data_type)});let k=nl(a,c),De=El(p),Fe=rl(h,l,m),ke=il({tableIndexesResult:m,tableIndexesCreateInfoResult:I,tableIndexesPartitioningResult:b}),Be=zu(x,n,r,l),me={description:De,Indxs:ke,...k,...Fe},q=$n(me),te=l.map(Wu(s)),Zn=tl(te),Ue=[];Zn&&(Ue=await this._getDocuments(r,n,te,t),te=Ku(te,Ue));let{attributes:Xn,entityLevel:ei}=_l(te,q);return{name:n,entityLevel:ei,jsonSchema:Kn(Xn),documents:Ue,relationships:Be}},async _getTableColumns(t,e,r){M.progress("Get columns",e,t);let s=await _.query(y.GET_TABLE_COLUMNS,[t,e]),n=await _.queryTolerant(y.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return A.map(s,a=>({...a,ordinal_position:Number(a.ordinal_position),...A.find(n,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,s){var p;M.progress("Sampling table",t,e);let n=`${t}.${e}`,a=((p=await _.queryTolerant(y.GET_ROWS_COUNT(n),[],!0))==null?void 0:p.quantity)||0,o=sl(a,s),c=r.filter(({type:h})=>A.includes(["json","jsonb"],h)),l=A.map(c,"name").join(", "),u=await _.queryTolerant(y.GET_SAMPLED_DATA_SIZE(n,l),[o],!0);return M.info("Sampling table",{tableName:e,jsonColumnsNumber:c.length,samplingDataSize:u==null?void 0:u._hackolade_tmp_sampling_tbl_size}),await _.queryTolerant(y.GET_SAMPLED_DATA(n,l),[o])},async _retrieveSingleViewData(t,e,r){M.progress("Get view data",e,r),r=hl(r);let s=await _.query(y.GET_VIEW_DATA,[r,e],!0),n=!s.view_definition&&await _.queryTolerant(y.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),a=await _.queryTolerant(y.GET_VIEW_OPTIONS,[r,t],!0),o=dl(r,s,n),c=ml(s,a);return o?{name:r,data:c,ddl:{script:o,type:"postgres"}}:(M.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:c,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await _.queryTolerant(y.GET_VERSION_AS_NUM,[],!0),e=A.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var yl=i(t=>!!(A.startsWith(t,"pg_")||A.includes(["information_schema"],t)),"isSystemSchema"),gl=i(t=>t===10?y.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:y.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),El=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),fe=i((t,e)=>Promise.all(A.map(t,e)),"mapPromises")});var{createLogger:qe}=Ir(),w=Jn();module.exports={async disconnect(t,e,r,s){let n=s.require("@hackolade/ssh-service");await w.disconnect(n),r()},async testConnection(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{Cr("Test connection",t,e);let a=qe({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(s),await w.connect(t,n,a),await w.pingDb(),await w.logVersion(),r()}catch(a){e.log("error",j(a),"Test connection instance log"),r(j(a))}finally{await w.disconnect(n)}},async getDatabases(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{Cr("Get databases",t,e);let a=qe({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(s),await w.connect(t,n,a),await w.logVersion();let o=await w.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(a){return e.log("error",a),r(j(a))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{Cr("Get DB table names",t,e);let a=qe({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});w.setDependencies(s),await w.connect(t,n,a),await w.logVersion();let c=await(await w.getAllSchemasNames()).reduce(async(l,u)=>{let p=await l;try{let h=await w.getTablesNames(u);return p.concat({dbName:u,dbCollections:h,isEmpty:h.length===0})}catch(h){return a.info(`Error reading database "${u}"`),a.error(h),p.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(a){e.log("error",j(a),"Get DB collections names"),r(j(a)),await w.disconnect(n)}},async getDbCollectionsData(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let a=qe({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});a.progress("Start reverse engineering...");let o=t.collectionData.collections,c=t.collectionData.dataBaseNames,l=await w.getDbLevelData(),{packages:u,relationships:p}=await Promise.all(c.map(async h=>{let{tables:m,views:b,modelDefinitions:I}=await w.retrieveEntitiesData(h,o[h],t.recordSamplingSettings),{functions:x,procedures:k}=await w.retrieveSchemaLevelData(h,t.ignoreUdfUdpTriggers);return a.progress("Schema data fetched successfully",h),{schemaName:h,tables:m,views:b,functions:x,procedures:k,modelDefinitions:I}})).then(h=>{let m=h.flatMap(({tables:I})=>I.map(x=>x.relationships)).flat();return{packages:h.flatMap(({schemaName:I,tables:x,views:k,functions:De,procedures:Fe,modelDefinitions:ke})=>{let Be={UDFs:De,Procedures:Fe},me=x.map(q=>({dbName:I,collectionName:q.name,documents:q.documents,views:[],emptyBucket:!1,entityLevel:q.entityLevel,validation:{jsonSchema:q.jsonSchema},bucketInfo:Be,modelDefinitions:ke})).sort(q=>s.require("lodash").isEmpty(q.entityLevel.inherits)?-1:1);if(k!=null&&k.length){let q={dbName:I,views:k,emptyBucket:!1};return[...me,q]}return me}),relationships:m}}).then(({packages:h,relationships:m})=>({packages:Sl(h),relationships:m}));a.info("The data is processed and sent to the application",{packagesLength:u==null?void 0:u.length,relationshipsLength:p==null?void 0:p.length}),r(null,u,l,p)}catch(a){e.log("error",j(a),"Retrieve tables data"),r(j(a))}finally{await w.disconnect(n)}}};var j=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Cr=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),Sl=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages");
